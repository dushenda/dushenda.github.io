<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"dushenda.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-tomorrow"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:type" content="website">
<meta property="og:title" content="dushenda">
<meta property="og:url" content="https://dushenda.github.io/index.html">
<meta property="og:site_name" content="dushenda">
<meta property="og:description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dushenda">
<meta property="article:tag" content="代码、科研、计算机系统">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dushenda.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>dushenda</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","per_page":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">dushenda</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">李德胜大大粉丝</p>
      <img class="custom-logo-image" src="/uploads/icons8-star-trek-80.svg" alt="dushenda">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dushenda"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">dushenda</p>
  <div class="site-description" itemprop="description">雄关漫道真如铁，而今迈步从头越</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dushenda" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-github-alt fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/dushenda" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/Linux%20Debug/ftrace%E6%8A%80%E6%9C%AF-%E9%9D%99%E6%80%81%E8%B7%9F%E8%B8%AA%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/Linux%20Debug/ftrace%E6%8A%80%E6%9C%AF-%E9%9D%99%E6%80%81%E8%B7%9F%E8%B8%AA%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">ftrace技术-静态跟踪（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>Ftrace 是一款内部跟踪器，旨在帮助系统开发人员和设计人员了解内核内部的运行情况。它可用于调试或分析用户空间之外发生的延迟和性能问题。</p>
<h2 id="Debugfs-文件结构"><a href="#Debugfs-文件结构" class="headerlink" title="Debugfs 文件结构"></a>Debugfs 文件结构</h2><p>Ftrace 使用 debugfs 文件系统来保存控制文件以及用于显示输出的文件。</p>
<p>当 debugfs 配置到内核中时（选择任何 ftrace 选项都会执行此操作），将创建目录 &#x2F;sys&#x2F;kernel&#x2F;debug。要挂载此目录，可以将其添加到 &#x2F;etc&#x2F;fstab 文件中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/fstab</span></span><br><span class="line">debugfs /sys/kernel/debug debugfs default 0 0</span><br></pre></td></tr></table></figure>
<p>或者，也可以在运行时使用以下命令挂载它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t debugfs nodev /sys/kernel/debug</span><br></pre></td></tr></table></figure>
<p>为了更快地访问该目录，可以创建一个指向它的软链接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /sys/kernel/debug /debug</span><br></pre></td></tr></table></figure>
<h2 id="function跟踪"><a href="#function跟踪" class="headerlink" title="function跟踪"></a>function跟踪</h2><p>下表汇总了 <code>ftrace</code>最常用的操作命令，适用于直接操作 <code>/sys/kernel/debug/tracing</code>目录下的文件。</p>
<table>
<thead>
<tr>
<th>操作目的</th>
<th>命令示例</th>
<th>简要说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>查看可用跟踪器</strong>​</td>
<td><code>cat available_tracers</code></td>
<td>显示系统支持的所有跟踪器 。</td>
</tr>
<tr>
<td><strong>设置当前跟踪器</strong>​</td>
<td><code>echo function &gt; current_tracer</code></td>
<td>设置跟踪器，如 <code>function</code>，<code>function_graph</code>，<code>sched_switch</code>等 。</td>
</tr>
<tr>
<td><strong>开始&#x2F;停止跟踪</strong>​</td>
<td><code>echo 1 &gt; tracing_on</code>  <br><code>echo 0 &gt; tracing_on</code></td>
<td>控制跟踪的启动和停止 。</td>
</tr>
<tr>
<td><strong>查看跟踪结果</strong>​</td>
<td><code>cat trace</code></td>
<td>显示跟踪缓冲区的内容 。</td>
</tr>
<tr>
<td><strong>过滤跟踪函数</strong>​</td>
<td><code>echo sys_* &gt; set_ftrace_filter</code></td>
<td>只跟踪函数名匹配 <code>sys_*</code>的函数 。</td>
</tr>
<tr>
<td><strong>过滤跟踪进程</strong>​</td>
<td><code>echo 1234 &gt; set_ftrace_pid</code></td>
<td>只跟踪 PID 为 1234 的进程 。</td>
</tr>
<tr>
<td><strong>跟踪特定模块</strong>​</td>
<td><code>echo &#39;:mod:ext4&#39; &gt; set_ftrace_filter</code></td>
<td>只跟踪 <code>ext4</code>模块内的函数 。</td>
</tr>
<tr>
<td><strong>启用特定事件</strong>​</td>
<td><code>echo 1 &gt; events/sched/sched_switch/enable</code></td>
<td>启用 <code>sched_switch</code>调度事件 。</td>
</tr>
<tr>
<td><strong>清空跟踪缓冲区</strong>​</td>
<td><code>echo &gt; trace</code></td>
<td>清空当前跟踪缓冲区以便重新记录 。</td>
</tr>
</tbody></table>
<p>可通过调试文件系统启用函数跟踪器。确保已设置 ftrace_enabled；否则，此跟踪器将不执行任何操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">sysctl kernel.ftrace_enabled=1</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> <span class="keyword">function</span> &gt; current_tracer</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">usleep 1</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">cat</span> trace</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tracer: <span class="keyword">function</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#           TASK-PID   CPU#    TIMESTAMP  FUNCTION</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             | |      |          |         |</span></span><br><span class="line">            bash-4003  [00]   123.638713: finish_task_switch &lt;-schedule</span><br><span class="line">            bash-4003  [00]   123.638714: _spin_unlock_irq &lt;-finish_task_switch</span><br><span class="line">            bash-4003  [00]   123.638714: sub_preempt_count &lt;-_spin_unlock_irq</span><br><span class="line">            bash-4003  [00]   123.638715: hrtick_set &lt;-schedule</span><br><span class="line">            bash-4003  [00]   123.638715: _spin_lock_irqsave &lt;-hrtick_set</span><br><span class="line">            bash-4003  [00]   123.638716: add_preempt_count &lt;-_spin_lock_irqsave</span><br><span class="line">            bash-4003  [00]   123.638716: _spin_unlock_irqrestore &lt;-hrtick_set</span><br><span class="line">            bash-4003  [00]   123.638717: sub_preempt_count &lt;-_spin_unlock_irqrestore</span><br><span class="line">            bash-4003  [00]   123.638717: hrtick_clear &lt;-hrtick_set</span><br><span class="line">            bash-4003  [00]   123.638718: sub_preempt_count &lt;-schedule</span><br><span class="line">            bash-4003  [00]   123.638718: sub_preempt_count &lt;-preempt_schedule</span><br><span class="line">            bash-4003  [00]   123.638719: wait_for_completion &lt;-__stop_machine_run</span><br><span class="line">            bash-4003  [00]   123.638719: wait_for_common &lt;-wait_for_completion</span><br><span class="line">            bash-4003  [00]   123.638720: _spin_lock_irq &lt;-wait_for_common</span><br><span class="line">            bash-4003  [00]   123.638720: add_preempt_count &lt;-_spin_lock_irq</span><br><span class="line">[...]</span><br></pre></td></tr></table></figure>

<h2 id="irqoff跟踪"><a href="#irqoff跟踪" class="headerlink" title="irqoff跟踪"></a>irqoff跟踪</h2><p>当中断被关闭时，CPU 无法响应外部事件（如硬件中断），这会导致系统响应延迟。<code>irqsoff</code>跟踪器的工作原理是 ：</p>
<ul>
<li><strong>挂钩关键函数</strong>：它在 <code>local_irq_disable()</code>和 <code>local_irq_enable()</code>等关键函数中插入钩子。</li>
<li><strong>记录时间戳</strong>：当中断被关闭时开始计时，并在中断重新开启时停止计时。</li>
<li><strong>记录最大延迟</strong>：它会记录下中断关闭的最大时间，并将导致该延迟的调用路径信息保存下来，帮助开发者定位问题根源。</li>
</ul>
<p>当中断被禁用时，CPU 将无法响应任何其他外部事件（NMI 和 SMI 除外）。这会阻止定时器中断触发，或鼠标中断无法将新的鼠标事件告知内核。其结果是响应时间出现延迟。</p>
<p><code>irqsoff</code> 跟踪器会跟踪中断被禁用的时间。当达到新的最大延迟时，跟踪器会保存达到该延迟点之前的跟踪记录，以便每次达到新的最大值时，都会丢弃旧的跟踪记录并保存新的跟踪记录。<br>	<br>要重置最大值，请将 0 回显到 tracing_max_latency 中。以下是一个示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> irqsoff &gt; current_tracer</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; tracing_max_latency</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">ls</span> -ltr</span></span><br><span class="line"> [...]</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">cat</span> latency_trace</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tracer: irqsoff</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">	<span class="comment"># irqsoff latency trace v1.1.5 on 4.0.0</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--------------------------------------------------------------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">latency: 259 us, <span class="comment">#4/4, CPU#0 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:4)</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   -----------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   | task: ps-6143 (uid:0 <span class="built_in">nice</span>:0 policy:0 rt_prio:0)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">   -----------------</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> =&gt; started at: __lock_task_sighand</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> =&gt; ended at:   _raw_spin_unlock_irqrestore</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                 _------=&gt; CPU#</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">                / _-----=&gt; irqs-off</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               | / _----=&gt; need-resched</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               || / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               ||| / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               |||| /     delay</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> cmd     pid   ||||| <span class="keyword">time</span>  |   <span class="built_in">caller</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    \   /      |||||  \    |   /</span></span><br><span class="line">    ps-6143    0d.h1    0us+: _raw_spin_lock_irqsave &lt;-__lock_task_sighand</span><br><span class="line">    ps-6143    0d.h.  259us : _raw_spin_unlock_irqrestore &lt;-__lock_task_sighand</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>latency: 259 us</code></strong>：这是最重要的信息，表示本次跟踪中发现的最大中断关闭延迟为 259 微秒 。</li>
<li><strong><code>task: ps-6143</code></strong>：发生该延迟时正在执行的进程是 <code>ps</code>（PID 为 6143）。</li>
<li><strong><code>started at</code>和 <code>ended at</code></strong>：指出了中断关闭开始和结束的函数位置 。</li>
<li><strong><code>irqs-off</code></strong>：<code>d</code>表示中断被关闭 。</li>
<li><strong><code>delay</code>符号</strong>：输出中可能使用特殊符号（如 <code>!</code>表示大于100ms）来直观表示延迟大小。</li>
<li><strong>函数调用栈</strong>：在跟踪条目下方，通常会显示导致此次延迟的完整函数调用栈，这对于定位问题代码至关重要 。</li>
</ul>
<p>请注意，上面的示例中未设置 ftrace_enabled。如果我们设置了 ftrace_enabled，则会得到更大的输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tracer: irqsoff</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">irqsoff latency trace v1.1.5 on 2.6.26-rc8</span></span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line"> latency: 50 us, #101/101, CPU#0 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:2)</span><br><span class="line">    -----------------</span><br><span class="line">    | task: ls-4339 (uid:0 nice:0 policy:0 rt_prio:0)</span><br><span class="line">    -----------------</span><br><span class="line"> =&gt; started at: __alloc_pages_internal</span><br><span class="line"> =&gt; ended at:   __alloc_pages_internal</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               _------=&gt; CPU#</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">              / _-----=&gt; irqs-off</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             | / _----=&gt; need-resched</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             || / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             ||| / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||| /</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||||     delay</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> cmd     pid ||||| <span class="keyword">time</span>  |   <span class="built_in">caller</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    \   /    |||||   \   |   /</span></span><br><span class="line">      ls-4339  0...1    0us+: get_page_from_freelist (__alloc_pages_internal)</span><br><span class="line">      ls-4339  0d..1    3us : rmqueue_bulk (get_page_from_freelist)</span><br><span class="line">      ls-4339  0d..1    3us : _spin_lock (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..1    4us : add_preempt_count (_spin_lock)</span><br><span class="line">      ls-4339  0d..2    4us : __rmqueue (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..2    5us : __rmqueue_smallest (__rmqueue)</span><br><span class="line">      ls-4339  0d..2    5us : __mod_zone_page_state (__rmqueue_smallest)</span><br><span class="line">      ls-4339  0d..2    6us : __rmqueue (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..2    6us : __rmqueue_smallest (__rmqueue)</span><br><span class="line">      ls-4339  0d..2    7us : __mod_zone_page_state (__rmqueue_smallest)</span><br><span class="line">      ls-4339  0d..2    7us : __rmqueue (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..2    8us : __rmqueue_smallest (__rmqueue)</span><br><span class="line">[...]</span><br><span class="line">      ls-4339  0d..2   46us : __rmqueue_smallest (__rmqueue)</span><br><span class="line">      ls-4339  0d..2   47us : __mod_zone_page_state (__rmqueue_smallest)</span><br><span class="line">      ls-4339  0d..2   47us : __rmqueue (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..2   48us : __rmqueue_smallest (__rmqueue)</span><br><span class="line">      ls-4339  0d..2   48us : __mod_zone_page_state (__rmqueue_smallest)</span><br><span class="line">      ls-4339  0d..2   49us : _spin_unlock (rmqueue_bulk)</span><br><span class="line">      ls-4339  0d..2   49us : sub_preempt_count (_spin_unlock)</span><br><span class="line">      ls-4339  0d..1   50us : get_page_from_freelist (__alloc_pages_internal)</span><br><span class="line">      ls-4339  0d..2   51us : trace_hardirqs_on (__alloc_pages_internal)</span><br></pre></td></tr></table></figure>
<p>这里我们追踪到了 50 微秒的延迟。但我们也看到了这段时间内调用的所有函数。请注意，启用函数追踪会增加额外的开销。这种开销可能会延长延迟时间。尽管如此，这次追踪仍然提供了一些非常有用的调试信息。</p>
<h2 id="scdule-wakeup跟踪"><a href="#scdule-wakeup跟踪" class="headerlink" title="scdule wakeup跟踪"></a>scdule wakeup跟踪</h2><p>在实时环境中，了解最高优先级任务从被唤醒到执行所需的唤醒时间至关重要。这也被称为“调度延迟”。</p>
<p>实时环境关注的是最大延迟，也就是事件发生所需的最长延迟，而不是平均延迟。我们可以拥有一个速度非常快的调度器，它可能只是偶尔出现较大的延迟，但这并不适用于实时任务。唤醒跟踪器旨在记录实时任务的最大唤醒延迟。非实时任务不会被记录，因为跟踪器只记录一个最大延迟，而跟踪不可预测的非实时任务会覆盖实时任务的最大延迟。</p>
<p>由于此追踪器仅处理实时任务，因此我们将采用与之前追踪器略有不同的运行方式。我们不会执行“ls”命令，而是在“chrt”命令下运行“sleep 1”命令，这将改变任务的优先级。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> wakeup &gt; current_tracer</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; tracing_max_latency</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">echo</span> 1 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">chrt -f 5 <span class="built_in">sleep</span> 1</span></span><br><span class="line"><span class="meta prompt_">	 # </span><span class="language-bash"><span class="built_in">echo</span> 0 &gt; tracing_enabled</span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash"><span class="built_in">cat</span> latency_trace</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tracer: wakeup</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">wakeup latency trace v1.1.5 on 2.6.26-rc8</span></span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line"> latency: 4 us, #2/2, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:2)</span><br><span class="line">    -----------------</span><br><span class="line">    | task: sleep-4901 (uid:0 nice:0 policy:1 rt_prio:5)</span><br><span class="line">    -----------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               _------=&gt; CPU#</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">              / _-----=&gt; irqs-off</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             | / _----=&gt; need-resched</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             || / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             ||| / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||| /</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||||     delay</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> cmd     pid ||||| <span class="keyword">time</span>  |   <span class="built_in">caller</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    \   /    |||||   \   |   /</span></span><br><span class="line">  &lt;idle&gt;-0     1d.h4    0us+: try_to_wake_up (wake_up_process)</span><br><span class="line">  &lt;idle&gt;-0     1d..4    4us : schedule (cpu_idle)</span><br></pre></td></tr></table></figure>
<p>在空闲系统上运行此程序，我们发现任务切换仅耗时 4 微秒。请注意，由于调度中的跟踪标记位于实际“切换”之前，因此当记录的任务即将调度时，我们会停止跟踪。如果我们在调度程序末尾添加新的标记，则此情况可能会发生变化。</p>
<p>请注意，记录的任务是“sleep”，进程 ID 为 4901，其 rt_prio 为 5。此优先级为用户空间优先级，而非内核内部优先级。策略为：SCHED_FIFO 为 1，SCHED_RR 为 2。</p>
<p>使用 chrt -r 5 和 ftrace_enabled set 执行相同的操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tracer: wakeup</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">wakeup latency trace v1.1.5 on 2.6.26-rc8</span></span><br><span class="line">--------------------------------------------------------------------</span><br><span class="line"> latency: 50 us, #60/60, CPU#1 | (M:preempt VP:0, KP:0, SP:0 HP:0 #P:2)</span><br><span class="line">    -----------------</span><br><span class="line">    | task: sleep-4068 (uid:0 nice:0 policy:2 rt_prio:5)</span><br><span class="line">    -----------------</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">               _------=&gt; CPU#</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">              / _-----=&gt; irqs-off</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             | / _----=&gt; need-resched</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             || / _---=&gt; hardirq/softirq</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             ||| / _--=&gt; preempt-depth</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||| /</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">             |||||     delay</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> cmd     pid ||||| <span class="keyword">time</span>  |   <span class="built_in">caller</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    \   /    |||||   \   |   /</span></span><br><span class="line">ksoftirq-7     1d.H3    0us : try_to_wake_up (wake_up_process)</span><br><span class="line">ksoftirq-7     1d.H4    1us : sub_preempt_count (marker_probe_cb)</span><br><span class="line">ksoftirq-7     1d.H3    2us : check_preempt_wakeup (try_to_wake_up)</span><br><span class="line">ksoftirq-7     1d.H3    3us : update_curr (check_preempt_wakeup)</span><br><span class="line">ksoftirq-7     1d.H3    4us : calc_delta_mine (update_curr)</span><br><span class="line">ksoftirq-7     1d.H3    5us : __resched_task (check_preempt_wakeup)</span><br><span class="line">ksoftirq-7     1d.H3    6us : task_wake_up_rt (try_to_wake_up)</span><br><span class="line">ksoftirq-7     1d.H3    7us : _spin_unlock_irqrestore (try_to_wake_up)</span><br><span class="line">[...]</span><br><span class="line">ksoftirq-7     1d.H2   17us : irq_exit (smp_apic_timer_interrupt)</span><br><span class="line">ksoftirq-7     1d.H2   18us : sub_preempt_count (irq_exit)</span><br><span class="line">ksoftirq-7     1d.s3   19us : sub_preempt_count (irq_exit)</span><br><span class="line">ksoftirq-7     1..s2   20us : rcu_process_callbacks (__do_softirq)</span><br><span class="line">[...]</span><br><span class="line">ksoftirq-7     1..s2   26us : __rcu_process_callbacks (rcu_process_callbacks)</span><br><span class="line">ksoftirq-7     1d.s2   27us : _local_bh_enable (__do_softirq)</span><br><span class="line">ksoftirq-7     1d.s2   28us : sub_preempt_count (_local_bh_enable)</span><br><span class="line">ksoftirq-7     1.N.3   29us : sub_preempt_count (ksoftirqd)</span><br><span class="line">ksoftirq-7     1.N.2   30us : _cond_resched (ksoftirqd)</span><br><span class="line">ksoftirq-7     1.N.2   31us : __cond_resched (_cond_resched)</span><br><span class="line">ksoftirq-7     1.N.2   32us : add_preempt_count (__cond_resched)</span><br><span class="line">ksoftirq-7     1.N.2   33us : schedule (__cond_resched)</span><br><span class="line">ksoftirq-7     1.N.2   33us : add_preempt_count (schedule)</span><br><span class="line">ksoftirq-7     1.N.3   34us : hrtick_clear (schedule)</span><br><span class="line">ksoftirq-7     1dN.3   35us : _spin_lock (schedule)</span><br><span class="line">ksoftirq-7     1dN.3   36us : add_preempt_count (_spin_lock)</span><br><span class="line">ksoftirq-7     1d..4   37us : put_prev_task_fair (schedule)</span><br><span class="line">ksoftirq-7     1d..4   38us : update_curr (put_prev_task_fair)</span><br><span class="line">[...]</span><br><span class="line">ksoftirq-7     1d..5   47us : _spin_trylock (tracing_record_cmdline)</span><br><span class="line">ksoftirq-7     1d..5   48us : add_preempt_count (_spin_trylock)</span><br><span class="line">ksoftirq-7     1d..6   49us : _spin_unlock (tracing_record_cmdline)</span><br><span class="line">ksoftirq-7     1d..6   49us : sub_preempt_count (_spin_unlock)</span><br><span class="line">ksoftirq-7     1d..4   50us : schedule (__cond_resched)</span><br></pre></td></tr></table></figure>
<p>中断发生在 ksoftirqd 运行期间。该任务运行在 SCHED_OTHER 调度级别。为什么我们没有提前看到“N”被置位？这可能是 x86_32 架构和 4K 堆栈的一个无害 bug。在配置了 4K 堆栈的 x86_32 架构上，中断和软中断使用它们自己的堆栈运行。一些信息保存在任务堆栈的顶部（need_resched 和 preempt_count 都存储在那里）。NEED_RESCHED 位的设置直接作用于任务堆栈，但读取 NEED_RESCHED 位是通过查看当前堆栈完成的，在本例中，当前堆栈是硬中断的堆栈。这隐藏了 NEED_RESCHED 已被设置的事实。直到我们切换回任务分配的堆栈，才能看到“N”。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/TCP%E5%AD%A6%E4%B9%A0/TCP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/TCP%E5%AD%A6%E4%B9%A0/TCP%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">TCP报文格式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h1><h2 id="以太网物理帧"><a href="#以太网物理帧" class="headerlink" title="以太网物理帧"></a>以太网物理帧</h2><pre><code class="highlight mermaid">packet-beta
title 以太网物理层头
0-11: &quot;Inter Frame Gap（至少12Byte）&quot;
12-18: &quot;Preamble&quot;
19-20: &quot;FSD&quot;</code></pre>

<table>
<thead>
<tr>
<th>字段</th>
<th>长度</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>帧间隙</td>
<td>至少12字节</td>
<td>每个以太帧之间都要有帧间隙（Inter Frame Gap），即每发完一个帧后要等待一段时间才能再发另外一个帧，以便让帧接收者对接收的帧做必要的处理（如调整缓存的指针、更新计数、通知对报文进行处理等等）。在以太网标准中规定最小帧间隙是12个字节，其数据为全1。对于个别的接口，可减少到64(GE)或40比特(10GE)，其他的接口都不应该小于12字节。</td>
</tr>
<tr>
<td>前同步码</td>
<td>7字节</td>
<td>以太网标准中规定前导码为10101010 10101010 10101010 10101010 10101010 10101010 10101010（二进制），共7字节。</td>
</tr>
<tr>
<td>帧开始定界符</td>
<td>1字节</td>
<td>以太网标准中规定帧开始定界符为10101011（二进制），共1字节。</td>
</tr>
</tbody></table>
<h2 id="以太网帧头"><a href="#以太网帧头" class="headerlink" title="以太网帧头"></a>以太网帧头</h2><pre><code class="highlight mermaid">packet-beta
title Ethernet II
0-5: &quot;DMAC&quot;
6-11: &quot;SMAC&quot;
12-20: &quot;Data(46~1500)&quot;
21-24: &quot;FCS&quot;</code></pre>

<table>
<thead>
<tr>
<th>字段</th>
<th>长度</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>DMAC</td>
<td>6字节</td>
<td>目的MAC地址，IPv4为6字节，该字段标识帧的接收者。</td>
</tr>
<tr>
<td>SMAC</td>
<td>6字节</td>
<td>源MAC地址，IPv4为6字节，该字段标识帧的发送者。</td>
</tr>
<tr>
<td>Type</td>
<td>2字节</td>
<td>协议类型。<a target="_blank" rel="noopener" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100174722/ea0a043c#ethII_tab_3">表1-3</a>列出了链路直接封装的协议类型。</td>
</tr>
<tr>
<td>Data</td>
<td>46～1500字节</td>
<td>数据字段，标识帧的负载（可能包含填充位）。<br><br>数据字段的最小长度必须为46字节以保证帧长至少为64字节，这意味着传输1字节信息也必须使用46字节的数据字段。<br><br>如果填入该字段的信息少于46字节，该字段的其余部分也必须进行填充。数据字段的最大长度为1500字节。<br><br>以太帧的长度必须为整数字节，因此帧的负载长度不足整数字节，需插入填充字段以保证数据帧的长度为整数字节。</td>
</tr>
<tr>
<td>FCS</td>
<td>4字节</td>
<td>帧校验序列FCS（Frame Check Sequence）是为接收者提供判断是否传输错误的一种方法，如果发现错误，丢弃此帧。<br><br>FCS只是通用叫法，具体的FCS还可以细分多种校验方法。在以太帧中，FCS通常采用循环冗余码校验CRC（Cyclical Redundancy Check）。</td>
</tr>
</tbody></table>
<h2 id="TCP报文头"><a href="#TCP报文头" class="headerlink" title="TCP报文头"></a>TCP报文头</h2><pre><code class="highlight mermaid">packet-beta
title &quot;TCP Packet&quot;
0-15: &quot;Source Port&quot;
16-31: &quot;Destination Port&quot;
32-63: &quot;Sequence Number&quot;
64-95: &quot;Acknowledgment Number&quot;
96-99: &quot;Data Offset&quot;
100-105: &quot;Reserved&quot;
106: &quot;URG&quot;
107: &quot;ACK&quot;
108: &quot;PSH&quot;
109: &quot;RST&quot;
110: &quot;SYN&quot;
111: &quot;FIN&quot;
112-127: &quot;Window&quot;
128-143: &quot;Checksum&quot;
144-159: &quot;Urgent Pointer&quot;
160-191: &quot;(Options and Padding)&quot;
192-255: &quot;Data (&lt;=MSS)&quot;</code></pre>

<table>
<thead>
<tr>
<th>字段</th>
<th>长度</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Source Port</td>
<td>16比特</td>
<td>源端口，标识哪个应用程序发送。</td>
</tr>
<tr>
<td>Destination Port</td>
<td>16比特</td>
<td>目的端口，标识哪个应用程序接收。</td>
</tr>
<tr>
<td>Sequence Number</td>
<td>32比特</td>
<td>序号字段。TCP链接中传输的数据流中每个字节都编上一个序号。序号字段的值指的是本报文段所发送的数据的第一个字节的序号。</td>
</tr>
<tr>
<td>Acknowledgment Number</td>
<td>32比特</td>
<td>确认号，是期望收到对方的下一个报文段的数据的第1个字节的序号，即上次已成功接收到的数据字节序号加1。只有ACK标识为1，此字段有效。</td>
</tr>
<tr>
<td>Data Offset</td>
<td>4比特</td>
<td>数据偏移，即首部长度，指出TCP报文段的数据起始处距离TCP报文段的起始处有多远，以32比特（4字节）为计算单位。最多有60字节的首部，若无选项字段，正常为20字节。</td>
</tr>
<tr>
<td>Reserved</td>
<td>4比特</td>
<td>保留，必须填0。</td>
</tr>
<tr>
<td>CWR</td>
<td>1比特</td>
<td>拥塞窗口减少标识</td>
</tr>
<tr>
<td>ECE</td>
<td>1比特</td>
<td>ECN回声标识</td>
</tr>
<tr>
<td>URG</td>
<td>1比特</td>
<td>紧急指针有效标识。它告诉系统此报文段中有紧急数据，应尽快传送（相当于高优先级的数据）。</td>
</tr>
<tr>
<td>ACK</td>
<td>1比特</td>
<td>确认序号有效标识。只有当ACK&#x3D;1时确认号字段才有效。当ACK&#x3D;0时，确认号无效。</td>
</tr>
<tr>
<td>PSH</td>
<td>1比特</td>
<td>标识接收方应该尽快将这个报文段交给应用层。接收到PSH &#x3D; 1的TCP报文段，应尽快的交付接收应用进程，而不再等待整个缓存都填满了后再向上交付。</td>
</tr>
<tr>
<td>RST</td>
<td>1比特</td>
<td>重建连接标识。当RST&#x3D;1时，表明TCP连接中出现严重错误（如由于主机崩溃或其他原因），必须释放连接，然后再重新建立连接。</td>
</tr>
<tr>
<td>SYN</td>
<td>1比特</td>
<td>同步序号标识，用来发起一个连接。SYN&#x3D;1表示这是一个连接请求或连接接受请求。</td>
</tr>
<tr>
<td>FIN</td>
<td>1比特</td>
<td>发端完成发送任务标识。用来释放一个连接。FIN&#x3D;1表明此报文段的发送端的数据已经发送完毕，并要求释放连接。</td>
</tr>
<tr>
<td>Window</td>
<td>16比特</td>
<td>窗口：TCP的流量控制，窗口起始于确认序号字段指明的值，这个值是接收端期望接收的字节数。窗口最大为65535字节。</td>
</tr>
<tr>
<td>Checksum</td>
<td>16比特</td>
<td>校验字段，包括TCP首部和TCP数据，是一个强制性的字段，一定是由发端计算和存储，并由收端进行验证。在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。</td>
</tr>
<tr>
<td>Urgent Pointer</td>
<td>16比特</td>
<td>紧急指针，只有当URG标志置1时紧急指针才有效。TCP的紧急方式是发送端向另一端发送紧急数据的一种方式。紧急指针指出在本报文段中紧急数据共有多少个字节（紧急数据放在本报文段数据的最前面）。</td>
</tr>
<tr>
<td>Options</td>
<td>可变</td>
<td>选项字段。TCP协议最初只规定了一种选项，即最长报文段长度（只包含数据字段，不包括TCP首部），又称为MSS。MSS告诉对方TCP“我的缓存所能接收的报文段的数据字段的最大长度是MSS个字节”。<br><br>新的RFC规定有以下几种选型：选项表结束，空操作，最大报文段长度，窗口扩大因子，时间戳。<br><br>-  选项表结束。<br>- 空操作：没有特殊含义，一般用于将TCP选项的总长度填充为4字节的整数倍。<br>- 最大报文段长度：又称为MSS，只包含数据字段，不包括TCP首部。<br>- 窗口扩大因子：3字节，其中一个字节表示偏移值S。新的窗口值等于TCP首部中的窗口位数增大到（16+S），相当于把窗口值向左移动S位后获得实际的窗口大小。<br>- 时间戳：10字节，其中最主要的字段是时间戳值（4字节）和时间戳回送应答字段（4字节）。</td>
</tr>
<tr>
<td>data</td>
<td>可变</td>
<td>TCP负载。小于等于MSS</td>
</tr>
</tbody></table>
<h1 id="MTU、MSS、PMTU和分片"><a href="#MTU、MSS、PMTU和分片" class="headerlink" title="MTU、MSS、PMTU和分片"></a>MTU、MSS、PMTU和分片</h1><p>以太网的MTU 1500B、PPPoE 1492B、ATM 9180B。TCP中分割之后的段叫TCP报文段，这时候能够使用的最大报文段称为MSS。</p>
<p>$$<br>(P)MTU&#x3D;IP head+TCP head+MSS<br>$$</p>
<p>TCP需要获取PMTU大小，用来规划自己的MSS，PMTU是通过IP层的ICMP协议获取的。分片是IP层完成的事情，如果TCP MSS规划不合理，那么送到IP层的报文依旧存在大报文，会走IP分片报文。</p>
<p>$$<br>f(x)&#x3D;\left{<br>\begin{array}{<strong>lr</strong>}<br>3n+1&amp;x为奇数且x\neq1\<br>n&#x2F;2&amp;x为偶数\<br>1&amp;x&#x3D;1<br>\end{array}<br>\right.<br>$$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/TCP%E5%AD%A6%E4%B9%A0/TCP%E7%AA%97%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/TCP%E5%AD%A6%E4%B9%A0/TCP%E7%AA%97%E5%8F%A3/" class="post-title-link" itemprop="url">TCP窗口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="TCP几个窗口概念"><a href="#TCP几个窗口概念" class="headerlink" title="TCP几个窗口概念"></a>TCP几个窗口概念</h1><p>TCP窗口大小的单位是<strong>字节</strong>​ 。这意味着窗口大小衡量的是可以发送的<strong>数据字节数</strong>，而不是报文段或帧的数量。</p>
<p>下表总结了TCP通信中几个关键的窗口类型：</p>
<table>
<thead>
<tr>
<th>窗口类型</th>
<th>英文全称</th>
<th>控制方</th>
<th>核心作用</th>
</tr>
</thead>
<tbody><tr>
<td>**接收窗口 (RWND)**​</td>
<td>Receiver Window</td>
<td>接收端</td>
<td>流量控制，反映接收方应用程序的缓存剩余空间</td>
</tr>
<tr>
<td>**拥塞窗口 (CWND)**​</td>
<td>Congestion Window</td>
<td>发送端</td>
<td>拥塞控制，根据网络状况动态调整，避免造成网络过载</td>
</tr>
<tr>
<td>**发送窗口 (SWND)**​</td>
<td>Sender Window</td>
<td>发送端</td>
<td><strong>实际发送数据的上限</strong>，其大小由RWND和CWND共同决定</td>
</tr>
</tbody></table>
<ul>
<li><strong>为何以字节为单位</strong>：采用字节作为单位提供了极大的灵活性，允许TCP适应各种不同的应用需求（如大文件传输或短小交互命令），而不受底层网络数据包大小分割的限制 。核心目的是实现<strong>流量控制</strong>，确保发送方的发送速率不会超过接收方的处理能力 。</li>
<li><strong>流量控制过程</strong>：接收方通过TCP报文首部中的16位“窗口大小”字段，动态地向发送方通告自己的接收窗口剩余容量 。如果接收方缓冲区已满，它会通告一个<strong>零窗口</strong>，此时发送方会暂停发送，并通过<strong>持续计时器</strong>定时发送窗口探测报文，以等待接收方缓冲区空出后恢复传输 。</li>
<li><strong>窗口大小的限制与扩展</strong>：由于窗口字段是16位，理论上最大窗口值为65535字节。对于高带宽、高延迟的网络（如卫星链路），这可能成为瓶颈。因此，TCP使用了<strong>窗口缩放选项</strong>，通过一个缩放因子，可以将实际窗口大小最大扩展到约1GB，从而显著提高吞吐量 。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/ceatsheet/bpftrace%20cheatsheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/ceatsheet/bpftrace%20cheatsheet/" class="post-title-link" itemprop="url">bpftrace cheatsheet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">probe[,probe,...] /filter/ &#123; action &#125;</span><br></pre></td></tr></table></figure>
<p>探针指定要检测哪些事件，过滤器是可选的，可以根据布尔表达式筛选事件，而操作是要运行的小程序。</p>
<p>例子hello world:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e &#x27;BEGIN &#123; printf(&quot;Hello eBPF!\n&quot;); &#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>探针是BEGIN，这是一个特殊的探针，会在程序开始时运行（类似于 awk）。没有过滤器。操作是printf()语句。</p>
<p>举个实际例子：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e &#x27;kretprobe:vfs_read /pid == 181/ &#123; @bytes = hist(retval); &#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>这段代码使用 kretprobe 来检测 sys_read() 内核函数的返回值。如果进程 ID 为 181，则会将一个特殊的映射变量@bytes填充为一个以 sys_read() 返回值retval为参数的 log2 直方图函数。这样就能生成进程 ID 为 181 的读取大小的直方图。你的应用是否执行了大量 1 字节的读取操作？或许可以对此进行优化。</p>
<h1 id="探针类型"><a href="#探针类型" class="headerlink" title="探针类型"></a>探针类型</h1><p>这些是相关的探针库。目前支持的类型有：</p>
<table>
<thead>
<tr>
<th>Alias</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>t</td>
<td>tracepoint</td>
<td>Kernel static instrumentation points</td>
</tr>
<tr>
<td>U</td>
<td>usdt</td>
<td>User-level statically defined tracing</td>
</tr>
<tr>
<td>k</td>
<td>kprobe</td>
<td>Kernel dynamic function instrumentation (standard)</td>
</tr>
<tr>
<td>kr</td>
<td>kretprobe</td>
<td>Kernel dynamic function return instrumentation (standard)</td>
</tr>
<tr>
<td>f</td>
<td>kfunc</td>
<td>Kernel dynamic function instrumentation (BPF based)</td>
</tr>
<tr>
<td>fr</td>
<td>kretfunc</td>
<td>Kernel dynamic function return instrumentation (BPF based)</td>
</tr>
<tr>
<td>u</td>
<td>uprobe</td>
<td>User-level dynamic function instrumentation</td>
</tr>
<tr>
<td>ur</td>
<td>uretprobe</td>
<td>User-level dynamic function return instrumentation</td>
</tr>
<tr>
<td>s</td>
<td>software</td>
<td>Kernel software-based events</td>
</tr>
<tr>
<td>h</td>
<td>hardware</td>
<td>Hardware counter-based instrumentation</td>
</tr>
<tr>
<td>w</td>
<td>watchpoint</td>
<td>Memory watchpoint events</td>
</tr>
<tr>
<td>p</td>
<td>profile</td>
<td>Timed sampling across all CPUs</td>
</tr>
<tr>
<td>i</td>
<td>interval</td>
<td>Timed reporting (from one CPU)</td>
</tr>
<tr>
<td></td>
<td>iter</td>
<td>Iterator tracing over kernel objects</td>
</tr>
<tr>
<td></td>
<td>BEGIN</td>
<td>Start of bpftrace</td>
</tr>
<tr>
<td></td>
<td>END</td>
<td>End of bpftrace</td>
</tr>
</tbody></table>
<p>动态插桩允许在不重启程序的情况下跟踪正在运行的二进制文件中的任何软件函数。但是，它所暴露的函数并非稳定的 API，因为它们可能会随软件版本的变化而改变，从而导致您开发的 bpftrace 工具失效。请尽可能使用静态探针类型，因为它们通常能提供一定的稳定性。</p>
<h1 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h1><table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>@name</td>
<td>global</td>
</tr>
<tr>
<td>@name[key]</td>
<td>hash</td>
</tr>
<tr>
<td>@name[tid]</td>
<td>thread-local</td>
</tr>
<tr>
<td>$name</td>
<td>scratch</td>
</tr>
</tbody></table>
<p>以“@”为前缀的变量使用 BPF 映射，其行为类似于关联数组。它们可以通过以下两种方式之一进行填充：</p>
<ul>
<li>变量赋值：@name &#x3D; x;</li>
<li>函数赋值：@name &#x3D; hist(x);<br>内置了多种地图填充函数，可以快速汇总数据。</li>
</ul>
<h1 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h1><table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>pid</td>
<td>Process ID</td>
</tr>
<tr>
<td>tid</td>
<td>Thread ID</td>
</tr>
<tr>
<td>uid</td>
<td>User ID</td>
</tr>
<tr>
<td>username</td>
<td>Username</td>
</tr>
<tr>
<td>comm</td>
<td>Process or command name</td>
</tr>
<tr>
<td>curtask</td>
<td>Current task_struct as a u64</td>
</tr>
<tr>
<td>nsecs</td>
<td>Current time in nanoseconds</td>
</tr>
<tr>
<td>elapsed</td>
<td>Time in nanoseconds since bpftrace start</td>
</tr>
<tr>
<td>kstack</td>
<td>Kernel stack trace</td>
</tr>
<tr>
<td>ustack</td>
<td>User-level stack trace</td>
</tr>
<tr>
<td>arg0…argN</td>
<td>Function arguments</td>
</tr>
<tr>
<td>args</td>
<td>Tracepoint arguments</td>
</tr>
<tr>
<td>retval</td>
<td>Function return value</td>
</tr>
<tr>
<td>func</td>
<td>Function name</td>
</tr>
<tr>
<td>probe</td>
<td>Full probe name</td>
</tr>
<tr>
<td>$1…$N</td>
<td>Positional parameters</td>
</tr>
<tr>
<td>cgroup</td>
<td>Default cgroup v2 ID</td>
</tr>
</tbody></table>
<h1 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h1><table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>printf(“…”)</td>
<td>Print formatted string</td>
</tr>
<tr>
<td>time(“…”)</td>
<td>Print formatted time</td>
</tr>
<tr>
<td>join(char *arr[])</td>
<td>Join array of strings with a space</td>
</tr>
<tr>
<td>str(char *s [, int length])</td>
<td>Return string from s pointer</td>
</tr>
<tr>
<td>buf(void *p [, int length])</td>
<td>Return a hexadecimal string from p pointer</td>
</tr>
<tr>
<td>strncmp(char *s1, char *s2, int length)</td>
<td>Compares two strings up to length</td>
</tr>
<tr>
<td>sizeof(expression)</td>
<td>Returns the size of the expression</td>
</tr>
<tr>
<td>kstack([limit])</td>
<td>Kernel stack trace up to limit frames</td>
</tr>
<tr>
<td>ustack([limit])</td>
<td>User-level stack trace up to limit frames</td>
</tr>
<tr>
<td>ksym(void *p)</td>
<td>Resolve kernel address to symbol</td>
</tr>
<tr>
<td>usym(void *p)</td>
<td>Resolve user-space address to symbol</td>
</tr>
<tr>
<td>kaddr(char *name)</td>
<td>Resolve kernel symbol name to address</td>
</tr>
<tr>
<td>uaddr(char *name)</td>
<td>Resolve user-space symbol name to address</td>
</tr>
<tr>
<td>ntop([int af,]int|char[4:16] addr)</td>
<td>Convert IP address data to text</td>
</tr>
<tr>
<td>reg(char *name)</td>
<td>Return register value</td>
</tr>
<tr>
<td>cgroupid(char *path)</td>
<td>Return cgroupid for &#x2F;sys&#x2F;fs&#x2F;cgroup&#x2F;… path</td>
</tr>
<tr>
<td>time(“…”)</td>
<td>Print formatted time</td>
</tr>
<tr>
<td>system(“…”)</td>
<td>Run shell command</td>
</tr>
<tr>
<td>cat(char *filename)</td>
<td>Print file content</td>
</tr>
<tr>
<td>signal(char[] sig | int sig)</td>
<td>Send a signal to the current task</td>
</tr>
<tr>
<td>override(u64 rc)</td>
<td>Override a kernel function return value</td>
</tr>
<tr>
<td>exit()</td>
<td>Exits bpftrace</td>
</tr>
<tr>
<td>@ &#x3D; count()</td>
<td>Count events</td>
</tr>
<tr>
<td>@ &#x3D; sum(x)</td>
<td>Sum the value</td>
</tr>
<tr>
<td>@ &#x3D; hist(x)</td>
<td>Power-of-2 histogram for x</td>
</tr>
<tr>
<td>@ &#x3D; lhist(x, min, max, step)</td>
<td>Linear histogram for x</td>
</tr>
<tr>
<td>@ &#x3D; min(x)</td>
<td>Record the minimum value seen</td>
</tr>
<tr>
<td>@ &#x3D; max(x)</td>
<td>Record the maximum value seen</td>
</tr>
<tr>
<td>@ &#x3D; stats(x)</td>
<td>Return the count, average, and total for this value</td>
</tr>
<tr>
<td>delete(@x[key])</td>
<td>Delete the map element</td>
</tr>
<tr>
<td>clear(@x)</td>
<td>Delete all keys from the map</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/ceatsheet/ftrace%20cheatsheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/ceatsheet/ftrace%20cheatsheet/" class="post-title-link" itemprop="url">ftrace cheatsheet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/23/ceatsheet/perf%20cheatsheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/ceatsheet/perf%20cheatsheet/" class="post-title-link" itemprop="url">perf cheatsheet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-23 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-23T00:00:00+00:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://jvns.ca/perf-cheat-sheet.pdf">https://jvns.ca/perf-cheat-sheet.pdf</a></p>
</blockquote>
<p><img src="/perfcheatsheet.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/22/ceatsheet/iproute%20cheatsheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/22/ceatsheet/iproute%20cheatsheet/" class="post-title-link" itemprop="url">iproute cheatsheet</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-22 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-22T00:00:00+00:00">2025-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://paulgorman.org/technical/linux-iproute2-cheatsheet.html">https://paulgorman.org/technical/linux-iproute2-cheatsheet.html</a></p>
<p><a target="_blank" rel="noopener" href="https://access.redhat.com/sites/default/files/attachments/rh_ip_command_cheatsheet_1214_jcs_print.pdf">https://access.redhat.com/sites/default/files/attachments/rh_ip_command_cheatsheet_1214_jcs_print.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://linux-audit.com/cheat-sheets/ip/#subcommands">https://linux-audit.com/cheat-sheets/ip/#subcommands</a></p>
</blockquote>
<h1 id="ip和ifconfig比较"><a href="#ip和ifconfig比较" class="headerlink" title="ip和ifconfig比较"></a>ip和ifconfig比较</h1><p><img src="/compare.png"></p>
<h1 id="修改ip地址"><a href="#修改ip地址" class="headerlink" title="修改ip地址"></a>修改ip地址</h1><p><img src="/modifyaddr.png"></p>
<h1 id="管理路由表"><a href="#管理路由表" class="headerlink" title="管理路由表"></a>管理路由表</h1><p><img src="/routemanager.png"></p>
<h1 id="管理ARP表"><a href="#管理ARP表" class="headerlink" title="管理ARP表"></a>管理ARP表</h1><p><img src="/arpmanager.png"></p>
<h1 id="查询ip地址"><a href="#查询ip地址" class="headerlink" title="查询ip地址"></a>查询ip地址</h1><p><img src="/query.png"></p>
<h1 id="多播管理"><a href="#多播管理" class="headerlink" title="多播管理"></a>多播管理</h1><p><img src="/multicast.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/22/shells/Ten%20Things%20I%20Wish%20I%E2%80%99d%20Known%20About%20bash/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/22/shells/Ten%20Things%20I%20Wish%20I%E2%80%99d%20Known%20About%20bash/" class="post-title-link" itemprop="url">Ten Things I Wish I’d Known About bash</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-22 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-22T00:00:00+00:00">2025-12-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://zwischenzugs.com/2018/01/06/ten-things-i-wish-id-known-about-bash/">https://zwischenzugs.com/2018/01/06/ten-things-i-wish-id-known-about-bash/</a></p>
</blockquote>
<h2 id="1-vs"><a href="#1-vs" class="headerlink" title="1)  `` vs $()"></a>1)  <code>``</code> vs <code>$()</code></h2><p>这两完成了一样的事情：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> `<span class="built_in">ls</span>`</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $(<span class="built_in">ls</span>)</span></span><br></pre></td></tr></table></figure>
<p><code>``</code> 是Unix时代引入的，<code>$()</code>更现代和易读易写。<br>比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> `<span class="built_in">echo</span> \`<span class="built_in">echo</span> \\\`<span class="built_in">echo</span> inside\\\`\``</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $(<span class="built_in">echo</span> $(<span class="built_in">echo</span> $(<span class="built_in">echo</span> inside)))</span></span><br></pre></td></tr></table></figure>

<h2 id="2-globbing-vs-regexps"><a href="#2-globbing-vs-regexps" class="headerlink" title="2) globbing vs regexps"></a>2) globbing vs regexps</h2><p>glob和regexps是不一样的东西，glob是通配符，regexp是正则表达式。<br>看以下的表达式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rename -n <span class="string">&#x27;s/(.*)/new$1/&#x27;</span> *</span></span><br></pre></td></tr></table></figure>
<p>这里有两个<code>*</code>号</p>
<ul>
<li>第一个在引号内部，作为正则表达式的一部分</li>
<li>第二个在外部，作为通配符的部分</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> *</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> .*</span></span><br></pre></td></tr></table></figure>
<p>所以第二个看着像是正则表达式，但是实际上并不是</p>
<h2 id="3-Exit-Codes"><a href="#3-Exit-Codes" class="headerlink" title="3) Exit Codes"></a>3) Exit Codes</h2><p>所有的命令都会返回值给shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">grep not_there /dev/null</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">echo</span> $?</span></span><br></pre></td></tr></table></figure>
<ul>
<li>0就是命令执行正确，非0就是执行失败</li>
<li><code>$?</code>是一个特殊的符号，用来从shell里获取上一条命令的返回值</li>
</ul>
<h2 id="4-if-statements-and"><a href="#4-if-statements-and" class="headerlink" title="4) if statements, [ and [["></a>4) <code>if</code> statements, <code>[</code> and <code>[[</code></h2><ul>
<li><code>[</code>（单方括号）实际上是<code>test</code>命令的别名，是一个内置命令。它用于基本的条件测试，需要遵循严格的语法格式（如括号内必须有空格）。</li>
<li><code>[[</code>（双方括号）​ 是Bash的关键字，提供了比<code>[</code>更强大的功能。它不是普通命令，而是Bash的语法结构，因此具有更灵活和直观的行为。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用[（需要引号防止空变量错误）</span></span><br><span class="line">if [ &quot;$name&quot; = &quot;John&quot; ]; then</span><br><span class="line">    echo &quot;Hello John&quot;</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用[[（更安全，无需引号）</span></span><br><span class="line">if [[ $name == &quot;John&quot; ]]; then</span><br><span class="line">    echo &quot;Hello John&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>举个例子</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用[]</span></span><br><span class="line">if [ $(grep not_there /dev/null) = &#x27;&#x27; ]</span><br><span class="line">then</span><br><span class="line">    echo -n hi</span><br><span class="line">else</span><br><span class="line">    echo -n lo</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用[[]]</span></span><br><span class="line">if [[ $(grep not_there /dev/null) = &#x27;&#x27; ]]</span><br><span class="line">then</span><br><span class="line">    echo -n hi</span><br><span class="line">else</span><br><span class="line">    echo -n lo</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<ul>
<li>第一个会报错，因为<code>$(grep not_there /dev/null)</code>返回值是空，那么最后就会变成<code>[ = &#39;&#39; ]</code>直接报错，这就是为什么经常能看到这些语句</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if [ x$(grep not_there /dev/null) = &#x27;x&#x27; ]</span><br></pre></td></tr></table></figure>
<ul>
<li>推荐使用第二种用法，因为它更安全、功能更丰富</li>
</ul>
<h2 id="5-set"><a href="#5-set" class="headerlink" title="5) set"></a>5) <code>set</code></h2><p>当脚本中<strong>任何一条命令</strong>的退出状态码（<code>$?</code>）<strong>非零</strong>（即执行失败）时，脚本<strong>立即终止</strong>运行，后续命令不再执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set -e</span><br></pre></td></tr></table></figure>
<p>建议使用trap来做一些清理工作，例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line">cleanup() &#123;</span><br><span class="line">    echo &quot;脚本在第 $1 行出错，正在执行清理...&quot;</span><br><span class="line">    # 清理临时文件等操作</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置陷阱，在收到 ERR 信号时（即命令失败）调用 cleanup 函数</span></span><br><span class="line">trap &#x27;cleanup $LINENO&#x27; ERR</span><br></pre></td></tr></table></figure>
<p><code>set -e</code><strong>管道命令的盲点</strong>：默认只检查管道中<strong>最后一个命令</strong>的退出状态。如果管道中前面的命令失败，但最后一个命令成功，脚本不会退出 。解决方案是结合 <code>set -o pipefail</code>。推荐设置如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">set -euo pipefail  # -e: 出错退出; -u: 使用未定义变量时报错; -o pipefail: 处理管道错误</span><br></pre></td></tr></table></figure>
<p>调试命令，打印执行的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set -x</span><br></pre></td></tr></table></figure>
<p>因此这个是设置一些选项</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">set -e</span><br><span class="line">set -x</span><br><span class="line">grep not_there /dev/null  &lt;-- 错误了之后直接退出</span><br><span class="line">echo $?</span><br></pre></td></tr></table></figure>

<h2 id="6-​​"><a href="#6-​​" class="headerlink" title="6) ​​&lt;()"></a>6) ​​<code>&lt;()</code></h2><p><code>&lt;()</code>输出的是文件，比如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">diff比较grep完file1和file2的结果</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">grep somestring file1 &gt; /tmp/a</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">grep somestring file2 &gt; /tmp/b</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">diff /tmp/a /tmp/b</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接等价于下面的命令，更优雅</span></span><br><span class="line">diff &lt;(grep somestring file1) &lt;(grep somestring file2)</span><br></pre></td></tr></table></figure>

<h2 id="7-Quoting"><a href="#7-Quoting" class="headerlink" title="7) Quoting"></a>7) Quoting</h2><p>引用在 bash 中是一个棘手的主题，就像在许多软件环境中一样。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A=&#x27;123&#x27;  </span><br><span class="line">echo &quot;$A&quot;   # &lt;-- 123</span><br><span class="line">echo &#x27;$A&#x27;   # &lt;-- $A</span><br></pre></td></tr></table></figure>
<p>非常简单——双引号取消引用变量，而单引号则直接引用<br>下面的表格清晰地总结了两者的主要差异：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>单引号 (<code>&#39;</code>)</th>
<th>双引号 (<code>&quot;</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><strong>变量替换</strong>​</td>
<td>不进行替换，原样输出</td>
<td>进行替换，输出变量值</td>
</tr>
<tr>
<td><strong>命令替换</strong>​</td>
<td>不执行，原样输出</td>
<td>执行，输出命令结果</td>
</tr>
<tr>
<td><strong>转义字符</strong>​</td>
<td>不解析（&#96;&#96;也视为普通字符）</td>
<td>解析（如 <code>\n</code>, <code>\t</code>等，需配合 <code>echo -e</code>）</td>
</tr>
<tr>
<td><strong>特殊字符</strong>​</td>
<td>所有字符（<code>$</code>, <code>`</code>, &#96;&#96;等）均失去特殊含义</td>
<td>仅部分字符（<code>$</code>, <code>`</code>, <code>&quot;</code>, &#96;&#96;）保留特殊含义</td>
</tr>
<tr>
<td>简单来说，单引号提供严格的字面意义保护，而双引号在保护字符串整体的同时，允许变量和命令等动态内容的插入。</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p tmp</span><br><span class="line">cd tmp</span><br><span class="line">touch a</span><br><span class="line">echo &quot;*&quot;   # 输出&quot;*&quot;</span><br><span class="line">echo &#x27;*&#x27;   # 输出&quot;*&quot;，*不保留特殊含义</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>使用单引号 (<code>&#39;</code>)</strong>：当你的字符串是<strong>纯粹的文本常量</strong>，不需要任何变量或命令替换，也不需要解析转义字符时。例如，固定的提示信息、符号文字等。</li>
<li><strong>使用双引号 (<code>&quot;</code>)</strong>：当你的字符串中<strong>需要包含变量、命令执行结果，或者需要处理包含空格的参数</strong>时。这是更常见的情况，也是更安全的做法，因为它可以防止字符串被意外分割。</li>
<li><strong>避免无引号</strong>：除非是极简单的连续字符（如数字、路径），否则为变量赋值或传递参数时，<strong>强烈建议总是使用引号</strong>，这能有效预防许多难以排查的错误。</li>
</ul>
<h2 id="8-Top-three-shortcuts"><a href="#8-Top-three-shortcuts" class="headerlink" title="8) Top three shortcuts"></a>8) Top three shortcuts</h2><table>
<thead>
<tr>
<th>功能</th>
<th>语法</th>
<th>作用</th>
<th>经典使用场景</th>
</tr>
</thead>
<tbody><tr>
<td><strong>获取最后参数</strong>​</td>
<td><code>!$</code></td>
<td>代表<strong>上一条命令的最后一个参数</strong>。</td>
<td>当你执行 <code>ls /a/very/long/path</code>后，想进入该目录，只需 <code>cd !$</code>，等效于 <code>cd /a/very/long/path</code>。</td>
</tr>
<tr>
<td><strong>获取参数范围</strong>​</td>
<td><code>!:1-$</code></td>
<td>代表<strong>上一条命令中从第1个到最后一个的所有参数</strong>。</td>
<td>误将 <code>tar -czf archive.tar.gz file1 file2</code>打成了 <code>zip</code>，可快速改为 <code>tar -czf archive.tar.gz !:1-$</code>。</td>
</tr>
<tr>
<td><strong>提取目录路径</strong>​</td>
<td><code>:h</code>  <br>（修饰符）</td>
<td>移除路径中的<strong>最后一级</strong>（文件名或目录名），返回纯目录路径。</td>
<td>操作文件失败时（如 <code>cat /etc/nginx/sites-available/my_site</code>），用 <code>cd !$:h</code>直接切换到文件所在目录 <code>/etc/nginx/sites-available</code>查看。</td>
</tr>
<tr>
<td><code>!$</code>：特殊变量，上一条命令的最后一个参数。如果你在处理文件，懒得一遍又一遍地重新输入命令，这可以省下很多工作：</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep somestring /long/path/to/some/file/or/other.txt</span><br><span class="line">vi !$</span><br></pre></td></tr></table></figure>
<p><code>!:1-$</code>:这个组合使这更进一步。 它获取上一个命令的所有参数并将它们放入。所以：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep isthere /long/path/to/some/file/or/other.txt</span><br><span class="line">egrep !:1-$</span><br><span class="line">fgrep !:1-$</span><br></pre></td></tr></table></figure>
<blockquote>
<p>:是分隔符，1-$指的是第一个到最后一个参数，！指的是上一个命令</p>
</blockquote>
<p>我也经常使用这个。 如果将其放在文件名后面，它将更改该文件名以删除该文件夹中的所有内容。 像这样：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep isthere /long/path/to/some/file/or/other.txt</span><br><span class="line">cd !$:h # 进入了/long/path/to/some/file/or/ 目录</span><br></pre></td></tr></table></figure>

<h2 id="9-startup-order"><a href="#9-startup-order" class="headerlink" title="9) startup order"></a>9) startup order</h2><p>bash的启动顺序如下图<br><img src="/shell-startup-actual.png"><br>它显示 bash 决定根据有关 bash 运行上下文的决策（决定要遵循的颜色）从顶部运行哪些脚本。</p>
<p>因此，如果处于本地（非远程）、非登录、交互式 shell 中（例如，当您从命令行运行 bash 本身时），您就位于“绿色”行，这些是读取文件的顺序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/bash.bashrc</span><br><span class="line">~/.bashrc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">[bash runs, <span class="keyword">then</span> terminates]</span></span><br><span class="line">~/.bash_logout</span><br></pre></td></tr></table></figure>

<h2 id="10-getopts-cheapci"><a href="#10-getopts-cheapci" class="headerlink" title="10) getopts (cheapci)"></a>10) getopts (cheapci)</h2><p>Bash 的 <code>getopts</code>是一个内置命令，用于在 Shell 脚本中规范地解析命令行选项和参数。</p>
<p><code>getopts</code>的基本命令格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getopts optstring name [args]</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong><code>optstring</code></strong>：定义脚本识别的选项字符。</p>
<ul>
<li>如果一个字符后跟冒号（<code>:</code>），表示该选项需要参数，如 <code>a:</code>表示 <code>-a</code>需要跟一个参数。</li>
<li>如果 <code>optstring</code>以冒号（<code>:</code>）开头，则开启<strong>静默错误模式</strong>，抑制默认错误信息，便于自定义错误处理。</li>
</ul>
</li>
<li><p><strong><code>name</code></strong>：每次调用 <code>getopts</code>时，会将解析到的选项字符（不带 <code>-</code>）存入该变量。</p>
</li>
<li><p><strong><code>[args]</code></strong>：可选参数。若提供，<code>getopts</code>会解析这些参数而非脚本的位置参数（<code>$1, $2, ...</code>）。<br><code>getopts</code>依赖两个重要的环境变量：</p>
</li>
<li><p><strong><code>OPTARG</code></strong>：当选项需要参数时，该参数值存放在 <code>OPTARG</code>变量中。</p>
</li>
<li><p><strong><code>OPTIND</code></strong>：保存下一个要被处理的参数索引。初始值为 1，处理完选项后，可用 <code>shift $(($OPTIND - 1))</code>跳过已处理的选项，使 <code>$1</code>指向第一个非选项参数。</p>
</li>
</ul>
<p>通常将 <code>getopts</code>放入 <code>while</code>循环，结合 <code>case</code>语句处理不同选项。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">verbose=false</span><br><span class="line">input_file=&quot;&quot;</span><br><span class="line">output_dir=&quot;&quot;</span><br><span class="line"></span><br><span class="line">while getopts &quot;:vi:o:&quot; opt; do</span><br><span class="line">    case $opt in</span><br><span class="line">        v) </span><br><span class="line">            verbose=true</span><br><span class="line">            echo &quot;详细模式已开启&quot; </span><br><span class="line">            ;;</span><br><span class="line">        i) </span><br><span class="line">            input_file=&quot;$OPTARG&quot;</span><br><span class="line">            echo &quot;输入文件设置为: $input_file&quot; </span><br><span class="line">            ;;</span><br><span class="line">        o) </span><br><span class="line">            output_dir=&quot;$OPTARG&quot;</span><br><span class="line">            echo &quot;输出目录设置为: $output_dir&quot; </span><br><span class="line">            ;;</span><br><span class="line">        \?) </span><br><span class="line">            echo &quot;错误：不支持的选项 -$OPTARG&quot; &gt;&amp;2</span><br><span class="line">            exit 1 </span><br><span class="line">            ;;</span><br><span class="line">        :) </span><br><span class="line">            echo &quot;错误：选项 -$OPTARG 需要一个参数&quot; &gt;&amp;2</span><br><span class="line">            exit 1 </span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">处理剩余的非选项参数</span></span><br><span class="line">shift $(($OPTIND - 1))</span><br><span class="line"></span><br><span class="line">if [ $# -gt 0 ]; then</span><br><span class="line">    echo &quot;剩余的非选项参数: $@&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>脚本用法示例</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./myscript.sh -i data.txt -o /tmp/output -v file1 file2</span><br><span class="line">输入文件设置为: data.txt</span><br><span class="line">输出目录设置为: /tmp/output</span><br><span class="line">详细模式已开启</span><br><span class="line">剩余的非选项参数: file1 file2</span><br></pre></td></tr></table></figure>


<ol>
<li><p><strong>选项处理顺序与组合</strong><br> <code>getopts</code>按顺序解析选项，遇到非选项参数（不以 <code>-</code>开头）或 <code>--</code>时停止。选项可以组合，如 <code>-vi file</code>等效于 <code>-v -i file</code>。</p>
</li>
<li><p><strong>错误处理模式</strong><br> 通过在 <code>optstring</code>前加冒号（<code>:</code>）开启静默模式。此模式下：</p>
<ul>
<li>遇到无效选项，<code>name</code>被设置为 <code>?</code>，<code>OPTARG</code>为无效选项字符。</li>
<li>遇到缺少参数的选项，<code>name</code>被设置为 <code>:</code>，<code>OPTARG</code>为对应选项字符。</li>
</ul>
</li>
<li><p>处理完选项后，使用 <code>shift $(($OPTIND - 1))</code>来移除已处理的选项和其参数，便于后续处理剩余的非选项参数。</p>
</li>
<li><p>重置 OPTIND<br> 如果在同一脚本中需要多次调用 <code>getopts</code>解析不同参数集，必须在每次解析新参数集前手动重置 <code>OPTIND=1</code>，因为 Shell 不会自动重置它。</p>
</li>
</ol>
<blockquote>
<ul>
<li><code>getopts</code>主要用于解析<strong>短选项</strong>（如 <code>-a</code>, <code>-l</code>）。虽然可以通过一些技巧模拟处理长选项（如 <code>--help</code>），但过程较为复杂，通常需要借助 <code>getopt</code>命令（注意，不是内置的 <code>getopts</code>）。</li>
<li><code>getopts</code>是 Shell 内置命令，执行效率高。而 <code>getopt</code>是外部命令，功能更强大（如直接支持长选项），但使用也更复杂，且不同系统上的实现可能有差异。</li>
</ul>
</blockquote>
<p>If you go deep with bash, you might end up writing chunky utilities in it. If you do, then getting to grips with <code>getopts</code> can pay large dividends.</p>
<p>For fun, I once wrote a <a target="_blank" rel="noopener" href="https://github.com/ianmiell/cheapci/blob/master/cheapci">script</a> called <code>cheapci</code> which I used to work like a Jenkins job.</p>
<p>The code <a target="_blank" rel="noopener" href="https://github.com/ianmiell/cheapci/blob/master/cheapci#L70-L96">here</a> implements the reading of the <a target="_blank" rel="noopener" href="https://github.com/ianmiell/cheapci/blob/master/cheapci#L33-L51">two required, and 14 non-required arguments</a>. Better to learn this than to build up a bunch of bespoke code that can get very messy pretty quickly as your utility grows.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/21/shells/%E5%B8%B8%E7%94%A8shell%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/21/shells/%E5%B8%B8%E7%94%A8shell%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">常用shell命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-21 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-21T00:00:00+00:00">2025-12-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Bash快捷键"><a href="#Bash快捷键" class="headerlink" title="Bash快捷键"></a>Bash快捷键</h1><p><img src="/moving_cli.png"></p>
<h2 id="Moving"><a href="#Moving" class="headerlink" title="Moving"></a>Moving</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + a</td>
<td>Goto BEGINNING of command line</td>
</tr>
<tr>
<td>ctrl + e</td>
<td>Goto END of command line</td>
</tr>
<tr>
<td>ctrl + b</td>
<td>move back one character</td>
</tr>
<tr>
<td>ctrl + f</td>
<td>move forward one character</td>
</tr>
<tr>
<td>alt + f</td>
<td>move cursor FORWARD one word</td>
</tr>
<tr>
<td>alt + b</td>
<td>move cursor BACK one word</td>
</tr>
<tr>
<td>ctrl + xx</td>
<td>Toggle between the start of line and current cursor position</td>
</tr>
<tr>
<td>ctrl + ] + x</td>
<td>Where x is any character, moves the cursor forward to the next occurance of x</td>
</tr>
<tr>
<td>alt + ctrl + ] + x</td>
<td>Where x is any character, moves the cursor backwards to the previous occurance of x</td>
</tr>
</tbody></table>
<h2 id="Edit-Other"><a href="#Edit-Other" class="headerlink" title="Edit &#x2F; Other"></a>Edit &#x2F; Other</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + d</td>
<td>Delete the character under the cursor</td>
</tr>
<tr>
<td>ctrl + h</td>
<td>Delete the previous character before cursor</td>
</tr>
<tr>
<td>ctrl + u</td>
<td>Clear all &#x2F; cut BEFORE cursor</td>
</tr>
<tr>
<td>ctrl + k</td>
<td>Clear all &#x2F; cut AFTER cursor</td>
</tr>
<tr>
<td>ctrl + w</td>
<td>delete the word BEFORE the cursor</td>
</tr>
<tr>
<td>alt + d</td>
<td>delete the word FROM the cursor</td>
</tr>
<tr>
<td>ctrl + y</td>
<td>paste (if you used a previous command to delete)</td>
</tr>
<tr>
<td>ctrl + i</td>
<td>command completion like Tab</td>
</tr>
<tr>
<td>ctrl + l</td>
<td>Clear the screen (same as clear command)</td>
</tr>
<tr>
<td>ctrl + c</td>
<td>kill whatever is running</td>
</tr>
<tr>
<td>ctrl + d</td>
<td>Exit shell (same as exit command when cursor line is empty)</td>
</tr>
<tr>
<td>ctrl + z</td>
<td>Place current process in background</td>
</tr>
<tr>
<td>ctrl + _</td>
<td>Undo</td>
</tr>
<tr>
<td>ctrl + x ctrl + u</td>
<td>Undo the last changes. ctrl+ _ does the same</td>
</tr>
<tr>
<td>ctrl + t</td>
<td>Swap the last two characters before the cursor</td>
</tr>
<tr>
<td>esc + t</td>
<td>Swap last two words before the cursor</td>
</tr>
<tr>
<td>alt + t</td>
<td>swap current word with previous</td>
</tr>
<tr>
<td>esc + .</td>
<td></td>
</tr>
<tr>
<td>esc + _</td>
<td></td>
</tr>
<tr>
<td>alt + [Backspace]</td>
<td>delete PREVIOUS word</td>
</tr>
<tr>
<td>alt + &lt;</td>
<td>Move to the first line in the history</td>
</tr>
<tr>
<td>alt + &gt;</td>
<td>Move to the end of the input history, i.e., the line currently being entered</td>
</tr>
<tr>
<td>alt + ?</td>
<td>display the file&#x2F;folder names in the current path as help</td>
</tr>
<tr>
<td>alt + *</td>
<td>print all the file&#x2F;folder names in the current path as parameter</td>
</tr>
<tr>
<td>alt + .</td>
<td>print the LAST ARGUMENT (ie “vim file1.txt file2.txt” will yield “file2.txt”)</td>
</tr>
<tr>
<td>alt + c</td>
<td>capitalize the first character to end of word starting at cursor (whole word if cursor is at the beginning of word)</td>
</tr>
<tr>
<td>alt + u</td>
<td>make uppercase from cursor to end of word</td>
</tr>
<tr>
<td>alt + l</td>
<td>make lowercase from cursor to end of word</td>
</tr>
<tr>
<td>alt + n</td>
<td></td>
</tr>
<tr>
<td>alt + p</td>
<td>Non-incremental reverse search of history.</td>
</tr>
<tr>
<td>alt + r</td>
<td>Undo all changes to the line</td>
</tr>
<tr>
<td>alt + ctl + e</td>
<td>Expand command line.</td>
</tr>
<tr>
<td>~[TAB][TAB]</td>
<td>List all users</td>
</tr>
<tr>
<td>$[TAB][TAB]</td>
<td>List all system variables</td>
</tr>
<tr>
<td>@[TAB][TAB]</td>
<td>List all entries in your &#x2F;etc&#x2F;hosts file</td>
</tr>
<tr>
<td>[TAB]</td>
<td>Auto complete</td>
</tr>
<tr>
<td>cd -</td>
<td>change to PREVIOUS working directory</td>
</tr>
</tbody></table>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + r</td>
<td>Search backward starting at the current line and moving ‘up’ through the history as necessary</td>
</tr>
<tr>
<td>crtl + s</td>
<td>Search forward starting at the current line and moving ‘down’ through the history as necessary</td>
</tr>
<tr>
<td>ctrl + p</td>
<td>Fetch the previous command from the history list, moving back in the list (same as up arrow)</td>
</tr>
<tr>
<td>ctrl + n</td>
<td>Fetch the next command from the history list, moving forward in the list (same as down arrow)</td>
</tr>
<tr>
<td>ctrl + o</td>
<td>Execute the command found via Ctrl+r or Ctrl+s</td>
</tr>
<tr>
<td>ctrl + g</td>
<td>Escape from history searching mode</td>
</tr>
<tr>
<td>!!</td>
<td>Run PREVIOUS command (ie <code>sudo !!</code>)</td>
</tr>
<tr>
<td>!vi</td>
<td>Run PREVIOUS command that BEGINS with vi</td>
</tr>
<tr>
<td>!vi:p</td>
<td>Print previously run command that BEGINS with vi</td>
</tr>
<tr>
<td>!n</td>
<td>Execute nth command in history</td>
</tr>
<tr>
<td>!$</td>
<td>Last argument of last command</td>
</tr>
<tr>
<td>!^</td>
<td>First argument of last command</td>
</tr>
<tr>
<td>^abc^xyz</td>
<td>Replace first occurance of abc with xyz in last command and execute it</td>
</tr>
</tbody></table>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jlevy/the-art-of-command-line/tree/master">https://github.com/jlevy/the-art-of-command-line/tree/master</a></p>
</blockquote>
<h2 id="bash命令行"><a href="#bash命令行" class="headerlink" title="bash命令行"></a>bash命令行</h2><ul>
<li>如果你输入命令的时候中途改了主意，按下 <strong>alt-#</strong> 在行首添加 <code>#</code> 把它当做注释再按下回车执行（或者依次按下 <strong>ctrl-a</strong>， <strong>#</strong>， <strong>enter</strong>）。这样做的话，之后借助命令行历史记录，你可以很方便恢复你刚才输入到一半的命令。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ # yum install gcc   &lt;--前面加#</span><br><span class="line">➜  ~ # yum install gcc   &lt;-- 按上键</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>netstat -lntp</code> 或 <code>ss -plat</code> 检查哪些进程在监听端口（默认是检查 TCP 端口; 添加参数 <code>-u</code> 则检查 UDP 端口）或者 <code>lsof -iTCP -sTCP:LISTEN -P -n</code> (这也可以在 OS X 上运行)。</li>
<li><code>pstree -p</code> 以一种优雅的方式展示进程树。</li>
<li>使用 <code>nohup</code> 或 <code>disown</code> 使一个后台进程持续运行。</li>
<li>使用 <code>pgrep</code> 和 <code>pkill</code> 根据名字查找进程或发送信号（<code>-f</code> 参数通常有用）。</li>
<li>将 shell 切换为其他用户，使用 <code>su username</code> 或者 <code>su - username</code>。加入 <code>-</code> 会使得切换后的环境与使用该用户登录后的环境相同。省略用户名则默认为 root。切换到哪个用户，就需要输入_哪个用户的_密码。</li>
<li>可以把别名、shell 选项和常用函数保存在 <code>~/.bashrc</code>，具体看下这篇<a target="_blank" rel="noopener" href="http://superuser.com/a/183980/7106">文章</a>。这样做的话你就可以在所有 shell 会话中使用你的设定。</li>
<li>把环境变量的设定以及登陆时要执行的命令保存在 <code>~/.bash_profile</code>。而对于从图形界面启动的 shell 和 <code>cron</code> 启动的 shell，则需要单独配置文件。</li>
<li>shell PS1显示</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 编辑配置文件（以当前用户的 ~/.bashrc 为例）</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 在文件末尾添加一行，例如：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示效果类似于：[Sun Dec 21 14:05:30] user@server:~$</span></span><br><span class="line">export PS1=&quot;[\d \t] \u@\h:\W\$ &quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 让配置立即生效</span></span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="文件及数据处理"><a href="#文件及数据处理" class="headerlink" title="文件及数据处理"></a>文件及数据处理</h2><ul>
<li><code>wc</code> 去计算新行数（<code>-l</code>），字符数（<code>-m</code>），单词数（<code>-w</code>）以及字节数（<code>-c</code>）。</li>
<li>使用 <code>tee</code> 将标准输入复制到文件甚至标准输出，例如 <code>ls -al | tee file.txt</code>。</li>
<li>替换一个或多个文件中出现的字符串：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pi.bak -e &#x27;s/old-string/new-string/g&#x27; my-files-*.txt</span><br></pre></td></tr></table></figure>
<ul>
<li><code>rsync</code> 是一个快速且非常灵活的文件复制工具。它闻名于设备之间的文件同步，但其实它在本地情况下也同样有用。在安全设置允许下，用 <code>rsync</code> 代替 <code>scp</code> 可以实现文件续传，而不用重新从头开始。它同时也是删除大量文件的<a target="_blank" rel="noopener" href="https://web.archive.org/web/20130929001850/http://linuxnote.net/jianingy/en/linux/a-fast-way-to-remove-huge-number-of-files.html">最快方法</a>之一：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir empty &amp;&amp; rsync -r --delete empty/ some-dir &amp;&amp; rmdir some-dir</span><br></pre></td></tr></table></figure>
<ul>
<li>标准的源代码对比及合并工具是 <code>diff</code> 和 <code>patch</code>。使用 <code>diffstat</code> 查看变更总览数据。注意到 <code>diff -r</code> 对整个文件夹有效。使用 <code>diff -r tree1 tree2 | diffstat</code> 查看变更的统计数据。<code>vimdiff</code> 用于比对并编辑文件。<br><img src="/diff.png"></li>
<li>对于二进制文件，使用 <code>hd</code>，<code>hexdump</code> 或者 <code>xxd</code> 使其以十六进制显示，使用 <code>bvi</code>，<code>hexedit</code> 或者 <code>biew</code> 来进行二进制编辑。</li>
<li>同样对于二进制文件，<code>strings</code>（包括 <code>grep</code> 等工具）可以帮助在二进制文件中查找特定比特。</li>
<li>拆分文件可以使用 <code>split</code>（按大小拆分）和 <code>csplit</code>（按模式拆分）。</li>
<li>操作日期和时间表达式，可以用 <a target="_blank" rel="noopener" href="http://www.fresse.org/dateutils/"><code>dateutils</code></a> 中的 <code>dateadd</code>、<code>datediff</code>、<code>strptime</code> 等工具。</li>
<li>使用 <code>zless</code>、<code>zmore</code>、<code>zcat</code> 和 <code>zgrep</code> 对压缩过的文件进行操作。</li>
<li>文件属性可以通过 <code>chattr</code> 进行设置，它比文件权限更加底层。例如，为了保护文件不被意外删除，可以使用不可修改标记：<code>sudo chattr +i /critical/directory/or/file</code></li>
<li>使用 <code>getfacl</code> 和 <code>setfacl</code> 以保存和恢复文件权限。例如：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getfacl -R /some/path &gt; permissions.txt</span><br><span class="line">setfacl --restore=permissions.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>为了高效地创建空文件，请使用 <code>truncate</code>（创建<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%A8%80%E7%96%8F%E6%96%87%E4%BB%B6">稀疏文件</a>），<code>fallocate</code>（用于 ext4，xfs，btrf 和 ocfs2 文件系统），<code>xfs_mkfile</code>（适用于几乎所有的文件系统，包含在 xfsprogs 包中），<code>mkfile</code>（用于类 Unix 操作系统，比如 Solaris 和 Mac OS）。</li>
</ul>
<h2 id="系统调试"><a href="#系统调试" class="headerlink" title="系统调试"></a>系统调试</h2><ul>
<li><code>curl</code> 和 <code>curl -I</code> 可以被轻松地应用于 web 调试中，它们的好兄弟 <code>wget</code> 也是如此，或者也可以试试更潮的 <a target="_blank" rel="noopener" href="https://github.com/jkbrzt/httpie"><code>httpie</code></a>。</li>
<li>获取 CPU 和硬盘的使用状态，通常使用使用 <code>top</code>（<code>htop</code> 更佳），<code>iostat</code> 和 <code>iotop</code>。而 <code>iostat -mxz 15</code> 可以让你获悉 CPU 和每个硬盘分区的基本信息和性能表现。</li>
<li>使用 <code>netstat</code> 和 <code>ss</code> 查看网络连接的细节。</li>
<li><code>dstat</code> 在你想要对系统的现状有一个粗略的认识时是非常有用的。然而若要对系统有一个深度的总体认识，使用 <a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a>，它会在一个终端窗口中向你提供一些系统级的数据。</li>
<li>若要了解内存状态，运行并理解 <code>free</code> 和 <code>vmstat</code> 的输出。值得留意的是“cached”的值，它指的是 Linux 内核用来作为文件缓存的内存大小，而与空闲内存无关。</li>
<li>Java 系统调试则是一件截然不同的事，一个可以用于 Oracle 的 JVM 或其他 JVM 上的调试的技巧是你可以运行 <code>kill -3 &lt;pid&gt;</code> 同时一个完整的栈轨迹和堆概述（包括 GC 的细节）会被保存到标准错误或是日志文件。JDK 中的 <code>jps</code>，<code>jstat</code>，<code>jstack</code>，<code>jmap</code> 很有用。<a target="_blank" rel="noopener" href="https://github.com/aragozin/jvm-tools">SJK tools</a> 更高级。</li>
<li>使用 <a target="_blank" rel="noopener" href="http://www.bitwizard.nl/mtr/"><code>mtr</code></a> 去跟踪路由，用于确定网络问题。</li>
<li>用 <a target="_blank" rel="noopener" href="https://dev.yorhel.nl/ncdu"><code>ncdu</code></a> 来查看磁盘使用情况，它比寻常的命令，如 <code>du -sh *</code>，更节省时间。</li>
<li>查找正在使用带宽的套接字连接或进程，使用 <a target="_blank" rel="noopener" href="http://www.ex-parrot.com/~pdw/iftop/"><code>iftop</code></a> 或 <a target="_blank" rel="noopener" href="https://github.com/raboof/nethogs"><code>nethogs</code></a>。</li>
<li><code>ab</code> 工具（Apache 中自带）可以简单粗暴地检查 web 服务器的性能。对于更复杂的负载测试，使用 <code>siege</code>。</li>
<li><a target="_blank" rel="noopener" href="https://wireshark.org/"><code>wireshark</code></a>，<a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/wsug_html_chunked/AppToolstshark.html"><code>tshark</code></a> 和 <a target="_blank" rel="noopener" href="http://ngrep.sourceforge.net/"><code>ngrep</code></a> 可用于复杂的网络调试。</li>
<li>了解 <code>strace</code> 和 <code>ltrace</code>。这俩工具在你的程序运行失败、挂起甚至崩溃，而你却不知道为什么或你想对性能有个总体的认识的时候是非常有用的。注意 profile 参数（<code>-c</code>）和附加到一个运行的进程参数 （<code>-p</code>）。</li>
<li>了解使用 <code>ldd</code> 来检查共享库。但是<a target="_blank" rel="noopener" href="http://www.catonmat.net/blog/ldd-arbitrary-code-execution/">永远不要在不信任的文件上运行</a>。</li>
<li>了解如何运用 <code>gdb</code> 连接到一个运行着的进程并获取它的堆栈轨迹。</li>
<li>学会使用 <code>/proc</code>。它在调试正在出现的问题的时候有时会效果惊人。比如：<code>/proc/cpuinfo</code>，<code>/proc/meminfo</code>，<code>/proc/cmdline</code>，<code>/proc/xxx/cwd</code>，<code>/proc/xxx/exe</code>，<code>/proc/xxx/fd/</code>，<code>/proc/xxx/smaps</code>（这里的 <code>xxx</code> 表示进程的 id 或 pid）。</li>
<li>当调试一些之前出现的问题的时候，<a target="_blank" rel="noopener" href="http://sebastien.godard.pagesperso-orange.fr/"><code>sar</code></a> 非常有用。它展示了 cpu、内存以及网络等的历史数据。</li>
<li>关于更深层次的系统分析以及性能分析，看看 <code>stap</code>（<a target="_blank" rel="noopener" href="https://sourceware.org/systemtap/wiki">SystemTap</a>），<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Perf_(Linux)"><code>perf</code></a>，以及<a target="_blank" rel="noopener" href="https://github.com/draios/sysdig"><code>sysdig</code></a>。</li>
<li>查看你当前使用的系统，使用 <code>uname</code>，<code>uname -a</code>（Unix／kernel 信息）或者 <code>lsb_release -a</code>（Linux 发行版信息）。</li>
<li>无论什么东西工作得很欢乐（可能是硬件或驱动问题）时可以试试 <code>dmesg</code>。</li>
<li>如果你删除了一个文件，但通过 <code>du</code> 发现没有释放预期的磁盘空间，请检查文件是否被进程占用： <code>lsof | grep deleted | grep &quot;filename-of-my-big-file&quot;</code></li>
</ul>
<h2 id="单行脚本"><a href="#单行脚本" class="headerlink" title="单行脚本"></a>单行脚本</h2><ul>
<li>当你需要对文本文件做集合交、并、差运算时，<code>sort</code> 和 <code>uniq</code> 会是你的好帮手。具体例子请参照代码后面的，此处假设 <code>a</code> 与 <code>b</code> 是两内容不同的文件。这种方式效率很高，并且在小文件和上 G 的文件上都能运用（注意尽管在 <code>/tmp</code> 在一个小的根分区上时你可能需要 <code>-T</code> 参数，但是实际上 <code>sort</code> 并不被内存大小约束），参阅前文中关于 <code>LC_ALL</code> 和 <code>sort</code> 的 <code>-u</code> 参数的部分。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort a b | uniq &gt; c   # c 是 a 并 b</span><br><span class="line">sort a b | uniq -d &gt; c   # c 是 a 交 b</span><br><span class="line">sort a b b | uniq -u &gt; c   # c 是 a - b</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>grep . *</code>（每行都会附上文件名）或者 <code>head -100 *</code>（每个文件有一个标题）来阅读检查目录下所有文件的内容。这在检查一个充满配置文件的目录（如 <code>/sys</code>、<code>/proc</code>、<code>/etc</code>）时特别好用。</li>
<li>计算文本文件第三列中所有数的和（可能比同等作用的 Python 代码快三倍且代码量少三倍）：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123; x += $3 &#125; END &#123; print x &#125;&#x27; myfile</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你想在文件树上查看大小&#x2F;日期，这可能看起来像递归版的 <code>ls -l</code> 但比 <code>ls -lR</code> 更易于理解：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f -ls</span><br></pre></td></tr></table></figure>
<ul>
<li>假设你有一个类似于 web 服务器日志文件的文本文件，并且一个确定的值只会出现在某些行上，假设一个 <code>acct_id</code> 参数在 URI 中。如果你想计算出每个 <code>acct_id</code> 值有多少次请求，使用如下代码：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -o &#x27;acct_id=[0-9]+&#x27; access.log | cut -d= -f2 | sort | uniq -c | sort -rn</span><br></pre></td></tr></table></figure>
<ul>
<li>要持续监测文件改动，可以使用 <code>watch</code>，例如检查某个文件夹中文件的改变，可以用 <code>watch -d -n 2 &#39;ls -rtlh | tail&#39;</code>；或者在排查 WiFi 设置故障时要监测网络设置的更改，可以用 <code>watch -d -n 2 ifconfig</code>。</li>
<li>运行这个函数从这篇文档中随机获取一条技巧（解析 Markdown 文件并抽取项目）：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function taocl() &#123;</span><br><span class="line">	curl -s https://raw.githubusercontent.com/jlevy/the-art-of-command-line/master/README-zh.md|</span><br><span class="line">	pandoc -f markdown -t html |</span><br><span class="line">       iconv -f &#x27;utf-8&#x27; -t &#x27;unicode&#x27; |</span><br><span class="line">       xmlstarlet fo --html --dropdtd |</span><br><span class="line">       xmlstarlet sel -t -v &quot;(html/body/ul/li[count(p)&gt;0])[$RANDOM mod last()+1]&quot; |</span><br><span class="line">       xmlstarlet unesc | fmt -80</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="冷门但有用"><a href="#冷门但有用" class="headerlink" title="冷门但有用"></a>冷门但有用</h2><ul>
<li><code>expr</code>：计算表达式或正则匹配</li>
<li><code>m4</code>：简单的宏处理器</li>
<li><code>yes</code>：多次打印字符串</li>
<li><code>cal</code>：漂亮的日历</li>
<li><code>env</code>：执行一个命令（脚本文件中很有用）</li>
<li><code>printenv</code>：打印环境变量（调试时或在写脚本文件时很有用）</li>
<li><code>look</code>：查找以特定字符串开头的单词或行</li>
<li><code>cut</code>，<code>paste</code> 和 <code>join</code>：数据修改</li>
<li><code>fmt</code>：格式化文本段落</li>
<li><code>pr</code>：将文本格式化成页／列形式</li>
<li><code>fold</code>：包裹文本中的几行</li>
<li><code>column</code>：将文本格式化成多个对齐、定宽的列或表格</li>
<li><code>expand</code> 和 <code>unexpand</code>：制表符与空格之间转换</li>
<li><code>nl</code>：添加行号</li>
<li><code>seq</code>：打印数字</li>
<li><code>bc</code>：计算器</li>
<li><code>factor</code>：分解因数</li>
<li><a target="_blank" rel="noopener" href="https://gnupg.org/"><code>gpg</code></a>：加密并签名文件</li>
<li><code>toe</code>：terminfo 入口列表</li>
<li><code>nc</code>：网络调试及数据传输</li>
<li><code>socat</code>：套接字代理，与 <code>netcat</code> 类似</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mattthias/slurm"><code>slurm</code></a>：网络流量可视化</li>
<li><code>dd</code>：文件或设备间传输数据</li>
<li><code>file</code>：确定文件类型</li>
<li><code>tree</code>：以树的形式显示路径和文件，类似于递归的 <code>ls</code></li>
<li><code>stat</code>：文件信息</li>
<li><code>time</code>：执行命令，并计算执行时间</li>
<li><code>timeout</code>：在指定时长范围内执行命令，并在规定时间结束后停止进程</li>
<li><code>lockfile</code>：使文件只能通过 <code>rm -f</code> 移除</li>
<li><code>logrotate</code>： 切换、压缩以及发送日志文件</li>
<li><code>watch</code>：重复运行同一个命令，展示结果并／或高亮有更改的部分</li>
<li><a target="_blank" rel="noopener" href="https://github.com/joh/when-changed"><code>when-changed</code></a>：当检测到文件更改时执行指定命令。参阅 <code>inotifywait</code> 和 <code>entr</code>。</li>
<li><code>tac</code>：反向输出文件</li>
<li><code>shuf</code>：文件中随机选取几行</li>
<li><code>comm</code>：一行一行的比较排序过的文件</li>
<li><code>strings</code>：从二进制文件中抽取文本</li>
<li><code>tr</code>：转换字母</li>
<li><code>iconv</code> 或 <code>uconv</code>：文本编码转换</li>
<li><code>split</code> 和 <code>csplit</code>：分割文件</li>
<li><code>sponge</code>：在写入前读取所有输入，在读取文件后再向同一文件写入时比较有用，例如 <code>grep -v something some-file | sponge some-file</code></li>
<li><code>units</code>：将一种计量单位转换为另一种等效的计量单位（参阅 <code>/usr/share/units/definitions.units</code>）</li>
<li><code>apg</code>：随机生成密码</li>
<li><code>xz</code>：高比例的文件压缩</li>
<li><code>ldd</code>：动态库信息</li>
<li><code>nm</code>：提取 obj 文件中的符号</li>
<li><code>ab</code> 或 <a target="_blank" rel="noopener" href="https://github.com/wg/wrk"><code>wrk</code></a>：web 服务器性能分析</li>
<li><code>strace</code>：调试系统调用</li>
<li><a target="_blank" rel="noopener" href="http://www.bitwizard.nl/mtr/"><code>mtr</code></a>：更好的网络调试跟踪工具</li>
<li><code>cssh</code>：可视化的并发 shell</li>
<li><code>rsync</code>：通过 ssh 或本地文件系统同步文件和文件夹</li>
<li><a target="_blank" rel="noopener" href="https://wireshark.org/"><code>wireshark</code></a> 和 <a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/wsug_html_chunked/AppToolstshark.html"><code>tshark</code></a>：抓包和网络调试工具</li>
<li><a target="_blank" rel="noopener" href="http://ngrep.sourceforge.net/"><code>ngrep</code></a>：网络层的 grep</li>
<li><code>host</code> 和 <code>dig</code>：DNS 查找</li>
<li><code>lsof</code>：列出当前系统打开文件的工具以及查看端口信息</li>
<li><code>dstat</code>：系统状态查看</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a>：高层次的多子系统总览</li>
<li><code>iostat</code>：硬盘使用状态</li>
<li><code>mpstat</code>： CPU 使用状态</li>
<li><code>vmstat</code>： 内存使用状态</li>
<li><code>htop</code>：top 的加强版</li>
<li><code>last</code>：登入记录</li>
<li><code>w</code>：查看处于登录状态的用户</li>
<li><code>id</code>：用户&#x2F;组 ID 信息</li>
<li><a target="_blank" rel="noopener" href="http://sebastien.godard.pagesperso-orange.fr/"><code>sar</code></a>：系统历史数据</li>
<li><a target="_blank" rel="noopener" href="http://www.ex-parrot.com/~pdw/iftop/"><code>iftop</code></a> 或 <a target="_blank" rel="noopener" href="https://github.com/raboof/nethogs"><code>nethogs</code></a>：套接字及进程的网络利用情况</li>
<li><code>ss</code>：套接字数据</li>
<li><code>dmesg</code>：引导及系统错误信息</li>
<li><code>sysctl</code>： 在内核运行时动态地查看和修改内核的运行参数</li>
<li><code>hdparm</code>：SATA&#x2F;ATA 磁盘更改及性能分析</li>
<li><code>lsblk</code>：列出块设备信息：以树形展示你的磁盘以及磁盘分区信息</li>
<li><code>lshw</code>，<code>lscpu</code>，<code>lspci</code>，<code>lsusb</code> 和 <code>dmidecode</code>：查看硬件信息，包括 CPU、BIOS、RAID、显卡、USB设备等</li>
<li><code>lsmod</code> 和 <code>modinfo</code>：列出内核模块，并显示其细节</li>
<li><code>fortune</code>，<code>ddate</code> 和 <code>sl</code>：额，这主要取决于你是否认为蒸汽火车和莫名其妙的名人名言是否“有用”</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/21/shells/Linux%20Troubleshooting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/21/shells/Linux%20Troubleshooting/" class="post-title-link" itemprop="url">Linux Trouble Shooting</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-21 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-21T00:00:00+00:00">2025-12-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>转载：<a target="_blank" rel="noopener" href="https://github.com/rahulrajaram/linux_troubleshooting">https://github.com/rahulrajaram/linux_troubleshooting</a></p>
</blockquote>
<p>Purpose: a single-page, production-ready cheatsheet for Linux&#x2F;SRE triage. Optimized for fast on-call </p>
<p>use: concise flags, copy-paste recipes, brief notes, and clear risk callouts.</p>
<h1 id="Binaries-ELF"><a href="#Binaries-ELF" class="headerlink" title="Binaries &amp; ELF"></a>Binaries &amp; ELF</h1><p>Cheat Card</p>
<ul>
<li>Linked libs: <code>ldd /path/to/bin</code> (security caveat: may execute code in rare cases)</li>
<li>ELF headers&#x2F;sections: <code>readelf -h /bin/ls</code>; sections: <code>readelf -S /bin/ls</code></li>
<li>Symbols (prefer readelf): <code>readelf -Ws /bin/ls | grep &#39; FUNC &#39;</code>; dynamic: <code>readelf -Ws -d /bin/ls</code></li>
<li>Disassemble: <code>objdump -d /bin/ls | less</code> (add <code>-M intel</code> for Intel syntax)</li>
<li>Symbols via nm: <code>nm -D /bin/ls | grep symbol_name</code></li>
<li>Requires: binutils (readelf&#x2F;objdump&#x2F;nm)</li>
</ul>
<h2 id="1-ldd"><a href="#1-ldd" class="headerlink" title="1. ldd"></a>1. ldd</h2><p>List shared library dependencies of executables and shared objects.</p>
<ul>
<li>Basic: <code>ldd /path/to/bin</code></li>
<li>Security caveat: may execute code in rare cases; avoid on untrusted binaries.</li>
<li>Alternative: <code>LD_TRACE_LOADED_OBJECTS=1 /lib64/ld-linux-x86-64.so.2 /path/to/bin</code> (still uses loader)</li>
</ul>
<h3 id="Text-Data-Utilities"><a href="#Text-Data-Utilities" class="headerlink" title="Text &amp; Data Utilities"></a>Text &amp; Data Utilities</h3><p>Cheat Card</p>
<ul>
<li>Search recursively: <code>grep -RIn --exclude-dir .git &#39;pattern&#39; .</code>; context: <code>-C2</code></li>
<li>Edit in-place: <code>sed -i.bak -E &#39;s/old/new/g&#39; file</code> (backup)</li>
<li>Summarize data: <code>awk -F, &#39;{a[$1]+=$2} END{for(k in a) print k,a[k]}&#39; file.csv</code></li>
<li>JSON parse: <code>jq -r &#39;.items[].metadata.name&#39; file.json</code></li>
<li>Compare dirs: <code>diff -ruN dir_old dir_new | less -R</code></li>
<li>Transform text: <code>tr -s &#39; &#39; | cut -d, -f1,3 | xargs -n1 echo</code></li>
<li>Safe temp: <code>mktemp -d</code> for dirs; files: <code>mktemp</code></li>
<li>Reverse lines: <code>rev &lt;file</code> (quick visual check)</li>
</ul>
<h2 id="2-grep"><a href="#2-grep" class="headerlink" title="2. grep"></a>2. grep</h2><ul>
<li>search for one or more expressions: <code>grep -E &#39;hello|world&#39; temp</code></li>
<li>search for one or more words: <code>grep -Ew &#39;hello|world&#39; temp</code></li>
<li>search for suffix matches: <code>grep -E &#39;hello(world|lolo)&#39; temp</code></li>
<li>search for suffixes matching regex: <code>grep -E &#39;hello[0-9]{3,}&#39; temp</code></li>
<li>recursive search in tree: <code>grep -RIn --exclude-dir .git --exclude=&#39;*.log&#39; &#39;pattern&#39; .</code></li>
<li>fixed strings (fast) and ignore case: <code>grep -Fni &#39;literal text&#39; file</code></li>
<li>context lines: <code>grep -R --color -n -C2 &#39;pattern&#39; .</code> (or <code>-A</code> after, <code>-B</code> before)</li>
<li>binary-skip and file names only: <code>grep -rI -l &#39;pattern&#39; .</code></li>
</ul>
<h2 id="3-sed"><a href="#3-sed" class="headerlink" title="3. sed"></a>3. sed</h2><p>What it does: stream editor for non-interactive find&#x2F;replace, line edits, and range selections.</p>
<ul>
<li>In-place with backup: <code>sed -i.bak -E &#39;s/old/new/g&#39; file</code></li>
<li>Delete matching lines: <code>sed -i &#39;/pattern/d&#39; file</code></li>
<li>Print lines between markers: <code>sed -n &#39;/BEGIN/,/END/p&#39; file</code></li>
<li>Replace with capture groups: <code>sed -E &#39;s/([0-9]{4})-([0-9]{2})-([0-9]{2})/\3-\2-\1/&#39; file</code></li>
<li>Insert before&#x2F;after match:<ul>
<li>Before: <code>sed &#39;/pattern/i\\inserted before&#39; file</code></li>
<li>After: <code>sed &#39;/pattern/a\\appended after&#39; file</code></li>
</ul>
</li>
<li>Trim trailing spaces: <code>sed -i &#39;s/[ \t]\+$//&#39; file</code></li>
<li>Multiple edits: <code>sed -E -e &#39;s/foo/bar/g&#39; -e &#39;/tmp/d&#39; file</code></li>
</ul>
<h2 id="4-awk"><a href="#4-awk" class="headerlink" title="4. awk"></a>4. awk</h2><p>What it does: text processing and quick data summarization using fields and expressions.</p>
<ul>
<li>Default FS is whitespace; set CSV FS: <code>awk -F, &#39;...&#39; file.csv</code></li>
<li>Select fields: <code>awk &#39;{print $1, $3}&#39; file</code></li>
<li>Filter rows: <code>awk &#39;$5 &gt; 100 {print $1, $5}&#39; file</code></li>
<li>Sum a column: <code>awk &#39;{s+=$3} END{print s}&#39; file</code></li>
<li>Group and sum by key: <code>awk &#39;{a[$1]+=$2} END{for (k in a) print k, a[k]}&#39; file</code></li>
<li>Pretty print: <code>awk &#39;{printf &quot;%-20s %10d\n&quot;, $1, $2}&#39; file</code></li>
<li>Count unique values: <code>awk &#39;{c[$1]++} END{for (k in c) print k, c[k]}&#39; file</code></li>
</ul>
<h1 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h1><p>Cheat Card</p>
<ul>
<li>Ports→PIDs: <code>ss -ltnp</code>; established only: <code>ss -tn state established</code></li>
<li>TCP detail: <code>ss -i dst &lt;ip&gt;</code> (rtt, cwnd, retrans)</li>
<li>Path&#x2F;source IP: <code>ip route get &lt;dest&gt;</code>; counters: <code>ip -s link show &lt;iface&gt;</code></li>
<li>Latency&#x2F;loss: <code>mtr -ezbw &lt;dest&gt;</code>; quick traceroute ICMP: <code>traceroute -I &lt;dest&gt;</code></li>
<li>Targeted capture: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> (or <code>port 53</code>, <code>icmp</code>)</li>
<li>DNS: <code>resolvectl query &lt;name&gt;</code> or <code>dig &lt;name&gt; A +short</code></li>
</ul>
<h2 id="5-ping"><a href="#5-ping" class="headerlink" title="5. ping"></a>5. ping</h2><ul>
<li>Compat: Linux; Root: may require CAP_NET_RAW depending on system; Requires: iputils-ping.</li>
<li><code>-4</code>: ping IPv4 only</li>
<li><code>-6</code>: ping IPv6 only</li>
<li><code>-A</code>: adapts to roundtrip time</li>
<li><code>-b</code>: allow pinging broadcast addresses</li>
<li><code>-I</code>: ping through an interface</li>
<li><code>-M</code>: set PMTU strategy</li>
<li><code>-s</code>: set packetsize (default is 56B)</li>
<li><code>-t</code>: set IP time-to-live</li>
<li><code>ping 224.0.0.1</code>: ping multicast address</li>
</ul>
<p>Notes:</p>
<ul>
<li>Using average <code>rtt</code> values, you can determine whether there are huge variations causing jitter, especially in RT applications</li>
<li>ping will report duplications, however, duplicate packets should never occur, and seem to be caused by inappropriate link-level retransmissions</li>
<li>ping will report damaged packets, suggesting broken hardware in the network Requires: iputils-ping.</li>
</ul>
<h2 id="6-ip"><a href="#6-ip" class="headerlink" title="6. ip"></a>6. ip</h2><ul>
<li>Compat: Linux; Root: not required for reads; Requires: iproute2.</li>
<li><code>ip addr</code>: Show information for all addresses</li>
<li><code>ip addr show dev wlo1</code>: Display information only for device wlo1</li>
<li><code>ip link</code>: Show information for all interfaces</li>
<li><code>ip link show dev wlo1</code>: Display information only for device wlo1</li>
<li><code>ip -s</code>: Display interface statistics (packets dropped, received, sent, etc.)</li>
<li>Quick recipes:<ul>
<li>Path and source IP: <code>ip route get &lt;dest&gt;</code></li>
<li>Interface counters: <code>ip -s link show &lt;iface&gt;</code> (rx&#x2F;tx errors, drops)</li>
<li>Neighbors&#x2F;ARP: <code>ip neigh</code> and <code>ip neigh show dev &lt;iface&gt;</code></li>
<li>Multicast: <code>ip maddr</code> or <code>ip maddr show dev &lt;iface&gt;</code></li>
</ul>
</li>
</ul>
<p>Example</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Query path and chosen <span class="built_in">source</span> IP</span></span><br><span class="line">ip route get 8.8.8.8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Expect: 8.8.8.8 via 192.168.1.1 dev wlo1 src 192.168.1.23</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ip route</code>: List all of the route entries in the kernel</li>
<li><code>ip route add</code>: Add a route entry to the kernel routing table</li>
<li><code>ip route replace</code>: Replace an existing route (add if not present)</li>
<li><code>ip maddr</code>: Display multicast information for all devices</li>
<li><code>ip maddr show dev wlo1</code></li>
<li><code>ip neigh show dev wlo1</code>: check for reachability of specific interfaces      Requires: iproute2.</li>
</ul>
<h2 id="7-arp"><a href="#7-arp" class="headerlink" title="7. arp"></a>7. arp</h2><ul>
<li>Compat: Legacy; prefer <code>ip neigh</code>; Requires: net-tools.</li>
<li><code>arp</code>: show all ARP table entries</li>
<li><code>arp -d address</code>: delete ARP entry for address</li>
<li><code>arp -s address hw_addr</code>: set up new table entry Note: legacy from net-tools; prefer <code>ip neigh</code>. Requires: net-tools.</li>
</ul>
<h2 id="8-arping"><a href="#8-arping" class="headerlink" title="8. arping"></a>8. arping</h2><ul>
<li>Compat: Linux; Root&#x2F;CAP_NET_RAW required; Package: arping (iputils-arping on some distros).</li>
<li><code>arping -I wlo1 192.168.0.1</code>: send ARP requests to host</li>
<li><code>arping -D -I wlo1 192.168.0.15</code>: check for duplicate MAC address Requires: arping (iputils-arping on some distros).</li>
</ul>
<h2 id="9-ethtool"><a href="#9-ethtool" class="headerlink" title="9. ethtool"></a>9. ethtool</h2><ul>
<li>Compat: Linux; Root for changing settings, read stats usually ok; Requires: ethtool.</li>
<li><code>ethtool -S wlo1</code>: print network statistics Requires: ethtool.</li>
</ul>
<h2 id="10-ss"><a href="#10-ss" class="headerlink" title="10. ss"></a>10. ss</h2><ul>
<li>Compat: Linux; Modern replacement for netstat; Requires: iproute2.</li>
<li><code>ss -a</code>: show all sockets</li>
<li><code>ss -o</code>: show all sockets with timer information</li>
<li><code>ss -p</code>: show process using the socket</li>
<li><code>ss -t|-u|-4|-6</code></li>
<li><code>ss -ltnp</code>: list listening TCP sockets with PIDs</li>
<li><code>ss -tn state established</code>: show established TCP only</li>
<li><code>ss -tn sport = :443</code> or <code>ss -tn dport = :443</code>: filter by port</li>
<li><code>ss -s</code>: summary stats (TCP states, mem)</li>
<li><code>ss -i</code>:<ul>
<li><code>ts</code>: show string “ts” if the timestamp option is set</li>
<li><code>sack</code>: show string “sack” if the sack option is set</li>
<li><code>ecn</code>: show string “ecn” if the explicit congestion notification option is set</li>
<li><code>ecnseen</code>: show string “ecnseen” if the saw ecn flag is found in received packets</li>
<li><code>fastopen</code>: show string “fastopen” if the fastopen option is set</li>
<li><code>cong_alg</code>: the congestion algorithm name, the default congestion algorithm is “cubic”</li>
<li><code>wscale:&lt;snd_wscale&gt;:&lt;rcv_wscale&gt;</code>: if window scale option is used, this field shows the send scale factor and receive scale factor</li>
<li><code>rto:&lt;icsk_rto&gt;</code>: tcp re-transmission timeout value, the unit is millisecond</li>
<li><code>backoff:&lt;icsk_backoff&gt;</code>: used for exponential backoff re-transmission, the actual re-transmission timeout value is icsk_rto &lt;&lt; icsk_backoff</li>
<li><code>rtt:&lt;rtt&gt;/&lt;rttvar&gt;</code>: rtt is the average round trip time, rttvar is the mean deviation of rtt, their units are millisecond</li>
<li><code>ato:&lt;ato&gt;</code>: ack timeout, unit is millisecond, used for delay ack mode</li>
<li><code>mss:&lt;mss&gt;</code>: max segment size</li>
<li><code>cwnd:&lt;cwnd&gt;</code>: congestion window size</li>
<li><code>pmtu:&lt;pmtu&gt;</code>: path MTU value</li>
<li><code>ssthresh:&lt;ssthresh&gt;</code>: tcp congestion window slow start threshold</li>
<li><code>bytes_acked:&lt;bytes_acked&gt;</code>: bytes acked</li>
<li><code>bytes_received:&lt;bytes_received&gt;</code>: bytes received</li>
<li><code>segs_out:&lt;segs_out&gt;</code>: segments sent out</li>
<li><code>segs_in:&lt;segs_in&gt;</code>: segments received</li>
<li><code>send &lt;send_bps&gt;bps</code>: egress bps</li>
<li><code>lastsnd:&lt;lastsnd&gt;</code>: how long time since the last packet sent, the unit is millisecond</li>
<li><code>lastrcv:&lt;lastrcv&gt;</code>: how long time since the last packet received, the unit is millisecond</li>
<li><code>lastack:&lt;lastack&gt;</code>: how long time since the last ack received, the unit is millisecond</li>
</ul>
</li>
<li><code>ss -A tcp,udp</code>: dump socket tables Requires: iproute2.</li>
</ul>
<h2 id="37-tcpdump"><a href="#37-tcpdump" class="headerlink" title="37. tcpdump"></a>37. tcpdump</h2><p>Compat: Linux; Root&#x2F;CAP_NET_RAW required for captures; Requires: tcpdump. What it does: capture packets for inspection and troubleshooting. Requires: tcpdump.</p>
<ul>
<li>Interface and no name resolution: <code>tcpdump -ni &lt;iface&gt;</code></li>
<li>Host or subnet: <code>tcpdump -ni &lt;iface&gt; host &lt;ip&gt;</code>; <code>tcpdump -ni &lt;iface&gt; net 10.0.0.0/8</code></li>
<li>Ports&#x2F;protocols: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> or <code>udp port 53</code></li>
<li>SYNs only (new TCP handshakes):</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">New TCP handshakes only (SYN without ACK)</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; &#x27;tcp[tcpflags] &amp; (tcp-syn) != 0 and tcp[tcpflags] &amp; (tcp-ack) == 0&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>DNS queries: <code>tcpdump -ni &lt;iface&gt; port 53</code></li>
<li>ICMP reachability: <code>tcpdump -ni &lt;iface&gt; icmp</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: tcpdump</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Capture full packets to a file</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -w capture.pcap</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Rotate captures every 5m, keep 6 files</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -G 300 -W 6 -w &#x27;cap-%Y%m%d%H%M%S.pcap&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="38-mtr"><a href="#38-mtr" class="headerlink" title="38. mtr"></a>38. mtr</h2><p>Compat: Linux; May need root&#x2F;CAP_NET_RAW for certain probe types; Requires: mtr. What it does: combines ping and traceroute to visualize latency and loss per hop.</p>
<ul>
<li>Run with extra info: <code>mtr -ezbw &lt;dest&gt;</code></li>
<li>Report mode (one-off): <code>mtr -ezbwrc 10 &lt;dest&gt;</code> Requires: mtr.</li>
</ul>
<h2 id="39-traceroute"><a href="#39-traceroute" class="headerlink" title="39. traceroute"></a>39. traceroute</h2><ul>
<li>Compat: Linux; Requires: traceroute; TCP mode may need CAP_NET_RAW&#x2F;root.</li>
<li><code>traceroute -I</code>: use ICMP echo for probes</li>
<li><code>traceroute -T</code>: use TCP SYN for probes Requires: traceroute.</li>
</ul>
<h2 id="40-nicstat"><a href="#40-nicstat" class="headerlink" title="40. nicstat"></a>40. nicstat</h2><ul>
<li>Compat: Linux; Not widely packaged; Consider <code>sar -n</code>&#x2F;<code>ethtool -S</code> alternatives.</li>
<li>nicstat prints out network statistics for all network cards (NICs), including packets, kilobytes per second, average packet sizes and more.</li>
<li><code>nicstat -t</code>: show CPU stats</li>
<li><code>nicstat</code>: show network interface stats Requires: nicstat (may need third-party repo&#x2F;source on some distros).</li>
</ul>
<p>Metrics reference (click to expand)</p>
<ul>
<li><code>Time</code> - The time corresponding to the end of the sample shown, in HH:MM:SS format (24-hour clock).</li>
<li><code>Int</code> - The interface name.</li>
<li><code>rKB/s, InKB</code> - Kilobytes&#x2F;second read (received).</li>
<li><code>wKB/s, OutKB</code> - Kilobytes&#x2F;second written (transmitted).</li>
<li><code>rMbps, RdMbps</code> - Megabits&#x2F;second read (received).</li>
<li><code>wMbps, WrMbps</code> - Megabits&#x2F;second written (transmitted).</li>
<li><code>rPk/s, InSeg, InDG</code> - Packets (TCP Segments, UDP Datagrams)&#x2F;second read (received).</li>
<li><code>wPk/s, OutSeg, OutDG</code> - Packets (TCP Segments, UDP Datagrams)&#x2F;second written (transmitted).</li>
<li><code>rAvs</code> - Average size of packets read (received).</li>
<li><code>wAvs</code> - Average size of packets written (transmitted).</li>
<li><code>%Util</code> - Percentage utilization of the interface. For full-duplex interfaces, this is the greater of rKB&#x2F;s or wKB&#x2F;s as a percentage of the interface speed. For half-duplex interfaces, rKB&#x2F;s and wKB&#x2F;s are summed.</li>
<li><code>%rUtil, %wUtil</code> - Percentage utilization for bytes read and written, respectively.</li>
<li><code>Sat</code> - Saturation. This the number of errors&#x2F;second seen for the interface<ul>
<li>an indicator the interface may be approaching saturation. This statistic is combined from a number of kernel statistics. It is recommended to use the ‘-x’ option to see more individual statistics (those mentioned below) when attempting to diagnose a network issue.</li>
</ul>
</li>
<li><code>IErr</code> - Packets received that could not be processed because they contained errors</li>
<li><code>OErr</code> - Packets that were not successfully transmitted because of errors</li>
<li><code>Coll</code> - Ethernet collisions during transmit.</li>
<li><code>NoCP</code> - No-can-puts. This is when an incoming packet can not be put to the process reading the socket. This suggests the local process is unable to process incoming packets in a timely manner.</li>
<li><code>Defer</code> - Defer Transmits. Packets without collisions where first transmit attempt was delayed because the medium was busy.</li>
<li><code>Reset</code> - tcpEstabResets. The number of times TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state.</li>
<li><code>AttF</code> - tcpAttemptFails - The number of times that TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state.</li>
<li><code>%ReTX</code> - Percentage of TCP segments retransmitted - that is, the number of TCP segments transmitted containing one or more previously transmitted octets.</li>
<li><code>InConn</code> - tcpPassiveOpens - The number of times that TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state.</li>
<li><code>OutCon</code> - tcpActiveOpens - The number of times that TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state.</li>
<li><code>Drops</code> - tcpHalfOpenDrop + tcpListenDrop + tcpListenDropQ0. tcpListenDrop and tcpListenDropQ0 - Number of connections dropped from the completed connection queue and incomplete connection queue, respectively. tcpHalfOpenDrops - Number of connections dropped after the initial SYN packet was received.</li>
</ul>
<h2 id="41-nslookup"><a href="#41-nslookup" class="headerlink" title="41. nslookup"></a>41. nslookup</h2><ul>
<li>Compat: Legacy; prefer <code>dig</code>&#x2F;<code>resolvectl</code>; Requires: dnsutils&#x2F;bind-utils.query Internet name servers interactively</li>
<li><code>nslookup &lt;domain&gt;</code></li>
<li>Note: legacy tool. Prefer <code>dig</code> for detailed queries or <code>resolvectl</code> on systemd-based systems. Requires: dnsutils&#x2F;bind-utils (for nslookup&#x2F;dig).</li>
<li>Quick equivalents: <code>dig &lt;domain&gt; A +short</code>; <code>resolvectl query &lt;domain&gt;</code></li>
</ul>
<h2 id="42-host"><a href="#42-host" class="headerlink" title="42. host"></a>42. host</h2><ul>
<li>Compat: Linux; Requires: bind9-host&#x2F;bind-utils.<br>host is a simple utility for performing DNS lookups. It is normally used to convert names to IP addresses and vice versa.</li>
<li><code>host &lt;domain&gt;</code></li>
<li>Examples: <code>host -t A &lt;domain&gt;</code>; reverse lookup: <code>host &lt;ip&gt;</code></li>
<li>Tip: for more control, use <code>dig</code> (if installed) or <code>resolvectl</code>. Requires: bind9-host (Debian&#x2F;Ubuntu) or bind-utils.</li>
</ul>
<h2 id="43-iwconfig"><a href="#43-iwconfig" class="headerlink" title="43. iwconfig"></a>43. iwconfig</h2><ul>
<li>Compat: Legacy; prefer <code>iw</code>; Requires: wireless-tools.</li>
<li><code>iwconfig wlo1</code>: show WLAN config:</li>
<li>Note: <code>iwconfig</code> is legacy (wireless-tools). Prefer <code>iw</code> for modern drivers, e.g., <code>iw dev</code>, <code>iw dev wlo1 link</code>. Requires: wireless-tools. Modern alternative: iw.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wlo1      IEEE 802.11  ESSID:&quot;NETGEAR97&quot;  </span><br><span class="line">      Mode:Managed  Frequency:2.462 GHz  Access Point: C4:04:15:58:60:C7   </span><br><span class="line">      Bit Rate=72.2 Mb/s   Tx-Power=20 dBm   </span><br><span class="line">      Retry short limit:7   RTS thr=2347 B   Fragment thr:off</span><br><span class="line">      Power Management:off</span><br><span class="line">      Link Quality=70/70  Signal level=-32 dBm  </span><br><span class="line">      Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">      Tx excessive retries:0  Invalid misc:22932   Missed beacon:0</span><br></pre></td></tr></table></figure>

<h2 id="44-brctl"><a href="#44-brctl" class="headerlink" title="44. brctl"></a>44. brctl</h2><ul>
<li>Compat: Legacy; prefer <code>ip link</code> and <code>bridge</code>; Requires: bridge-utils.</li>
<li>brctl is used to set up, maintain, and inspect the ethernet bridge configuration in the linux kernel. Legacy: prefer <code>ip link add name br0 type bridge</code> and <code>bridge</code> (iproute2) tooling. Requires: bridge-utils.</li>
</ul>
<h1 id="Kernel-Tracing"><a href="#Kernel-Tracing" class="headerlink" title="Kernel &amp; Tracing"></a>Kernel &amp; Tracing</h1><p>Cheat Card</p>
<ul>
<li>Kernel logs: <code>dmesg -T -l err,crit,alert,emerg</code></li>
<li>Syscalls: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file</code></li>
<li>Modules: <code>lsmod | head</code>, <code>modprobe &lt;name&gt;</code> (caution), <code>sysctl -a | grep tcp</code></li>
<li>Optional advanced:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf (<span class="keyword">if</span> installed)</span></span><br><span class="line">perf top</span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bpftrace one-liner (Requires: bpftrace)</span></span><br><span class="line">bpftrace -e &#x27;tracepoint:syscalls:sys_enter_openat &#123; @[comm] = count(); &#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-dmesg"><a href="#11-dmesg" class="headerlink" title="11. dmesg"></a>11. dmesg</h2><ul>
<li><p>Compat: Linux; May be restricted by <code>kernel.dmesg_restrict</code>; Requires: util-linux.</p>
</li>
<li><p><code>dmesg --level=&lt;LEVEL&gt;</code> where <code>&lt;LEVEL&gt;</code> is:</p>
<ul>
<li><code>emerg</code> - system is unusable.</li>
<li><code>alert</code> - action must be taken immediately.</li>
<li><code>crit</code> - critical conditions.</li>
<li><code>err</code> - error conditions.</li>
<li><code>warn</code> - warning conditions.</li>
<li><code>notice</code> - normal but significant condition.</li>
<li><code>info</code> - informational.</li>
<li><code>debug</code> - debug-level messages.</li>
</ul>
</li>
<li><p><code>dmesg -k</code>: print kernel messages</p>
</li>
<li><p><code>dmesg -f=&lt;FACILITY&gt;</code> where <code>&lt;FACILITY&gt;</code> is:</p>
<ul>
<li><code>kern</code>: Kernel messages.</li>
<li><code>user</code>: User-level messages.</li>
<li><code>mail</code>: Mail system.</li>
<li><code>daemon</code>: System daemons.</li>
<li><code>auth</code>: Security&#x2F;authorization messages.</li>
<li><code>syslog</code>: Internal syslogd messages.</li>
<li><code>lpr</code>: Line printer subsystem.</li>
<li><code>news</code>: Network news subsystem.</li>
</ul>
</li>
<li><p><code>dmesg -T</code>: human readable timestamps</p>
</li>
</ul>
<h2 id="12-lsmod"><a href="#12-lsmod" class="headerlink" title="12. lsmod"></a>12. lsmod</h2><ul>
<li>Compat: Linux; Lists modules without root; Requires: kmod.</li>
<li>Show loaded kernel modules and sizes&#x2F;dependencies.</li>
<li>Quick peek: <code>lsmod | head</code></li>
<li>Module info (version, params): <code>modinfo &lt;module&gt;</code></li>
</ul>
<h2 id="13-modprobe"><a href="#13-modprobe" class="headerlink" title="13. modprobe"></a>13. modprobe</h2><ul>
<li>Compat: Linux; Root required; Caution: can destabilize systems; Requires: kmod.Add or remove modules from the Linux kernel.</li>
<li>Load: <code>modprobe &lt;module&gt;</code>; with params: <code>modprobe &lt;module&gt; key=value</code></li>
<li>Unload: <code>modprobe -r &lt;module&gt;</code> (fails if in use)</li>
<li>Caution: loading&#x2F;unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</li>
</ul>
<h1 id="Disk-Filesystems"><a href="#Disk-Filesystems" class="headerlink" title="Disk &amp; Filesystems"></a>Disk &amp; Filesystems</h1><p>Cheat Card</p>
<ul>
<li>Space&#x2F;inodes: <code>df -h</code> and <code>df -i</code>; biggest dirs: <code>du -xhd1 /path | sort -h</code></li>
<li>IO saturation: <code>iostat -xz 1</code>; per-proc IO: <code>pidstat -d 1</code>, <code>iotop -oPa</code></li>
<li>Devices&#x2F;FS: <code>lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</code>; mounts: <code>findmnt</code></li>
<li>Mount ops: <code>mount --bind olddir newdir</code>; remount ro: <code>mount -o remount,ro /mnt</code></li>
</ul>
<p>Inventory and health</p>
<ul>
<li>Device tree: <code>lsblk -o NAME,TYPE,SIZE,FSTYPE,MOUNTPOINT,MODEL</code></li>
<li>Identify filesystem UUID&#x2F;TYPE: <code>blkid</code></li>
<li>SMART check (if supported): <code>smartctl -H /dev/sdX</code> and <code>smartctl -a /dev/sdX</code> (Requires: smartmontools)</li>
<li>NVMe info: <code>nvme list</code>; <code>nvme smart-log /dev/nvme0</code> (Requires: nvme-cli)</li>
</ul>
<p><strong>Notes</strong></p>
<ul>
<li>iostat quick view (Requires: sysstat): <code>iostat -xz 1</code> (watch <code>await</code>, <code>%util</code>, <code>r/s</code>, <code>w/s</code>)</li>
<li>findmnt: show mount hierarchy or lookup by target: <code>findmnt /mount/point</code></li>
<li>adds or removes modules from the Linux Kernel</li>
<li>Caution: loading&#x2F;unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</li>
</ul>
<h2 id="14-dd-DANGER-DESTRUCTIVE-—-READ-FIRST"><a href="#14-dd-DANGER-DESTRUCTIVE-—-READ-FIRST" class="headerlink" title="14. dd (DANGER: DESTRUCTIVE — READ FIRST)"></a>14. dd (DANGER: DESTRUCTIVE — READ FIRST)</h2><ul>
<li>Compat: Linux; Root required for raw devices; Highly destructive when writing; Requires: coreutils.</li>
<li>Danger: dd will overwrite data with no confirmation. Double-check devices (e.g., <code>/dev/sdX</code>) and consider read-only or safer alternatives first. Use <code>lsblk</code>, <code>blkid</code> to verify targets.</li>
<li>Safer tips: for copies, consider <code>pv</code> to visualize throughput; for imaging, <code>dcfldd</code>; for testing, prefer non-destructive reads.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: wipes target disk. Verify device with lsblk/blkid.</span></span><br><span class="line">dd if=/dev/zero of=/dev/sda bs=4k status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Verify a drive is zeroed (non-zero bytes check)</span></span><br><span class="line">dd if=/dev/sda status=none | hexdump -C | grep -q &#x27;[^00]&#x27; || echo &quot;All zeros&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Fill a file with random data (example size)</span></span><br><span class="line">dd if=/dev/urandom of=myfile bs=6703104 count=1 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: <span class="built_in">clone</span> a partition to another (same size/align). Verify both!</span></span><br><span class="line">dd if=/dev/sda3 of=/dev/sdb3 bs=4096 status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: write an image to a USB device. Verify device path first!</span></span><br><span class="line">dd if=/path/to/bootimage.img of=/dev/sdc bs=4M status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Quick r/w benchmark <span class="keyword">for</span> a file (non-destructive <span class="built_in">read</span> + temp write)</span></span><br><span class="line">dd if=/home/$user/bigfile of=/dev/null status=progress</span><br><span class="line">dd if=/dev/zero of=/home/$user/bigfile bs=1M count=1000 oflag=dsync status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Sequential device <span class="built_in">read</span> throughput sample (approx 1 GiB)</span></span><br><span class="line">dd if=/dev/sda of=/dev/null bs=1024k count=1024 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Create a swapfile (example: 8 GiB), <span class="keyword">then</span> mkswap + swapon</span></span><br><span class="line">dd if=/dev/zero of=swapfile bs=1MiB count=$((8*1024)) status=progress</span><br></pre></td></tr></table></figure>

<h2 id="15-jq"><a href="#15-jq" class="headerlink" title="15. jq"></a>15. jq</h2><ul>
<li>Compat: Linux; Requires: jq package.<br>What it does: parse&#x2F;query&#x2F;transform JSON on the command line. Requires: jq.</li>
<li>Pretty-print: <code>jq . file.json</code></li>
<li>Extract field list: <code>jq -r &#39;.items[].metadata.name&#39; file.json</code></li>
<li>Filter by condition: <code>jq &#39;.[] | select(.status==&quot;RUNNING&quot;)&#39; file.json</code></li>
<li>Transform and count: <code>jq &#39;[.[] | .level] | group_by(.) | map({level: .[0], count: length})&#39; file.json</code></li>
<li>Sort and top N: <code>jq &#39;sort_by(.time) | reverse | .[0:5]&#39; file.json</code></li>
<li>From journald: <code>journalctl -o json | jq -r &#39;select(.PRIORITY&lt;=3) | .MESSAGE&#39;</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: jq — show high-priority messages from journald</span></span><br><span class="line">journalctl -o json | jq -r &#x27;select(.PRIORITY&lt;=3) | .MESSAGE&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>Keys and length: <code>jq &#39;keys, length&#39; file.json</code></li>
</ul>
<h2 id="16-diff"><a href="#16-diff" class="headerlink" title="16. diff"></a>16. diff</h2><ul>
<li>Compat: Linux; Requires: diffutils.</li>
<li>unified diff: <code>diff -u old.txt new.txt</code></li>
<li>recursive dirs: <code>diff -ruN dir_old dir_new</code></li>
<li>ignore whitespace changes: <code>diff -u -w old new</code></li>
<li>handle CRLF: <code>diff -u --strip-trailing-cr a b</code></li>
<li>color (if supported): <code>diff --color=auto -u a b</code></li>
<li>apply a patch: <code>patch -p1 &lt; change.diff</code></li>
</ul>
<h2 id="17-uname"><a href="#17-uname" class="headerlink" title="17. uname"></a>17. uname</h2><ul>
<li>Compat: Linux; Requires: coreutils.</li>
<li>get all details about the computer</li>
</ul>
<h2 id="18-sync-fsync"><a href="#18-sync-fsync" class="headerlink" title="18. sync&#x2F;fsync"></a>18. sync&#x2F;fsync</h2><ul>
<li>Compat: Linux; <code>sync</code> is user command; <code>fsync</code> is a syscall.</li>
<li><code>fsync</code> is a syscall that flushes a file’s in-memory data and metadata to storage. From the shell, use <code>sync</code> (flush all dirty data) or <code>syncfs</code> (flush a filesystem) when available.</li>
</ul>
<h2 id="19-mkswap"><a href="#19-mkswap" class="headerlink" title="19. mkswap"></a>19. mkswap</h2><ul>
<li>Compat: Linux; Root required; Requires: util-linux.</li>
<li><code>-c</code>: check if blocks are corrupted</li>
<li><code>-p</code>: set pagesize</li>
</ul>
<h2 id="20-fsck"><a href="#20-fsck" class="headerlink" title="20. fsck"></a>20. fsck</h2><ul>
<li>Compat: Linux; Root required; Avoid on mounted filesystems; Requires: e2fsprogs for ext*.</li>
<li>check for file system consistency:<ul>
<li>The superblock is checked for inconsistencies in:<ul>
<li>File system size</li>
<li>Number of inodes</li>
<li>Free-block count</li>
<li>Free-inode count</li>
</ul>
</li>
<li>Each inode is checked for inconsistencies in:<ul>
<li>Format and type</li>
<li>Link count</li>
<li>Duplicate block</li>
<li>Bad block numbers</li>
<li>Inode size</li>
</ul>
</li>
</ul>
</li>
<li>see: <a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19455-01/805-7228/6j6q7uf0e/index.html">https://docs.oracle.com/cd/E19455-01/805-7228/6j6q7uf0e/index.html</a></li>
<li>Caution: avoid running fsck on a mounted filesystem (except with specific fs support); prefer read-only mounts or maintenance windows.</li>
</ul>
<p>Extended notes</p>
<ul>
<li>ext* specifics: <code>e2fsck</code> checks ext2&#x2F;3&#x2F;4; use <code>-f</code> to force, <code>-n</code> for read-only, <code>-p</code> for preen (auto-fix safe issues). Requires: e2fsprogs.</li>
<li>Bad blocks (DANGER): <code>badblocks</code> scans devices for bad sectors; write-mode is destructive. Prefer read-only first.</li>
</ul>
<p>Examples</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Read-only badblocks scan (non-destructive)</span></span><br><span class="line">sudo badblocks -sv /dev/sdX</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DANGER: write-mode destructive scan — data loss</span></span><br><span class="line">sudo badblocks -wsv /dev/sdX</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ext* filesystem check (read-only)</span></span><br><span class="line">sudo e2fsck -fn /dev/sdXN</span><br></pre></td></tr></table></figure>

<h2 id="21-mount"><a href="#21-mount" class="headerlink" title="21. mount"></a>21. mount</h2><ul>
<li>Compat: Linux; Root required unless user mounts configured; Requires: util-linux.</li>
<li><code>mount -a [-t type] [-O optlist]</code>: mount all FSs mentioned in fstab to be mounted</li>
<li><code>-o</code>: override the settings in fstab</li>
<li><code>mount --bind olddir newdir</code>: remount part of the hierarchy elsewhere</li>
<li><code>mount --move</code>: move mounted tree to another place</li>
<li>Caution: <code>--bind/--move</code> and remounts can impact running services; ensure correct <code>fstab</code> for persistence and have rollback plan.</li>
</ul>
<h2 id="22-umount"><a href="#22-umount" class="headerlink" title="22. umount"></a>22. umount</h2><ul>
<li>Compat: Linux; Root required for system mounts; Requires: util-linux.</li>
<li>unmount from a mountpoint</li>
</ul>
<h2 id="23-chown"><a href="#23-chown" class="headerlink" title="23. chown"></a>23. chown</h2><ul>
<li><code>chown root:staff /u</code>: change owner and group</li>
</ul>
<h2 id="24-sysctl"><a href="#24-sysctl" class="headerlink" title="24. sysctl"></a>24. sysctl</h2><ul>
<li>Compat: Linux; Root required for <code>-w</code>; Persistence via <code>/etc/sysctl.d</code>; Requires: procps.</li>
<li>configure kernel parameters at runtime</li>
<li><code>sysctl -a | grep &quot;tcp&quot;</code></li>
<li>Caution: <code>sysctl -w</code> changes take effect immediately; persist only via <code>/etc/sysctl.d/*.conf</code> after validation.</li>
<li>Read a key: <code>sysctl net.ipv4.tcp_congestion_control</code></li>
<li>Set a key (runtime): <code>sysctl -w vm.swappiness=10</code></li>
<li>Persist: create <code>/etc/sysctl.d/99-local.conf</code> with <code>vm.swappiness = 10</code>, then <code>sysctl --system</code></li>
</ul>
<h2 id="25-iotop"><a href="#25-iotop" class="headerlink" title="25. iotop"></a>25. iotop</h2><ul>
<li>Compat: Linux; Root required; Needs kernel taskstats&#x2F;delay accounting; Python tool.</li>
<li><code>iotop -o</code>: only show threads doing I&#x2F;O</li>
<li><code>iotop -p &lt;PID1&gt;,&lt;PID2&gt;,...</code>: list of processes to monitor</li>
<li><code>iotop -a</code>: show accumulated IO rather than diff Requires: iotop.</li>
</ul>
<h2 id="26-netstat"><a href="#26-netstat" class="headerlink" title="26. netstat"></a>26. netstat</h2><ul>
<li>Compat: Legacy; prefer <code>ss</code>; Requires: net-tools.</li>
</ul>
<h1 id="Processes-Scheduling"><a href="#Processes-Scheduling" class="headerlink" title="Processes &amp; Scheduling"></a>Processes &amp; Scheduling</h1><p>Cheat Card</p>
<ul>
<li>Top offenders: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code></li>
<li>Threads view: <code>top -H</code> or <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code></li>
<li>Target processes:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Preview before signaling</span></span><br><span class="line">pgrep -a &lt;name&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Then send a scoped, safe signal (example: TERM)</span></span><br><span class="line">pkill -TERM -u &lt;user&gt; -f &#x27;&lt;exact-pattern&gt;&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>Over time: <code>pidstat -u 1 -p &lt;pid&gt;</code> (CPU) and <code>pidstat -d 1</code> (IO)</li>
<li>Find PIDs: <code>pidof &lt;proc&gt;</code>; list threads: <code>ps -Lp &lt;pid&gt;</code></li>
<li>Niceness: start <code>nice -n 10 cmd</code>; adjust: <code>renice -n 10 -p &lt;pid&gt;</code></li>
<li>Locks: <code>/proc/locks</code> shows current file locks (read-only)</li>
<li>Sessions: users <code>who</code>; recent logins <code>last | head</code></li>
<li>Schedule: <code>crontab -l</code> list; <code>crontab -e</code> edit</li>
<li>Deprecated in many distros; prefer <code>ss</code>.</li>
<li>Common mappings:<ul>
<li><code>netstat -tulpn</code> -&gt; <code>ss -tulpn</code></li>
<li><code>netstat -anp</code> -&gt; <code>ss -anp</code></li>
<li><code>netstat -s</code> -&gt; <code>ss -s</code></li>
</ul>
</li>
</ul>
<h2 id="27-top"><a href="#27-top" class="headerlink" title="27. top"></a>27. top</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li>Dynamic process view with CPU, memory, and load summaries.</li>
<li>Key CPU line fields: <code>us</code> (user), <code>sy</code> (system), <code>ni</code>, <code>id</code> (idle), <code>wa</code> (iowait), <code>hi/si</code> (IRQ&#x2F;softIRQ), <code>st</code> (steal).</li>
<li>Key per-proc fields: <code>%CPU</code>, <code>%MEM</code>, <code>VIRT</code> (virtual), <code>RES</code> (resident), <code>SHR</code> (shared), <code>TIME+</code> (CPU time).</li>
<li><code>top -E m|g</code>: scale as mega|giga bytes</li>
<li><code>top -H</code>: thread-mode</li>
<li><code>top -i</code>: show idle processes</li>
<li><code>top -o RES|VIRT|SWAP</code>, etc: sort by attribute</li>
<li><code>top -O</code>: output fields: print all available sort-attributes</li>
<li><code>top -p pid1,pid2,...</code>: monitor only these PIDs</li>
<li><code>top -1</code>: show per-CPU stats</li>
</ul>
<h2 id="28-vmstat"><a href="#28-vmstat" class="headerlink" title="28. vmstat"></a>28. vmstat</h2><ul>
<li>Compat: Linux; Requires: procps.<br>Useful to get so&#x2F;si information</li>
<li>Report virtual memory statistics</li>
<li><code>vmstat -a</code>: number active&#x2F;inactive memory</li>
<li><code>vmstat --stats</code>: various statistics</li>
</ul>
<p>Interpretation tips</p>
<ul>
<li><code>r</code> runnable &gt; number of CPUs indicates run-queue contention.</li>
<li><code>b</code> blocked processes (often IO wait); correlate with <code>%wa</code> in top&#x2F;mpstat.</li>
<li><code>si/so</code> swap in&#x2F;out: sustained non-zero values indicate memory pressure.</li>
<li>Use <code>vmstat 1</code> for near-real-time view.</li>
</ul>
<h2 id="29-strace"><a href="#29-strace" class="headerlink" title="29. strace"></a>29. strace</h2><ul>
<li>Compat: Linux; May be restricted by ptrace scope; Requires: strace.<br>Trace system calls and signals.</li>
<li>Attach to a PID: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</code></li>
<li>Run a program under strace: <code>strace -o strace.log -s 200 -vv -f -ttT your_cmd --arg</code></li>
<li>Syscall time summary: <code>strace -c -p &lt;pid&gt;</code></li>
<li>Filter a path: <code>strace -ttT -e trace=file -P /etc/resolv.conf -p &lt;pid&gt;</code></li>
<li>Notes: <code>-f</code> follows forks; <code>-ttT</code> adds timestamps and syscall durations; <code>-s</code> increases string size.</li>
<li>trace system calls and signals</li>
</ul>
<h2 id="30-slabtop"><a href="#30-slabtop" class="headerlink" title="30. slabtop"></a>30. slabtop</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li><code>slabtop</code>: display kernel slab cache information in real time</li>
<li>Sort by size: <code>slabtop -s c</code>; one-shot: <code>slabtop -o</code></li>
</ul>
<h2 id="31-uptime"><a href="#31-uptime" class="headerlink" title="31. uptime"></a>31. uptime</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li>information about how long the system has been up, and load averages</li>
</ul>
<h2 id="32-htop"><a href="#32-htop" class="headerlink" title="32. htop"></a>32. htop</h2><ul>
<li>Compat: Linux; Requires: htop package.</li>
<li>like top, but prettier</li>
</ul>
<h2 id="33-ps"><a href="#33-ps" class="headerlink" title="33. ps"></a>33. ps</h2><ul>
<li>Compat: Linux; Requires: procps.<br>Cheat Card</li>
<li>Top CPU: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code></li>
<li>Top RSS: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code></li>
<li>Tree view: <code>ps -ejH</code> (or <code>ps axjf</code>)</li>
<li>By command: <code>ps -C nginx -o pid,ppid,cmd,%mem,%cpu</code></li>
<li>Threads of a PID: <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code></li>
<li><code>ps aux</code>: show all processes</li>
<li><code>ps axjf</code> - print process tree</li>
<li><code>ps a</code> - Lift the BSD-style “only yourself” restriction</li>
<li><code>ps -A</code> - select all processes</li>
<li><code>ps -d</code> - select all processes except session leaders</li>
<li><code>ps g</code> - select all processes including session leaders</li>
<li><code>ps Ta</code> - all process associated with this terminal</li>
<li><code>ps r</code> - restrict to running processes</li>
<li><code>ps --pid pidlist</code> - restrict to pidlist processes</li>
<li><code>ps -s|--sid</code> - select by session ID</li>
<li><code>ps t ttylist</code> - select by TTY list</li>
<li><code>ps U|-U</code> - select by effective user-id</li>
<li><code>ps s</code> - display signals</li>
<li><code>ps f</code> - ASCII art process hierarchy</li>
<li><code>ps ax -o rss,pid,user,pcpu,command --sort -%cpu</code>: sort by %cpu</li>
<li><code>ps ax -o rss,pid,user,pcpu,command --sort -rss</code>: sort by rss</li>
</ul>
<p>process states:</p>
<ul>
<li><code>D</code> - uninterruptible sleep (usually IO)</li>
<li><code>I</code> - Idle kernel thread</li>
<li><code>R</code> - running or runnable (on run queue)</li>
<li><code>S</code> - interruptible sleep (waiting for an event to complete)</li>
<li><code>T</code> - stopped by job control signal</li>
<li><code>t</code> - stopped by debugger during the tracing</li>
<li><code>W</code> - paging (not valid since the 2.6.xx kernel)</li>
<li><code>X</code> - dead (should never be seen)</li>
<li><code>Z</code> - defunct (“zombie”) process, terminated but not reaped by its parent</li>
</ul>
<p>see STANDARD FORMAT SPECIFIERS in <code>man ps</code></p>
<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><p>Cheat Card</p>
<ul>
<li>CPU saturation: <code>mpstat -P ALL 1</code> (sys&#x2F;iowait&#x2F;irq&#x2F;soft)</li>
<li>Per-core view in top: <code>top -1</code>; over time per PID: <code>pidstat -u 1 -p &lt;pid&gt;</code></li>
<li>Interrupt spikes: <code>mpstat -I CPU 1</code></li>
</ul>
<h2 id="34-mpstat"><a href="#34-mpstat" class="headerlink" title="34. mpstat"></a>34. mpstat</h2><ul>
<li>Compat: Linux; Requires: sysstat.</li>
</ul>
<p>The mpstat command writes to standard output activities for each available processor, processor 0 being the first one. Global average activities among all processors are also reported. Requires: sysstat.</p>
<p>Interpretation tips</p>
<ul>
<li>High <code>%iowait</code>: CPUs idle while waiting on disk IO (check iostat).</li>
<li>High <code>%irq/%soft</code>: heavy interrupts&#x2F;softirqs (often network or storage).</li>
<li>High <code>%steal</code>: hypervisor stealing time (noisy neighbor in a VM).</li>
<li>Compare per-core: hotspots can be isolated to specific cores (affinity).</li>
<li><code>CPU</code>: Processor number. The keyword all indicates that statistics are calculated as averages among all processors.</li>
<li><code>%usr</code>: Show the percentage of CPU utilization that occurred while executing at the user level (application).</li>
<li><code>%nice</code>: Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</li>
<li><code>%sys</code>: Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.</li>
<li><code>%iowait</code>: Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I&#x2F;O request.</li>
<li><code>%irq</code>: Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.</li>
<li><code>%soft</code>: Show the percentage of time spent by the CPU or CPUs to service software interrupts.</li>
<li><code>%steal</code>: Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</li>
<li><code>%guest</code>: Show the percentage of time spent by the CPU or CPUs to run a virtual processor.</li>
<li><code>%gnice</code>: Show the percentage of time spent by the CPU or CPUs to run a niced guest.</li>
<li><code>mpstat -I</code>: report interrupt stats<ul>
<li>of interrupts per CPU</li>
<li>of times a particular interrupt occurred</li>
</ul>
</li>
</ul>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Cheat Card</p>
<ul>
<li>Snapshot: <code>free -h --wide</code>; paging: <code>vmstat -a 1</code> (si&#x2F;so)</li>
<li>Per-proc memory: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code>; deep dive: <code>pmap -x &lt;pid&gt;</code></li>
<li>OOM evidence: <code>dmesg -T | grep -i oom</code> or <code>journalctl -k -g OOM</code></li>
</ul>
<h2 id="35-free"><a href="#35-free" class="headerlink" title="35. free"></a>35. free</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li><code>used</code> - Used memory (calculated as total - free - buffers - cache)</li>
<li><code>free</code> - Unused memory (MemFree and SwapFree in &#x2F;proc&#x2F;meminfo)</li>
<li><code>shared</code> - Memory used (mostly) by tmpfs (Shmem in &#x2F;proc&#x2F;meminfo)</li>
<li><code>buffers</code> - Memory used by kernel buffers (Buffers in &#x2F;proc&#x2F;meminfo)</li>
<li><code>cache</code> - Memory used by the page cache and slabs (Cached and SReclaimable in &#x2F;proc&#x2F;meminfo)</li>
<li><code>buff/cache</code> - Sum of buffers and cache</li>
<li><code>available</code> - Estimation of how much memory is available for starting new applications, without swapping. Unlike the data provided by the cache or free fields, this field takes into account page cache and also that not all reclaimable memory slabs will be reclaimed due to items being in use (MemAvailable in &#x2F;proc&#x2F;meminfo, available on kernels 3.14, emulated on kernels 2.6.27+, otherwise the same as free)</li>
<li><code>free -l</code>: show low-high memory breakdown</li>
<li><code>free --wide</code>: show free memory stats<br>Interpretation tips</li>
<li><code>available</code> approximates memory free for new apps without swapping; don’t confuse <code>free</code> with usable memory.</li>
<li>High <code>buff/cache</code> is normal; it’s the page cache and reclaimable slabs.<br>Examples</li>
<li>Human-readable snapshot: <code>free -h --wide</code></li>
<li>Example output:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           31Gi        2.1Gi       22Gi        312Mi       7.2Gi        28Gi</span><br><span class="line">Swap:           8Gi           0B        8Gi</span><br></pre></td></tr></table></figure>

<h2 id="36-sar"><a href="#36-sar" class="headerlink" title="36. sar"></a>36. sar</h2><ul>
<li><p>Compat: Linux; Requires: sysstat; history needs <code>sadc</code> enabled.<br>Cheat Card</p>
</li>
<li><p>CPU load&#x2F;queue: <code>sar -q 1 5</code>; memory: <code>sar -r 1 5</code></p>
</li>
<li><p>IO bw&#x2F;ops: <code>sar -b 1 5</code>; per-device: <code>sar -d 1 5</code> (watch <code>await</code>, <code>%util</code>)</p>
</li>
<li><p>Network: <code>sar -n DEV 1 5</code>; TCP: <code>sar -n TCP,ETCP 1 5</code></p>
</li>
<li><p>Paging: <code>sar -B 1 5</code> (<code>pgsteal</code>, <code>pgscan</code>, <code>majflt/s</code>)<br>Requires: sysstat (includes pidstat).<br>Field reference (click to expand)</p>
</li>
<li><p><code>sar -B</code>: report paging stats</p>
<ul>
<li><code>gpgin/s</code> - Total number of kilobytes the system paged in from disk per second.</li>
<li><code>pgpgout/s</code> - Total number of kilobytes the system paged out to disk per second.</li>
</ul>
</li>
<li><p><code>fault/s</code> - Number of page faults (major + minor) made by the system per second. This is not a count of page faults that generate I&#x2F;O, because some page faults can be resolved without I&#x2F;O.</p>
<ul>
<li><code>majflt/s</code> - Number of major faults the system has made per second, those which have required loading a memory page from disk.</li>
<li><code>pgfree/s</code> - Number of pages placed on the free list by the system per second.</li>
<li><code>pgscank/s</code> - Number of pages scanned by the kswapd daemon per second.</li>
<li><code>pgscand/s</code> - Number of pages scanned directly per second.</li>
<li><code>pgsteal/s</code> - Number of pages the system has reclaimed from cache (pagecache and swapcache) per second to satisfy its memory demands.</li>
<li><code>%vmeff</code> - Calculated as pgsteal &#x2F; pgscan, this is a metric of the efficiency of page reclaim. If it is near 100% then almost every page coming off the tail of the inactive list is being reaped. If it gets too low (e.g. less than 30%) then the virtual memory is having some difficulty. This field is displayed as zero if no pages have been scanned during the interval of time.</li>
</ul>
</li>
<li><p><code>sar -b</code>: Report I&#x2F;O and transfer rate statistics.</p>
<ul>
<li><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I&#x2F;O request to a physical device. Multiple logical requests can be combined into a single I&#x2F;O request to the device. A transfer is of indeterminate size.</li>
<li><code>rtps</code> - Total number of read requests per second issued to physical devices.</li>
<li><code>wtps</code> - Total number of write requests per second issued to physical devices.</li>
<li><code>bread/s</code> - Total amount of data read from the devices in blocks per second. Blocks are equivalent to sectors and therefore have a size of 512 bytes.</li>
<li><code>bwrtn/s</code> - Total amount of data written to devices in blocks per second.</li>
</ul>
</li>
<li><p><code>sar -d</code>: report activity for each block device</p>
</li>
<li><p><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I&#x2F;O request to a physical device. Multiple logical requests can be combined into a single I&#x2F;O request to the device. A transfer is of indeterminate size.</p>
<ul>
<li><code>rkB/s</code> - Number of kilobytes read from the device per second.</li>
<li><code>wkB/s</code> - Number of kilobytes written to the device per second.</li>
<li><code>areq-sz</code> - The average size (in kilobytes) of the I&#x2F;O requests that were issued to the device. Note: In previous versions, this field was known as avgrq-sz and was expressed in sectors.</li>
<li><code>aqu-sz</code> - The average queue length of the requests that were issued to the device. Note: In previous versions, this field was known as avgqu-sz.</li>
<li><code>await</code> - The average time (in milliseconds) for I&#x2F;O requests issued to the device to be served. This includes the time spent by the requests in queue and the time spent servicing them.</li>
<li><code>svctm</code> - The average service time (in milliseconds) for I&#x2F;O requests that were issued to the device. Warning! Do not trust this field any more. This field will be removed in a future sysstat version.</li>
<li><code>%util</code> - Percentage of elapsed time during which I&#x2F;O requests were issued to the device (bandwidth utilization for the device). Device saturation occurs when this value is close to 100% for devices serving requests serially. But for devices serving requests in parallel, such as RAID arrays and modern SSDs, this number does not reflect their performance limits.</li>
</ul>
</li>
<li><p><code>sar -F</code>: display stats. for currently mounted FSs:</p>
<ul>
<li><code>MBfsfree</code> - Total amount of free space in megabytes (including space available only to privileged user).</li>
<li><code>MBfsused</code> - Total amount of space used in megabytes.</li>
<li><code>%fsused</code> - Percentage of filesystem space used, as seen by a privileged user.</li>
<li><code>%ufsused</code> - Percentage of filesystem space used, as seen by an unprivileged user.</li>
<li><code>Ifree</code> - Total number of free file nodes in filesystem.</li>
<li><code>Iused</code> - Total number of file nodes used in filesystem.</li>
<li><code>%Iused</code> - Percentage of file nodes used in filesystem.</li>
</ul>
</li>
<li><p><code>sar -m</code>: power management statistics:</p>
<ul>
<li><code>MHz</code> - Instantaneous CPU clock frequency in MHz.<br>  With the FAN keyword, statistics about fans speed are reported. The following values are displayed:</li>
<li><code>rpm</code> - Fan speed expressed in revolutions per minute.</li>
<li><code>drpm</code> - This field is calculated as the difference between current fan speed (rpm) and its low limit (fan_min).</li>
<li><code>DEVICE</code> - Sensor device name.<br>  With the FREQ keyword, statistics about CPU clock frequency are reported. The following value is displayed:</li>
<li><code>wghMHz</code> - Weighted average CPU clock frequency in MHz. Note that the cpufreq-stats driver must be compiled in the kernel for this option to work.</li>
</ul>
<p>  With the IN keyword, statistics about voltage inputs are reported. The following values are displayed:</p>
<ul>
<li><code>inV</code> - Voltage input expressed in Volts.</li>
<li><code>%in</code> - Relative input value. A value of 100% means that voltage input has reached its high limit (in_max) whereas a value of 0% means that it has reached its low limit (in_min).</li>
<li><code>DEVICE</code> - Sensor device name.</li>
</ul>
<p>  With the USB keyword, the sar command takes a snapshot of all the USB devices currently plugged into the system. At the end of the report, sar will display a summary of all those USB devices. The following values are displayed:</p>
<ul>
<li><code>BUS</code> - Root hub number of the USB device.</li>
<li><code>idvendor</code> - Vendor ID number (assigned by USB organization).</li>
<li><code>idprod</code> - Product ID number (assigned by Manufacturer).</li>
<li><code>maxpower</code> - Maximum power consumption of the device (expressed in mA).</li>
<li><code>manufact</code> - Manufacturer name.</li>
<li><code>product</code> - Product name.</li>
</ul>
</li>
<li><p><code>sar -n DEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxpck/s</code> - Total number of packets received per second.</li>
<li><code>txpck/s</code> - Total number of packets transmitted per second.</li>
<li><code>rxkB/s</code> - Total number of kilobytes received per second.</li>
<li><code>txkB/s</code> - Total number of kilobytes transmitted per second.</li>
<li><code>rxcmp/s</code> - Number of compressed packets received per second (for cslip etc.).</li>
<li><code>txcmp/s</code> - Number of compressed packets transmitted per second.</li>
<li><code>rxmcst/s</code> - Number of multicast packets received per second.</li>
<li><code>%ifutil</code> - Utilization percentage of the network interface. For half-duplex interfaces, utilization is calculated using the sum of rxkB&#x2F;s and txkB&#x2F;s as a percentage of the interface speed. For full-duplex, this is the greater of rxkB&#x2F;S or txkB&#x2F;s.</li>
</ul>
</li>
<li><p><code>sar -n EDEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxerr/s</code> - Total number of bad packets received per second.</li>
<li><code>txerr/s</code> - Total number of errors that happened per second while transmitting packets.</li>
<li><code>coll/s</code> - Number of collisions that happened per second while transmitting packets.</li>
<li><code>rxdrop/s</code> - Number of received packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txdrop/s</code> - Number of transmitted packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txcarr/s</code> - Number of carrier-errors that happened per second while transmitting packets.</li>
<li><code>rxfram/s</code> - Number of frame alignment errors that happened per second on received packets.</li>
<li><code>rxfifo/s</code> - Number of FIFO overrun errors that happened per second on received packets.</li>
<li><code>txfifo/s</code> - Number of FIFO overrun errors that happened per second on transmitted packets.</li>
</ul>
</li>
<li><p><code>sar -n ICMP</code>:</p>
<ul>
<li><code>imsg/s</code> - The total number of ICMP messages which the entity received per second [icmpInMsgs]. Note that this counter includes all those counted by ierr&#x2F;s.</li>
<li><code>omsg/s</code> - The total number of ICMP messages which this entity attempted to send per second [icmpOutMsgs]. Note that this counter includes all those counted by oerr&#x2F;s.</li>
<li><code>iech/s</code> - The number of ICMP Echo (request) messages received per second [icmpInEchos].</li>
<li><code>iechr/s</code> - The number of ICMP Echo Reply messages received per second [icmpInEchoReps].</li>
<li><code>oech/s</code> - The number of ICMP Echo (request) messages sent per second [icmpOutEchos].</li>
<li><code>oechr/s</code> - The number of ICMP Echo Reply messages sent per second [icmpOutEchoReps].</li>
<li><code>itm/s</code> - The number of ICMP Timestamp (request) messages received per second [icmpInTimestamps].</li>
<li><code>itmr/s</code> - The number of ICMP Timestamp Reply messages received per second [icmpInTimestampReps].</li>
<li><code>otm/s</code> - The number of ICMP Timestamp (request) messages sent per second [icmpOutTimestamps].</li>
<li><code>otmr/s</code> - The number of ICMP Timestamp Reply messages sent per second [icmpOutTimestampReps].</li>
<li><code>iadrmk/s</code> - The number of ICMP Address Mask Request messages received per second [icmpInAddrMasks].</li>
<li><code>oadrmk/s</code> - The number of ICMP Address Mask Request messages sent per second [icmpOutAddrMasks].</li>
<li><code>oadrmkr/s</code> - The number of ICMP Address Mask Reply messages sent per second [icmpOutAddrMaskReps].</li>
</ul>
</li>
<li><p><code>sar -n EICMP</code>: Extended ICMP stats (errors, dest unreachable, time exceeded). Focus on spikes in <code>ierr/s</code> and <code>oerr/s</code>, and patterns in unreachable&#x2F;time- exceeded when debugging path issues.</p>
</li>
<li><p><code>sar -n EIP</code>: Extended IPv4 stats (header errors, addr errors, discards, no routes, reassembly, fragment fails). Use to spot header errors and routing&#x2F; no-route conditions.</p>
</li>
<li><p><code>sar -n IP6</code>: IPv6 per-protocol counters (receive&#x2F;deliver&#x2F;forward, multicast, fragmentation). Check for anomalies similar to IPv4.</p>
</li>
<li><p><code>sar -n EIP6</code>: Extended IPv6 errors and routing stats (header&#x2F;addr errors, discards, no routes, reassembly&#x2F;frag). Useful for IPv6-specific troubleshooting.</p>
</li>
<li><p><code>sar -n SOCK</code>:</p>
<ul>
<li><code>totsck</code> - Total number of sockets used by the system.</li>
<li><code>tcpsck</code> - TCP sockets in use; <code>tcp-tw</code> - TIME_WAIT sockets.</li>
</ul>
</li>
<li><p><code>sar -n SOFT</code>:</p>
<ul>
<li><code>total/s</code> - The total number of network frames processed per second.</li>
<li><code>dropd/s</code> - The total number of network frames dropped per second because there was no room on the processing queue.</li>
<li><code>squeezd/s</code> - The number of times the softirq handler function terminated per second because its budget was consumed or the time limit was reached, but more work could have been done.</li>
<li><code>rx_rps/s</code> - The number of times the CPU has been woken up per second to process packets via an inter-processor interrupt.</li>
<li><code>flw_lim/s</code> - The number of times the flow limit has been reached per second. Flow limiting is an optional RPS feature that can be used to limit the number of packets queued to the backlog for each flow to a certain amount. This can help ensure that smaller flows are processed even though much larger flows are pushing packets in.</li>
</ul>
</li>
<li><p><code>sar -n TCP</code>:</p>
<ul>
<li><code>active/s</code> - The number of times TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state per second [tcpActiveOpens].</li>
<li><code>passive/s</code> - The number of times TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state per second [tcpPassiveOpens].</li>
<li><code>iseg/s</code> - The total number of segments received per second, including those received in error [tcpInSegs]. This count includes segments received on currently established connections.</li>
<li><code>oseg/s</code> - The total number of segments sent per second, including those on current connections but excluding those containing only retransmitted octets [tcpOutSegs].</li>
</ul>
</li>
<li><p><code>sar -n ETCP</code>:</p>
<ul>
<li><code>atmptf/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times per second TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state [tcpAttemptFails].</li>
<li><code>estres/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state [tcpEstabResets].</li>
<li><code>retrans/s</code> - The total number of segments retransmitted per second - that is, the number of TCP segments transmitted containing one or more previously transmitted octets [tcpRetransSegs].</li>
<li><code>isegerr/s</code> - The total number of segments received in error (e.g., bad TCP checksums) per second [tcpInErrs].</li>
<li><code>orsts/s</code> - The number of TCP segments sent per second containing the RST flag [tcpOutRsts].</li>
</ul>
</li>
<li><p><code>sar -n UDP</code>:</p>
<ul>
<li><code>idgm/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmerr/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul>
</li>
<li><p><code>sar -n UDP6</code>:</p>
<ul>
<li><code>idgm6/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm6/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport6/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmer6/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul>
</li>
<li><p><code>sar -q</code>:</p>
<ul>
<li><code>runq-sz</code> - Run queue length (number of tasks waiting for run time).</li>
<li><code>plist-sz</code> - Number of tasks in the task list.</li>
<li><code>ldavg-1</code> - System load average for the last minute. The load average is calculated as the average number of runnable or running tasks (R state), and the number of tasks in uninterruptible sleep (D state) over the specified interval.</li>
<li><code>ldavg-5</code> - System load average for the past 5 minutes.</li>
<li><code>ldavg-15</code> - System load average for the past 15 minutes.</li>
<li><code>blocked</code> - Number of tasks currently blocked, waiting for I&#x2F;O to complete.</li>
</ul>
</li>
<li><p><code>sar -r</code>:</p>
<ul>
<li><code>kbmemfree</code> - Amount of free memory available in kilobytes.</li>
<li><code>kbavail</code> - Estimate of how much memory in kilobytes is available for starting new applications, without swapping. The estimate takes into account that the system needs some page cache to function well, and that not all reclaimable memory slabs will be reclaimable, due to items being in use. The impact of those factors will vary from system to system.</li>
</ul>
</li>
<li><p><code>kbmemused</code> - Amount of used memory in kilobytes (calculated as total installed memory - kbmemfree - kbbuffers - kbcached - kbslab).</p>
<ul>
<li><code>%memused</code> - Percentage of used memory.</li>
<li><code>kbbuffers</code> - Amount of memory used as buffers by the kernel in kilobytes.</li>
<li><code>kbcached</code> - Amount of memory used to cache data by the kernel in kilobytes.</li>
</ul>
</li>
<li><p><code>kbcommit</code> - Amount of memory in kilobytes needed for current workload. This is an estimate of how much RAM&#x2F;swap is needed to guarantee that there never is out of memory.</p>
</li>
<li><p><code>%commit</code> - Percentage of memory needed for current workload in relation to the total amount of memory (RAM+swap). This number may be greater than 100% because the kernel usually overcommits memory.</p>
</li>
<li><p><code>kbactive</code> - Amount of active memory in kilobytes (memory that has been used more recently and usually not reclaimed unless absolutely necessary).</p>
</li>
<li><p><code>kbinact</code> - Amount of inactive memory in kilobytes (memory which has been less recently used. It is more eligible to be reclaimed for other purposes).</p>
<ul>
<li><code>kbdirty</code> - Amount of memory in kilobytes waiting to get written back to the disk.</li>
<li><code>kbanonpg</code> - Amount of non-file backed pages in kilobytes mapped into userspace page tables.</li>
<li><code>kbslab</code> - Amount of memory in kilobytes used by the kernel to cache data structures for its own use.</li>
<li><code>kbkstack</code> - Amount of memory in kilobytes used for kernel stack space.</li>
<li><code>kbpgtbl</code> - Amount of memory in kilobytes dedicated to the lowest level of page tables.</li>
<li><code>kbvmused</code> - Amount of memory in kilobytes of used virtual address space.</li>
</ul>
</li>
<li><p><code>sar -S</code>:</p>
<ul>
<li><code>kbswpfree</code> - Amount of free swap space in kilobytes.</li>
<li><code>kbswpused</code> - Amount of used swap space in kilobytes.</li>
<li><code>%swpused</code> - Percentage of used swap space.</li>
</ul>
</li>
<li><p><code>kbswpcad</code> - Amount of cached swap memory in kilobytes. This is memory that once was swapped out, is swapped back in but still also is in the swap area (if memory is needed it doesn’t need to be swapped out again because it is already in the swap area. This saves I&#x2F;O).</p>
<ul>
<li><code>%swpcad</code> - Percentage of cached swap memory in relation to the amount of used swap space.</li>
</ul>
</li>
<li><p><code>sar -u</code>:</p>
</li>
<li><p><code>%user</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field includes time spent running virtual processors.</p>
</li>
<li><p><code>%usr</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field does NOT include time spent running virtual processors.</p>
</li>
<li><p><code>%nice</code> - Percentage of CPU utilization that occurred while executing at the user level with nice priority.</p>
</li>
<li><p><code>%system</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field includes time spent servicing hardware and software interrupts.</p>
</li>
<li><p><code>%sys</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field does NOT include time spent servicing hardware or software interrupts.</p>
</li>
<li><p><code>%iowait</code> - Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I&#x2F;O request.</p>
</li>
<li><p><code>%steal</code> - Percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</p>
<ul>
<li><code>%irq</code> - Percentage of time spent by the CPU or CPUs to service hardware interrupts.</li>
<li><code>%soft</code> - Percentage of time spent by the CPU or CPUs to service software interrupts.</li>
<li><code>%guest</code> - Percentage of time spent by the CPU or CPUs to run a virtual processor.</li>
<li><code>%gnice</code> - Percentage of time spent by the CPU or CPUs to run a niced guest.</li>
</ul>
</li>
<li><p><code>%idle</code> - Percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I&#x2F;O request.</p>
</li>
<li><p><code>sar -v</code>:</p>
<ul>
<li><code>dentunusd</code> - Number of unused cache entries in the directory cache.</li>
<li><code>file-nr</code> - Number of file handles used by the system.</li>
<li><code>inode-nr</code> - Number of inode handlers used by the system.</li>
<li><code>pty-nr</code> - Number of pseudo-terminals used by the system.</li>
</ul>
</li>
<li><p><code>sar -W</code>: Report swapping statistics. The following values are displayed:</p>
<ul>
<li><code>pswpin/s</code> - Total number of swap pages the system brought in per second.</li>
<li><code>pswpout/s</code> - Total number of swap pages the system brought out per second.</li>
</ul>
</li>
<li><p><code>sar -w</code>: Report task creation and system switching activity.</p>
<ul>
<li><code>proc/s</code> - Tasks created per second; <code>cswch/s</code> - context switches per second.</li>
</ul>
</li>
<li><p><code>sar -y</code>: Report TTY devices activity. The following values are displayed:</p>
</li>
<li><p><code>rcvin/s</code> - Number of receive interrupts per second for current serial line. Serial line number is given in the TTY column.</p>
<ul>
<li><code>xmtin/s</code> - Number of transmit interrupts per second for current serial line.</li>
<li><code>framerr/s</code> - Number of frame errors per second for current serial line.</li>
<li><code>prtyerr/s</code> - Number of parity errors per second for current serial line.</li>
<li><code>brk/s</code> - Number of breaks per second for current serial line.</li>
<li><code>ovrun/s</code> - Number of overrun errors per second for current serial line.</li>
</ul>
</li>
</ul>
<h2 id="45-pidstat"><a href="#45-pidstat" class="headerlink" title="45. pidstat"></a>45. pidstat</h2><ul>
<li>Compat: Linux; Requires: sysstat.</li>
<li>monitor individual tasks currently being managed Requires: sysstat.</li>
</ul>
<p>Cheat Card</p>
<ul>
<li>CPU by PID: <code>pidstat -u 1 -p &lt;pid&gt;</code> (watch <code>%usr/%system/%wait</code>)</li>
<li>IO by PID: <code>pidstat -d 1 -p &lt;pid&gt;</code> (check <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code>)</li>
<li>Memory faults: <code>pidstat -r 1 -p &lt;pid&gt;</code> (watch <code>majflt/s</code>)</li>
<li>Threads: <code>pidstat -t -u 1 -p &lt;pid&gt;</code></li>
<li><code>pidstat -d</code>:<ul>
<li>Key fields: <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code> (IO wait), <code>kB_ccwr/s</code> (cancelled writes).</li>
</ul>
</li>
<li><code>pidstat -R</code>: Report realtime priority and scheduling policy information. The following values may be displayed:<ul>
<li>Key fields: <code>prio</code>, <code>policy</code>.</li>
</ul>
</li>
<li><code>pidstat -r</code>: Report page faults and memory utilization.<br>  When reporting statistics for individual tasks, the following values may be displayed:<ul>
<li>Key fields: <code>majflt/s</code> (major faults), <code>RSS</code>, <code>%MEM</code>.<br>  When reporting global statistics for tasks and all their children, the following values may be displayed:</li>
<li>With children: <code>majflt-nr</code>, <code>minflt-nr</code> summarize faults.</li>
</ul>
</li>
<li><code>pidstat -s</code>: Report stack utilization. The following values may be displayed:<ul>
<li>Key fields: <code>StkRef</code> (used), <code>StkSize</code> (reserved).</li>
</ul>
</li>
<li><code>pidstat -t</code>: Also display statistics for threads associated with selected tasks. List process and threads</li>
<li><code>pidstat -u</code>: Report CPU utilization.<br>  When reporting statistics for individual tasks, the following values may be displayed:<ul>
<li>Key fields: <code>%usr</code>, <code>%system</code>, <code>%wait</code>, <code>%CPU</code>, <code>CPU</code>.<br>  When reporting global statistics for tasks and all their children, the following values may be displayed:</li>
<li>With children: <code>usr-ms</code>, <code>system-ms</code>, <code>guest-ms</code> summarize CPU time.</li>
</ul>
</li>
</ul>
<h2 id="46-lsof"><a href="#46-lsof" class="headerlink" title="46. lsof"></a>46. lsof</h2><ul>
<li>Compat: Linux; May require root to see all descriptors; Requires: lsof.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># List all open files</span><br><span class="line">lsof</span><br><span class="line"></span><br><span class="line"># Processes using a file? (fuser equivalent)</span><br><span class="line">lsof /path/to/file</span><br><span class="line"></span><br><span class="line"># Open files within a directory</span><br><span class="line">lsof +D /path</span><br><span class="line"></span><br><span class="line"># Files by user</span><br><span class="line">lsof -u name</span><br><span class="line">lsof -u name1,name2</span><br><span class="line">lsof -u name1 -u name2</span><br><span class="line"></span><br><span class="line"># By program name</span><br><span class="line">lsof -c apache</span><br><span class="line"></span><br><span class="line"># AND&#x27;ing selection conditions</span><br><span class="line">lsof -u www-data -c apache</span><br><span class="line"></span><br><span class="line"># By pid</span><br><span class="line">lsof -p 1</span><br><span class="line"></span><br><span class="line"># Except certain pids</span><br><span class="line">lsof -p ^1</span><br><span class="line"></span><br><span class="line"># TCP and UDP connections</span><br><span class="line">lsof -i</span><br><span class="line">lsof -i tcp # TCP connections</span><br><span class="line">lsof -i udp # UDP connections</span><br><span class="line"></span><br><span class="line"># By port</span><br><span class="line">lsof -i :25</span><br><span class="line">lsof -i :smtp</span><br><span class="line">lsof -i udp:53</span><br><span class="line">lsof -i tcp:80</span><br><span class="line"></span><br><span class="line"># All network activity by a user</span><br><span class="line">lsof -a -u name1 -i</span><br><span class="line"></span><br><span class="line">lsof -N # NFS use</span><br><span class="line">lsof -U # UNIX domain socket use</span><br><span class="line"></span><br><span class="line"># List PIDs</span><br><span class="line">lsof -t -i</span><br><span class="line"># Danger: broad kill; preview and scope carefully before use</span><br><span class="line">kill -9 $(lsof -t -i) # Kill all programs w/network activity</span><br></pre></td></tr></table></figure>

<p>Requires: lsof.</p>
<h2 id="51-pmap"><a href="#51-pmap" class="headerlink" title="51. pmap"></a>51. pmap</h2><ul>
<li>Compat: Linux; Requires: procps; <code>-X</code> needs procps-ng.</li>
<li><code>pmap 29740 -X</code>: show Address,Perm,Offset,Device,Inode,Size,Rss,Pss,Referenced,Anonymous,LazyFree, ShmemPmdMapped,Shared_Hugetlb,Private_Hugetlb,Swap,SwapPss,Locked,THPeligible, Mapping Requires: procps.<br>Common recipes</li>
<li>Largest mappings first: <code>pmap -x &lt;pid&gt; | sort -nrk 3 | head</code> (by RSS KB)</li>
<li>Totals summary: <code>pmap &lt;pid&gt;</code> (last line shows total)</li>
</ul>
<h2 id="52-blktrace"><a href="#52-blktrace" class="headerlink" title="52. blktrace"></a>52. blktrace</h2><ul>
<li>Compat: Linux; Root required; Needs kernel block trace support; Requires: blktrace.</li>
<li>blktrace is a block layer IO tracing mechanism which provides detailed information about request queue operations up to user space. There are three major components: a kernel component, a utility to record the i&#x2F;o trace information for the kernel to user space, and utilities to analyse and view the trace information.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Trace block I/O on /dev/sda and parse</span></span><br><span class="line">sudo blktrace -d /dev/sda -o - | blkparse -i -</span><br></pre></td></tr></table></figure>
<p>Requires: blktrace.<br>outputs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">CPU0 (8,0):</span><br><span class="line"> Reads Queued:         385,     1540KiB     Writes Queued:           0,        0KiB</span><br><span class="line"> Read Dispatches:       75,     1544KiB     Write Dispatches:        4,       16KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:          315,     1260KiB     Write Merges:            0,        0KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            63             Timer unplugs:           0</span><br><span class="line">CPU1 (8,0):</span><br><span class="line"> Reads Queued:         406,     1624KiB     Writes Queued:          13,      996KiB</span><br><span class="line"> Read Dispatches:       71,     1620KiB     Write Dispatches:       10,      992KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          336,     1344KiB     Write Merges:            2,      200KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            68             Timer unplugs:           0</span><br><span class="line">CPU2 (8,0):</span><br><span class="line"> Reads Queued:        1531,     6152KiB     Writes Queued:          30,      120KiB</span><br><span class="line"> Read Dispatches:      257,     6152KiB     Write Dispatches:        3,      108KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:         1277,     5108KiB     Write Merges:           24,       96KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           255             Timer unplugs:           0</span><br><span class="line">CPU3 (8,0):</span><br><span class="line"> Reads Queued:        1266,     5852KiB     Writes Queued:          23,       92KiB</span><br><span class="line"> Read Dispatches:      279,     5852KiB     Write Dispatches:       21,       92KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          987,     3948KiB     Write Merges:            2,        8KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           279             Timer unplugs:           1</span><br><span class="line"></span><br><span class="line">Total (8,0):</span><br><span class="line"> Reads Queued:        3588,    15168KiB     Writes Queued:          66,     1208KiB</span><br><span class="line"> Read Dispatches:      682,    15168KiB     Write Dispatches:       38,     1208KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:         2915,    11660KiB     Write Merges:           28,      304KiB</span><br><span class="line"> IO unplugs:           665             Timer unplugs:           1</span><br></pre></td></tr></table></figure>

<h2 id="53-btrace"><a href="#53-btrace" class="headerlink" title="53. btrace"></a>53. btrace</h2><ul>
<li>Compat: Linux; Wrapper script from blktrace; Root required.</li>
<li>The btrace script provides a quick and easy way to do live tracing of block devices. It calls blktrace on the specified devices and pipes the output through blkparse for formatting. See blktrace (8) for more in-depth information about how blktrace works.</li>
<li><code>btrace /dev/sda</code> Requires: blktrace.</li>
</ul>
<h2 id="54-tr"><a href="#54-tr" class="headerlink" title="54. tr"></a>54. tr</h2><ul>
<li>Compat: Linux; Requires: coreutils.<br>Translate, squeeze, and&#x2F;or delete characters from standard input, writing to standard output.</li>
<li><code>tr &#39;\n&#39; &#39;,&#39;</code>: convert new lines to commas</li>
<li>squeeze repeats: <code>tr -s &#39; &#39; &lt; file</code> (collapse runs of spaces)</li>
<li>delete chars: <code>tr -d &#39;\r&#39; &lt; file</code> (remove CR)</li>
<li>keep only printable: <code>tr -cd &#39;[:print:]\n&#39; &lt; file</code></li>
<li>case convert: <code>tr &#39;[:upper:]&#39; &#39;[:lower:]&#39; &lt; file</code></li>
</ul>
<h2 id="55-cut"><a href="#55-cut" class="headerlink" title="55. cut"></a>55. cut</h2><ul>
<li>Compat: Linux; Requires: coreutils.</li>
<li>select CSV fields: <code>cut -d, -f1,3 file.csv</code></li>
<li>ranges: <code>cut -d: -f1-3 /etc/passwd</code></li>
<li>bytes&#x2F;chars: <code>cut -b1-10 file</code>; <code>cut -c1-20 file</code></li>
<li>complement: <code>cut -d, -f1 --complement file.csv</code></li>
<li>with headers: pair with <code>head -1</code> to see column indexes</li>
</ul>
<h2 id="56-xargs"><a href="#56-xargs" class="headerlink" title="56. xargs"></a>56. xargs</h2><ul>
<li>Compat: Linux; Requires: findutils; GNU <code>-r</code> may vary on BusyBox.<br>Build and run argument lists; combine with <code>find</code> and null-terminated records for safety.</li>
<li>safe null delim: <code>find . -type f -name &#39;*.log&#39; -print0 | xargs -0 rm -f</code></li>
<li>limit args per call: <code>xargs -n 1 -I{} sh -c &#39;echo {}&#39;</code></li>
<li>parallelism: <code>xargs -P 4 -n 1 cmd</code> (run 4 at a time)</li>
<li>interactive confirm: <code>xargs -p rm</code> (ask before each batch)</li>
<li>do nothing on empty input: <code>xargs -r cmd</code> (GNU)</li>
</ul>
<h1 id="Logs-Systemd"><a href="#Logs-Systemd" class="headerlink" title="Logs &amp; Systemd"></a>Logs &amp; Systemd</h1><p>Cheat Card</p>
<ul>
<li>Unit status: <code>systemctl status &lt;unit&gt;</code>; failed: <code>systemctl list-units --failed</code></li>
<li>Hot errors: <code>journalctl -xeu &lt;unit&gt;</code>; follow: <code>journalctl -fu &lt;unit&gt;</code></li>
<li>Boot scoping: <code>journalctl -b</code> and <code>-b -1</code>; size: <code>journalctl --disk-usage</code></li>
</ul>
<h2 id="Systemd-basics"><a href="#Systemd-basics" class="headerlink" title="Systemd basics"></a>Systemd basics</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Unit status and enablement</span></span><br><span class="line">systemctl status &lt;unit&gt;</span><br><span class="line">systemctl is-active &lt;unit&gt;</span><br><span class="line">systemctl is-enabled &lt;unit&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Failed units overview</span></span><br><span class="line">systemctl list-units --failed</span><br><span class="line">journalctl -xe  # recent critical logs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Restart and verify logs from this boot</span></span><br><span class="line">systemctl restart &lt;unit&gt;</span><br><span class="line">journalctl -u &lt;unit&gt; -b -n 50</span><br></pre></td></tr></table></figure>
<h2 id="Journal-essentials"><a href="#Journal-essentials" class="headerlink" title="Journal essentials"></a>Journal essentials</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Recent errors <span class="keyword">for</span> a unit and live follow</span></span><br><span class="line">journalctl -xeu &lt;unit&gt;</span><br><span class="line">journalctl -fu &lt;unit&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Time window and priority</span></span><br><span class="line">journalctl -u &lt;unit&gt; --since &quot;1 hour ago&quot; --until now</span><br><span class="line">journalctl -p err..alert -b</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Previous boot</span></span><br><span class="line">journalctl -b -1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">JSON output piped to jq (Requires: jq)</span></span><br><span class="line">journalctl -u &lt;unit&gt; -o json | jq -r &#x27;.MESSAGE&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="Journal-management"><a href="#Journal-management" class="headerlink" title="Journal management"></a>Journal management</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disk usage and vacuum</span></span><br><span class="line">journalctl --disk-usage</span><br><span class="line">journalctl --vacuum-size=1G</span><br><span class="line">journalctl --vacuum-time=7d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Make logs persistent (requires root; edit journald.conf)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/systemd/journald.conf: <span class="built_in">set</span> Storage=persistent</span></span><br><span class="line">systemctl restart systemd-journald</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Tip: tune RateLimitIntervalSec/RateLimitBurst to manage <span class="built_in">log</span> storms</span></span><br></pre></td></tr></table></figure>
<h2 id="Resolved-DNS"><a href="#Resolved-DNS" class="headerlink" title="Resolved (DNS)"></a>Resolved (DNS)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Overall resolver status</span></span><br><span class="line">resolvectl status</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Query using systemd-resolved</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Flush caches</span></span><br><span class="line">resolvectl flush-caches</span><br></pre></td></tr></table></figure>

<h1 id="Security-Audit"><a href="#Security-Audit" class="headerlink" title="Security &amp; Audit"></a>Security &amp; Audit</h1><p>Cheat Card</p>
<ul>
<li>SELinux mode: <code>getenforce</code>; recent denials: <code>ausearch -m AVC -ts recent</code></li>
<li>AppArmor status: <code>aa-status</code>; set complain&#x2F;enforce on a profile</li>
<li>Audit rule example: <code>auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</code><br>SELinux</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Current mode and temporary permissive (diagnostic; requires root)</span></span><br><span class="line">getenforce</span><br><span class="line">setenforce 0  # Caution: reduces enforcement</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Contexts and recent denials</span></span><br><span class="line">ls -Z</span><br><span class="line">ps -eZ | head</span><br><span class="line">ausearch -m AVC -ts recent</span><br><span class="line">journalctl -t setroubleshoot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Manage booleans (example: allow httpd network connect)</span></span><br><span class="line">getsebool -a | grep httpd</span><br><span class="line">setsebool -P httpd_can_network_connect on</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: selinux-utils/policycoreutils; setroubleshoot (optional)</span></span><br></pre></td></tr></table></figure>
<p>AppArmor</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Status and service</span></span><br><span class="line">aa-status</span><br><span class="line">systemctl status apparmor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Toggle a profile mode</span></span><br><span class="line">aa-complain /path/to/bin</span><br><span class="line">aa-enforce /path/to/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: apparmor-utils</span></span><br></pre></td></tr></table></figure>
<p>Auditd</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Service and rules</span></span><br><span class="line">systemctl status auditd</span><br><span class="line">auditctl -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Search recent denials / by PID</span></span><br><span class="line">ausearch -m avc -ts recent</span><br><span class="line">ausearch -p &lt;pid&gt; -ts recent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Watch a file <span class="keyword">for</span> writes/attr changes (key: sshcfg)</span></span><br><span class="line">auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Summary report</span></span><br><span class="line">aureport --summary -ts today</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: auditd (auditd, auditctl, ausearch, aureport)</span></span><br></pre></td></tr></table></figure>

<h1 id="Containers-Namespaces"><a href="#Containers-Namespaces" class="headerlink" title="Containers &amp; Namespaces"></a>Containers &amp; Namespaces</h1><p>Cheat Card</p>
<ul>
<li>Enter container namespace: <code>nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</code></li>
<li>Docker triage: <code>docker ps</code>, <code>docker logs --tail=200 -f &lt;id&gt;</code>, <code>docker exec -it &lt;id&gt; sh</code></li>
<li>K8s triage: <code>kubectl get pods -A</code>, <code>kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</code>, <code>kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</code><br>nsenter (enter namespaces of a PID)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get target PID (e.g., container process)</span></span><br><span class="line">pidof &lt;proc&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enter multiple namespaces of a PID</span></span><br><span class="line">nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Inspect and chroot-like into the process rootfs</span></span><br><span class="line">ls -l /proc/&lt;pid&gt;/root</span><br><span class="line">nsenter --target &lt;pid&gt; --mount -- chroot /proc/&lt;pid&gt;/root bash</span><br></pre></td></tr></table></figure>
<p>Docker (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List, <span class="built_in">exec</span>, inspect PID, and <span class="built_in">tail</span> logs</span></span><br><span class="line">docker ps --format &#x27;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125; &#123;&#123;.Status&#125;&#125;&#x27;</span><br><span class="line">docker exec -it &lt;id|name&gt; bash  # or sh</span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; &lt;id&gt;</span><br><span class="line">docker logs --tail=200 -f &lt;id&gt;</span><br></pre></td></tr></table></figure>
<p>Kubernetes (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Pods and events</span></span><br><span class="line">kubectl get pods -A -o wide</span><br><span class="line">kubectl get events -A --sort-by=.lastTimestamp | tail</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Describe, logs, and <span class="built_in">exec</span></span></span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --tail=200</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line">kubectl exec -it &lt;pod&gt; -n &lt;ns&gt; -- bash</span><br></pre></td></tr></table></figure>
<p>CRI&#x2F;containerd (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List, inspect, and logs via crictl</span></span><br><span class="line">crictl ps -a</span><br><span class="line">crictl inspect &lt;id&gt;</span><br><span class="line">crictl logs &lt;id&gt;</span><br></pre></td></tr></table></figure>
<p>Notes</p>
<ul>
<li>Without runtime CLIs, use <code>nsenter</code> by PID from <code>ps</code>&#x2F;<code>systemctl</code>.</li>
<li>Requires: docker or podman for Docker-like commands; kubectl; crictl for containerd&#x2F;CRI.</li>
</ul>
<h1 id="Incident-Playbooks"><a href="#Incident-Playbooks" class="headerlink" title="Incident Playbooks"></a>Incident Playbooks</h1><h2 id="High-CPU"><a href="#High-CPU" class="headerlink" title="High CPU"></a>High CPU</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Top CPU processes and hot threads</span></span><br><span class="line">ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</span><br><span class="line">top -H</span><br><span class="line">ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Per-process CPU over <span class="keyword">time</span>; optional perf <span class="keyword">if</span> available</span></span><br><span class="line">pidstat -u 1 -p &lt;pid&gt;</span><br><span class="line">perf top  # if installed</span><br></pre></td></tr></table></figure>
<h2 id="High-IO-wait-Disk-latency"><a href="#High-IO-wait-Disk-latency" class="headerlink" title="High IO wait &#x2F; Disk latency"></a>High IO wait &#x2F; Disk latency</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Device saturation and per-process IO</span></span><br><span class="line">iostat -xz 1   # watch await, %util, r/s, w/s</span><br><span class="line">pidstat -d 1</span><br><span class="line">iotop -oPa</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Device/FS inventory and kernel errors</span></span><br><span class="line">lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</span><br><span class="line">dmesg -T | egrep -i &#x27;error|reset|blk|nvme&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Optional deep dive</span></span><br><span class="line">blktrace -d /dev/sdX -o - | blkparse -i -</span><br></pre></td></tr></table></figure>
<h2 id="Memory-leak-OOM"><a href="#Memory-leak-OOM" class="headerlink" title="Memory leak &#x2F; OOM"></a>Memory leak &#x2F; OOM</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Snapshot and top RSS processes</span></span><br><span class="line">free -h</span><br><span class="line">ps aux --sort=-rss | head</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Per-process mappings and over-time faults</span></span><br><span class="line">pmap -x &lt;pid&gt; | sort -nrk 3 | head</span><br><span class="line">pidstat -r 1 -p &lt;pid&gt;</span><br><span class="line">smem -r  # if installed</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OOM evidence</span></span><br><span class="line">dmesg -T | grep -i oom || journalctl -k -g OOM</span><br></pre></td></tr></table></figure>
<h2 id="Packet-loss-High-latency"><a href="#Packet-loss-High-latency" class="headerlink" title="Packet loss &#x2F; High latency"></a>Packet loss &#x2F; High latency</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Path and end-to-end latency</span></span><br><span class="line">ip route get &lt;dest&gt;</span><br><span class="line">mtr -ezbw &lt;dest&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Interface health and TCP details</span></span><br><span class="line">ip -s link show &lt;iface&gt;</span><br><span class="line">ethtool -S &lt;iface&gt;</span><br><span class="line">ss -i dst &lt;dest&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Targeted capture samples</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; host &lt;dest&gt; and icmp</span><br><span class="line">tcpdump -ni &lt;iface&gt; tcp port 443 and &#x27;tcp[tcpflags] &amp; tcp-syn != 0&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="DNS-failures"><a href="#DNS-failures" class="headerlink" title="DNS failures"></a>DNS failures</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Resolve via systemd-resolved (or dig <span class="keyword">if</span> available)</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line">resolvectl status</span><br><span class="line">dig @8.8.8.8 example.com A +time=2 +tries=1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Reachability and captures</span></span><br><span class="line">ss -u &#x27;sport = :53 or dport = :53&#x27;</span><br><span class="line">tcpdump -ni &lt;iface&gt; port 53</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config checks</span></span><br><span class="line">ls -l /etc/resolv.conf</span><br><span class="line">resolvectl flush-caches</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check firewall rules as appropriate</span></span><br></pre></td></tr></table></figure>
<h2 id="TLS-handshake-issues"><a href="#TLS-handshake-issues" class="headerlink" title="TLS handshake issues"></a>TLS handshake issues</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Inspect handshake/cert chain (TLS1.2 example)</span></span><br><span class="line">openssl s_client -connect host:443 -servername host -tls1_2 -showcerts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check expiry/subject/issuer quickly</span></span><br><span class="line">echo | openssl s_client -connect host:443 -servername host 2&gt;/dev/null \</span><br><span class="line">  | openssl x509 -noout -dates -subject -issuer</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">App behavior (SNI, ALPN, protocols)</span></span><br><span class="line">curl -v https://host/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If proxy/MTLS: verify CA path and client certs; check <span class="keyword">time</span> skew</span></span><br><span class="line">timedatectl</span><br></pre></td></tr></table></figure>
<h2 id="Disk-full-Inode-exhaustion"><a href="#Disk-full-Inode-exhaustion" class="headerlink" title="Disk full &#x2F; Inode exhaustion"></a>Disk full &#x2F; Inode exhaustion</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Space vs inodes</span></span><br><span class="line">df -h</span><br><span class="line">df -i</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find biggest <span class="built_in">dirs</span> on same filesystem</span></span><br><span class="line">du -xhd1 /path | sort -h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Deleted-but-open files</span></span><br><span class="line">lsof +L1</span><br><span class="line">journalctl --vacuum-size=1G  # cull journal size</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Many small files</span></span><br><span class="line">find /path -xdev -type f | wc -l</span><br></pre></td></tr></table></figure>
<h2 id="Syscall-slowness"><a href="#Syscall-slowness" class="headerlink" title="Syscall slowness"></a>Syscall slowness</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Trace syscalls and timings</span></span><br><span class="line">strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Optional CPU hotspot profiling</span></span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br></pre></td></tr></table></figure>
<h2 id="Container-restart-loops"><a href="#Container-restart-loops" class="headerlink" title="Container restart loops"></a>Container restart loops</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Docker restart loops</span></span><br><span class="line">docker ps --filter &#x27;status=restarting&#x27;</span><br><span class="line">docker logs &lt;id&gt; --tail=200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Kubernetes restart loops</span></span><br><span class="line">kubectl get pods -A</span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Node/agent issues</span></span><br><span class="line">journalctl -u kubelet</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2021 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-thin fa-abacus"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dushenda</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dushenda" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
