<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"dushenda.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-tomorrow"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:type" content="website">
<meta property="og:title" content="dushenda">
<meta property="og:url" content="https://dushenda.github.io/index.html">
<meta property="og:site_name" content="dushenda">
<meta property="og:description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dushenda">
<meta property="article:tag" content="代码、科研、计算机系统">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dushenda.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>dushenda</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","per_page":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">dushenda</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">李德胜大大粉丝</p>
      <img class="custom-logo-image" src="/uploads/icons8-star-trek-80.svg" alt="dushenda">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dushenda"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">dushenda</p>
  <div class="site-description" itemprop="description">雄关漫道真如铁，而今迈步从头越</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dushenda" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-github-alt fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/dushenda" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/10/Linux%20Debug/Linux-%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/10/Linux%20Debug/Linux-%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85/" class="post-title-link" itemprop="url">Linux-网络抓包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+00:00">2025-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="wireshark">wireshark</h1>
<h2 id="远程抓包">远程抓包</h2>
<p>在wireshark的以下两个部分进行抓包，不建议性能分析时进行，在连通性验证时开源 <img src="./Linux-网络抓包/img1.png" /> <img src="./Linux-网络抓包/image.png" alt="image.png" /> ## ssh+tcpdump+wireshark解析 直接抓包解析 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;ip&gt; &#x27;tcpdump -ni any -s0 -U -w - udp port 53&#x27; | wireshark -k -i -</span><br></pre></td></tr></table></figure> 跳板机执行 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -J &lt;jumpsever ip&gt; &lt;ip&gt; &#x27;tcpdump -ni any -s0 -U -w - udp port 53&#x27; | wireshark -k -i -</span><br></pre></td></tr></table></figure> 直接抓包并保存 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;ip&gt; <span class="string">&#x27;tcpdump -ni any -s0 -U -w- udp port 53&#x27;</span> &gt; /tmp/packets.pcap</span><br></pre></td></tr></table></figure></p>
<h1 id="tcpdump">tcpdump</h1>
<h2 id="常用抓包指令">常用抓包指令</h2>
<p>过滤tcp flags，比如抓syn报文，看是否能握手成功 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn&#x27;</span><br></pre></td></tr></table></figure> 查看tcp状态，如下为发送了sync，如果一直未回复，则可以在<code>sar -n ETCP 1</code>看到<code>retrans/s</code>不断上升 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 0.1 &#x27;ss -tpn state syn-sent&#x27;</span><br></pre></td></tr></table></figure> 抓syn和syn+ack报文 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any <span class="string">&#x27;tcp[tcpflags] == tcp-syn or tcp[13]=18&#x27;</span></span><br></pre></td></tr></table></figure> 抓syn和syn+rst报文 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn or tcp[13] &amp; 4!=0&#x27;</span><br></pre></td></tr></table></figure> 抓syn和icmp不可达报文 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn or icmp[0] = 3&#x27;</span><br></pre></td></tr></table></figure> 抓syn、syn+ack、rst和icmp端口不可达报文（tcp[13]指的是从tcp报文头偏移13字节的选项） <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;(tcp[tcpflags] == tcp-syn or tcp[13]=18) or tcp[13] &amp;amp; 4!=0 or icmp[0] = 3&#x27;</span><br></pre></td></tr></table></figure> tcp flags抓包例子 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-syn&#x27;</span><br><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-rst&#x27;</span><br><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-fin&#x27;</span><br></pre></td></tr></table></figure> 抓取指定报文大小 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump less 32</span><br><span class="line">tcpdump greater 32</span><br><span class="line">tcpdump &lt;= 102</span><br></pre></td></tr></table></figure> 持续抓取端口 <code>8080</code>的流量，每个文件最大 <code>100MB</code>，最多保留 <code>10</code>个文件，写满后覆盖最旧的文件 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -C 100 -W 10 -w my_capture.pcap port 8080</span><br></pre></td></tr></table></figure> 抓取 <code>10000</code>个发往 <code>80</code>端口的包 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -c 10000 -w http_requests.pcap dst port 80</span><br></pre></td></tr></table></figure></p>
<h2 id="常用选项">常用选项</h2>
<table>
<thead>
<tr class="header">
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>-i &lt;interface&gt;</code></strong>​</td>
<td>指定抓包网卡。<code>any</code>表示所有网卡。</td>
<td><code>-i any</code></td>
</tr>
<tr class="even">
<td><strong><code>port &lt;端口号&gt;</code></strong>​</td>
<td>过滤特定端口的流量（TCP/UDP）。</td>
<td><code>port 8080</code></td>
</tr>
<tr class="odd">
<td><strong><code>-C &lt;大小&gt;</code></strong>​</td>
<td><strong>按文件大小分割</strong>。单位通常为MB（M）。</td>
<td><code>-C 100</code></td>
</tr>
<tr class="even">
<td><strong><code>-W &lt;数量&gt;</code></strong>​</td>
<td><strong>限制文件总数</strong>，与 <code>-C</code>配合实现循环覆盖。</td>
<td><code>-W 10</code></td>
</tr>
<tr class="odd">
<td><strong><code>-w &lt;文件名&gt;</code></strong>​</td>
<td>将抓取的原始数据包写入指定文件。</td>
<td><code>-w my_capture.pcap</code></td>
</tr>
<tr class="even">
<td><strong><code>-c &lt;数量&gt;</code></strong>​</td>
<td>抓取指定数量的数据包后自动退出。</td>
<td><code>-c 10000</code></td>
</tr>
<tr class="odd">
<td><strong><code>-s &lt;长度&gt;</code></strong>​</td>
<td>设置每个数据包的抓取长度（快照长度byte），<code>-s 0</code>表示抓取完整数据包。<strong>(在长期抓只需要分析报文头很实用)</strong></td>
<td><code>-s 0</code></td>
</tr>
</tbody>
</table>
<h2 id="其他选项">其他选项</h2>
<h3 id="capture-commands">Capture Commands</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Example usage</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-i any</code></td>
<td><code>tcpdump -i any</code></td>
<td>Capture from all interfaces; may require superuser (<code>sudo/su</code>)</td>
</tr>
<tr class="even">
<td><code>-i eth0</code></td>
<td><code>tcpdump -i eth0</code></td>
<td>Capture from the interface <code>eth0</code></td>
</tr>
<tr class="odd">
<td><code>-c count</code></td>
<td><code>tcpdump -i eth0 -c 5</code></td>
<td>Exit after receiving <code>count (5)</code> packets</td>
</tr>
<tr class="even">
<td><code>-r captures.pcap</code></td>
<td><code>tcpdump -i eth0 -r captures.pcap</code></td>
<td>Read and analyze saved capture file <code>captures.pcap</code></td>
</tr>
<tr class="odd">
<td><code>tcp</code></td>
<td><code>tcpdump -i eth0 tcp</code></td>
<td>Show TCP packets only</td>
</tr>
<tr class="even">
<td><code>udp</code></td>
<td><code>tcpdump -i eth0 udp</code></td>
<td>Show UDP packets only</td>
</tr>
<tr class="odd">
<td><code>icmp</code></td>
<td><code>tcpdump -i eth0 icmp</code></td>
<td>Show ICMP packets only</td>
</tr>
<tr class="even">
<td><code>ip</code></td>
<td><code>tcpdump -i eth0 ip</code></td>
<td>Show IPv4 packets only</td>
</tr>
<tr class="odd">
<td><code>ip6</code></td>
<td><code>tcpdump -i eth0 ip6</code></td>
<td>Show IPv6 packets only</td>
</tr>
<tr class="even">
<td><code>arp</code></td>
<td><code>tcpdump -i eth0 arp</code></td>
<td>Show ARP packets only</td>
</tr>
<tr class="odd">
<td><code>rarp</code></td>
<td><code>tcpdump -i eth0 rarp</code></td>
<td>Show RARP packets only</td>
</tr>
<tr class="even">
<td><code>slip</code></td>
<td><code>tcpdump -i eth0 slip</code></td>
<td>Show SLIP packets only</td>
</tr>
<tr class="odd">
<td><code>-I</code></td>
<td><code>tcpdump -i eth0 -I</code></td>
<td>Set interface as monitor mode</td>
</tr>
<tr class="even">
<td><code>-K</code></td>
<td><code>tcpdump -i eth0 -K</code></td>
<td>Don’t verify checksum</td>
</tr>
<tr class="odd">
<td><code>-p</code></td>
<td><code>tcpdump -i eth0 -p</code></td>
<td>Don’t capture in promiscuous mode</td>
</tr>
</tbody>
</table>
<h3 id="filter-commands">Filter Commands</h3>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 77%" />
</colgroup>
<thead>
<tr class="header">
<th>Filter expression</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>src host 127.0.0.1</code></td>
<td>Filter by source IP/hostname <code>127.0.0.1</code></td>
</tr>
<tr class="even">
<td><code>dst host 127.0.0.1</code></td>
<td>Filter by destination IP/hostname <code>127.0.0.1</code></td>
</tr>
<tr class="odd">
<td><code>host 127.0.0.1</code></td>
<td>Filter by source or destination = <code>127.0.0.1</code></td>
</tr>
<tr class="even">
<td><code>ether src 01:23:45:AB:CD:EF</code></td>
<td>Filter by source MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr class="odd">
<td><code>ether dst 01:23:45:AB:CD:EF</code></td>
<td>Filter by destination MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr class="even">
<td><code>ether host 01:23:45:AB:CD:EF</code></td>
<td>Filter by source or destination MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr class="odd">
<td><code>src net 127.0.0.1</code></td>
<td>Filter by source network location <code>127.0.0.1</code></td>
</tr>
<tr class="even">
<td><code>dst net 127.0.0.1</code></td>
<td>Filter by destination network location <code>127.0.0.1</code></td>
</tr>
<tr class="odd">
<td><code>net 127.0.0.1</code></td>
<td>Filter by source or destination network location <code>127.0.0.1</code></td>
</tr>
<tr class="even">
<td><code>net 127.0.0.1/24</code></td>
<td>Filter by source or destination network location <code>127.0.0.1</code> with the tcpdump subnet mask of length <code>24</code></td>
</tr>
<tr class="odd">
<td><code>src port 80</code></td>
<td>Filter by source port = 80</td>
</tr>
<tr class="even">
<td><code>dst port 80</code></td>
<td>Filter by destination port = 80</td>
</tr>
<tr class="odd">
<td><code>port 80</code></td>
<td>Filter by source or destination port = 80</td>
</tr>
<tr class="even">
<td><code>src portrange 80-400</code></td>
<td>Filter by source port value between 80 and 400</td>
</tr>
<tr class="odd">
<td><code>dst portrange 80-400</code></td>
<td>Filter by destination port value between 80 and 400</td>
</tr>
<tr class="even">
<td><code>portrange 80-400</code></td>
<td>Filter by source or destination port value between 80 and 400</td>
</tr>
<tr class="odd">
<td><code>ether broadcast</code></td>
<td>Filter for Ethernet broadcasts</td>
</tr>
<tr class="even">
<td><code>ip broadcast</code></td>
<td>Filter for IPv4 broadcasts</td>
</tr>
<tr class="odd">
<td><code>ether multicast</code></td>
<td>Filter for Ethernet multicasts</td>
</tr>
<tr class="even">
<td><code>ip multicast</code></td>
<td>Filter for IPv4 multicasts</td>
</tr>
<tr class="odd">
<td><code>ip6 multicast</code></td>
<td>Filter for IPv6 multicasts</td>
</tr>
<tr class="even">
<td><code>ip src host mydevice</code></td>
<td>Filter by IPv4 source hostname <code>mydevice</code></td>
</tr>
<tr class="odd">
<td><code>arp dst host mycar</code></td>
<td>Filter by ARP destination hostname <code>mycar</code></td>
</tr>
<tr class="even">
<td><code>rarp src host 127.0.0.1</code></td>
<td>Filter by RARP source <code>127.0.0.1</code></td>
</tr>
<tr class="odd">
<td><code>ip6 dst host mywatch</code></td>
<td>Filter by IPv6 destination hostname <code>mywatch</code></td>
</tr>
<tr class="even">
<td><code>tcp dst port 8000</code></td>
<td>Filter by destination TCP port = 8000</td>
</tr>
<tr class="odd">
<td><code>udp src portrange 1000-2000</code></td>
<td>Filter by source TCP ports in 1000–2000</td>
</tr>
<tr class="even">
<td><code>sctp port 22</code></td>
<td>Filter by source or destination port = 22</td>
</tr>
</tbody>
</table>
<h3 id="display-commands">Display Commands</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="header">
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tcpdump -i eth0 -A</code></td>
<td>Print each packet (minus its link level header) in ASCII. Handy for capturing web pages. <br> <br>[![Screenshot with ASCII (sudo tcpdump twitter)</td>
</tr>
<tr class="even">
<td><code>tcpdump -D</code></td>
<td>Print the list of the network interfaces available on the system and on which tcpdump can capture packets.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -e</code></td>
<td>Print the link-level header on each output line, such as MAC layer addresses for protocols such as Ethernet and IEEE 802.11.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -F /path/to/params.conf</code></td>
<td>Use the file <code>params.conf</code> as input for the <a href="###%20Filter%20Commands">filter expression</a>. (Ignore other expressions on the command line.)</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -n</code></td>
<td>Don’t convert addresses (i.e., host addresses, port numbers, etc.) to names.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -S</code></td>
<td>Print absolute, rather than relative, TCP sequence numbers. (Absolute TCP sequence numbers are longer.)</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 --time-stamp-precision=nano</code></td>
<td>When capturing, set the timestamp precision for the capture to <code>tsp</code>: <br>• <code>micro</code> for microsecond (default) <br>• <code>nano</code> for nanosecond.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -t</code></td>
<td>Omit the timestamp on each output line.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -tt</code></td>
<td>Print the timestamp, as seconds since January 1, 1970, 00:00:00, UTC, and fractions of a second since that time, on each dump line.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -ttt</code></td>
<td>Print a delta (microsecond or nanosecond resolution depending on the <code>--time-stamp-precision</code> option) between the current and previous line on each output line. The default is microsecond resolution.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -tttt</code></td>
<td>Print a timestamp as hours, minutes, seconds, and fractions of a second since midnight, preceded by the date, on each dump line.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -ttttt</code></td>
<td>Print a delta (microsecond or nanosecond resolution depending on the <code>--time-stamp-precision</code> option) between the current and first line on each dump line. The default is microsecond resolution.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -u</code></td>
<td>Print undecoded network file system (NFS) handles.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -v</code></td>
<td>Produce verbose output. <br>When writing to a file (<code>-w</code> option) and at the same time not reading from a file (<code>-r</code> option), report to standard error, once per second, the number of packets captured.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -vv</code></td>
<td>Additional verbose output than <code>-v</code></td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -vvv</code></td>
<td>Additional verbose output than <code>-vv</code></td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -x</code></td>
<td>Print the headers and data of each packet (minus its link level header) in hex.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -xx</code></td>
<td>Print the headers and data of each packet, including its link level header, in hex.</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -X</code></td>
<td>Print the headers and data of each packet (minus its link level header) in hex and ASCII.</td>
</tr>
<tr class="even">
<td><code>tcpdump -i eth0 -XX</code></td>
<td>Print the headers and data of each packet, including its link level header, in hex and ASCII.</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="output-commands">Output Commands</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-w captures.pcap</code></td>
<td><code>tcpdump -i eth0 -w captures.pcap</code></td>
<td>Output capture to a file <code>captures.pcap</code></td>
</tr>
<tr class="even">
<td><code>-d</code></td>
<td><code>tcpdump -i eth0 -d</code></td>
<td>Display human-readable form in standard output</td>
</tr>
<tr class="odd">
<td><code>-L</code></td>
<td><code>tcpdump -i eth0 -L</code></td>
<td>Display data link types for the interface</td>
</tr>
<tr class="even">
<td><code>-q</code></td>
<td><code>tcpdump -i eth0 -q</code></td>
<td>Quick/quiet output. Print less protocol information, so output lines are shorter.</td>
</tr>
<tr class="odd">
<td><code>-U</code></td>
<td><code>tcpdump -i eth0 -U -w out.pcap</code></td>
<td><strong>Without -w option</strong> <br>Print a description of each packet’s contents. <br><strong>With -w option</strong> <br>Write each packet to the output file <code>out.pcap</code> in real time rather than only when the output buffer fills.</td>
</tr>
</tbody>
</table>
<h3 id="miscellaneous-commands">Miscellaneous Commands</h3>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Operator</th>
<th>Syntax</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>AND</code></td>
<td><code>and, &amp;&amp;</code></td>
<td><code>tcpdump -n src 127.0.0.1 and dst port 21</code></td>
<td>Combine filtering options joined by “and”</td>
</tr>
<tr class="even">
<td><code>OR</code></td>
<td><code>or, \|</code></td>
<td><code>tcpdump dst 127.0.0.1 or src port 22</code></td>
<td>Match any of the conditions joined by “or”</td>
</tr>
<tr class="odd">
<td><code>EXCEPT</code></td>
<td><code>not, !</code></td>
<td><code>tcpdump dst 127.0.0.1 and not icmp</code></td>
<td>Negate the condition prefixed by “not”</td>
</tr>
<tr class="even">
<td><code>LESS</code></td>
<td><code>less, &lt;, (&lt;=)</code></td>
<td><code>tcpdump dst host 127.0.0.1 and less 128</code></td>
<td>Shows packets shorter than (or equal to) 128 bytes in length. <br>&lt; only applies to length 32, i.e., <code>&lt;32</code>.</td>
</tr>
<tr class="odd">
<td><code>GREATER</code></td>
<td><code>greater, &gt;, (&gt;=)</code></td>
<td><code>tcpdump dst host 127.0.0.1 and greater 64</code></td>
<td>Shows packets longer than (or equal to) 64 bytes in length. <br>&gt; only applies to length 32, i.e., <code>&gt;32</code>.</td>
</tr>
<tr class="even">
<td><code>EQUAL</code></td>
<td><code>=, ==</code></td>
<td><code>tcpdump host 127.0.0.1 = 0</code></td>
<td>Show packets with zero length</td>
</tr>
</tbody>
</table>
<h3 id="example-usage">Example Usage</h3>
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="header">
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tcpdump -r outfile.pcap src host 10.0.2.15</code></td>
<td>Print all packets in the file <code>outfile.pcap</code> coming from the host with IP address 10.0.2.15</td>
</tr>
<tr class="even">
<td><code>tcpdump -i any ip and not tcp port 80</code></td>
<td>Listen for non-HTTP packets (which have TCP port number 80) on any network interface</td>
</tr>
<tr class="odd">
<td><code>tcpdump -i eth0 -n &gt;32 -w pv01.pcap -c 30</code></td>
<td>Save 30 packets of length exceeding 32 bytes to <code>captures.pcap</code> without DNS resolution on the <code>eth0</code> network interface</td>
</tr>
<tr class="even">
<td><code>tcpdump -AtuvX icmp</code></td>
<td>Capture ICMP traffic and print ICMP packets in hex and ASCII and the following features: <br>With: <br>• headers <br>• data <br>• undecoded NFS handles <br>Without: <br>• link level headers <br>• timestamps.</td>
</tr>
<tr class="odd">
<td><code>tcpdump 'tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'</code></td>
<td>Print all IPv4 HTTP packets to and from port 80, i.e. print only packets that contain data, not, for example, SYN and FIN packets and ACK-only packets.</td>
</tr>
</tbody>
</table>
<h1 id="参考搬运">参考/搬运</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://debugging.works/blog/network-debugging/">https://debugging.works/blog/network-debugging/</a></li>
<li>https://www.stationx.net/tcpdump-cheat-sheet/</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/10/xv6%E5%AD%A6%E4%B9%A0/xv6-vscode%E8%B0%83%E8%AF%95%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/10/xv6%E5%AD%A6%E4%B9%A0/xv6-vscode%E8%B0%83%E8%AF%95%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">xv6-vscode调试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+00:00">2025-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="gdbinit">.gdbinit</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">set $lastcs = -1</span><br><span class="line"></span><br><span class="line">define hook-stop</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">There doesn<span class="string">&#x27;t seem to be a good way to detect if we&#x27;</span>re <span class="keyword">in</span> 16- or</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">32-bit mode, but <span class="keyword">in</span> 32-bit mode we always run with CS == 8 <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">kernel and CS == 35 <span class="keyword">in</span> user space</span></span><br><span class="line">  if $cs == 8 || $cs == 35</span><br><span class="line">    if $lastcs != 8 &amp;&amp; $lastcs != 35</span><br><span class="line">      set architecture i386</span><br><span class="line">    end</span><br><span class="line">    x/i $pc</span><br><span class="line">  else</span><br><span class="line">    if $lastcs == -1 || $lastcs == 8 || $lastcs == 35</span><br><span class="line">      set architecture i8086</span><br><span class="line">    end</span><br><span class="line">    # Translate the segment:offset into a physical address</span><br><span class="line">    printf &quot;[%4x:%4x] &quot;, $cs, $eip</span><br><span class="line">    x/i $cs*16+$eip</span><br><span class="line">  end</span><br><span class="line">  set $lastcs = $cs</span><br><span class="line">end</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">需要注释掉</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">echo</span> + target remote localhost:25000\n</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">target remote localhost:25000</span></span><br><span class="line"></span><br><span class="line">echo + symbol-file kernel\n</span><br><span class="line">symbol-file kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="launch.json">launch.json</h2>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Debug xv6 x86&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/kernel&quot;</span><span class="punctuation">,</span> <span class="comment">// 修改kernel 或者 bootblock</span></span><br><span class="line">      <span class="attr">&quot;miDebuggerServerAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost:25000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;miDebuggerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;set architecture i386:x86-64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;set disassemble-next-line auto&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-print for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;preLaunchTask&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xv6build&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logging&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;trace&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;traceResponse&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;engineLogging&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="tasks.json">tasks.json</h2>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xv6build&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;isBackground&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;make qemu-nox-gdb&quot;</span><span class="punctuation">,</span> </span><br><span class="line">      <span class="attr">&quot;problemMatcher&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pattern&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;regexp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;file&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;beginsPattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.* Now run &#x27;gdb&#x27;.&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;endsPattern&quot;</span><span class="punctuation">:</span> <span class="string">&quot;.&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/09/Linux%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/%E5%B8%B8%E8%A7%81%E7%9A%84linux%E6%80%A7%E8%83%BD%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/09/Linux%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/%E5%B8%B8%E8%A7%81%E7%9A%84linux%E6%80%A7%E8%83%BD%E6%9F%A5%E8%AF%A2%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">常见的linux性能查询命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-09T00:00:00+00:00">2025-12-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="常见的linux性能查询命令">常见的linux性能查询命令</h1>
<p>Purpose: a single-page, production-ready cheatsheet for Linux/SRE triage. Optimized for fast on-call use: concise flags, copy-paste recipes, brief notes, and clear risk callouts.</p>
<p>Tip: Use your editor/browser search to jump to any command by its number, e.g., “## 41. lsof”.</p>
<h2 id="binaries-elf">Binaries &amp; ELF</h2>
<p>Cheat Card - Linked libs: <code>ldd /path/to/bin</code> (security caveat: may execute code in rare cases) - ELF headers/sections: <code>readelf -h /bin/ls</code>; sections: <code>readelf -S /bin/ls</code> - Symbols (prefer readelf): <code>readelf -Ws /bin/ls | grep ' FUNC '</code>; dynamic: <code>readelf -Ws -d /bin/ls</code> - Disassemble: <code>objdump -d /bin/ls | less</code> (add <code>-M intel</code> for Intel syntax) - Symbols via nm: <code>nm -D /bin/ls | grep symbol_name</code> - Requires: binutils (readelf/objdump/nm)</p>
<h2 id="ldd">1. ldd</h2>
<p>List shared library dependencies of executables and shared objects. - Basic: <code>ldd /path/to/bin</code> - Security caveat: may execute code in rare cases; avoid on untrusted binaries. - Alternative: <code>LD_TRACE_LOADED_OBJECTS=1 /lib64/ld-linux-x86-64.so.2 /path/to/bin</code> (still uses loader)</p>
<h2 id="text-data-utilities">Text &amp; Data Utilities</h2>
<p>Cheat Card - Search recursively: <code>grep -RIn --exclude-dir .git 'pattern' .</code>; context: <code>-C2</code> - Edit in-place: <code>sed -i.bak -E 's/old/new/g' file</code> (backup) - Summarize data: <code>awk -F, '{a[$1]+=$2} END{for(k in a) print k,a[k]}' file.csv</code> - JSON parse: <code>jq -r '.items[].metadata.name' file.json</code> - Compare dirs: <code>diff -ruN dir_old dir_new | less -R</code> - Transform text: <code>tr -s ' ' | cut -d, -f1,3 | xargs -n1 echo</code> - Safe temp: <code>mktemp -d</code> for dirs; files: <code>mktemp</code> - Reverse lines: <code>rev &lt;file</code> (quick visual check)</p>
<h2 id="grep">2. grep</h2>
<ul>
<li>search for one or more expressions: <code>grep -E 'hello|world' temp</code></li>
<li>search for one or more words: <code>grep -Ew 'hello|world' temp</code></li>
<li>search for suffix matches: <code>grep -E 'hello(world|lolo)' temp</code></li>
<li>search for suffixes matching regex: <code>grep -E 'hello[0-9]{3,}' temp</code></li>
<li>recursive search in tree: <code>grep -RIn --exclude-dir .git --exclude='*.log' 'pattern' .</code></li>
<li>fixed strings (fast) and ignore case: <code>grep -Fni 'literal text' file</code></li>
<li>context lines: <code>grep -R --color -n -C2 'pattern' .</code> (or <code>-A</code> after, <code>-B</code> before)</li>
<li>binary-skip and file names only: <code>grep -rI -l 'pattern' .</code></li>
</ul>
<h2 id="sed">3. sed</h2>
<p>What it does: stream editor for non-interactive find/replace, line edits, and range selections.</p>
<ul>
<li>In-place with backup: <code>sed -i.bak -E 's/old/new/g' file</code></li>
<li>Delete matching lines: <code>sed -i '/pattern/d' file</code></li>
<li>Print lines between markers: <code>sed -n '/BEGIN/,/END/p' file</code></li>
<li>Replace with capture groups: <code>sed -E 's/([0-9]{4})-([0-9]{2})-([0-9]{2})/\3-\2-\1/' file</code></li>
<li>Insert before/after match:
<ul>
<li>Before: <code>sed '/pattern/i\\inserted before' file</code></li>
<li>After: <code>sed '/pattern/a\\appended after' file</code></li>
</ul></li>
<li>Trim trailing spaces: <code>sed -i 's/[ \t]\+$//' file</code></li>
<li>Multiple edits: <code>sed -E -e 's/foo/bar/g' -e '/tmp/d' file</code></li>
</ul>
<h2 id="awk">4. awk</h2>
<p>What it does: text processing and quick data summarization using fields and expressions.</p>
<ul>
<li>Default FS is whitespace; set CSV FS: <code>awk -F, '...' file.csv</code></li>
<li>Select fields: <code>awk '{print $1, $3}' file</code></li>
<li>Filter rows: <code>awk '$5 &gt; 100 {print $1, $5}' file</code></li>
<li>Sum a column: <code>awk '{s+=$3} END{print s}' file</code></li>
<li>Group and sum by key: <code>awk '{a[$1]+=$2} END{for (k in a) print k, a[k]}' file</code></li>
<li>Pretty print: <code>awk '{printf "%-20s %10d\n", $1, $2}' file</code></li>
<li>Count unique values: <code>awk '{c[$1]++} END{for (k in c) print k, c[k]}' file</code></li>
</ul>
<h2 id="networking">Networking</h2>
<p>Cheat Card - Ports→PIDs: <code>ss -ltnp</code>; established only: <code>ss -tn state established</code> - TCP detail: <code>ss -i dst &lt;ip&gt;</code> (rtt, cwnd, retrans) - Path/source IP: <code>ip route get &lt;dest&gt;</code>; counters: <code>ip -s link show &lt;iface&gt;</code> - Latency/loss: <code>mtr -ezbw &lt;dest&gt;</code>; quick traceroute ICMP: <code>traceroute -I &lt;dest&gt;</code> - Targeted capture: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> (or <code>port 53</code>, <code>icmp</code>) - DNS: <code>resolvectl query &lt;name&gt;</code> or <code>dig &lt;name&gt; A +short</code></p>
<h2 id="ping">5. ping</h2>
<ul>
<li><p>Compat: Linux; Root: may require CAP_NET_RAW depending on system; Requires: iputils-ping.</p></li>
<li><p><code>-4</code>: ping IPv4 only</p></li>
<li><p><code>-6</code>: ping IPv6 only</p></li>
<li><p><code>-A</code>: adapts to roundtrip time</p></li>
<li><p><code>-b</code>: allow pinging broadcast addresses</p></li>
<li><p><code>-I</code>: ping through an interface</p></li>
<li><p><code>-M</code>: set PMTU strategy</p></li>
<li><p><code>-s</code>: set packetsize (default is 56B)</p></li>
<li><p><code>-t</code>: set IP time-to-live</p></li>
<li><p><code>ping 224.0.0.1</code>: ping multicast address</p></li>
</ul>
<p>Notes: - Using average <code>rtt</code> values, you can determine whether there are huge variations causing jitter, especially in RT applications - ping will report duplications, however, duplicate packets should never occur, and seem to be caused by inappropriate link-level retransmissions - ping will report damaged packets, suggesting broken hardware in the network Requires: iputils-ping.</p>
<h2 id="ip">6. ip</h2>
<ul>
<li><p>Compat: Linux; Root: not required for reads; Requires: iproute2.</p></li>
<li><p><code>ip addr</code>: Show information for all addresses</p></li>
<li><p><code>ip addr show dev wlo1</code>: Display information only for device wlo1</p></li>
<li><p><code>ip link</code>: Show information for all interfaces</p></li>
<li><p><code>ip link show dev wlo1</code>: Display information only for device wlo1</p></li>
<li><p><code>ip -s</code>: Display interface statistics (packets dropped, received, sent, etc.)</p></li>
<li><p>Quick recipes:</p>
<ul>
<li>Path and source IP: <code>ip route get &lt;dest&gt;</code></li>
<li>Interface counters: <code>ip -s link show &lt;iface&gt;</code> (rx/tx errors, drops)</li>
<li>Neighbors/ARP: <code>ip neigh</code> and <code>ip neigh show dev &lt;iface&gt;</code></li>
<li>Multicast: <code>ip maddr</code> or <code>ip maddr show dev &lt;iface&gt;</code></li>
</ul></li>
</ul>
<p>Example <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Query path and chosen source IP</span></span><br><span class="line">ip route get 8.8.8.8</span><br><span class="line"><span class="comment"># Expect: 8.8.8.8 via 192.168.1.1 dev wlo1 src 192.168.1.23</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><code>ip route</code>: List all of the route entries in the kernel</p></li>
<li><p><code>ip route add</code>: Add a route entry to the kernel routing table</p></li>
<li><p><code>ip route replace</code>: Replace an existing route (add if not present)</p></li>
<li><p><code>ip maddr</code>: Display multicast information for all devices</p></li>
<li><p><code>ip maddr show dev wlo1</code></p></li>
<li><p><code>ip neigh show dev wlo1</code>: check for reachability of specific interfaces<br />
Requires: iproute2.</p></li>
</ul>
<h2 id="arp">7. arp</h2>
<ul>
<li><p>Compat: Legacy; prefer <code>ip neigh</code>; Requires: net-tools.</p></li>
<li><p><code>arp</code>: show all ARP table entries</p></li>
<li><p><code>arp -d address</code>: delete ARP entry for address</p></li>
<li><p><code>arp -s address hw_addr</code>: set up new table entry Note: legacy from net-tools; prefer <code>ip neigh</code>. Requires: net-tools.</p></li>
</ul>
<h2 id="arping">8. arping</h2>
<ul>
<li><p>Compat: Linux; Root/CAP_NET_RAW required; Package: arping (iputils-arping on some distros).</p></li>
<li><p><code>arping -I wlo1 192.168.0.1</code>: send ARP requests to host</p></li>
<li><p><code>arping -D -I wlo1 192.168.0.15</code>: check for duplicate MAC address Requires: arping (iputils-arping on some distros).</p></li>
</ul>
<h2 id="ethtool">9. ethtool</h2>
<ul>
<li><p>Compat: Linux; Root for changing settings, read stats usually ok; Requires: ethtool.</p></li>
<li><p><code>ethtool -S wlo1</code>: print network statistics Requires: ethtool.</p></li>
</ul>
<h2 id="ss">10. ss</h2>
<ul>
<li><p>Compat: Linux; Modern replacement for netstat; Requires: iproute2.</p></li>
<li><p><code>ss -a</code>: show all sockets</p></li>
<li><p><code>ss -o</code>: show all sockets with timer information</p></li>
<li><p><code>ss -p</code>: show process using the socket</p></li>
<li><p><code>ss -t|-u|-4|-6</code></p></li>
<li><p><code>ss -ltnp</code>: list listening TCP sockets with PIDs</p></li>
<li><p><code>ss -tn state established</code>: show established TCP only</p></li>
<li><p><code>ss -tn sport = :443</code> or <code>ss -tn dport = :443</code>: filter by port</p></li>
<li><p><code>ss -s</code>: summary stats (TCP states, mem)</p></li>
<li><p><code>ss -i</code>:</p>
<ul>
<li><code>ts</code>: show string “ts” if the timestamp option is set</li>
<li><code>sack</code>: show string “sack” if the sack option is set</li>
<li><code>ecn</code>: show string “ecn” if the explicit congestion notification option is set</li>
<li><code>ecnseen</code>: show string “ecnseen” if the saw ecn flag is found in received packets</li>
<li><code>fastopen</code>: show string “fastopen” if the fastopen option is set</li>
<li><code>cong_alg</code>: the congestion algorithm name, the default congestion algorithm is “cubic”</li>
<li><code>wscale:&lt;snd_wscale&gt;:&lt;rcv_wscale&gt;</code>: if window scale option is used, this field shows the send scale factor and receive scale factor</li>
<li><code>rto:&lt;icsk_rto&gt;</code>: tcp re-transmission timeout value, the unit is millisecond</li>
<li><code>backoff:&lt;icsk_backoff&gt;</code>: used for exponential backoff re-transmission, the actual re-transmission timeout value is icsk_rto &lt;&lt; icsk_backoff</li>
<li><code>rtt:&lt;rtt&gt;/&lt;rttvar&gt;</code>: rtt is the average round trip time, rttvar is the mean deviation of rtt, their units are millisecond</li>
<li><code>ato:&lt;ato&gt;</code>: ack timeout, unit is millisecond, used for delay ack mode</li>
<li><code>mss:&lt;mss&gt;</code>: max segment size</li>
<li><code>cwnd:&lt;cwnd&gt;</code>: congestion window size</li>
<li><code>pmtu:&lt;pmtu&gt;</code>: path MTU value</li>
<li><code>ssthresh:&lt;ssthresh&gt;</code>: tcp congestion window slow start threshold</li>
<li><code>bytes_acked:&lt;bytes_acked&gt;</code>: bytes acked</li>
<li><code>bytes_received:&lt;bytes_received&gt;</code>: bytes received</li>
<li><code>segs_out:&lt;segs_out&gt;</code>: segments sent out</li>
<li><code>segs_in:&lt;segs_in&gt;</code>: segments received</li>
<li><code>send &lt;send_bps&gt;bps</code>: egress bps</li>
<li><code>lastsnd:&lt;lastsnd&gt;</code>: how long time since the last packet sent, the unit is millisecond</li>
<li><code>lastrcv:&lt;lastrcv&gt;</code>: how long time since the last packet received, the unit is millisecond</li>
<li><code>lastack:&lt;lastack&gt;</code>: how long time since the last ack received, the unit is millisecond</li>
</ul></li>
<li><p><code>ss -A tcp,udp</code>: dump socket tables Requires: iproute2.</p></li>
</ul>
<h2 id="tcpdump">37. tcpdump</h2>
<p>Compat: Linux; Root/CAP_NET_RAW required for captures; Requires: tcpdump. What it does: capture packets for inspection and troubleshooting. Requires: tcpdump.</p>
<ul>
<li>Interface and no name resolution: <code>tcpdump -ni &lt;iface&gt;</code></li>
<li>Host or subnet: <code>tcpdump -ni &lt;iface&gt; host &lt;ip&gt;</code>; <code>tcpdump -ni &lt;iface&gt; net 10.0.0.0/8</code></li>
<li>Ports/protocols: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> or <code>udp port 53</code></li>
<li>SYNs only (new TCP handshakes): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># New TCP handshakes only (SYN without ACK)</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; <span class="string">&#x27;tcp[tcpflags] &amp; (tcp-syn) != 0 and tcp[tcpflags] &amp; (tcp-ack) == 0&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>DNS queries: <code>tcpdump -ni &lt;iface&gt; port 53</code></li>
<li>ICMP reachability: <code>tcpdump -ni &lt;iface&gt; icmp</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Requires: tcpdump</span></span><br><span class="line"><span class="comment"># Capture full packets to a file</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -w capture.pcap</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rotate captures every 5m, keep 6 files</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -G 300 -W 6 -w <span class="string">&#x27;cap-%Y%m%d%H%M%S.pcap&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="mtr">38. mtr</h2>
<p>Compat: Linux; May need root/CAP_NET_RAW for certain probe types; Requires: mtr. What it does: combines ping and traceroute to visualize latency and loss per hop.</p>
<ul>
<li>Run with extra info: <code>mtr -ezbw &lt;dest&gt;</code></li>
<li>Report mode (one-off): <code>mtr -ezbwrc 10 &lt;dest&gt;</code> Requires: mtr.</li>
</ul>
<h2 id="traceroute">39. traceroute</h2>
<ul>
<li><p>Compat: Linux; Requires: traceroute; TCP mode may need CAP_NET_RAW/root.</p></li>
<li><p><code>traceroute -I</code>: use ICMP echo for probes</p></li>
<li><p><code>traceroute -T</code>: use TCP SYN for probes Requires: traceroute.</p></li>
</ul>
<h2 id="nicstat">40. nicstat</h2>
<ul>
<li><p>Compat: Linux; Not widely packaged; Consider <code>sar -n</code>/<code>ethtool -S</code> alternatives.</p></li>
<li><p>nicstat prints out network statistics for all network cards (NICs), including packets, kilobytes per second, average packet sizes and more.</p></li>
<li><p><code>nicstat -t</code>: show CPU stats</p></li>
<li><p><code>nicstat</code>: show network interface stats Requires: nicstat (may need third-party repo/source on some distros).</p></li>
</ul>
<details>
<summary>
Metrics reference (click to expand)
</summary>
<ul>
<li><code>Time</code> - The time corresponding to the end of the sample shown, in HH:MM:SS format (24-hour clock).</li>
<li><code>Int</code> - The interface name.</li>
<li><code>rKB/s, InKB</code> - Kilobytes/second read (received).</li>
<li><code>wKB/s, OutKB</code> - Kilobytes/second written (transmitted).</li>
<li><code>rMbps, RdMbps</code> - Megabits/second read (received).</li>
<li><code>wMbps, WrMbps</code> - Megabits/second written (transmitted).</li>
<li><code>rPk/s, InSeg, InDG</code> - Packets (TCP Segments, UDP Datagrams)/second read (received).</li>
<li><code>wPk/s, OutSeg, OutDG</code> - Packets (TCP Segments, UDP Datagrams)/second written (transmitted).</li>
<li><code>rAvs</code> - Average size of packets read (received).</li>
<li><code>wAvs</code> - Average size of packets written (transmitted).</li>
<li><code>%Util</code> - Percentage utilization of the interface. For full-duplex interfaces, this is the greater of rKB/s or wKB/s as a percentage of the interface speed. For half-duplex interfaces, rKB/s and wKB/s are summed.</li>
<li><code>%rUtil, %wUtil</code> - Percentage utilization for bytes read and written, respectively.</li>
<li><code>Sat</code> - Saturation. This the number of errors/second seen for the interface
<ul>
<li>an indicator the interface may be approaching saturation. This statistic is combined from a number of kernel statistics. It is recommended to use the ‘-x’ option to see more individual statistics (those mentioned below) when attempting to diagnose a network issue.</li>
</ul></li>
<li><code>IErr</code> - Packets received that could not be processed because they contained errors</li>
<li><code>OErr</code> - Packets that were not successfully transmitted because of errors</li>
<li><code>Coll</code> - Ethernet collisions during transmit.</li>
<li><code>NoCP</code> - No-can-puts. This is when an incoming packet can not be put to the process reading the socket. This suggests the local process is unable to process incoming packets in a timely manner.</li>
<li><code>Defer</code> - Defer Transmits. Packets without collisions where first transmit attempt was delayed because the medium was busy.</li>
<li><code>Reset</code> - tcpEstabResets. The number of times TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state.</li>
<li><code>AttF</code> - tcpAttemptFails - The number of times that TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state.</li>
<li><code>%ReTX</code> - Percentage of TCP segments retransmitted - that is, the number of TCP segments transmitted containing one or more previously transmitted octets.</li>
<li><code>InConn</code> - tcpPassiveOpens - The number of times that TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state.</li>
<li><code>OutCon</code> - tcpActiveOpens - The number of times that TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state.</li>
<li><code>Drops</code> - tcpHalfOpenDrop + tcpListenDrop + tcpListenDropQ0. tcpListenDrop and tcpListenDropQ0 - Number of connections dropped from the completed connection queue and incomplete connection queue, respectively. tcpHalfOpenDrops - Number of connections dropped after the initial SYN packet was received.</li>
</ul>
</details>
<h2 id="nslookup">41. nslookup</h2>
<ul>
<li>Compat: Legacy; prefer <code>dig</code>/<code>resolvectl</code>; Requires: dnsutils/bind-utils.</li>
</ul>
<p>query Internet name servers interactively</p>
<ul>
<li><code>nslookup &lt;domain&gt;</code></li>
<li>Note: legacy tool. Prefer <code>dig</code> for detailed queries or <code>resolvectl</code> on systemd-based systems. Requires: dnsutils/bind-utils (for nslookup/dig).</li>
<li>Quick equivalents: <code>dig &lt;domain&gt; A +short</code>; <code>resolvectl query &lt;domain&gt;</code></li>
</ul>
<h2 id="host">42. host</h2>
<ul>
<li>Compat: Linux; Requires: bind9-host/bind-utils.</li>
</ul>
<p>host is a simple utility for performing DNS lookups. It is normally used to convert names to IP addresses and vice versa.</p>
<ul>
<li><code>host &lt;domain&gt;</code></li>
<li>Examples: <code>host -t A &lt;domain&gt;</code>; reverse lookup: <code>host &lt;ip&gt;</code></li>
<li>Tip: for more control, use <code>dig</code> (if installed) or <code>resolvectl</code>. Requires: bind9-host (Debian/Ubuntu) or bind-utils.</li>
</ul>
<h2 id="iwconfig">43. iwconfig</h2>
<ul>
<li><p>Compat: Legacy; prefer <code>iw</code>; Requires: wireless-tools.</p></li>
<li><p><code>iwconfig wlo1</code>: show WLAN config:</p></li>
<li><p>Note: <code>iwconfig</code> is legacy (wireless-tools). Prefer <code>iw</code> for modern drivers, e.g., <code>iw dev</code>, <code>iw dev wlo1 link</code>. Requires: wireless-tools. Modern alternative: iw.</p></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wlo1      IEEE 802.11  ESSID:&quot;NETGEAR97&quot;  </span><br><span class="line">      Mode:Managed  Frequency:2.462 GHz  Access Point: C4:04:15:58:60:C7   </span><br><span class="line">      Bit Rate=72.2 Mb/s   Tx-Power=20 dBm   </span><br><span class="line">      Retry short limit:7   RTS thr=2347 B   Fragment thr:off</span><br><span class="line">      Power Management:off</span><br><span class="line">      Link Quality=70/70  Signal level=-32 dBm  </span><br><span class="line">      Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">      Tx excessive retries:0  Invalid misc:22932   Missed beacon:0</span><br></pre></td></tr></table></figure>
<h2 id="brctl">44. brctl</h2>
<ul>
<li><p>Compat: Legacy; prefer <code>ip link</code> and <code>bridge</code>; Requires: bridge-utils.</p></li>
<li><p>brctl is used to set up, maintain, and inspect the ethernet bridge configuration in the linux kernel. Legacy: prefer <code>ip link add name br0 type bridge</code> and <code>bridge</code> (iproute2) tooling. Requires: bridge-utils.</p></li>
</ul>
<h2 id="kernel-tracing">Kernel &amp; Tracing</h2>
<p>Cheat Card - Kernel logs: <code>dmesg -T -l err,crit,alert,emerg</code> - Syscalls: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file</code> - Modules: <code>lsmod | head</code>, <code>modprobe &lt;name&gt;</code> (caution), <code>sysctl -a | grep tcp</code> - Optional advanced: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># perf (if installed)</span></span><br><span class="line">perf top</span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br><span class="line"></span><br><span class="line"><span class="comment"># bpftrace one-liner (Requires: bpftrace)</span></span><br><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:syscalls:sys_enter_openat &#123; @[comm] = count(); &#125;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="dmesg">11. dmesg</h2>
<ul>
<li><p>Compat: Linux; May be restricted by <code>kernel.dmesg_restrict</code>; Requires: util-linux.</p></li>
<li><p><code>dmesg --level=&lt;LEVEL&gt;</code> where <code>&lt;LEVEL&gt;</code> is:</p>
<ul>
<li><code>emerg</code> - system is unusable.</li>
<li><code>alert</code> - action must be taken immediately.</li>
<li><code>crit</code> - critical conditions.</li>
<li><code>err</code> - error conditions.</li>
<li><code>warn</code> - warning conditions.</li>
<li><code>notice</code> - normal but significant condition.</li>
<li><code>info</code> - informational.</li>
<li><code>debug</code> - debug-level messages.</li>
</ul></li>
<li><p><code>dmesg -k</code>: print kernel messages</p></li>
<li><p><code>dmesg -f=&lt;FACILITY&gt;</code> where <code>&lt;FACILITY&gt;</code> is:</p>
<ul>
<li><code>kern</code>: Kernel messages.</li>
<li><code>user</code>: User-level messages.</li>
<li><code>mail</code>: Mail system.</li>
<li><code>daemon</code>: System daemons.</li>
<li><code>auth</code>: Security/authorization messages.</li>
<li><code>syslog</code>: Internal syslogd messages.</li>
<li><code>lpr</code>: Line printer subsystem.</li>
<li><code>news</code>: Network news subsystem.</li>
</ul></li>
<li><p><code>dmesg -T</code>: human readable timestamps</p></li>
</ul>
<h2 id="lsmod">12. lsmod</h2>
<ul>
<li><p>Compat: Linux; Lists modules without root; Requires: kmod.</p></li>
<li><p>Show loaded kernel modules and sizes/dependencies.</p></li>
<li><p>Quick peek: <code>lsmod | head</code></p></li>
<li><p>Module info (version, params): <code>modinfo &lt;module&gt;</code></p></li>
</ul>
<h2 id="modprobe">13. modprobe</h2>
<ul>
<li>Compat: Linux; Root required; Caution: can destabilize systems; Requires: kmod.</li>
</ul>
<p>Add or remove modules from the Linux kernel. - Load: <code>modprobe &lt;module&gt;</code>; with params: <code>modprobe &lt;module&gt; key=value</code> - Unload: <code>modprobe -r &lt;module&gt;</code> (fails if in use) - Caution: loading/unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</p>
<h2 id="disk-filesystems">Disk &amp; Filesystems</h2>
<p>Cheat Card - Space/inodes: <code>df -h</code> and <code>df -i</code>; biggest dirs: <code>du -xhd1 /path | sort -h</code> - IO saturation: <code>iostat -xz 1</code>; per-proc IO: <code>pidstat -d 1</code>, <code>iotop -oPa</code> - Devices/FS: <code>lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</code>; mounts: <code>findmnt</code> - Mount ops: <code>mount --bind olddir newdir</code>; remount ro: <code>mount -o remount,ro /mnt</code></p>
<p>Inventory and health - Device tree: <code>lsblk -o NAME,TYPE,SIZE,FSTYPE,MOUNTPOINT,MODEL</code> - Identify filesystem UUID/TYPE: <code>blkid</code> - SMART check (if supported): <code>smartctl -H /dev/sdX</code> and <code>smartctl -a /dev/sdX</code> (Requires: smartmontools) - NVMe info: <code>nvme list</code>; <code>nvme smart-log /dev/nvme0</code> (Requires: nvme-cli)</p>
<p>Notes - iostat quick view (Requires: sysstat): <code>iostat -xz 1</code> (watch <code>await</code>, <code>%util</code>, <code>r/s</code>, <code>w/s</code>) - findmnt: show mount hierarchy or lookup by target: <code>findmnt /mount/point</code></p>
<ul>
<li>adds or removes modules from the Linux Kernel</li>
<li>Caution: loading/unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</li>
</ul>
<h2 id="dd-danger-destructive-read-first">14. dd (DANGER: DESTRUCTIVE — READ FIRST)</h2>
<ul>
<li><p>Compat: Linux; Root required for raw devices; Highly destructive when writing; Requires: coreutils.</p></li>
<li><p>Danger: dd will overwrite data with no confirmation. Double-check devices (e.g., <code>/dev/sdX</code>) and consider read-only or safer alternatives first. Use <code>lsblk</code>, <code>blkid</code> to verify targets.</p></li>
<li><p>Safer tips: for copies, consider <code>pv</code> to visualize throughput; for imaging, <code>dcfldd</code>; for testing, prefer non-destructive reads.</p></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Danger: wipes target disk. Verify device with lsblk/blkid.</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/dev/sda bs=4k status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Verify a drive is zeroed (non-zero bytes check)</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda status=none | hexdump -C | grep -q <span class="string">&#x27;[^00]&#x27;</span> || <span class="built_in">echo</span> <span class="string">&quot;All zeros&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fill a file with random data (example size)</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/urandom of=myfile bs=6703104 count=1 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Danger: clone a partition to another (same size/align). Verify both!</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda3 of=/dev/sdb3 bs=4096 status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Danger: write an image to a USB device. Verify device path first!</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/path/to/bootimage.img of=/dev/sdc bs=4M status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Quick r/w benchmark for a file (non-destructive read + temp write)</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/home/<span class="variable">$user</span>/bigfile of=/dev/null status=progress</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/home/<span class="variable">$user</span>/bigfile bs=1M count=1000 oflag=dsync status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sequential device read throughput sample (approx 1 GiB)</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sda of=/dev/null bs=1024k count=1024 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a swapfile (example: 8 GiB), then mkswap + swapon</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=swapfile bs=1MiB count=$((<span class="number">8</span>*<span class="number">1024</span>)) status=progress</span><br></pre></td></tr></table></figure>
<h2 id="jq">15. jq</h2>
<ul>
<li>Compat: Linux; Requires: jq package.</li>
</ul>
<p>What it does: parse/query/transform JSON on the command line. Requires: jq.</p>
<ul>
<li>Pretty-print: <code>jq . file.json</code></li>
<li>Extract field list: <code>jq -r '.items[].metadata.name' file.json</code></li>
<li>Filter by condition: <code>jq '.[] | select(.status=="RUNNING")' file.json</code></li>
<li>Transform and count: <code>jq '[.[] | .level] | group_by(.) | map({level: .[0], count: length})' file.json</code></li>
<li>Sort and top N: <code>jq 'sort_by(.time) | reverse | .[0:5]' file.json</code></li>
<li>From journald: <code>journalctl -o json | jq -r 'select(.PRIORITY&lt;=3) | .MESSAGE'</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Requires: jq — show high-priority messages from journald</span></span><br><span class="line">journalctl -o json | jq -r <span class="string">&#x27;select(.PRIORITY&lt;=3) | .MESSAGE&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>Keys and length: <code>jq 'keys, length' file.json</code></li>
</ul>
<h2 id="diff">16. diff</h2>
<ul>
<li><p>Compat: Linux; Requires: diffutils.</p></li>
<li><p>unified diff: <code>diff -u old.txt new.txt</code></p></li>
<li><p>recursive dirs: <code>diff -ruN dir_old dir_new</code></p></li>
<li><p>ignore whitespace changes: <code>diff -u -w old new</code></p></li>
<li><p>handle CRLF: <code>diff -u --strip-trailing-cr a b</code></p></li>
<li><p>color (if supported): <code>diff --color=auto -u a b</code></p></li>
<li><p>apply a patch: <code>patch -p1 &lt; change.diff</code></p></li>
</ul>
<h2 id="uname">17. uname</h2>
<ul>
<li><p>Compat: Linux; Requires: coreutils.</p></li>
<li><p>get all details about the computer</p></li>
</ul>
<h2 id="syncfsync">18. sync/fsync</h2>
<ul>
<li><p>Compat: Linux; <code>sync</code> is user command; <code>fsync</code> is a syscall.</p></li>
<li><p><code>fsync</code> is a syscall that flushes a file’s in-memory data and metadata to storage. From the shell, use <code>sync</code> (flush all dirty data) or <code>syncfs</code> (flush a filesystem) when available.</p></li>
</ul>
<h2 id="mkswap">19. mkswap</h2>
<ul>
<li><p>Compat: Linux; Root required; Requires: util-linux.</p></li>
<li><p><code>-c</code>: check if blocks are corrupted</p></li>
<li><p><code>-p</code>: set pagesize</p></li>
</ul>
<h2 id="fsck">20. fsck</h2>
<ul>
<li><p>Compat: Linux; Root required; Avoid on mounted filesystems; Requires: e2fsprogs for ext*.</p></li>
<li><p>check for file system consistency:</p>
<ul>
<li>The superblock is checked for inconsistencies in:
<ul>
<li>File system size</li>
<li>Number of inodes</li>
<li>Free-block count</li>
<li>Free-inode count</li>
</ul></li>
<li>Each inode is checked for inconsistencies in:
<ul>
<li>Format and type</li>
<li>Link count</li>
<li>Duplicate block</li>
<li>Bad block numbers</li>
<li>Inode size</li>
</ul></li>
</ul></li>
<li><p>see: https://docs.oracle.com/cd/E19455-01/805-7228/6j6q7uf0e/index.html</p></li>
<li><p>Caution: avoid running fsck on a mounted filesystem (except with specific fs support); prefer read-only mounts or maintenance windows.</p></li>
</ul>
<p>Extended notes - ext* specifics: <code>e2fsck</code> checks ext2/3/4; use <code>-f</code> to force, <code>-n</code> for read-only, <code>-p</code> for preen (auto-fix safe issues). Requires: e2fsprogs. - Bad blocks (DANGER): <code>badblocks</code> scans devices for bad sectors; write-mode is destructive. Prefer read-only first.</p>
<p>Examples <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Read-only badblocks scan (non-destructive)</span></span><br><span class="line"><span class="built_in">sudo</span> badblocks -sv /dev/sdX</span><br><span class="line"></span><br><span class="line"><span class="comment"># DANGER: write-mode destructive scan — data loss</span></span><br><span class="line"><span class="built_in">sudo</span> badblocks -wsv /dev/sdX</span><br><span class="line"></span><br><span class="line"><span class="comment"># ext* filesystem check (read-only)</span></span><br><span class="line"><span class="built_in">sudo</span> e2fsck -fn /dev/sdXN</span><br></pre></td></tr></table></figure></p>
<h2 id="mount">21. mount</h2>
<ul>
<li><p>Compat: Linux; Root required unless user mounts configured; Requires: util-linux.</p></li>
<li><p><code>mount -a [-t type] [-O optlist]</code>: mount all FSs mentioned in fstab to be mounted</p></li>
<li><p><code>-o</code>: override the settings in fstab</p></li>
<li><p><code>mount --bind olddir newdir</code>: remount part of the hierarchy elsewhere</p></li>
<li><p><code>mount --move</code>: move mounted tree to another place</p></li>
<li><p>Caution: <code>--bind/--move</code> and remounts can impact running services; ensure correct <code>fstab</code> for persistence and have rollback plan.</p></li>
</ul>
<h2 id="umount">22. umount</h2>
<ul>
<li><p>Compat: Linux; Root required for system mounts; Requires: util-linux.</p></li>
<li><p>unmount from a mountpoint</p></li>
</ul>
<h2 id="chown">23. chown</h2>
<ul>
<li><code>chown root:staff /u</code>: change owner and group</li>
</ul>
<h2 id="sysctl">24. sysctl</h2>
<ul>
<li><p>Compat: Linux; Root required for <code>-w</code>; Persistence via <code>/etc/sysctl.d</code>; Requires: procps.</p></li>
<li><p>configure kernel parameters at runtime</p></li>
<li><p><code>sysctl -a | grep "tcp"</code></p></li>
<li><p>Caution: <code>sysctl -w</code> changes take effect immediately; persist only via <code>/etc/sysctl.d/*.conf</code> after validation.</p></li>
<li><p>Read a key: <code>sysctl net.ipv4.tcp_congestion_control</code></p></li>
<li><p>Set a key (runtime): <code>sysctl -w vm.swappiness=10</code></p></li>
<li><p>Persist: create <code>/etc/sysctl.d/99-local.conf</code> with <code>vm.swappiness = 10</code>, then <code>sysctl --system</code></p></li>
</ul>
<h2 id="iotop">25. iotop</h2>
<ul>
<li><p>Compat: Linux; Root required; Needs kernel taskstats/delay accounting; Python tool.</p></li>
<li><p><code>iotop -o</code>: only show threads doing I/O</p></li>
<li><p><code>iotop -p &lt;PID1&gt;,&lt;PID2&gt;,...</code>: list of processes to monitor</p></li>
<li><p><code>iotop -a</code>: show accumulated IO rather than diff Requires: iotop.</p></li>
</ul>
<h2 id="netstat">26. netstat</h2>
<ul>
<li>Compat: Legacy; prefer <code>ss</code>; Requires: net-tools.</li>
</ul>
<h2 id="processes-scheduling">Processes &amp; Scheduling</h2>
<p>Cheat Card - Top offenders: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code> - Threads view: <code>top -H</code> or <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code> - Target processes: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Preview before signaling</span></span><br><span class="line">pgrep -a &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Then send a scoped, safe signal (example: TERM)</span></span><br><span class="line">pkill -TERM -u &lt;user&gt; -f <span class="string">&#x27;&lt;exact-pattern&gt;&#x27;</span></span><br></pre></td></tr></table></figure> - Over time: <code>pidstat -u 1 -p &lt;pid&gt;</code> (CPU) and <code>pidstat -d 1</code> (IO) - Find PIDs: <code>pidof &lt;proc&gt;</code>; list threads: <code>ps -Lp &lt;pid&gt;</code> - Niceness: start <code>nice -n 10 cmd</code>; adjust: <code>renice -n 10 -p &lt;pid&gt;</code> - Locks: <code>/proc/locks</code> shows current file locks (read-only) - Sessions: users <code>who</code>; recent logins <code>last | head</code> - Schedule: <code>crontab -l</code> list; <code>crontab -e</code> edit</p>
<ul>
<li>Deprecated in many distros; prefer <code>ss</code>.</li>
<li>Common mappings:
<ul>
<li><code>netstat -tulpn</code> -&gt; <code>ss -tulpn</code></li>
<li><code>netstat -anp</code> -&gt; <code>ss -anp</code></li>
<li><code>netstat -s</code> -&gt; <code>ss -s</code></li>
</ul></li>
</ul>
<h2 id="top">27. top</h2>
<ul>
<li><p>Compat: Linux; Requires: procps.</p></li>
<li><p>Dynamic process view with CPU, memory, and load summaries.</p></li>
<li><p>Key CPU line fields: <code>us</code> (user), <code>sy</code> (system), <code>ni</code>, <code>id</code> (idle), <code>wa</code> (iowait), <code>hi/si</code> (IRQ/softIRQ), <code>st</code> (steal).</p></li>
<li><p>Key per-proc fields: <code>%CPU</code>, <code>%MEM</code>, <code>VIRT</code> (virtual), <code>RES</code> (resident), <code>SHR</code> (shared), <code>TIME+</code> (CPU time).</p></li>
<li><p><code>top -E m|g</code>: scale as mega|giga bytes</p></li>
<li><p><code>top -H</code>: thread-mode</p></li>
<li><p><code>top -i</code>: show idle processes</p></li>
<li><p><code>top -o RES|VIRT|SWAP</code>, etc: sort by attribute</p></li>
<li><p><code>top -O</code>: output fields: print all available sort-attributes</p></li>
<li><p><code>top -p pid1,pid2,...</code>: monitor only these PIDs</p></li>
<li><p><code>top -1</code>: show per-CPU stats</p></li>
</ul>
<h2 id="vmstat">28. vmstat</h2>
<ul>
<li>Compat: Linux; Requires: procps.</li>
</ul>
<p>Useful to get so/si information</p>
<ul>
<li>Report virtual memory statistics</li>
<li><code>vmstat -a</code>: number active/inactive memory</li>
<li><code>vmstat --stats</code>: various statistics</li>
</ul>
<p>Interpretation tips - <code>r</code> runnable &gt; number of CPUs indicates run-queue contention. - <code>b</code> blocked processes (often IO wait); correlate with <code>%wa</code> in top/mpstat. - <code>si/so</code> swap in/out: sustained non-zero values indicate memory pressure. - Use <code>vmstat 1</code> for near-real-time view.</p>
<h2 id="strace">29. strace</h2>
<ul>
<li>Compat: Linux; May be restricted by ptrace scope; Requires: strace.</li>
</ul>
<p>Trace system calls and signals. - Attach to a PID: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</code> - Run a program under strace: <code>strace -o strace.log -s 200 -vv -f -ttT your_cmd --arg</code> - Syscall time summary: <code>strace -c -p &lt;pid&gt;</code> - Filter a path: <code>strace -ttT -e trace=file -P /etc/resolv.conf -p &lt;pid&gt;</code> - Notes: <code>-f</code> follows forks; <code>-ttT</code> adds timestamps and syscall durations; <code>-s</code> increases string size. - trace system calls and signals</p>
<h2 id="slabtop">30. slabtop</h2>
<ul>
<li><p>Compat: Linux; Requires: procps.</p></li>
<li><p><code>slabtop</code>: display kernel slab cache information in real time</p></li>
<li><p>Sort by size: <code>slabtop -s c</code>; one-shot: <code>slabtop -o</code></p></li>
</ul>
<h2 id="uptime">31. uptime</h2>
<ul>
<li><p>Compat: Linux; Requires: procps.</p></li>
<li><p>information about how long the system has been up, and load averages</p></li>
</ul>
<h2 id="htop">32. htop</h2>
<ul>
<li><p>Compat: Linux; Requires: htop package.</p></li>
<li><p>like top, but prettier</p></li>
</ul>
<h2 id="ps">33. ps</h2>
<ul>
<li>Compat: Linux; Requires: procps.</li>
</ul>
<p>Cheat Card - Top CPU: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code> - Top RSS: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code> - Tree view: <code>ps -ejH</code> (or <code>ps axjf</code>) - By command: <code>ps -C nginx -o pid,ppid,cmd,%mem,%cpu</code> - Threads of a PID: <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code></p>
<ul>
<li><p><code>ps aux</code>: show all processes</p></li>
<li><p><code>ps axjf</code> - print process tree</p></li>
<li><p><code>ps a</code> - Lift the BSD-style “only yourself” restriction</p></li>
<li><p><code>ps -A</code> - select all processes</p></li>
<li><p><code>ps -d</code> - select all processes except session leaders</p></li>
<li><p><code>ps g</code> - select all processes including session leaders</p></li>
<li><p><code>ps Ta</code> - all process associated with this terminal</p></li>
<li><p><code>ps r</code> - restrict to running processes</p></li>
<li><p><code>ps --pid pidlist</code> - restrict to pidlist processes</p></li>
<li><p><code>ps -s|--sid</code> - select by session ID</p></li>
<li><p><code>ps t ttylist</code> - select by TTY list</p></li>
<li><p><code>ps U|-U</code> - select by effective user-id</p></li>
<li><p><code>ps s</code> - display signals</p></li>
<li><p><code>ps f</code> - ASCII art process hierarchy</p></li>
<li><p><code>ps ax -o rss,pid,user,pcpu,command --sort -%cpu</code>: sort by %cpu</p></li>
<li><p><code>ps ax -o rss,pid,user,pcpu,command --sort -rss</code>: sort by rss</p></li>
</ul>
<p>process states: - <code>D</code> - uninterruptible sleep (usually IO) - <code>I</code> - Idle kernel thread - <code>R</code> - running or runnable (on run queue) - <code>S</code> - interruptible sleep (waiting for an event to complete) - <code>T</code> - stopped by job control signal - <code>t</code> - stopped by debugger during the tracing - <code>W</code> - paging (not valid since the 2.6.xx kernel) - <code>X</code> - dead (should never be seen) - <code>Z</code> - defunct (“zombie”) process, terminated but not reaped by its parent</p>
<p>see STANDARD FORMAT SPECIFIERS in <code>man ps</code></p>
<h2 id="cpu">CPU</h2>
<p>Cheat Card - CPU saturation: <code>mpstat -P ALL 1</code> (sys/iowait/irq/soft) - Per-core view in top: <code>top -1</code>; over time per PID: <code>pidstat -u 1 -p &lt;pid&gt;</code> - Interrupt spikes: <code>mpstat -I CPU 1</code></p>
<h2 id="mpstat">34. mpstat</h2>
<ul>
<li>Compat: Linux; Requires: sysstat.</li>
</ul>
<p>The mpstat command writes to standard output activities for each available processor, processor 0 being the first one. Global average activities among all processors are also reported. Requires: sysstat.</p>
<p>Interpretation tips - High <code>%iowait</code>: CPUs idle while waiting on disk IO (check iostat). - High <code>%irq/%soft</code>: heavy interrupts/softirqs (often network or storage). - High <code>%steal</code>: hypervisor stealing time (noisy neighbor in a VM). - Compare per-core: hotspots can be isolated to specific cores (affinity).</p>
<ul>
<li><p><code>CPU</code>: Processor number. The keyword all indicates that statistics are calculated as averages among all processors.</p></li>
<li><p><code>%usr</code>: Show the percentage of CPU utilization that occurred while executing at the user level (application).</p></li>
<li><p><code>%nice</code>: Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</p></li>
<li><p><code>%sys</code>: Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.</p></li>
<li><p><code>%iowait</code>: Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.</p></li>
<li><p><code>%irq</code>: Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.</p></li>
<li><p><code>%soft</code>: Show the percentage of time spent by the CPU or CPUs to service software interrupts.</p></li>
<li><p><code>%steal</code>: Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</p></li>
<li><p><code>%guest</code>: Show the percentage of time spent by the CPU or CPUs to run a virtual processor.</p></li>
<li><p><code>%gnice</code>: Show the percentage of time spent by the CPU or CPUs to run a niced guest.</p></li>
<li><p><code>mpstat -I</code>: report interrupt stats</p>
<ul>
<li><h1 id="of-interrupts-per-cpu">of interrupts per CPU</h1></li>
<li><h1 id="of-times-a-particular-interrupt-occurred">of times a particular interrupt occurred</h1></li>
</ul></li>
</ul>
<h2 id="memory">Memory</h2>
<p>Cheat Card - Snapshot: <code>free -h --wide</code>; paging: <code>vmstat -a 1</code> (si/so) - Per-proc memory: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code>; deep dive: <code>pmap -x &lt;pid&gt;</code> - OOM evidence: <code>dmesg -T | grep -i oom</code> or <code>journalctl -k -g OOM</code></p>
<h2 id="free">35. free</h2>
<ul>
<li><p>Compat: Linux; Requires: procps.</p></li>
<li><p><code>used</code> - Used memory (calculated as total - free - buffers - cache)</p></li>
<li><p><code>free</code> - Unused memory (MemFree and SwapFree in /proc/meminfo)</p></li>
<li><p><code>shared</code> - Memory used (mostly) by tmpfs (Shmem in /proc/meminfo)</p></li>
<li><p><code>buffers</code> - Memory used by kernel buffers (Buffers in /proc/meminfo)</p></li>
<li><p><code>cache</code> - Memory used by the page cache and slabs (Cached and SReclaimable in /proc/meminfo)</p></li>
<li><p><code>buff/cache</code> - Sum of buffers and cache</p></li>
<li><p><code>available</code> - Estimation of how much memory is available for starting new applications, without swapping. Unlike the data provided by the cache or free fields, this field takes into account page cache and also that not all reclaimable memory slabs will be reclaimed due to items being in use (MemAvailable in /proc/meminfo, available on kernels 3.14, emulated on kernels 2.6.27+, otherwise the same as free)</p></li>
<li><p><code>free -l</code>: show low-high memory breakdown</p></li>
<li><p><code>free --wide</code>: show free memory stats</p></li>
</ul>
<p>Interpretation tips - <code>available</code> approximates memory free for new apps without swapping; don’t confuse <code>free</code> with usable memory. - High <code>buff/cache</code> is normal; it’s the page cache and reclaimable slabs.</p>
<p>Examples - Human-readable snapshot: <code>free -h --wide</code> - Example output: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           31Gi        2.1Gi       22Gi        312Mi       7.2Gi        28Gi</span><br><span class="line">Swap:           8Gi           0B        8Gi</span><br></pre></td></tr></table></figure></p>
<h2 id="sar">36. sar</h2>
<ul>
<li>Compat: Linux; Requires: sysstat; history needs <code>sadc</code> enabled.</li>
</ul>
<p>Cheat Card - CPU load/queue: <code>sar -q 1 5</code>; memory: <code>sar -r 1 5</code> - IO bw/ops: <code>sar -b 1 5</code>; per-device: <code>sar -d 1 5</code> (watch <code>await</code>, <code>%util</code>) - Network: <code>sar -n DEV 1 5</code>; TCP: <code>sar -n TCP,ETCP 1 5</code> - Paging: <code>sar -B 1 5</code> (<code>pgsteal</code>, <code>pgscan</code>, <code>majflt/s</code>)</p>
<p>Requires: sysstat (includes pidstat).</p>
<details>
<summary>
Field reference (click to expand)
</summary>
<ul>
<li><p><code>sar -B</code>: report paging stats</p>
<ul>
<li><code>gpgin/s</code> - Total number of kilobytes the system paged in from disk per second.</li>
<li><code>pgpgout/s</code> - Total number of kilobytes the system paged out to disk per second.</li>
</ul></li>
<li><p><code>fault/s</code> - Number of page faults (major + minor) made by the system per second. This is not a count of page faults that generate I/O, because some page faults can be resolved without I/O.</p>
<ul>
<li><code>majflt/s</code> - Number of major faults the system has made per second, those which have required loading a memory page from disk.</li>
<li><code>pgfree/s</code> - Number of pages placed on the free list by the system per second.</li>
<li><code>pgscank/s</code> - Number of pages scanned by the kswapd daemon per second.</li>
<li><code>pgscand/s</code> - Number of pages scanned directly per second.</li>
<li><code>pgsteal/s</code> - Number of pages the system has reclaimed from cache (pagecache and swapcache) per second to satisfy its memory demands.</li>
<li><code>%vmeff</code> - Calculated as pgsteal / pgscan, this is a metric of the efficiency of page reclaim. If it is near 100% then almost every page coming off the tail of the inactive list is being reaped. If it gets too low (e.g. less than 30%) then the virtual memory is having some difficulty. This field is displayed as zero if no pages have been scanned during the interval of time.</li>
</ul></li>
<li><p><code>sar -b</code>: Report I/O and transfer rate statistics.</p>
<ul>
<li><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I/O request to a physical device. Multiple logical requests can be combined into a single I/O request to the device. A transfer is of indeterminate size.</li>
<li><code>rtps</code> - Total number of read requests per second issued to physical devices.</li>
<li><code>wtps</code> - Total number of write requests per second issued to physical devices.</li>
<li><code>bread/s</code> - Total amount of data read from the devices in blocks per second. Blocks are equivalent to sectors and therefore have a size of 512 bytes.</li>
<li><code>bwrtn/s</code> - Total amount of data written to devices in blocks per second.</li>
</ul></li>
<li><p><code>sar -d</code>: report activity for each block device</p></li>
<li><p><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I/O request to a physical device. Multiple logical requests can be combined into a single I/O request to the device. A transfer is of indeterminate size.</p>
<ul>
<li><code>rkB/s</code> - Number of kilobytes read from the device per second.</li>
<li><code>wkB/s</code> - Number of kilobytes written to the device per second.</li>
<li><code>areq-sz</code> - The average size (in kilobytes) of the I/O requests that were issued to the device. Note: In previous versions, this field was known as avgrq-sz and was expressed in sectors.</li>
<li><code>aqu-sz</code> - The average queue length of the requests that were issued to the device. Note: In previous versions, this field was known as avgqu-sz.</li>
<li><code>await</code> - The average time (in milliseconds) for I/O requests issued to the device to be served. This includes the time spent by the requests in queue and the time spent servicing them.</li>
<li><code>svctm</code> - The average service time (in milliseconds) for I/O requests that were issued to the device. Warning! Do not trust this field any more. This field will be removed in a future sysstat version.</li>
<li><code>%util</code> - Percentage of elapsed time during which I/O requests were issued to the device (bandwidth utilization for the device). Device saturation occurs when this value is close to 100% for devices serving requests serially. But for devices serving requests in parallel, such as RAID arrays and modern SSDs, this number does not reflect their performance limits.</li>
</ul></li>
<li><p><code>sar -F</code>: display stats. for currently mounted FSs:</p>
<ul>
<li><code>MBfsfree</code> - Total amount of free space in megabytes (including space available only to privileged user).</li>
<li><code>MBfsused</code> - Total amount of space used in megabytes.</li>
<li><code>%fsused</code> - Percentage of filesystem space used, as seen by a privileged user.</li>
<li><code>%ufsused</code> - Percentage of filesystem space used, as seen by an unprivileged user.</li>
<li><code>Ifree</code> - Total number of free file nodes in filesystem.</li>
<li><code>Iused</code> - Total number of file nodes used in filesystem.</li>
<li><code>%Iused</code> - Percentage of file nodes used in filesystem.</li>
</ul></li>
<li><p><code>sar -m</code>: power management statistics:</p>
<ul>
<li><code>MHz</code> - Instantaneous CPU clock frequency in MHz.</li>
</ul>
<p>With the FAN keyword, statistics about fans speed are reported. The following values are displayed:</p>
<ul>
<li><code>rpm</code> - Fan speed expressed in revolutions per minute.</li>
<li><code>drpm</code> - This field is calculated as the difference between current fan speed (rpm) and its low limit (fan_min).</li>
<li><code>DEVICE</code> - Sensor device name.</li>
</ul>
<p>With the FREQ keyword, statistics about CPU clock frequency are reported. The following value is displayed:</p>
<ul>
<li><code>wghMHz</code> - Weighted average CPU clock frequency in MHz. Note that the cpufreq-stats driver must be compiled in the kernel for this option to work.</li>
</ul>
<p>With the IN keyword, statistics about voltage inputs are reported. The following values are displayed:</p>
<ul>
<li><code>inV</code> - Voltage input expressed in Volts.</li>
<li><code>%in</code> - Relative input value. A value of 100% means that voltage input has reached its high limit (in_max) whereas a value of 0% means that it has reached its low limit (in_min).</li>
<li><code>DEVICE</code> - Sensor device name.</li>
</ul>
<p>With the USB keyword, the sar command takes a snapshot of all the USB devices currently plugged into the system. At the end of the report, sar will display a summary of all those USB devices. The following values are displayed:</p>
<ul>
<li><code>BUS</code> - Root hub number of the USB device.</li>
<li><code>idvendor</code> - Vendor ID number (assigned by USB organization).</li>
<li><code>idprod</code> - Product ID number (assigned by Manufacturer).</li>
<li><code>maxpower</code> - Maximum power consumption of the device (expressed in mA).</li>
<li><code>manufact</code> - Manufacturer name.</li>
<li><code>product</code> - Product name.</li>
</ul></li>
<li><p><code>sar -n DEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxpck/s</code> - Total number of packets received per second.</li>
<li><code>txpck/s</code> - Total number of packets transmitted per second.</li>
<li><code>rxkB/s</code> - Total number of kilobytes received per second.</li>
<li><code>txkB/s</code> - Total number of kilobytes transmitted per second.</li>
<li><code>rxcmp/s</code> - Number of compressed packets received per second (for cslip etc.).</li>
<li><code>txcmp/s</code> - Number of compressed packets transmitted per second.</li>
<li><code>rxmcst/s</code> - Number of multicast packets received per second.</li>
<li><code>%ifutil</code> - Utilization percentage of the network interface. For half-duplex interfaces, utilization is calculated using the sum of rxkB/s and txkB/s as a percentage of the interface speed. For full-duplex, this is the greater of rxkB/S or txkB/s.</li>
</ul></li>
<li><p><code>sar -n EDEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxerr/s</code> - Total number of bad packets received per second.</li>
<li><code>txerr/s</code> - Total number of errors that happened per second while transmitting packets.</li>
<li><code>coll/s</code> - Number of collisions that happened per second while transmitting packets.</li>
<li><code>rxdrop/s</code> - Number of received packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txdrop/s</code> - Number of transmitted packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txcarr/s</code> - Number of carrier-errors that happened per second while transmitting packets.</li>
<li><code>rxfram/s</code> - Number of frame alignment errors that happened per second on received packets.</li>
<li><code>rxfifo/s</code> - Number of FIFO overrun errors that happened per second on received packets.</li>
<li><code>txfifo/s</code> - Number of FIFO overrun errors that happened per second on transmitted packets.</li>
</ul></li>
<li><p><code>sar -n ICMP</code>:</p>
<ul>
<li><code>imsg/s</code> - The total number of ICMP messages which the entity received per second [icmpInMsgs]. Note that this counter includes all those counted by ierr/s.</li>
<li><code>omsg/s</code> - The total number of ICMP messages which this entity attempted to send per second [icmpOutMsgs]. Note that this counter includes all those counted by oerr/s.</li>
<li><code>iech/s</code> - The number of ICMP Echo (request) messages received per second [icmpInEchos].</li>
<li><code>iechr/s</code> - The number of ICMP Echo Reply messages received per second [icmpInEchoReps].</li>
<li><code>oech/s</code> - The number of ICMP Echo (request) messages sent per second [icmpOutEchos].</li>
<li><code>oechr/s</code> - The number of ICMP Echo Reply messages sent per second [icmpOutEchoReps].</li>
<li><code>itm/s</code> - The number of ICMP Timestamp (request) messages received per second [icmpInTimestamps].</li>
<li><code>itmr/s</code> - The number of ICMP Timestamp Reply messages received per second [icmpInTimestampReps].</li>
<li><code>otm/s</code> - The number of ICMP Timestamp (request) messages sent per second [icmpOutTimestamps].</li>
<li><code>otmr/s</code> - The number of ICMP Timestamp Reply messages sent per second [icmpOutTimestampReps].</li>
<li><code>iadrmk/s</code> - The number of ICMP Address Mask Request messages received per second [icmpInAddrMasks].</li>
<li><code>oadrmk/s</code> - The number of ICMP Address Mask Request messages sent per second [icmpOutAddrMasks].</li>
<li><code>oadrmkr/s</code> - The number of ICMP Address Mask Reply messages sent per second [icmpOutAddrMaskReps].</li>
</ul></li>
<li><p><code>sar -n EICMP</code>: Extended ICMP stats (errors, dest unreachable, time exceeded). Focus on spikes in <code>ierr/s</code> and <code>oerr/s</code>, and patterns in unreachable/time- exceeded when debugging path issues.</p></li>
<li><p><code>sar -n EIP</code>: Extended IPv4 stats (header errors, addr errors, discards, no routes, reassembly, fragment fails). Use to spot header errors and routing/ no-route conditions.</p></li>
<li><p><code>sar -n IP6</code>: IPv6 per-protocol counters (receive/deliver/forward, multicast, fragmentation). Check for anomalies similar to IPv4.</p></li>
<li><p><code>sar -n EIP6</code>: Extended IPv6 errors and routing stats (header/addr errors, discards, no routes, reassembly/frag). Useful for IPv6-specific troubleshooting.</p></li>
<li><p><code>sar -n SOCK</code>:</p>
<ul>
<li><code>totsck</code> - Total number of sockets used by the system.</li>
<li><code>tcpsck</code> - TCP sockets in use; <code>tcp-tw</code> - TIME_WAIT sockets.</li>
</ul></li>
<li><p><code>sar -n SOFT</code>:</p>
<ul>
<li><code>total/s</code> - The total number of network frames processed per second.</li>
<li><code>dropd/s</code> - The total number of network frames dropped per second because there was no room on the processing queue.</li>
<li><code>squeezd/s</code> - The number of times the softirq handler function terminated per second because its budget was consumed or the time limit was reached, but more work could have been done.</li>
<li><code>rx_rps/s</code> - The number of times the CPU has been woken up per second to process packets via an inter-processor interrupt.</li>
<li><code>flw_lim/s</code> - The number of times the flow limit has been reached per second. Flow limiting is an optional RPS feature that can be used to limit the number of packets queued to the backlog for each flow to a certain amount. This can help ensure that smaller flows are processed even though much larger flows are pushing packets in.</li>
</ul></li>
<li><p><code>sar -n TCP</code>:</p>
<ul>
<li><code>active/s</code> - The number of times TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state per second [tcpActiveOpens].</li>
<li><code>passive/s</code> - The number of times TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state per second [tcpPassiveOpens].</li>
<li><code>iseg/s</code> - The total number of segments received per second, including those received in error [tcpInSegs]. This count includes segments received on currently established connections.</li>
<li><code>oseg/s</code> - The total number of segments sent per second, including those on current connections but excluding those containing only retransmitted octets [tcpOutSegs].</li>
</ul></li>
<li><p><code>sar -n ETCP</code>:</p>
<ul>
<li><code>atmptf/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times per second TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state [tcpAttemptFails].</li>
<li><code>estres/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state [tcpEstabResets].</li>
<li><code>retrans/s</code> - The total number of segments retransmitted per second - that is, the number of TCP segments transmitted containing one or more previously transmitted octets [tcpRetransSegs].</li>
<li><code>isegerr/s</code> - The total number of segments received in error (e.g., bad TCP checksums) per second [tcpInErrs].</li>
<li><code>orsts/s</code> - The number of TCP segments sent per second containing the RST flag [tcpOutRsts].</li>
</ul></li>
<li><p><code>sar -n UDP</code>:</p>
<ul>
<li><code>idgm/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmerr/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul></li>
<li><p><code>sar -n UDP6</code>:</p>
<ul>
<li><code>idgm6/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm6/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport6/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmer6/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul></li>
<li><p><code>sar -q</code>:</p>
<ul>
<li><code>runq-sz</code> - Run queue length (number of tasks waiting for run time).</li>
<li><code>plist-sz</code> - Number of tasks in the task list.</li>
<li><code>ldavg-1</code> - System load average for the last minute. The load average is calculated as the average number of runnable or running tasks (R state), and the number of tasks in uninterruptible sleep (D state) over the specified interval.</li>
<li><code>ldavg-5</code> - System load average for the past 5 minutes.</li>
<li><code>ldavg-15</code> - System load average for the past 15 minutes.</li>
<li><code>blocked</code> - Number of tasks currently blocked, waiting for I/O to complete.</li>
</ul></li>
<li><p><code>sar -r</code>:</p>
<ul>
<li><code>kbmemfree</code> - Amount of free memory available in kilobytes.</li>
<li><code>kbavail</code> - Estimate of how much memory in kilobytes is available for starting new applications, without swapping. The estimate takes into account that the system needs some page cache to function well, and that not all reclaimable memory slabs will be reclaimable, due to items being in use. The impact of those factors will vary from system to system.</li>
</ul></li>
<li><p><code>kbmemused</code> - Amount of used memory in kilobytes (calculated as total installed memory - kbmemfree - kbbuffers - kbcached - kbslab).</p>
<ul>
<li><code>%memused</code> - Percentage of used memory.</li>
<li><code>kbbuffers</code> - Amount of memory used as buffers by the kernel in kilobytes.</li>
<li><code>kbcached</code> - Amount of memory used to cache data by the kernel in kilobytes.</li>
</ul></li>
<li><p><code>kbcommit</code> - Amount of memory in kilobytes needed for current workload. This is an estimate of how much RAM/swap is needed to guarantee that there never is out of memory.</p></li>
<li><p><code>%commit</code> - Percentage of memory needed for current workload in relation to the total amount of memory (RAM+swap). This number may be greater than 100% because the kernel usually overcommits memory.</p></li>
<li><p><code>kbactive</code> - Amount of active memory in kilobytes (memory that has been used more recently and usually not reclaimed unless absolutely necessary).</p></li>
<li><p><code>kbinact</code> - Amount of inactive memory in kilobytes (memory which has been less recently used. It is more eligible to be reclaimed for other purposes).</p>
<ul>
<li><code>kbdirty</code> - Amount of memory in kilobytes waiting to get written back to the disk.</li>
<li><code>kbanonpg</code> - Amount of non-file backed pages in kilobytes mapped into userspace page tables.</li>
<li><code>kbslab</code> - Amount of memory in kilobytes used by the kernel to cache data structures for its own use.</li>
<li><code>kbkstack</code> - Amount of memory in kilobytes used for kernel stack space.</li>
<li><code>kbpgtbl</code> - Amount of memory in kilobytes dedicated to the lowest level of page tables.</li>
<li><code>kbvmused</code> - Amount of memory in kilobytes of used virtual address space.</li>
</ul></li>
<li><p><code>sar -S</code>:</p>
<ul>
<li><code>kbswpfree</code> - Amount of free swap space in kilobytes.</li>
<li><code>kbswpused</code> - Amount of used swap space in kilobytes.</li>
<li><code>%swpused</code> - Percentage of used swap space.</li>
</ul></li>
<li><p><code>kbswpcad</code> - Amount of cached swap memory in kilobytes. This is memory that once was swapped out, is swapped back in but still also is in the swap area (if memory is needed it doesn’t need to be swapped out again because it is already in the swap area. This saves I/O).</p>
<ul>
<li><code>%swpcad</code> - Percentage of cached swap memory in relation to the amount of used swap space.</li>
</ul></li>
<li><p><code>sar -u</code>:</p></li>
<li><p><code>%user</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field includes time spent running virtual processors.</p></li>
<li><p><code>%usr</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field does NOT include time spent running virtual processors.</p></li>
<li><p><code>%nice</code> - Percentage of CPU utilization that occurred while executing at the user level with nice priority.</p></li>
<li><p><code>%system</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field includes time spent servicing hardware and software interrupts.</p></li>
<li><p><code>%sys</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field does NOT include time spent servicing hardware or software interrupts.</p></li>
<li><p><code>%iowait</code> - Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.</p></li>
<li><p><code>%steal</code> - Percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</p>
<ul>
<li><code>%irq</code> - Percentage of time spent by the CPU or CPUs to service hardware interrupts.</li>
<li><code>%soft</code> - Percentage of time spent by the CPU or CPUs to service software interrupts.</li>
<li><code>%guest</code> - Percentage of time spent by the CPU or CPUs to run a virtual processor.</li>
<li><code>%gnice</code> - Percentage of time spent by the CPU or CPUs to run a niced guest.</li>
</ul></li>
<li><p><code>%idle</code> - Percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I/O request.</p></li>
<li><p><code>sar -v</code>:</p>
<ul>
<li><code>dentunusd</code> - Number of unused cache entries in the directory cache.</li>
<li><code>file-nr</code> - Number of file handles used by the system.</li>
<li><code>inode-nr</code> - Number of inode handlers used by the system.</li>
<li><code>pty-nr</code> - Number of pseudo-terminals used by the system.</li>
</ul></li>
<li><p><code>sar -W</code>: Report swapping statistics. The following values are displayed:</p>
<ul>
<li><code>pswpin/s</code> - Total number of swap pages the system brought in per second.</li>
<li><code>pswpout/s</code> - Total number of swap pages the system brought out per second.</li>
</ul></li>
<li><p><code>sar -w</code>: Report task creation and system switching activity.</p>
<ul>
<li><code>proc/s</code> - Tasks created per second; <code>cswch/s</code> - context switches per second.</li>
</ul></li>
<li><p><code>sar -y</code>: Report TTY devices activity. The following values are displayed:</p></li>
<li><p><code>rcvin/s</code> - Number of receive interrupts per second for current serial line. Serial line number is given in the TTY column.</p>
<ul>
<li><code>xmtin/s</code> - Number of transmit interrupts per second for current serial line.</li>
<li><code>framerr/s</code> - Number of frame errors per second for current serial line.</li>
<li><code>prtyerr/s</code> - Number of parity errors per second for current serial line.</li>
<li><code>brk/s</code> - Number of breaks per second for current serial line.</li>
<li><code>ovrun/s</code> - Number of overrun errors per second for current serial line.</li>
</ul></li>
</ul>
</details>
<h2 id="pidstat">45. pidstat</h2>
<ul>
<li><p>Compat: Linux; Requires: sysstat.</p></li>
<li><p>monitor individual tasks currently being managed Requires: sysstat.</p></li>
</ul>
<p>Cheat Card - CPU by PID: <code>pidstat -u 1 -p &lt;pid&gt;</code> (watch <code>%usr/%system/%wait</code>) - IO by PID: <code>pidstat -d 1 -p &lt;pid&gt;</code> (check <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code>) - Memory faults: <code>pidstat -r 1 -p &lt;pid&gt;</code> (watch <code>majflt/s</code>) - Threads: <code>pidstat -t -u 1 -p &lt;pid&gt;</code></p>
<ul>
<li><p><code>pidstat -d</code>:</p>
<ul>
<li>Key fields: <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code> (IO wait), <code>kB_ccwr/s</code> (cancelled writes).</li>
</ul></li>
<li><p><code>pidstat -R</code>: Report realtime priority and scheduling policy information. The following values may be displayed:</p>
<ul>
<li>Key fields: <code>prio</code>, <code>policy</code>.</li>
</ul></li>
<li><p><code>pidstat -r</code>: Report page faults and memory utilization.</p>
<p>When reporting statistics for individual tasks, the following values may be displayed:</p>
<ul>
<li>Key fields: <code>majflt/s</code> (major faults), <code>RSS</code>, <code>%MEM</code>.</li>
</ul>
<p>When reporting global statistics for tasks and all their children, the following values may be displayed:</p>
<ul>
<li>With children: <code>majflt-nr</code>, <code>minflt-nr</code> summarize faults.</li>
</ul></li>
<li><p><code>pidstat -s</code>: Report stack utilization. The following values may be displayed:</p>
<ul>
<li>Key fields: <code>StkRef</code> (used), <code>StkSize</code> (reserved).</li>
</ul></li>
<li><p><code>pidstat -t</code>: Also display statistics for threads associated with selected tasks. List process and threads</p></li>
<li><p><code>pidstat -u</code>: Report CPU utilization.</p>
<p>When reporting statistics for individual tasks, the following values may be displayed:</p>
<ul>
<li>Key fields: <code>%usr</code>, <code>%system</code>, <code>%wait</code>, <code>%CPU</code>, <code>CPU</code>.</li>
</ul>
<p>When reporting global statistics for tasks and all their children, the following values may be displayed:</p>
<ul>
<li>With children: <code>usr-ms</code>, <code>system-ms</code>, <code>guest-ms</code> summarize CPU time.</li>
</ul></li>
</ul>
<h2 id="lsof">46. lsof</h2>
<ul>
<li>Compat: Linux; May require root to see all descriptors; Requires: lsof.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># List all open files</span><br><span class="line">lsof</span><br><span class="line"></span><br><span class="line"># Processes using a file? (fuser equivalent)</span><br><span class="line">lsof /path/to/file</span><br><span class="line"></span><br><span class="line"># Open files within a directory</span><br><span class="line">lsof +D /path</span><br><span class="line"></span><br><span class="line"># Files by user</span><br><span class="line">lsof -u name</span><br><span class="line">lsof -u name1,name2</span><br><span class="line">lsof -u name1 -u name2</span><br><span class="line"></span><br><span class="line"># By program name</span><br><span class="line">lsof -c apache</span><br><span class="line"></span><br><span class="line"># AND&#x27;ing selection conditions</span><br><span class="line">lsof -u www-data -c apache</span><br><span class="line"></span><br><span class="line"># By pid</span><br><span class="line">lsof -p 1</span><br><span class="line"></span><br><span class="line"># Except certain pids</span><br><span class="line">lsof -p ^1</span><br><span class="line"></span><br><span class="line"># TCP and UDP connections</span><br><span class="line">lsof -i</span><br><span class="line">lsof -i tcp # TCP connections</span><br><span class="line">lsof -i udp # UDP connections</span><br><span class="line"></span><br><span class="line"># By port</span><br><span class="line">lsof -i :25</span><br><span class="line">lsof -i :smtp</span><br><span class="line">lsof -i udp:53</span><br><span class="line">lsof -i tcp:80</span><br><span class="line"></span><br><span class="line"># All network activity by a user</span><br><span class="line">lsof -a -u name1 -i</span><br><span class="line"></span><br><span class="line">lsof -N # NFS use</span><br><span class="line">lsof -U # UNIX domain socket use</span><br><span class="line"></span><br><span class="line"># List PIDs</span><br><span class="line">lsof -t -i</span><br><span class="line"># Danger: broad kill; preview and scope carefully before use</span><br><span class="line">kill -9 $(lsof -t -i) # Kill all programs w/network activity</span><br></pre></td></tr></table></figure>
<p>Requires: lsof.</p>
<h2 id="pmap">51. pmap</h2>
<ul>
<li><p>Compat: Linux; Requires: procps; <code>-X</code> needs procps-ng.</p></li>
<li><p><code>pmap 29740 -X</code>: show Address,Perm,Offset,Device,Inode,Size,Rss,Pss,Referenced,Anonymous,LazyFree, ShmemPmdMapped,Shared_Hugetlb,Private_Hugetlb,Swap,SwapPss,Locked,THPeligible, Mapping Requires: procps.</p></li>
</ul>
<p>Common recipes - Largest mappings first: <code>pmap -x &lt;pid&gt; | sort -nrk 3 | head</code> (by RSS KB) - Totals summary: <code>pmap &lt;pid&gt;</code> (last line shows total)</p>
<h2 id="blktrace">52. blktrace</h2>
<ul>
<li><p>Compat: Linux; Root required; Needs kernel block trace support; Requires: blktrace.</p></li>
<li><p>blktrace is a block layer IO tracing mechanism which provides detailed information about request queue operations up to user space. There are three major components: a kernel component, a utility to record the i/o trace information for the kernel to user space, and utilities to analyse and view the trace information.</p></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Trace block I/O on /dev/sda and parse</span></span><br><span class="line"><span class="built_in">sudo</span> blktrace -d /dev/sda -o - | blkparse -i -</span><br></pre></td></tr></table></figure>
<p>Requires: blktrace.</p>
<p>outputs: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">CPU0 (8,0):</span><br><span class="line"> Reads Queued:         385,     1540KiB     Writes Queued:           0,        0KiB</span><br><span class="line"> Read Dispatches:       75,     1544KiB     Write Dispatches:        4,       16KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:          315,     1260KiB     Write Merges:            0,        0KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            63             Timer unplugs:           0</span><br><span class="line">CPU1 (8,0):</span><br><span class="line"> Reads Queued:         406,     1624KiB     Writes Queued:          13,      996KiB</span><br><span class="line"> Read Dispatches:       71,     1620KiB     Write Dispatches:       10,      992KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          336,     1344KiB     Write Merges:            2,      200KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            68             Timer unplugs:           0</span><br><span class="line">CPU2 (8,0):</span><br><span class="line"> Reads Queued:        1531,     6152KiB     Writes Queued:          30,      120KiB</span><br><span class="line"> Read Dispatches:      257,     6152KiB     Write Dispatches:        3,      108KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:         1277,     5108KiB     Write Merges:           24,       96KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           255             Timer unplugs:           0</span><br><span class="line">CPU3 (8,0):</span><br><span class="line"> Reads Queued:        1266,     5852KiB     Writes Queued:          23,       92KiB</span><br><span class="line"> Read Dispatches:      279,     5852KiB     Write Dispatches:       21,       92KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          987,     3948KiB     Write Merges:            2,        8KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           279             Timer unplugs:           1</span><br><span class="line"></span><br><span class="line">Total (8,0):</span><br><span class="line"> Reads Queued:        3588,    15168KiB     Writes Queued:          66,     1208KiB</span><br><span class="line"> Read Dispatches:      682,    15168KiB     Write Dispatches:       38,     1208KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:         2915,    11660KiB     Write Merges:           28,      304KiB</span><br><span class="line"> IO unplugs:           665             Timer unplugs:           1</span><br></pre></td></tr></table></figure></p>
<h2 id="btrace">53. btrace</h2>
<ul>
<li><p>Compat: Linux; Wrapper script from blktrace; Root required.</p></li>
<li><p>The btrace script provides a quick and easy way to do live tracing of block devices. It calls blktrace on the specified devices and pipes the output through blkparse for formatting. See blktrace (8) for more in-depth information about how blktrace works.</p></li>
<li><p><code>btrace /dev/sda</code> Requires: blktrace.</p></li>
</ul>
<h2 id="tr">54. tr</h2>
<ul>
<li>Compat: Linux; Requires: coreutils.</li>
</ul>
<p>Translate, squeeze, and/or delete characters from standard input, writing to standard output.</p>
<ul>
<li><code>tr '\n' ','</code>: convert new lines to commas</li>
<li>squeeze repeats: <code>tr -s ' ' &lt; file</code> (collapse runs of spaces)</li>
<li>delete chars: <code>tr -d '\r' &lt; file</code> (remove CR)</li>
<li>keep only printable: <code>tr -cd '[:print:]\n' &lt; file</code></li>
<li>case convert: <code>tr '[:upper:]' '[:lower:]' &lt; file</code></li>
</ul>
<h2 id="cut">55. cut</h2>
<ul>
<li><p>Compat: Linux; Requires: coreutils.</p></li>
<li><p>select CSV fields: <code>cut -d, -f1,3 file.csv</code></p></li>
<li><p>ranges: <code>cut -d: -f1-3 /etc/passwd</code></p></li>
<li><p>bytes/chars: <code>cut -b1-10 file</code>; <code>cut -c1-20 file</code></p></li>
<li><p>complement: <code>cut -d, -f1 --complement file.csv</code></p></li>
<li><p>with headers: pair with <code>head -1</code> to see column indexes ## 56. xargs</p></li>
<li><p>Compat: Linux; Requires: findutils; GNU <code>-r</code> may vary on BusyBox.</p></li>
</ul>
<p>Build and run argument lists; combine with <code>find</code> and null-terminated records for safety.</p>
<ul>
<li>safe null delim: <code>find . -type f -name '*.log' -print0 | xargs -0 rm -f</code></li>
<li>limit args per call: <code>xargs -n 1 -I{} sh -c 'echo {}'</code></li>
<li>parallelism: <code>xargs -P 4 -n 1 cmd</code> (run 4 at a time)</li>
<li>interactive confirm: <code>xargs -p rm</code> (ask before each batch)</li>
<li>do nothing on empty input: <code>xargs -r cmd</code> (GNU)</li>
</ul>
<h2 id="logs-systemd">Logs &amp; Systemd</h2>
<p>Cheat Card - Unit status: <code>systemctl status &lt;unit&gt;</code>; failed: <code>systemctl list-units --failed</code> - Hot errors: <code>journalctl -xeu &lt;unit&gt;</code>; follow: <code>journalctl -fu &lt;unit&gt;</code> - Boot scoping: <code>journalctl -b</code> and <code>-b -1</code>; size: <code>journalctl --disk-usage</code></p>
<p>Systemd basics <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Unit status and enablement</span></span><br><span class="line">systemctl status &lt;unit&gt;</span><br><span class="line">systemctl is-active &lt;unit&gt;</span><br><span class="line">systemctl is-enabled &lt;unit&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Failed units overview</span></span><br><span class="line">systemctl list-units --failed</span><br><span class="line">journalctl -xe  <span class="comment"># recent critical logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Restart and verify logs from this boot</span></span><br><span class="line">systemctl restart &lt;unit&gt;</span><br><span class="line">journalctl -u &lt;unit&gt; -b -n 50</span><br></pre></td></tr></table></figure></p>
<p>Journal essentials <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Recent errors for a unit and live follow</span></span><br><span class="line">journalctl -xeu &lt;unit&gt;</span><br><span class="line">journalctl -fu &lt;unit&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Time window and priority</span></span><br><span class="line">journalctl -u &lt;unit&gt; --since <span class="string">&quot;1 hour ago&quot;</span> --<span class="keyword">until</span> now</span><br><span class="line">journalctl -p err..alert -b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Previous boot</span></span><br><span class="line">journalctl -b -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON output piped to jq (Requires: jq)</span></span><br><span class="line">journalctl -u &lt;unit&gt; -o json | jq -r <span class="string">&#x27;.MESSAGE&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>Journal management <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Disk usage and vacuum</span></span><br><span class="line">journalctl --disk-usage</span><br><span class="line">journalctl --vacuum-size=1G</span><br><span class="line">journalctl --vacuum-time=7d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make logs persistent (requires root; edit journald.conf)</span></span><br><span class="line"><span class="comment"># /etc/systemd/journald.conf: set Storage=persistent</span></span><br><span class="line">systemctl restart systemd-journald</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tip: tune RateLimitIntervalSec/RateLimitBurst to manage log storms</span></span><br></pre></td></tr></table></figure></p>
<p>Resolved (DNS) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Overall resolver status</span></span><br><span class="line">resolvectl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># Query using systemd-resolved</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flush caches</span></span><br><span class="line">resolvectl flush-caches</span><br></pre></td></tr></table></figure></p>
<h2 id="security-audit">Security &amp; Audit</h2>
<p>Cheat Card - SELinux mode: <code>getenforce</code>; recent denials: <code>ausearch -m AVC -ts recent</code> - AppArmor status: <code>aa-status</code>; set complain/enforce on a profile - Audit rule example: <code>auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</code></p>
<p>SELinux <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Current mode and temporary permissive (diagnostic; requires root)</span></span><br><span class="line">getenforce</span><br><span class="line">setenforce 0  <span class="comment"># Caution: reduces enforcement</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Contexts and recent denials</span></span><br><span class="line"><span class="built_in">ls</span> -Z</span><br><span class="line">ps -eZ | <span class="built_in">head</span></span><br><span class="line">ausearch -m AVC -ts recent</span><br><span class="line">journalctl -t setroubleshoot</span><br><span class="line"></span><br><span class="line"><span class="comment"># Manage booleans (example: allow httpd network connect)</span></span><br><span class="line">getsebool -a | grep httpd</span><br><span class="line">setsebool -P httpd_can_network_connect on</span><br><span class="line"><span class="comment"># Requires: selinux-utils/policycoreutils; setroubleshoot (optional)</span></span><br></pre></td></tr></table></figure></p>
<p>AppArmor <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Status and service</span></span><br><span class="line">aa-status</span><br><span class="line">systemctl status apparmor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Toggle a profile mode</span></span><br><span class="line">aa-complain /path/to/bin</span><br><span class="line">aa-enforce /path/to/bin</span><br><span class="line"><span class="comment"># Requires: apparmor-utils</span></span><br></pre></td></tr></table></figure></p>
<p>Auditd <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Service and rules</span></span><br><span class="line">systemctl status auditd</span><br><span class="line">auditctl -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># Search recent denials / by PID</span></span><br><span class="line">ausearch -m avc -ts recent</span><br><span class="line">ausearch -p &lt;pid&gt; -ts recent</span><br><span class="line"></span><br><span class="line"><span class="comment"># Watch a file for writes/attr changes (key: sshcfg)</span></span><br><span class="line">auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># Summary report</span></span><br><span class="line">aureport --summary -ts today</span><br><span class="line"><span class="comment"># Requires: auditd (auditd, auditctl, ausearch, aureport)</span></span><br></pre></td></tr></table></figure></p>
<h2 id="containers-namespaces">Containers &amp; Namespaces</h2>
<p>Cheat Card - Enter container namespace: <code>nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</code> - Docker triage: <code>docker ps</code>, <code>docker logs --tail=200 -f &lt;id&gt;</code>, <code>docker exec -it &lt;id&gt; sh</code> - K8s triage: <code>kubectl get pods -A</code>, <code>kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</code>, <code>kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</code></p>
<p>nsenter (enter namespaces of a PID) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get target PID (e.g., container process)</span></span><br><span class="line">pidof &lt;proc&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Enter multiple namespaces of a PID</span></span><br><span class="line">nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inspect and chroot-like into the process rootfs</span></span><br><span class="line"><span class="built_in">ls</span> -l /proc/&lt;pid&gt;/root</span><br><span class="line">nsenter --target &lt;pid&gt; --mount -- <span class="built_in">chroot</span> /proc/&lt;pid&gt;/root bash</span><br></pre></td></tr></table></figure></p>
<p>Docker (if present) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># List, exec, inspect PID, and tail logs</span></span><br><span class="line">docker ps --format <span class="string">&#x27;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125; &#123;&#123;.Status&#125;&#125;&#x27;</span></span><br><span class="line">docker <span class="built_in">exec</span> -it &lt;<span class="built_in">id</span>|name&gt; bash  <span class="comment"># or sh</span></span><br><span class="line">docker inspect -f <span class="string">&#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27;</span> &lt;<span class="built_in">id</span>&gt;</span><br><span class="line">docker logs --<span class="built_in">tail</span>=200 -f &lt;<span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>Kubernetes (if present) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pods and events</span></span><br><span class="line">kubectl get pods -A -o wide</span><br><span class="line">kubectl get events -A --sort-by=.lastTimestamp | <span class="built_in">tail</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Describe, logs, and exec</span></span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --<span class="built_in">tail</span>=200</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod&gt; -n &lt;ns&gt; -- bash</span><br></pre></td></tr></table></figure></p>
<p>CRI/containerd (if present) <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># List, inspect, and logs via crictl</span></span><br><span class="line">crictl ps -a</span><br><span class="line">crictl inspect &lt;<span class="built_in">id</span>&gt;</span><br><span class="line">crictl logs &lt;<span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>Notes - Without runtime CLIs, use <code>nsenter</code> by PID from <code>ps</code>/<code>systemctl</code>. - Requires: docker or podman for Docker-like commands; kubectl; crictl for containerd/CRI.</p>
<h2 id="incident-playbooks">Incident Playbooks</h2>
<p>High CPU <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Top CPU processes and hot threads</span></span><br><span class="line">ps -eo pid,ppid,user,%cpu,%mem,cmd --<span class="built_in">sort</span>=-%cpu | <span class="built_in">head</span></span><br><span class="line">top -H</span><br><span class="line">ps -Lp &lt;pid&gt; -o pid,tid,pcpu,<span class="built_in">comm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Per-process CPU over time; optional perf if available</span></span><br><span class="line">pidstat -u 1 -p &lt;pid&gt;</span><br><span class="line">perf top  <span class="comment"># if installed</span></span><br></pre></td></tr></table></figure></p>
<p>High IO wait / Disk latency <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Device saturation and per-process IO</span></span><br><span class="line">iostat -xz 1   <span class="comment"># watch await, %util, r/s, w/s</span></span><br><span class="line">pidstat -d 1</span><br><span class="line">iotop -oPa</span><br><span class="line"></span><br><span class="line"><span class="comment"># Device/FS inventory and kernel errors</span></span><br><span class="line">lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</span><br><span class="line">dmesg -T | egrep -i <span class="string">&#x27;error|reset|blk|nvme&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional deep dive</span></span><br><span class="line">blktrace -d /dev/sdX -o - | blkparse -i -</span><br></pre></td></tr></table></figure></p>
<p>Memory leak / OOM <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Snapshot and top RSS processes</span></span><br><span class="line">free -h</span><br><span class="line">ps aux --<span class="built_in">sort</span>=-rss | <span class="built_in">head</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Per-process mappings and over-time faults</span></span><br><span class="line">pmap -x &lt;pid&gt; | <span class="built_in">sort</span> -nrk 3 | <span class="built_in">head</span></span><br><span class="line">pidstat -r 1 -p &lt;pid&gt;</span><br><span class="line">smem -r  <span class="comment"># if installed</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OOM evidence</span></span><br><span class="line">dmesg -T | grep -i oom || journalctl -k -g OOM</span><br></pre></td></tr></table></figure></p>
<p>Packet loss / High latency <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Path and end-to-end latency</span></span><br><span class="line">ip route get &lt;dest&gt;</span><br><span class="line">mtr -ezbw &lt;dest&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Interface health and TCP details</span></span><br><span class="line">ip -s <span class="built_in">link</span> show &lt;iface&gt;</span><br><span class="line">ethtool -S &lt;iface&gt;</span><br><span class="line">ss -i dst &lt;dest&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Targeted capture samples</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; host &lt;dest&gt; and icmp</span><br><span class="line">tcpdump -ni &lt;iface&gt; tcp port 443 and <span class="string">&#x27;tcp[tcpflags] &amp; tcp-syn != 0&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>DNS failures <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Resolve via systemd-resolved (or dig if available)</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line">resolvectl status</span><br><span class="line">dig @8.8.8.8 example.com A +<span class="keyword">time</span>=2 +tries=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Reachability and captures</span></span><br><span class="line">ss -u <span class="string">&#x27;sport = :53 or dport = :53&#x27;</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; port 53</span><br><span class="line"></span><br><span class="line"><span class="comment"># Config checks</span></span><br><span class="line"><span class="built_in">ls</span> -l /etc/resolv.conf</span><br><span class="line">resolvectl flush-caches</span><br><span class="line"><span class="comment"># Check firewall rules as appropriate</span></span><br></pre></td></tr></table></figure></p>
<p>TLS handshake issues <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inspect handshake/cert chain (TLS1.2 example)</span></span><br><span class="line">openssl s_client -connect host:443 -servername host -tls1_2 -showcerts</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check expiry/subject/issuer quickly</span></span><br><span class="line"><span class="built_in">echo</span> | openssl s_client -connect host:443 -servername host 2&gt;/dev/null \</span><br><span class="line">  | openssl x509 -noout -dates -subject -issuer</span><br><span class="line"></span><br><span class="line"><span class="comment"># App behavior (SNI, ALPN, protocols)</span></span><br><span class="line">curl -v https://host/</span><br><span class="line"></span><br><span class="line"><span class="comment"># If proxy/MTLS: verify CA path and client certs; check time skew</span></span><br><span class="line">timedatectl</span><br></pre></td></tr></table></figure></p>
<p>Disk full / Inode exhaustion <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Space vs inodes</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br><span class="line"><span class="built_in">df</span> -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># Find biggest dirs on same filesystem</span></span><br><span class="line"><span class="built_in">du</span> -xhd1 /path | <span class="built_in">sort</span> -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deleted-but-open files</span></span><br><span class="line">lsof +L1</span><br><span class="line">journalctl --vacuum-size=1G  <span class="comment"># cull journal size</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Many small files</span></span><br><span class="line">find /path -xdev -<span class="built_in">type</span> f | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure></p>
<p>Syscall slowness <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Trace syscalls and timings</span></span><br><span class="line">strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional CPU hotspot profiling</span></span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br></pre></td></tr></table></figure></p>
<p>Container restart loops <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker restart loops</span></span><br><span class="line">docker ps --filter <span class="string">&#x27;status=restarting&#x27;</span></span><br><span class="line">docker logs &lt;<span class="built_in">id</span>&gt; --<span class="built_in">tail</span>=200</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kubernetes restart loops</span></span><br><span class="line">kubectl get pods -A</span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line"></span><br><span class="line"><span class="comment"># Node/agent issues</span></span><br><span class="line">journalctl -u kubelet</span><br></pre></td></tr></table></figure></p>
<ul>
<li>modify priority of running process</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/09/xv6%E5%AD%A6%E4%B9%A0/%E5%A2%9E%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/09/xv6%E5%AD%A6%E4%B9%A0/%E5%A2%9E%E5%8A%A0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/" class="post-title-link" itemprop="url">xv6-增加系统调用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-09T00:00:00+00:00">2025-12-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="panic">panic</h1>
<p>以下代码报错 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lapicid 2: panic: mycpu called with interrupts enabled</span><br><span class="line">80103937 8010394f 80104a7d 80105b51 8010589e 0 0 0 0 0</span><br></pre></td></tr></table></figure></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> </span><br><span class="line">	<span class="title function_">getcpuid</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> cpuid();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>原因：<code>mycpu()</code>要求在关闭中断时调用（函数开头检查 IF），而某处（这里是 scheduler 开头）在中断允许的情况下调用了它，导致 panic。</li>
<li>修复：在调用 <code>mycpu()</code>前禁用中断<code>（pushcli）</code>，调用后恢复<code>（popcli）</code>。把 scheduler 开头修改如下。</li>
<li>说明：这样能保证在读取/比较本 CPU 的 <code>LAPIC id</code> 时不会被中断重入。若还有其它在未禁中断情况下直接调用 <code>mycpu()</code> 的地方，也请同样处理或确保调用者已禁中断。 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> </span><br><span class="line"><span class="title function_">getcpuid</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  pushcli();</span><br><span class="line">  <span class="type">int</span> id = cpuid();</span><br><span class="line">  popcli();</span><br><span class="line">  <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/04/11/audit%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/audit%E5%AE%A1%E8%AE%A1%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">audit审计工具使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-11 00:00:00" itemprop="dateCreated datePublished" datetime="2024-04-11T00:00:00+00:00">2024-04-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="audit用途">audit用途</h2>
<p>监控文件、命令、网络等，生成监控报告。</p>
<h2 id="安装启动audit">安装启动audit</h2>
<p>安装audit工具 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install audit</span><br></pre></td></tr></table></figure> 配置了 <code>auditd</code> 后，启动服务以收集 审计信息，并将它存储在日志文件中。以 root 用户身份运行以下命令来启动 <code>auditd</code> ：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service auditd start</span><br></pre></td></tr></table></figure>
<p>将 <code>auditd</code> 配置为在引导时启动：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable auditd</span><br></pre></td></tr></table></figure>
<p>可以使用 <code># auditctl -e 0</code> 命令临时禁用 <code>auditd</code>，并使用 <code># auditctl -e 1</code> 重新启用它。</p>
<p>可以使用 <code>service auditd _&lt;action&gt;_</code> 命令对 <code>auditd</code> 执行其他操作，其中 <code>_&lt;action&gt;_</code>可以是以下之一：</p>
<p><code>stop</code> ：停止 <code>auditd</code>。</p>
<p><code>restart</code>：重新启动 <code>auditd</code>。</p>
<p><code>reload</code> 或 <code>force-reload</code>：重新加载 <code>/etc/audit/auditd.conf</code> 文件中 <code>auditd</code> 的配置。</p>
<p><code>rotate</code>：轮转 <code>/var/log/audit/</code> 目录中的日志文件。</p>
<p><code>resume</code>：在其之前被暂停后重新恢复审计事件记录，例如，当保存审计日志文件的磁盘分区中没有足够的可用空间时。</p>
<p><code>condrestart</code> 或 <code>try-restart</code>：只有当 <code>auditd</code> 运行时才重新启动它。</p>
<p><code>status</code>：显示 <code>auditd</code> 的运行状态。</p>
<h2 id="配置规则">配置规则</h2>
<p>举例说明，监控<code>/home/test_audit/</code>文件夹（文件）的变更选项为rwxa（<strong>r</strong>=read, <strong>w</strong>=write, <strong>x</strong>=execute, <strong>a</strong>=attribute），设置关键字<code>dushnda_watch</code> <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auditctl -w /home/test_audit/ -p rwxa -k dushnda_watch</span><br></pre></td></tr></table></figure> 配置完后查询规则 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@172 ~]# auditctl -l</span><br><span class="line">-w /home/test_audit -p rwxa -k dushnda_watch</span><br></pre></td></tr></table></figure> 之后做一些权限改变，增改文件操，查看日志<code>ausearch</code>，查看报告<code>areport</code> <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ausearch -i -k dushnda_watch</span><br></pre></td></tr></table></figure></p>
<p><img src="audit审计工具使用_20240411_3.png" /></p>
<p>这里的每个type是一个一次的一条记录，具体的含义查看参考链接<code>[1]</code>，这里主要关注对文件的操作，这段日志含义是使用vim打开了文件（syscall），当前文件权限是644。</p>
<p><img src="audit审计工具使用_20240411_1.png" /></p>
<p>删除路径监控 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auditctl -W /home/test_audit -p rwxa -k dushnda_watch</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>其中，<code>auditctl -d</code>的删除和<code>auditctl -a</code>的添加对应，<code>auditctl -W</code>的删除和<code>auditctl -w</code>的添加对应，<code>auditctl -D</code>删除所有规则。</p>
</blockquote>
<h2 id="参考链接">参考链接</h2>
<p>[1] https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/8/html/security_hardening/auditing-the-system_security-hardening#linux-audit_auditing-the-system</p>
<p>[2] https://deepinout.com/linux-cmd/linux-audit-system-related-cmd/linux-cmd-auditctl.html</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/03/19/qemu%E8%B0%83%E8%AF%95linux/qemu%E8%B0%83%E8%AF%95linux%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/19/qemu%E8%B0%83%E8%AF%95linux/qemu%E8%B0%83%E8%AF%95linux%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">qemu调试linux（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-19 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-19T00:00:00+00:00">2024-03-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="gdb调试">GDB调试</h2>
<p>当前文件夹目录 <img src="qemu调试linux（二）_20240319_1.png" /> Makefile文件 <figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">cpvmlinux:  </span></span><br><span class="line">cp /home/dsd/Code/linux-5.18.10/vmlinux vmlinux  </span><br><span class="line">  </span><br><span class="line"><span class="section">cpimage:  </span></span><br><span class="line">cp /home/dsd/Code/linux-5.18.10/arch/x86/boot/bzImage ./bzImage  </span><br><span class="line">  </span><br><span class="line"><span class="section">initramfs:  </span></span><br><span class="line">cd ./initramfs_dir &amp;&amp; find . -print0 | cpio -ov --null --format=newc | gzip -9 &gt; ../initramfs.img  </span><br><span class="line">  </span><br><span class="line"><span class="section">run:  </span></span><br><span class="line">qemu-system-x86_64 \  </span><br><span class="line">-kernel bzImage \  </span><br><span class="line">-initrd initramfs.img \  </span><br><span class="line">-m 1G \  </span><br><span class="line">-nographic \  </span><br><span class="line">-append <span class="string">&quot;earlyprintk=serial,ttyS0 console=ttyS0&quot;</span>  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="section">debug:  </span></span><br><span class="line">qemu-system-x86_64 \  </span><br><span class="line">-kernel bzImage \  </span><br><span class="line">-initrd initramfs.img \  </span><br><span class="line">-m 1G \  </span><br><span class="line">-nographic \  </span><br><span class="line">-append <span class="string">&quot;earlyprintk=serial,ttyS0 console=ttyS0 nokaslr&quot;</span> \  </span><br><span class="line">-S \  </span><br><span class="line">-gdb tcp::9000</span><br></pre></td></tr></table></figure> 此目录下新建<code>.gdbinit</code>文件 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">target remote :9000  </span><br><span class="line">break start_kernel  </span><br><span class="line">continue  </span><br><span class="line">step</span><br></pre></td></tr></table></figure> 在<code>root/.gdbinit</code>文件增加<code>add-auto-load-safe-path /home/dsd/Code/qemu_linux_x86_5.18_space/.gdbinit</code> <img src="qemu调试linux（二）_20240319_2.png" /> 运行指令，任选一条 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb vmlinux</span><br><span class="line">gdb-multiarch vmlinux --tui</span><br></pre></td></tr></table></figure> <img src="qemu调试linux（二）_20240319_3.png" /></p>
<h2 id="vscode调试">vscode调试</h2>
<p>wsl权限问题，目录往外多一些 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown 755 &lt;usr&gt; *</span><br></pre></td></tr></table></figure> 生成编译指令信息，此时linux源码根目录下增加文件<code>compile_commands.json</code> <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./scripts/clang-tools/gen_compile_commands.py</span><br></pre></td></tr></table></figure> 配置<code>.vscode/lanuch.json</code> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qemu-kernel-gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerServerAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;127.0.0.1:9000&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceRoot&#125;/vmlinux&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;fileDirname&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure> 配置<code>.vscode/c_cpp_properties.json</code> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Linux&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;includePath&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;$&#123;workspaceFolder&#125;/**&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;defines&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compilerPath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/usr/bin/gcc&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c11&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cppStandard&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gnu++14&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;intelliSenseMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;linux-gcc-x64&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;compileCommands&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/compile_commands.json&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure> 开始调试 <img src="qemu调试linux（二）_20240319_4.png" /></p>
<h3 id="附调试qemu虚拟机模板">附：调试qemu虚拟机模板</h3>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 使用 IntelliSense 了解相关属性。 </span></span><br><span class="line">    <span class="comment">// 悬停以查看现有属性的描述。</span></span><br><span class="line">    <span class="comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;debug.elf&quot;</span><span class="punctuation">,</span><span class="comment">//vmlinux路径，debug的文件 &lt;--修改这里</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//启动参数,如果需要记录日志可以自己增加参数。因为gdbsever已经有了参数，这里可以不用设置</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="comment">//会自动停在main,不需要则设置为false</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceRoot&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span> <span class="comment">//运行模式</span></span><br><span class="line">            <span class="attr">&quot;logging&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;moduleLoad&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;engineLogging&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;trace&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">//命令</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;set architecture aarch64&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;set architecture aarch64&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerPath&quot;</span><span class="punctuation">:</span><span class="string">&quot;gdb-multiarch&quot;</span><span class="punctuation">,</span><span class="comment">//工具链gdb，arm下要使用多分支</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerServerAddress&quot;</span><span class="punctuation">:</span><span class="string">&quot;localhost:1234&quot;</span><span class="comment">//远程端口</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/01/24/qemu%E8%B0%83%E8%AF%95linux/qemu%E8%B0%83%E8%AF%95linux%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/24/qemu%E8%B0%83%E8%AF%95linux/qemu%E8%B0%83%E8%AF%95linux%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">qemu调试linux（一）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-24 00:00:00" itemprop="dateCreated datePublished" datetime="2024-01-24T00:00:00+00:00">2024-01-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="编译内核">编译内核</h2>
<h3 id="下载">下载</h3>
<p>kernel：https://mirrors.edge.kernel.org/pub/linux/kernel/</p>
<p>镜像：https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/</p>
<h3 id="编译">编译</h3>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@dushenda:/home/dsd/Code/linux-5.18.10# make menuconfig</span><br><span class="line">root@dushenda:/home/dsd/Code/linux-5.18.10# make -j`nproc`</span><br></pre></td></tr></table></figure>
<p><img src="qemu调试linux（一）_20240124_1.png" /> 编译完成得到 <img src="qemu调试linux（一）_20240124_2.png" /></p>
<h2 id="制作initramfs">制作initramfs</h2>
<h3 id="使用busybox">使用busybox</h3>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@dushenda:/home/dsd/Code/busybox-1.36.1# make menuconfig</span><br><span class="line">root@dushenda:/home/dsd/Code/busybox-1.36.1# make -j`nproc`</span><br><span class="line">root@dushenda:/home/dsd/Code/busybox-1.36.1# make install</span><br></pre></td></tr></table></figure>
<p><img src="qemu调试linux（一）_20240124_3.png" /> 编译完成得到 <img src="qemu调试linux（一）_20240124_4.png" /> <img src="qemu调试linux（一）_20240124_5.png" /> 制作initramfs.img，首先构造如下的目录结构 <img src="qemu调试linux（一）_20240124_6.png" /> init文件内容如下： <img src="qemu调试linux（一）_20240124_10.png" /> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@dushenda:/home/dsd/Code/initramfs_dir# find . -print0 | cpio -ov --null --format=newc | gzip -9 &gt; ../initramfs.img</span><br></pre></td></tr></table></figure> 最后生成文件 <img src="qemu调试linux（一）_20240124_7.png" /> qemu运行新内核 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@dushenda:/home/dsd/Code/initramfs_dir# qemu-system-x86_64 \  </span><br><span class="line">											-kernel bzImage \  </span><br><span class="line">											-initrd initramfs.img \  </span><br><span class="line">											-m 1G \  </span><br><span class="line">											-nographic \  </span><br><span class="line">											-append &quot;earlyprintk=serial,ttyS0 console=ttyS0&quot;</span><br></pre></td></tr></table></figure> 运行结果如下 <img src="qemu调试linux（一）_20240124_9.png" /> <img src="qemu调试linux（一）_20240124_8.png" /></p>
<h2 id="注意">注意</h2>
<p><code>init</code>需要设置为可执行权限</p>
<p>qemu退出快捷键ctrl+a按下后释放，再按x</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/01/22/bcc%E5%88%9D%E4%BD%93%E9%AA%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/22/bcc%E5%88%9D%E4%BD%93%E9%AA%8C/" class="post-title-link" itemprop="url">bcc初体验</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-22 00:00:00" itemprop="dateCreated datePublished" datetime="2024-01-22T00:00:00+00:00">2024-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装">安装</h2>
<h3 id="ubuntu">Ubuntu</h3>
<p>BCC已经打包到Ubuntu的multiverse仓库，名字<code>bpfcc-tools</code>，使用如下命令安装 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install build-essential bpfcc-tools linux-header-$(uname -r) bpftrace</span><br></pre></td></tr></table></figure></p>
<h2 id="使用">使用</h2>
<p>funccount</p>
<p>stackcount</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/01/22/Ubuntu%E4%B8%8BEDK2%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Ubuntu%E4%B8%8BEDK2%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/22/Ubuntu%E4%B8%8BEDK2%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/Ubuntu%E4%B8%8BEDK2%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">Ubuntu下EDK2开发环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-22 00:00:00" itemprop="dateCreated datePublished" datetime="2024-01-22T00:00:00+00:00">2024-01-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="背景介绍">背景介绍</h2>
<p>编译edk2代码，配置开发环境，服务器使用华为云耀云服务器，OS信息如下 <img src="Ubuntu下EDK2开发环境搭建_20240122_1.png" /></p>
<p>特点</p>
<ul>
<li>apt-get源可以访问</li>
<li>github不能访问</li>
<li>gitee可以访问</li>
</ul>
<h2 id="远程仓库迁移">远程仓库迁移</h2>
<p>因为编译需要clone相关仓库到指定路径，并且为了今后的同步方便，所以把github仓库迁移到gitee后再配置相关环境。配置流程如下</p>
<ol type="1">
<li><p>建立组织，用来合并仓库环境</p>
<p><img src="Ubuntu下EDK2开发环境搭建_20240122_2.png" /></p></li>
<li><p>迁移主仓库</p>
<p><img src="Ubuntu下EDK2开发环境搭建_20240122_3.png" /></p></li>
<li><p>导入submodule，因为edk2后续编译还需要一些子模块，找到如下仓库的路径，按照2导入到组织</p>
<p><img src="Ubuntu下EDK2开发环境搭建_20240122_4.png" /></p></li>
<li><p>修改主仓库的submodule路径</p>
<p><img src="Ubuntu下EDK2开发环境搭建_20240122_5.png" /></p></li>
</ol>
<h2 id="下载">下载</h2>
<p>下载edk2代码仓 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@gitee.com:edk2_back/edk2.git</span><br></pre></td></tr></table></figure> 下载子模块到对应路径，可以看到地址都替换了gitee路径 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init</span><br></pre></td></tr></table></figure> <img src="Ubuntu下EDK2开发环境搭建_20240122_6.png" /></p>
<h2 id="编译工具链安装">编译工具链安装</h2>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># apt-get install build-essential uuid-dev iasl git gcc nasm python3</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># python3 --version</span></span></span><br><span class="line">Python 3.10.12</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># ln -s /usr/bin/python3.10 /usr/bin/python</span></span></span><br></pre></td></tr></table></figure>
<h2 id="编译">编译</h2>
<h3 id="基本工具">基本工具</h3>
<p>看一下当前的目录结构，使用<code>make -C BaseTools</code>编译基本工具 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># ls</span></span></span><br><span class="line">ArmPkg           CryptoPkg         FatPkg               Maintainers.txt  pip-requirements.txt  SignedCapsulePkg</span><br><span class="line">ArmPlatformPkg   DynamicTablesPkg  FmpDevicePkg         MdeModulePkg     PrmPkg                SourceLevelDebugPkg</span><br><span class="line">ArmVirtPkg       edksetup.bat      IntelFsp2Pkg         MdePkg           ReadMe.rst            StandaloneMmPkg</span><br><span class="line">BaseTools        edksetup.sh       IntelFsp2WrapperPkg  NetworkPkg       RedfishPkg            UefiCpuPkg</span><br><span class="line">Conf             EmbeddedPkg       License-History.txt  OvmfPkg          SecurityPkg           UefiPayloadPkg</span><br><span class="line">CONTRIBUTING.md  EmulatorPkg       License.txt          PcAtChipsetPkg   ShellPkg              UnitTestFrameworkPkg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># make -C BaseTools</span></span></span><br></pre></td></tr></table></figure> 编译基本工具完成 <img src="Ubuntu下EDK2开发环境搭建_20240122_7.png" /></p>
<h3 id="编译目标文件">编译目标文件</h3>
<p>设置环境变量，<code>path/to/edk/BaseTools</code>需要换成当前的<code>BaseTools</code>所在路径。 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># export EDK_TOOLS_PATH=`path/to/edk/BaseTools`</span></span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># ./edksetup.sh --help</span></span></span><br><span class="line">Usage: edksetup.sh [Options]</span><br><span class="line"></span><br><span class="line">The system environment variable, WORKSPACE, is always set to the current</span><br><span class="line">working directory.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --help, -h, -?        Print this help screen and exit.</span><br><span class="line"></span><br><span class="line">  --reconfig            Overwrite the WORKSPACE/Conf/*.txt files with the</span><br><span class="line">                        template files from the BaseTools/Conf directory.</span><br><span class="line"></span><br><span class="line">Please note: This script must be &#x27;sourced&#x27; so the environment can be changed.</span><br><span class="line">. edksetup.sh</span><br><span class="line">source edksetup.sh</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># source edksetup.sh BaseTools</span></span></span><br></pre></td></tr></table></figure> <img src="Ubuntu下EDK2开发环境搭建_20240122_8.png" /> 在<code>edk</code>目录下使用<code>build</code>命令编译 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash"><span class="comment"># build</span></span></span><br></pre></td></tr></table></figure> <img src="Ubuntu下EDK2开发环境搭建_20240122_9.png" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2024/01/21/%E5%88%A4%E6%96%AD%E7%A3%81%E7%9B%98%E6%98%AFssd%E8%BF%98%E6%98%AFhdd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/21/%E5%88%A4%E6%96%AD%E7%A3%81%E7%9B%98%E6%98%AFssd%E8%BF%98%E6%98%AFhdd/" class="post-title-link" itemprop="url">判断磁盘是ssd还是hdd</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-21 00:00:00" itemprop="dateCreated datePublished" datetime="2024-01-21T00:00:00+00:00">2024-01-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="linux">Linux</h2>
<h3 id="通过文件系统">通过文件系统</h3>
<p><code>rotational</code>为1代表可以旋转，为hdd，为0代表不能旋转，为ssd</p>
<p>查看位置在<code>/sys/block/sd*/queue/rotational</code> <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@dushenda home]# grep ^ /sys/block/sd*/queue/rotational  </span><br><span class="line">/sys/block/sda/queue/rotational:1  </span><br><span class="line">/sys/block/sdb/queue/rotational:1  </span><br><span class="line">/sys/block/sdc/queue/rotational:1</span><br></pre></td></tr></table></figure></p>
<h3 id="lsblk">lsblk</h3>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@dushenda home]# lsblk -o name,rota,VENDOR  </span><br><span class="line">NAME ROTA VENDOR  </span><br><span class="line">sda 1 Msft  </span><br><span class="line">sdb 1 Msft  </span><br><span class="line">sdc 1 Msft</span><br></pre></td></tr></table></figure>
<p><code>lsblk</code>可选行信息如下等，通过<code>lsblk --help</code>查看 <img src="判断磁盘是ssd还是hdd_20240121.png" /></p>
<h3 id="smartctl">smartctl</h3>
<p>该工具需要自行安装Ubuntu和CentOS安装包名称均为<code>smartmontools</code>。 <figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@dushenda home]# smartctl -a /dev/sdc  </span><br><span class="line">smartctl 7.1 2019-12-30 r5022 [x86_64-linux-5.15.133.1-microsoft-standard-WSL2] (local build)  </span><br><span class="line">Copyright (C) 2002-19, Bruce Allen, Christian Franke, www.smartmontools.org  </span><br><span class="line">  </span><br><span class="line">=== START OF INFORMATION SECTION ===  </span><br><span class="line">Vendor: Msft  </span><br><span class="line">Product: Virtual Disk  </span><br><span class="line">Revision: 1.0  </span><br><span class="line">Compliance: SPC-3  </span><br><span class="line">User Capacity: 1,099,511,627,776 bytes [1.09 TB]  </span><br><span class="line">Logical block size: 512 bytes  </span><br><span class="line">Physical block size: 4096 bytes  </span><br><span class="line">LU is thin provisioned, LBPRZ=0</span><br></pre></td></tr></table></figure></p>
<h2 id="windows">Windows</h2>
<h3 id="powershell">powershell</h3>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(base) PS C:\Users\dushenda&gt; Get-PhysicalDisk</span><br><span class="line"></span><br><span class="line">Number FriendlyName                  SerialNumber    MediaType CanPool OperationalStatus HealthStatus Usage            Size</span><br><span class="line">------ ------------                  ------------    --------- ------- ----------------- ------------ -----            ----</span><br><span class="line">1      Samsung SSD 860 EVO M.2 500GB S414NB0K722943N SSD       False   OK                Healthy      Auto-Select 465.76 GB</span><br><span class="line">0      WDC WD10SPCX-24HWST1          WD-WXB1AC41L2P1 HDD       False   OK                Healthy      Auto-Select 931.51 GB</span><br></pre></td></tr></table></figure>
<h3 id="gui">GUI</h3>
<p>在任务管理器下查看 <img src="判断磁盘是ssd还是hdd_20240121_1.png" /></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dushenda</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dushenda" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
