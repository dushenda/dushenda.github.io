<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"dushenda.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-tomorrow"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:type" content="website">
<meta property="og:title" content="dushenda">
<meta property="og:url" content="https://dushenda.github.io/index.html">
<meta property="og:site_name" content="dushenda">
<meta property="og:description" content="雄关漫道真如铁，而今迈步从头越">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="dushenda">
<meta property="article:tag" content="代码、科研、计算机系统">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dushenda.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>dushenda</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/bookmark.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","per_page":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">dushenda</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">李德胜大大粉丝</p>
      <img class="custom-logo-image" src="/uploads/icons8-star-trek-80.svg" alt="dushenda">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dushenda"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">dushenda</p>
  <div class="site-description" itemprop="description">雄关漫道真如铁，而今迈步从头越</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dushenda" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-github-alt fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/dushenda" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;dushenda" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/en" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/21/shells/%E5%B8%B8%E7%94%A8shell%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/21/shells/%E5%B8%B8%E7%94%A8shell%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">常用shell命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-21 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-21T00:00:00+00:00">2025-12-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Bash快捷键"><a href="#Bash快捷键" class="headerlink" title="Bash快捷键"></a>Bash快捷键</h1><p><img src="/moving_cli.png"></p>
<h2 id="Moving"><a href="#Moving" class="headerlink" title="Moving"></a>Moving</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + a</td>
<td>Goto BEGINNING of command line</td>
</tr>
<tr>
<td>ctrl + e</td>
<td>Goto END of command line</td>
</tr>
<tr>
<td>ctrl + b</td>
<td>move back one character</td>
</tr>
<tr>
<td>ctrl + f</td>
<td>move forward one character</td>
</tr>
<tr>
<td>alt + f</td>
<td>move cursor FORWARD one word</td>
</tr>
<tr>
<td>alt + b</td>
<td>move cursor BACK one word</td>
</tr>
<tr>
<td>ctrl + xx</td>
<td>Toggle between the start of line and current cursor position</td>
</tr>
<tr>
<td>ctrl + ] + x</td>
<td>Where x is any character, moves the cursor forward to the next occurance of x</td>
</tr>
<tr>
<td>alt + ctrl + ] + x</td>
<td>Where x is any character, moves the cursor backwards to the previous occurance of x</td>
</tr>
</tbody></table>
<h2 id="Edit-Other"><a href="#Edit-Other" class="headerlink" title="Edit &#x2F; Other"></a>Edit &#x2F; Other</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + d</td>
<td>Delete the character under the cursor</td>
</tr>
<tr>
<td>ctrl + h</td>
<td>Delete the previous character before cursor</td>
</tr>
<tr>
<td>ctrl + u</td>
<td>Clear all &#x2F; cut BEFORE cursor</td>
</tr>
<tr>
<td>ctrl + k</td>
<td>Clear all &#x2F; cut AFTER cursor</td>
</tr>
<tr>
<td>ctrl + w</td>
<td>delete the word BEFORE the cursor</td>
</tr>
<tr>
<td>alt + d</td>
<td>delete the word FROM the cursor</td>
</tr>
<tr>
<td>ctrl + y</td>
<td>paste (if you used a previous command to delete)</td>
</tr>
<tr>
<td>ctrl + i</td>
<td>command completion like Tab</td>
</tr>
<tr>
<td>ctrl + l</td>
<td>Clear the screen (same as clear command)</td>
</tr>
<tr>
<td>ctrl + c</td>
<td>kill whatever is running</td>
</tr>
<tr>
<td>ctrl + d</td>
<td>Exit shell (same as exit command when cursor line is empty)</td>
</tr>
<tr>
<td>ctrl + z</td>
<td>Place current process in background</td>
</tr>
<tr>
<td>ctrl + _</td>
<td>Undo</td>
</tr>
<tr>
<td>ctrl + x ctrl + u</td>
<td>Undo the last changes. ctrl+ _ does the same</td>
</tr>
<tr>
<td>ctrl + t</td>
<td>Swap the last two characters before the cursor</td>
</tr>
<tr>
<td>esc + t</td>
<td>Swap last two words before the cursor</td>
</tr>
<tr>
<td>alt + t</td>
<td>swap current word with previous</td>
</tr>
<tr>
<td>esc + .</td>
<td></td>
</tr>
<tr>
<td>esc + _</td>
<td></td>
</tr>
<tr>
<td>alt + [Backspace]</td>
<td>delete PREVIOUS word</td>
</tr>
<tr>
<td>alt + &lt;</td>
<td>Move to the first line in the history</td>
</tr>
<tr>
<td>alt + &gt;</td>
<td>Move to the end of the input history, i.e., the line currently being entered</td>
</tr>
<tr>
<td>alt + ?</td>
<td>display the file&#x2F;folder names in the current path as help</td>
</tr>
<tr>
<td>alt + *</td>
<td>print all the file&#x2F;folder names in the current path as parameter</td>
</tr>
<tr>
<td>alt + .</td>
<td>print the LAST ARGUMENT (ie “vim file1.txt file2.txt” will yield “file2.txt”)</td>
</tr>
<tr>
<td>alt + c</td>
<td>capitalize the first character to end of word starting at cursor (whole word if cursor is at the beginning of word)</td>
</tr>
<tr>
<td>alt + u</td>
<td>make uppercase from cursor to end of word</td>
</tr>
<tr>
<td>alt + l</td>
<td>make lowercase from cursor to end of word</td>
</tr>
<tr>
<td>alt + n</td>
<td></td>
</tr>
<tr>
<td>alt + p</td>
<td>Non-incremental reverse search of history.</td>
</tr>
<tr>
<td>alt + r</td>
<td>Undo all changes to the line</td>
</tr>
<tr>
<td>alt + ctl + e</td>
<td>Expand command line.</td>
</tr>
<tr>
<td>~[TAB][TAB]</td>
<td>List all users</td>
</tr>
<tr>
<td>$[TAB][TAB]</td>
<td>List all system variables</td>
</tr>
<tr>
<td>@[TAB][TAB]</td>
<td>List all entries in your &#x2F;etc&#x2F;hosts file</td>
</tr>
<tr>
<td>[TAB]</td>
<td>Auto complete</td>
</tr>
<tr>
<td>cd -</td>
<td>change to PREVIOUS working directory</td>
</tr>
</tbody></table>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><table>
<thead>
<tr>
<th>command</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ctrl + r</td>
<td>Search backward starting at the current line and moving ‘up’ through the history as necessary</td>
</tr>
<tr>
<td>crtl + s</td>
<td>Search forward starting at the current line and moving ‘down’ through the history as necessary</td>
</tr>
<tr>
<td>ctrl + p</td>
<td>Fetch the previous command from the history list, moving back in the list (same as up arrow)</td>
</tr>
<tr>
<td>ctrl + n</td>
<td>Fetch the next command from the history list, moving forward in the list (same as down arrow)</td>
</tr>
<tr>
<td>ctrl + o</td>
<td>Execute the command found via Ctrl+r or Ctrl+s</td>
</tr>
<tr>
<td>ctrl + g</td>
<td>Escape from history searching mode</td>
</tr>
<tr>
<td>!!</td>
<td>Run PREVIOUS command (ie <code>sudo !!</code>)</td>
</tr>
<tr>
<td>!vi</td>
<td>Run PREVIOUS command that BEGINS with vi</td>
</tr>
<tr>
<td>!vi:p</td>
<td>Print previously run command that BEGINS with vi</td>
</tr>
<tr>
<td>!n</td>
<td>Execute nth command in history</td>
</tr>
<tr>
<td>!$</td>
<td>Last argument of last command</td>
</tr>
<tr>
<td>!^</td>
<td>First argument of last command</td>
</tr>
<tr>
<td>^abc^xyz</td>
<td>Replace first occurance of abc with xyz in last command and execute it</td>
</tr>
</tbody></table>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jlevy/the-art-of-command-line/tree/master">https://github.com/jlevy/the-art-of-command-line/tree/master</a></p>
</blockquote>
<h2 id="bash命令行"><a href="#bash命令行" class="headerlink" title="bash命令行"></a>bash命令行</h2><ul>
<li>如果你输入命令的时候中途改了主意，按下 <strong>alt-#</strong> 在行首添加 <code>#</code> 把它当做注释再按下回车执行（或者依次按下 <strong>ctrl-a</strong>， <strong>#</strong>， <strong>enter</strong>）。这样做的话，之后借助命令行历史记录，你可以很方便恢复你刚才输入到一半的命令。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ # yum install gcc   &lt;--前面加#</span><br><span class="line">➜  ~ # yum install gcc   &lt;-- 按上键</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>netstat -lntp</code> 或 <code>ss -plat</code> 检查哪些进程在监听端口（默认是检查 TCP 端口; 添加参数 <code>-u</code> 则检查 UDP 端口）或者 <code>lsof -iTCP -sTCP:LISTEN -P -n</code> (这也可以在 OS X 上运行)。</li>
<li><code>pstree -p</code> 以一种优雅的方式展示进程树。</li>
<li>使用 <code>nohup</code> 或 <code>disown</code> 使一个后台进程持续运行。</li>
<li>使用 <code>pgrep</code> 和 <code>pkill</code> 根据名字查找进程或发送信号（<code>-f</code> 参数通常有用）。</li>
<li>将 shell 切换为其他用户，使用 <code>su username</code> 或者 <code>su - username</code>。加入 <code>-</code> 会使得切换后的环境与使用该用户登录后的环境相同。省略用户名则默认为 root。切换到哪个用户，就需要输入_哪个用户的_密码。</li>
<li>可以把别名、shell 选项和常用函数保存在 <code>~/.bashrc</code>，具体看下这篇<a target="_blank" rel="noopener" href="http://superuser.com/a/183980/7106">文章</a>。这样做的话你就可以在所有 shell 会话中使用你的设定。</li>
<li>把环境变量的设定以及登陆时要执行的命令保存在 <code>~/.bash_profile</code>。而对于从图形界面启动的 shell 和 <code>cron</code> 启动的 shell，则需要单独配置文件。</li>
<li>shell PS1显示</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 编辑配置文件（以当前用户的 ~/.bashrc 为例）</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. 在文件末尾添加一行，例如：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示效果类似于：[Sun Dec 21 14:05:30] user@server:~$</span></span><br><span class="line">export PS1=&quot;[\d \t] \u@\h:\W\$ &quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 让配置立即生效</span></span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>

<h2 id="文件及数据处理"><a href="#文件及数据处理" class="headerlink" title="文件及数据处理"></a>文件及数据处理</h2><ul>
<li><code>wc</code> 去计算新行数（<code>-l</code>），字符数（<code>-m</code>），单词数（<code>-w</code>）以及字节数（<code>-c</code>）。</li>
<li>使用 <code>tee</code> 将标准输入复制到文件甚至标准输出，例如 <code>ls -al | tee file.txt</code>。</li>
<li>替换一个或多个文件中出现的字符串：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pi.bak -e &#x27;s/old-string/new-string/g&#x27; my-files-*.txt</span><br></pre></td></tr></table></figure>
<ul>
<li><code>rsync</code> 是一个快速且非常灵活的文件复制工具。它闻名于设备之间的文件同步，但其实它在本地情况下也同样有用。在安全设置允许下，用 <code>rsync</code> 代替 <code>scp</code> 可以实现文件续传，而不用重新从头开始。它同时也是删除大量文件的<a target="_blank" rel="noopener" href="https://web.archive.org/web/20130929001850/http://linuxnote.net/jianingy/en/linux/a-fast-way-to-remove-huge-number-of-files.html">最快方法</a>之一：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir empty &amp;&amp; rsync -r --delete empty/ some-dir &amp;&amp; rmdir some-dir</span><br></pre></td></tr></table></figure>
<ul>
<li>标准的源代码对比及合并工具是 <code>diff</code> 和 <code>patch</code>。使用 <code>diffstat</code> 查看变更总览数据。注意到 <code>diff -r</code> 对整个文件夹有效。使用 <code>diff -r tree1 tree2 | diffstat</code> 查看变更的统计数据。<code>vimdiff</code> 用于比对并编辑文件。<br><img src="/diff.png"></li>
<li>对于二进制文件，使用 <code>hd</code>，<code>hexdump</code> 或者 <code>xxd</code> 使其以十六进制显示，使用 <code>bvi</code>，<code>hexedit</code> 或者 <code>biew</code> 来进行二进制编辑。</li>
<li>同样对于二进制文件，<code>strings</code>（包括 <code>grep</code> 等工具）可以帮助在二进制文件中查找特定比特。</li>
<li>拆分文件可以使用 <code>split</code>（按大小拆分）和 <code>csplit</code>（按模式拆分）。</li>
<li>操作日期和时间表达式，可以用 <a target="_blank" rel="noopener" href="http://www.fresse.org/dateutils/"><code>dateutils</code></a> 中的 <code>dateadd</code>、<code>datediff</code>、<code>strptime</code> 等工具。</li>
<li>使用 <code>zless</code>、<code>zmore</code>、<code>zcat</code> 和 <code>zgrep</code> 对压缩过的文件进行操作。</li>
<li>文件属性可以通过 <code>chattr</code> 进行设置，它比文件权限更加底层。例如，为了保护文件不被意外删除，可以使用不可修改标记：<code>sudo chattr +i /critical/directory/or/file</code></li>
<li>使用 <code>getfacl</code> 和 <code>setfacl</code> 以保存和恢复文件权限。例如：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getfacl -R /some/path &gt; permissions.txt</span><br><span class="line">setfacl --restore=permissions.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>为了高效地创建空文件，请使用 <code>truncate</code>（创建<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%A8%80%E7%96%8F%E6%96%87%E4%BB%B6">稀疏文件</a>），<code>fallocate</code>（用于 ext4，xfs，btrf 和 ocfs2 文件系统），<code>xfs_mkfile</code>（适用于几乎所有的文件系统，包含在 xfsprogs 包中），<code>mkfile</code>（用于类 Unix 操作系统，比如 Solaris 和 Mac OS）。</li>
</ul>
<h2 id="系统调试"><a href="#系统调试" class="headerlink" title="系统调试"></a>系统调试</h2><ul>
<li><code>curl</code> 和 <code>curl -I</code> 可以被轻松地应用于 web 调试中，它们的好兄弟 <code>wget</code> 也是如此，或者也可以试试更潮的 <a target="_blank" rel="noopener" href="https://github.com/jkbrzt/httpie"><code>httpie</code></a>。</li>
<li>获取 CPU 和硬盘的使用状态，通常使用使用 <code>top</code>（<code>htop</code> 更佳），<code>iostat</code> 和 <code>iotop</code>。而 <code>iostat -mxz 15</code> 可以让你获悉 CPU 和每个硬盘分区的基本信息和性能表现。</li>
<li>使用 <code>netstat</code> 和 <code>ss</code> 查看网络连接的细节。</li>
<li><code>dstat</code> 在你想要对系统的现状有一个粗略的认识时是非常有用的。然而若要对系统有一个深度的总体认识，使用 <a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a>，它会在一个终端窗口中向你提供一些系统级的数据。</li>
<li>若要了解内存状态，运行并理解 <code>free</code> 和 <code>vmstat</code> 的输出。值得留意的是“cached”的值，它指的是 Linux 内核用来作为文件缓存的内存大小，而与空闲内存无关。</li>
<li>Java 系统调试则是一件截然不同的事，一个可以用于 Oracle 的 JVM 或其他 JVM 上的调试的技巧是你可以运行 <code>kill -3 &lt;pid&gt;</code> 同时一个完整的栈轨迹和堆概述（包括 GC 的细节）会被保存到标准错误或是日志文件。JDK 中的 <code>jps</code>，<code>jstat</code>，<code>jstack</code>，<code>jmap</code> 很有用。<a target="_blank" rel="noopener" href="https://github.com/aragozin/jvm-tools">SJK tools</a> 更高级。</li>
<li>使用 <a target="_blank" rel="noopener" href="http://www.bitwizard.nl/mtr/"><code>mtr</code></a> 去跟踪路由，用于确定网络问题。</li>
<li>用 <a target="_blank" rel="noopener" href="https://dev.yorhel.nl/ncdu"><code>ncdu</code></a> 来查看磁盘使用情况，它比寻常的命令，如 <code>du -sh *</code>，更节省时间。</li>
<li>查找正在使用带宽的套接字连接或进程，使用 <a target="_blank" rel="noopener" href="http://www.ex-parrot.com/~pdw/iftop/"><code>iftop</code></a> 或 <a target="_blank" rel="noopener" href="https://github.com/raboof/nethogs"><code>nethogs</code></a>。</li>
<li><code>ab</code> 工具（Apache 中自带）可以简单粗暴地检查 web 服务器的性能。对于更复杂的负载测试，使用 <code>siege</code>。</li>
<li><a target="_blank" rel="noopener" href="https://wireshark.org/"><code>wireshark</code></a>，<a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/wsug_html_chunked/AppToolstshark.html"><code>tshark</code></a> 和 <a target="_blank" rel="noopener" href="http://ngrep.sourceforge.net/"><code>ngrep</code></a> 可用于复杂的网络调试。</li>
<li>了解 <code>strace</code> 和 <code>ltrace</code>。这俩工具在你的程序运行失败、挂起甚至崩溃，而你却不知道为什么或你想对性能有个总体的认识的时候是非常有用的。注意 profile 参数（<code>-c</code>）和附加到一个运行的进程参数 （<code>-p</code>）。</li>
<li>了解使用 <code>ldd</code> 来检查共享库。但是<a target="_blank" rel="noopener" href="http://www.catonmat.net/blog/ldd-arbitrary-code-execution/">永远不要在不信任的文件上运行</a>。</li>
<li>了解如何运用 <code>gdb</code> 连接到一个运行着的进程并获取它的堆栈轨迹。</li>
<li>学会使用 <code>/proc</code>。它在调试正在出现的问题的时候有时会效果惊人。比如：<code>/proc/cpuinfo</code>，<code>/proc/meminfo</code>，<code>/proc/cmdline</code>，<code>/proc/xxx/cwd</code>，<code>/proc/xxx/exe</code>，<code>/proc/xxx/fd/</code>，<code>/proc/xxx/smaps</code>（这里的 <code>xxx</code> 表示进程的 id 或 pid）。</li>
<li>当调试一些之前出现的问题的时候，<a target="_blank" rel="noopener" href="http://sebastien.godard.pagesperso-orange.fr/"><code>sar</code></a> 非常有用。它展示了 cpu、内存以及网络等的历史数据。</li>
<li>关于更深层次的系统分析以及性能分析，看看 <code>stap</code>（<a target="_blank" rel="noopener" href="https://sourceware.org/systemtap/wiki">SystemTap</a>），<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Perf_(Linux)"><code>perf</code></a>，以及<a target="_blank" rel="noopener" href="https://github.com/draios/sysdig"><code>sysdig</code></a>。</li>
<li>查看你当前使用的系统，使用 <code>uname</code>，<code>uname -a</code>（Unix／kernel 信息）或者 <code>lsb_release -a</code>（Linux 发行版信息）。</li>
<li>无论什么东西工作得很欢乐（可能是硬件或驱动问题）时可以试试 <code>dmesg</code>。</li>
<li>如果你删除了一个文件，但通过 <code>du</code> 发现没有释放预期的磁盘空间，请检查文件是否被进程占用： <code>lsof | grep deleted | grep &quot;filename-of-my-big-file&quot;</code></li>
</ul>
<h2 id="单行脚本"><a href="#单行脚本" class="headerlink" title="单行脚本"></a>单行脚本</h2><ul>
<li>当你需要对文本文件做集合交、并、差运算时，<code>sort</code> 和 <code>uniq</code> 会是你的好帮手。具体例子请参照代码后面的，此处假设 <code>a</code> 与 <code>b</code> 是两内容不同的文件。这种方式效率很高，并且在小文件和上 G 的文件上都能运用（注意尽管在 <code>/tmp</code> 在一个小的根分区上时你可能需要 <code>-T</code> 参数，但是实际上 <code>sort</code> 并不被内存大小约束），参阅前文中关于 <code>LC_ALL</code> 和 <code>sort</code> 的 <code>-u</code> 参数的部分。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort a b | uniq &gt; c   # c 是 a 并 b</span><br><span class="line">sort a b | uniq -d &gt; c   # c 是 a 交 b</span><br><span class="line">sort a b b | uniq -u &gt; c   # c 是 a - b</span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>grep . *</code>（每行都会附上文件名）或者 <code>head -100 *</code>（每个文件有一个标题）来阅读检查目录下所有文件的内容。这在检查一个充满配置文件的目录（如 <code>/sys</code>、<code>/proc</code>、<code>/etc</code>）时特别好用。</li>
<li>计算文本文件第三列中所有数的和（可能比同等作用的 Python 代码快三倍且代码量少三倍）：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123; x += $3 &#125; END &#123; print x &#125;&#x27; myfile</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你想在文件树上查看大小&#x2F;日期，这可能看起来像递归版的 <code>ls -l</code> 但比 <code>ls -lR</code> 更易于理解：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -type f -ls</span><br></pre></td></tr></table></figure>
<ul>
<li>假设你有一个类似于 web 服务器日志文件的文本文件，并且一个确定的值只会出现在某些行上，假设一个 <code>acct_id</code> 参数在 URI 中。如果你想计算出每个 <code>acct_id</code> 值有多少次请求，使用如下代码：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep -o &#x27;acct_id=[0-9]+&#x27; access.log | cut -d= -f2 | sort | uniq -c | sort -rn</span><br></pre></td></tr></table></figure>
<ul>
<li>要持续监测文件改动，可以使用 <code>watch</code>，例如检查某个文件夹中文件的改变，可以用 <code>watch -d -n 2 &#39;ls -rtlh | tail&#39;</code>；或者在排查 WiFi 设置故障时要监测网络设置的更改，可以用 <code>watch -d -n 2 ifconfig</code>。</li>
<li>运行这个函数从这篇文档中随机获取一条技巧（解析 Markdown 文件并抽取项目）：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function taocl() &#123;</span><br><span class="line">	curl -s https://raw.githubusercontent.com/jlevy/the-art-of-command-line/master/README-zh.md|</span><br><span class="line">	pandoc -f markdown -t html |</span><br><span class="line">       iconv -f &#x27;utf-8&#x27; -t &#x27;unicode&#x27; |</span><br><span class="line">       xmlstarlet fo --html --dropdtd |</span><br><span class="line">       xmlstarlet sel -t -v &quot;(html/body/ul/li[count(p)&gt;0])[$RANDOM mod last()+1]&quot; |</span><br><span class="line">       xmlstarlet unesc | fmt -80</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="冷门但有用"><a href="#冷门但有用" class="headerlink" title="冷门但有用"></a>冷门但有用</h2><ul>
<li><code>expr</code>：计算表达式或正则匹配</li>
<li><code>m4</code>：简单的宏处理器</li>
<li><code>yes</code>：多次打印字符串</li>
<li><code>cal</code>：漂亮的日历</li>
<li><code>env</code>：执行一个命令（脚本文件中很有用）</li>
<li><code>printenv</code>：打印环境变量（调试时或在写脚本文件时很有用）</li>
<li><code>look</code>：查找以特定字符串开头的单词或行</li>
<li><code>cut</code>，<code>paste</code> 和 <code>join</code>：数据修改</li>
<li><code>fmt</code>：格式化文本段落</li>
<li><code>pr</code>：将文本格式化成页／列形式</li>
<li><code>fold</code>：包裹文本中的几行</li>
<li><code>column</code>：将文本格式化成多个对齐、定宽的列或表格</li>
<li><code>expand</code> 和 <code>unexpand</code>：制表符与空格之间转换</li>
<li><code>nl</code>：添加行号</li>
<li><code>seq</code>：打印数字</li>
<li><code>bc</code>：计算器</li>
<li><code>factor</code>：分解因数</li>
<li><a target="_blank" rel="noopener" href="https://gnupg.org/"><code>gpg</code></a>：加密并签名文件</li>
<li><code>toe</code>：terminfo 入口列表</li>
<li><code>nc</code>：网络调试及数据传输</li>
<li><code>socat</code>：套接字代理，与 <code>netcat</code> 类似</li>
<li><a target="_blank" rel="noopener" href="https://github.com/mattthias/slurm"><code>slurm</code></a>：网络流量可视化</li>
<li><code>dd</code>：文件或设备间传输数据</li>
<li><code>file</code>：确定文件类型</li>
<li><code>tree</code>：以树的形式显示路径和文件，类似于递归的 <code>ls</code></li>
<li><code>stat</code>：文件信息</li>
<li><code>time</code>：执行命令，并计算执行时间</li>
<li><code>timeout</code>：在指定时长范围内执行命令，并在规定时间结束后停止进程</li>
<li><code>lockfile</code>：使文件只能通过 <code>rm -f</code> 移除</li>
<li><code>logrotate</code>： 切换、压缩以及发送日志文件</li>
<li><code>watch</code>：重复运行同一个命令，展示结果并／或高亮有更改的部分</li>
<li><a target="_blank" rel="noopener" href="https://github.com/joh/when-changed"><code>when-changed</code></a>：当检测到文件更改时执行指定命令。参阅 <code>inotifywait</code> 和 <code>entr</code>。</li>
<li><code>tac</code>：反向输出文件</li>
<li><code>shuf</code>：文件中随机选取几行</li>
<li><code>comm</code>：一行一行的比较排序过的文件</li>
<li><code>strings</code>：从二进制文件中抽取文本</li>
<li><code>tr</code>：转换字母</li>
<li><code>iconv</code> 或 <code>uconv</code>：文本编码转换</li>
<li><code>split</code> 和 <code>csplit</code>：分割文件</li>
<li><code>sponge</code>：在写入前读取所有输入，在读取文件后再向同一文件写入时比较有用，例如 <code>grep -v something some-file | sponge some-file</code></li>
<li><code>units</code>：将一种计量单位转换为另一种等效的计量单位（参阅 <code>/usr/share/units/definitions.units</code>）</li>
<li><code>apg</code>：随机生成密码</li>
<li><code>xz</code>：高比例的文件压缩</li>
<li><code>ldd</code>：动态库信息</li>
<li><code>nm</code>：提取 obj 文件中的符号</li>
<li><code>ab</code> 或 <a target="_blank" rel="noopener" href="https://github.com/wg/wrk"><code>wrk</code></a>：web 服务器性能分析</li>
<li><code>strace</code>：调试系统调用</li>
<li><a target="_blank" rel="noopener" href="http://www.bitwizard.nl/mtr/"><code>mtr</code></a>：更好的网络调试跟踪工具</li>
<li><code>cssh</code>：可视化的并发 shell</li>
<li><code>rsync</code>：通过 ssh 或本地文件系统同步文件和文件夹</li>
<li><a target="_blank" rel="noopener" href="https://wireshark.org/"><code>wireshark</code></a> 和 <a target="_blank" rel="noopener" href="https://www.wireshark.org/docs/wsug_html_chunked/AppToolstshark.html"><code>tshark</code></a>：抓包和网络调试工具</li>
<li><a target="_blank" rel="noopener" href="http://ngrep.sourceforge.net/"><code>ngrep</code></a>：网络层的 grep</li>
<li><code>host</code> 和 <code>dig</code>：DNS 查找</li>
<li><code>lsof</code>：列出当前系统打开文件的工具以及查看端口信息</li>
<li><code>dstat</code>：系统状态查看</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nicolargo/glances"><code>glances</code></a>：高层次的多子系统总览</li>
<li><code>iostat</code>：硬盘使用状态</li>
<li><code>mpstat</code>： CPU 使用状态</li>
<li><code>vmstat</code>： 内存使用状态</li>
<li><code>htop</code>：top 的加强版</li>
<li><code>last</code>：登入记录</li>
<li><code>w</code>：查看处于登录状态的用户</li>
<li><code>id</code>：用户&#x2F;组 ID 信息</li>
<li><a target="_blank" rel="noopener" href="http://sebastien.godard.pagesperso-orange.fr/"><code>sar</code></a>：系统历史数据</li>
<li><a target="_blank" rel="noopener" href="http://www.ex-parrot.com/~pdw/iftop/"><code>iftop</code></a> 或 <a target="_blank" rel="noopener" href="https://github.com/raboof/nethogs"><code>nethogs</code></a>：套接字及进程的网络利用情况</li>
<li><code>ss</code>：套接字数据</li>
<li><code>dmesg</code>：引导及系统错误信息</li>
<li><code>sysctl</code>： 在内核运行时动态地查看和修改内核的运行参数</li>
<li><code>hdparm</code>：SATA&#x2F;ATA 磁盘更改及性能分析</li>
<li><code>lsblk</code>：列出块设备信息：以树形展示你的磁盘以及磁盘分区信息</li>
<li><code>lshw</code>，<code>lscpu</code>，<code>lspci</code>，<code>lsusb</code> 和 <code>dmidecode</code>：查看硬件信息，包括 CPU、BIOS、RAID、显卡、USB设备等</li>
<li><code>lsmod</code> 和 <code>modinfo</code>：列出内核模块，并显示其细节</li>
<li><code>fortune</code>，<code>ddate</code> 和 <code>sl</code>：额，这主要取决于你是否认为蒸汽火车和莫名其妙的名人名言是否“有用”</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/21/shells/Linux%20Troubleshooting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/21/shells/Linux%20Troubleshooting/" class="post-title-link" itemprop="url">Linux Trouble Shooting</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-21 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-21T00:00:00+00:00">2025-12-21</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>转载：<a target="_blank" rel="noopener" href="https://github.com/rahulrajaram/linux_troubleshooting">https://github.com/rahulrajaram/linux_troubleshooting</a></p>
</blockquote>
<p>Purpose: a single-page, production-ready cheatsheet for Linux&#x2F;SRE triage. Optimized for fast on-call </p>
<p>use: concise flags, copy-paste recipes, brief notes, and clear risk callouts.</p>
<h1 id="Binaries-ELF"><a href="#Binaries-ELF" class="headerlink" title="Binaries &amp; ELF"></a>Binaries &amp; ELF</h1><p>Cheat Card</p>
<ul>
<li>Linked libs: <code>ldd /path/to/bin</code> (security caveat: may execute code in rare cases)</li>
<li>ELF headers&#x2F;sections: <code>readelf -h /bin/ls</code>; sections: <code>readelf -S /bin/ls</code></li>
<li>Symbols (prefer readelf): <code>readelf -Ws /bin/ls | grep &#39; FUNC &#39;</code>; dynamic: <code>readelf -Ws -d /bin/ls</code></li>
<li>Disassemble: <code>objdump -d /bin/ls | less</code> (add <code>-M intel</code> for Intel syntax)</li>
<li>Symbols via nm: <code>nm -D /bin/ls | grep symbol_name</code></li>
<li>Requires: binutils (readelf&#x2F;objdump&#x2F;nm)</li>
</ul>
<h2 id="1-ldd"><a href="#1-ldd" class="headerlink" title="1. ldd"></a>1. ldd</h2><p>List shared library dependencies of executables and shared objects.</p>
<ul>
<li>Basic: <code>ldd /path/to/bin</code></li>
<li>Security caveat: may execute code in rare cases; avoid on untrusted binaries.</li>
<li>Alternative: <code>LD_TRACE_LOADED_OBJECTS=1 /lib64/ld-linux-x86-64.so.2 /path/to/bin</code> (still uses loader)</li>
</ul>
<h3 id="Text-Data-Utilities"><a href="#Text-Data-Utilities" class="headerlink" title="Text &amp; Data Utilities"></a>Text &amp; Data Utilities</h3><p>Cheat Card</p>
<ul>
<li>Search recursively: <code>grep -RIn --exclude-dir .git &#39;pattern&#39; .</code>; context: <code>-C2</code></li>
<li>Edit in-place: <code>sed -i.bak -E &#39;s/old/new/g&#39; file</code> (backup)</li>
<li>Summarize data: <code>awk -F, &#39;{a[$1]+=$2} END{for(k in a) print k,a[k]}&#39; file.csv</code></li>
<li>JSON parse: <code>jq -r &#39;.items[].metadata.name&#39; file.json</code></li>
<li>Compare dirs: <code>diff -ruN dir_old dir_new | less -R</code></li>
<li>Transform text: <code>tr -s &#39; &#39; | cut -d, -f1,3 | xargs -n1 echo</code></li>
<li>Safe temp: <code>mktemp -d</code> for dirs; files: <code>mktemp</code></li>
<li>Reverse lines: <code>rev &lt;file</code> (quick visual check)</li>
</ul>
<h2 id="2-grep"><a href="#2-grep" class="headerlink" title="2. grep"></a>2. grep</h2><ul>
<li>search for one or more expressions: <code>grep -E &#39;hello|world&#39; temp</code></li>
<li>search for one or more words: <code>grep -Ew &#39;hello|world&#39; temp</code></li>
<li>search for suffix matches: <code>grep -E &#39;hello(world|lolo)&#39; temp</code></li>
<li>search for suffixes matching regex: <code>grep -E &#39;hello[0-9]{3,}&#39; temp</code></li>
<li>recursive search in tree: <code>grep -RIn --exclude-dir .git --exclude=&#39;*.log&#39; &#39;pattern&#39; .</code></li>
<li>fixed strings (fast) and ignore case: <code>grep -Fni &#39;literal text&#39; file</code></li>
<li>context lines: <code>grep -R --color -n -C2 &#39;pattern&#39; .</code> (or <code>-A</code> after, <code>-B</code> before)</li>
<li>binary-skip and file names only: <code>grep -rI -l &#39;pattern&#39; .</code></li>
</ul>
<h2 id="3-sed"><a href="#3-sed" class="headerlink" title="3. sed"></a>3. sed</h2><p>What it does: stream editor for non-interactive find&#x2F;replace, line edits, and range selections.</p>
<ul>
<li>In-place with backup: <code>sed -i.bak -E &#39;s/old/new/g&#39; file</code></li>
<li>Delete matching lines: <code>sed -i &#39;/pattern/d&#39; file</code></li>
<li>Print lines between markers: <code>sed -n &#39;/BEGIN/,/END/p&#39; file</code></li>
<li>Replace with capture groups: <code>sed -E &#39;s/([0-9]{4})-([0-9]{2})-([0-9]{2})/\3-\2-\1/&#39; file</code></li>
<li>Insert before&#x2F;after match:<ul>
<li>Before: <code>sed &#39;/pattern/i\\inserted before&#39; file</code></li>
<li>After: <code>sed &#39;/pattern/a\\appended after&#39; file</code></li>
</ul>
</li>
<li>Trim trailing spaces: <code>sed -i &#39;s/[ \t]\+$//&#39; file</code></li>
<li>Multiple edits: <code>sed -E -e &#39;s/foo/bar/g&#39; -e &#39;/tmp/d&#39; file</code></li>
</ul>
<h2 id="4-awk"><a href="#4-awk" class="headerlink" title="4. awk"></a>4. awk</h2><p>What it does: text processing and quick data summarization using fields and expressions.</p>
<ul>
<li>Default FS is whitespace; set CSV FS: <code>awk -F, &#39;...&#39; file.csv</code></li>
<li>Select fields: <code>awk &#39;{print $1, $3}&#39; file</code></li>
<li>Filter rows: <code>awk &#39;$5 &gt; 100 {print $1, $5}&#39; file</code></li>
<li>Sum a column: <code>awk &#39;{s+=$3} END{print s}&#39; file</code></li>
<li>Group and sum by key: <code>awk &#39;{a[$1]+=$2} END{for (k in a) print k, a[k]}&#39; file</code></li>
<li>Pretty print: <code>awk &#39;{printf &quot;%-20s %10d\n&quot;, $1, $2}&#39; file</code></li>
<li>Count unique values: <code>awk &#39;{c[$1]++} END{for (k in c) print k, c[k]}&#39; file</code></li>
</ul>
<h1 id="Networking"><a href="#Networking" class="headerlink" title="Networking"></a>Networking</h1><p>Cheat Card</p>
<ul>
<li>Ports→PIDs: <code>ss -ltnp</code>; established only: <code>ss -tn state established</code></li>
<li>TCP detail: <code>ss -i dst &lt;ip&gt;</code> (rtt, cwnd, retrans)</li>
<li>Path&#x2F;source IP: <code>ip route get &lt;dest&gt;</code>; counters: <code>ip -s link show &lt;iface&gt;</code></li>
<li>Latency&#x2F;loss: <code>mtr -ezbw &lt;dest&gt;</code>; quick traceroute ICMP: <code>traceroute -I &lt;dest&gt;</code></li>
<li>Targeted capture: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> (or <code>port 53</code>, <code>icmp</code>)</li>
<li>DNS: <code>resolvectl query &lt;name&gt;</code> or <code>dig &lt;name&gt; A +short</code></li>
</ul>
<h2 id="5-ping"><a href="#5-ping" class="headerlink" title="5. ping"></a>5. ping</h2><ul>
<li>Compat: Linux; Root: may require CAP_NET_RAW depending on system; Requires: iputils-ping.</li>
<li><code>-4</code>: ping IPv4 only</li>
<li><code>-6</code>: ping IPv6 only</li>
<li><code>-A</code>: adapts to roundtrip time</li>
<li><code>-b</code>: allow pinging broadcast addresses</li>
<li><code>-I</code>: ping through an interface</li>
<li><code>-M</code>: set PMTU strategy</li>
<li><code>-s</code>: set packetsize (default is 56B)</li>
<li><code>-t</code>: set IP time-to-live</li>
<li><code>ping 224.0.0.1</code>: ping multicast address</li>
</ul>
<p>Notes:</p>
<ul>
<li>Using average <code>rtt</code> values, you can determine whether there are huge variations causing jitter, especially in RT applications</li>
<li>ping will report duplications, however, duplicate packets should never occur, and seem to be caused by inappropriate link-level retransmissions</li>
<li>ping will report damaged packets, suggesting broken hardware in the network Requires: iputils-ping.</li>
</ul>
<h2 id="6-ip"><a href="#6-ip" class="headerlink" title="6. ip"></a>6. ip</h2><ul>
<li>Compat: Linux; Root: not required for reads; Requires: iproute2.</li>
<li><code>ip addr</code>: Show information for all addresses</li>
<li><code>ip addr show dev wlo1</code>: Display information only for device wlo1</li>
<li><code>ip link</code>: Show information for all interfaces</li>
<li><code>ip link show dev wlo1</code>: Display information only for device wlo1</li>
<li><code>ip -s</code>: Display interface statistics (packets dropped, received, sent, etc.)</li>
<li>Quick recipes:<ul>
<li>Path and source IP: <code>ip route get &lt;dest&gt;</code></li>
<li>Interface counters: <code>ip -s link show &lt;iface&gt;</code> (rx&#x2F;tx errors, drops)</li>
<li>Neighbors&#x2F;ARP: <code>ip neigh</code> and <code>ip neigh show dev &lt;iface&gt;</code></li>
<li>Multicast: <code>ip maddr</code> or <code>ip maddr show dev &lt;iface&gt;</code></li>
</ul>
</li>
</ul>
<p>Example</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Query path and chosen <span class="built_in">source</span> IP</span></span><br><span class="line">ip route get 8.8.8.8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Expect: 8.8.8.8 via 192.168.1.1 dev wlo1 src 192.168.1.23</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ip route</code>: List all of the route entries in the kernel</li>
<li><code>ip route add</code>: Add a route entry to the kernel routing table</li>
<li><code>ip route replace</code>: Replace an existing route (add if not present)</li>
<li><code>ip maddr</code>: Display multicast information for all devices</li>
<li><code>ip maddr show dev wlo1</code></li>
<li><code>ip neigh show dev wlo1</code>: check for reachability of specific interfaces      Requires: iproute2.</li>
</ul>
<h2 id="7-arp"><a href="#7-arp" class="headerlink" title="7. arp"></a>7. arp</h2><ul>
<li>Compat: Legacy; prefer <code>ip neigh</code>; Requires: net-tools.</li>
<li><code>arp</code>: show all ARP table entries</li>
<li><code>arp -d address</code>: delete ARP entry for address</li>
<li><code>arp -s address hw_addr</code>: set up new table entry Note: legacy from net-tools; prefer <code>ip neigh</code>. Requires: net-tools.</li>
</ul>
<h2 id="8-arping"><a href="#8-arping" class="headerlink" title="8. arping"></a>8. arping</h2><ul>
<li>Compat: Linux; Root&#x2F;CAP_NET_RAW required; Package: arping (iputils-arping on some distros).</li>
<li><code>arping -I wlo1 192.168.0.1</code>: send ARP requests to host</li>
<li><code>arping -D -I wlo1 192.168.0.15</code>: check for duplicate MAC address Requires: arping (iputils-arping on some distros).</li>
</ul>
<h2 id="9-ethtool"><a href="#9-ethtool" class="headerlink" title="9. ethtool"></a>9. ethtool</h2><ul>
<li>Compat: Linux; Root for changing settings, read stats usually ok; Requires: ethtool.</li>
<li><code>ethtool -S wlo1</code>: print network statistics Requires: ethtool.</li>
</ul>
<h2 id="10-ss"><a href="#10-ss" class="headerlink" title="10. ss"></a>10. ss</h2><ul>
<li>Compat: Linux; Modern replacement for netstat; Requires: iproute2.</li>
<li><code>ss -a</code>: show all sockets</li>
<li><code>ss -o</code>: show all sockets with timer information</li>
<li><code>ss -p</code>: show process using the socket</li>
<li><code>ss -t|-u|-4|-6</code></li>
<li><code>ss -ltnp</code>: list listening TCP sockets with PIDs</li>
<li><code>ss -tn state established</code>: show established TCP only</li>
<li><code>ss -tn sport = :443</code> or <code>ss -tn dport = :443</code>: filter by port</li>
<li><code>ss -s</code>: summary stats (TCP states, mem)</li>
<li><code>ss -i</code>:<ul>
<li><code>ts</code>: show string “ts” if the timestamp option is set</li>
<li><code>sack</code>: show string “sack” if the sack option is set</li>
<li><code>ecn</code>: show string “ecn” if the explicit congestion notification option is set</li>
<li><code>ecnseen</code>: show string “ecnseen” if the saw ecn flag is found in received packets</li>
<li><code>fastopen</code>: show string “fastopen” if the fastopen option is set</li>
<li><code>cong_alg</code>: the congestion algorithm name, the default congestion algorithm is “cubic”</li>
<li><code>wscale:&lt;snd_wscale&gt;:&lt;rcv_wscale&gt;</code>: if window scale option is used, this field shows the send scale factor and receive scale factor</li>
<li><code>rto:&lt;icsk_rto&gt;</code>: tcp re-transmission timeout value, the unit is millisecond</li>
<li><code>backoff:&lt;icsk_backoff&gt;</code>: used for exponential backoff re-transmission, the actual re-transmission timeout value is icsk_rto &lt;&lt; icsk_backoff</li>
<li><code>rtt:&lt;rtt&gt;/&lt;rttvar&gt;</code>: rtt is the average round trip time, rttvar is the mean deviation of rtt, their units are millisecond</li>
<li><code>ato:&lt;ato&gt;</code>: ack timeout, unit is millisecond, used for delay ack mode</li>
<li><code>mss:&lt;mss&gt;</code>: max segment size</li>
<li><code>cwnd:&lt;cwnd&gt;</code>: congestion window size</li>
<li><code>pmtu:&lt;pmtu&gt;</code>: path MTU value</li>
<li><code>ssthresh:&lt;ssthresh&gt;</code>: tcp congestion window slow start threshold</li>
<li><code>bytes_acked:&lt;bytes_acked&gt;</code>: bytes acked</li>
<li><code>bytes_received:&lt;bytes_received&gt;</code>: bytes received</li>
<li><code>segs_out:&lt;segs_out&gt;</code>: segments sent out</li>
<li><code>segs_in:&lt;segs_in&gt;</code>: segments received</li>
<li><code>send &lt;send_bps&gt;bps</code>: egress bps</li>
<li><code>lastsnd:&lt;lastsnd&gt;</code>: how long time since the last packet sent, the unit is millisecond</li>
<li><code>lastrcv:&lt;lastrcv&gt;</code>: how long time since the last packet received, the unit is millisecond</li>
<li><code>lastack:&lt;lastack&gt;</code>: how long time since the last ack received, the unit is millisecond</li>
</ul>
</li>
<li><code>ss -A tcp,udp</code>: dump socket tables Requires: iproute2.</li>
</ul>
<h2 id="37-tcpdump"><a href="#37-tcpdump" class="headerlink" title="37. tcpdump"></a>37. tcpdump</h2><p>Compat: Linux; Root&#x2F;CAP_NET_RAW required for captures; Requires: tcpdump. What it does: capture packets for inspection and troubleshooting. Requires: tcpdump.</p>
<ul>
<li>Interface and no name resolution: <code>tcpdump -ni &lt;iface&gt;</code></li>
<li>Host or subnet: <code>tcpdump -ni &lt;iface&gt; host &lt;ip&gt;</code>; <code>tcpdump -ni &lt;iface&gt; net 10.0.0.0/8</code></li>
<li>Ports&#x2F;protocols: <code>tcpdump -ni &lt;iface&gt; tcp port 443</code> or <code>udp port 53</code></li>
<li>SYNs only (new TCP handshakes):</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">New TCP handshakes only (SYN without ACK)</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; &#x27;tcp[tcpflags] &amp; (tcp-syn) != 0 and tcp[tcpflags] &amp; (tcp-ack) == 0&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>DNS queries: <code>tcpdump -ni &lt;iface&gt; port 53</code></li>
<li>ICMP reachability: <code>tcpdump -ni &lt;iface&gt; icmp</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: tcpdump</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Capture full packets to a file</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -w capture.pcap</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Rotate captures every 5m, keep 6 files</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; -s 0 -G 300 -W 6 -w &#x27;cap-%Y%m%d%H%M%S.pcap&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="38-mtr"><a href="#38-mtr" class="headerlink" title="38. mtr"></a>38. mtr</h2><p>Compat: Linux; May need root&#x2F;CAP_NET_RAW for certain probe types; Requires: mtr. What it does: combines ping and traceroute to visualize latency and loss per hop.</p>
<ul>
<li>Run with extra info: <code>mtr -ezbw &lt;dest&gt;</code></li>
<li>Report mode (one-off): <code>mtr -ezbwrc 10 &lt;dest&gt;</code> Requires: mtr.</li>
</ul>
<h2 id="39-traceroute"><a href="#39-traceroute" class="headerlink" title="39. traceroute"></a>39. traceroute</h2><ul>
<li>Compat: Linux; Requires: traceroute; TCP mode may need CAP_NET_RAW&#x2F;root.</li>
<li><code>traceroute -I</code>: use ICMP echo for probes</li>
<li><code>traceroute -T</code>: use TCP SYN for probes Requires: traceroute.</li>
</ul>
<h2 id="40-nicstat"><a href="#40-nicstat" class="headerlink" title="40. nicstat"></a>40. nicstat</h2><ul>
<li>Compat: Linux; Not widely packaged; Consider <code>sar -n</code>&#x2F;<code>ethtool -S</code> alternatives.</li>
<li>nicstat prints out network statistics for all network cards (NICs), including packets, kilobytes per second, average packet sizes and more.</li>
<li><code>nicstat -t</code>: show CPU stats</li>
<li><code>nicstat</code>: show network interface stats Requires: nicstat (may need third-party repo&#x2F;source on some distros).</li>
</ul>
<p>Metrics reference (click to expand)</p>
<ul>
<li><code>Time</code> - The time corresponding to the end of the sample shown, in HH:MM:SS format (24-hour clock).</li>
<li><code>Int</code> - The interface name.</li>
<li><code>rKB/s, InKB</code> - Kilobytes&#x2F;second read (received).</li>
<li><code>wKB/s, OutKB</code> - Kilobytes&#x2F;second written (transmitted).</li>
<li><code>rMbps, RdMbps</code> - Megabits&#x2F;second read (received).</li>
<li><code>wMbps, WrMbps</code> - Megabits&#x2F;second written (transmitted).</li>
<li><code>rPk/s, InSeg, InDG</code> - Packets (TCP Segments, UDP Datagrams)&#x2F;second read (received).</li>
<li><code>wPk/s, OutSeg, OutDG</code> - Packets (TCP Segments, UDP Datagrams)&#x2F;second written (transmitted).</li>
<li><code>rAvs</code> - Average size of packets read (received).</li>
<li><code>wAvs</code> - Average size of packets written (transmitted).</li>
<li><code>%Util</code> - Percentage utilization of the interface. For full-duplex interfaces, this is the greater of rKB&#x2F;s or wKB&#x2F;s as a percentage of the interface speed. For half-duplex interfaces, rKB&#x2F;s and wKB&#x2F;s are summed.</li>
<li><code>%rUtil, %wUtil</code> - Percentage utilization for bytes read and written, respectively.</li>
<li><code>Sat</code> - Saturation. This the number of errors&#x2F;second seen for the interface<ul>
<li>an indicator the interface may be approaching saturation. This statistic is combined from a number of kernel statistics. It is recommended to use the ‘-x’ option to see more individual statistics (those mentioned below) when attempting to diagnose a network issue.</li>
</ul>
</li>
<li><code>IErr</code> - Packets received that could not be processed because they contained errors</li>
<li><code>OErr</code> - Packets that were not successfully transmitted because of errors</li>
<li><code>Coll</code> - Ethernet collisions during transmit.</li>
<li><code>NoCP</code> - No-can-puts. This is when an incoming packet can not be put to the process reading the socket. This suggests the local process is unable to process incoming packets in a timely manner.</li>
<li><code>Defer</code> - Defer Transmits. Packets without collisions where first transmit attempt was delayed because the medium was busy.</li>
<li><code>Reset</code> - tcpEstabResets. The number of times TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state.</li>
<li><code>AttF</code> - tcpAttemptFails - The number of times that TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state.</li>
<li><code>%ReTX</code> - Percentage of TCP segments retransmitted - that is, the number of TCP segments transmitted containing one or more previously transmitted octets.</li>
<li><code>InConn</code> - tcpPassiveOpens - The number of times that TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state.</li>
<li><code>OutCon</code> - tcpActiveOpens - The number of times that TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state.</li>
<li><code>Drops</code> - tcpHalfOpenDrop + tcpListenDrop + tcpListenDropQ0. tcpListenDrop and tcpListenDropQ0 - Number of connections dropped from the completed connection queue and incomplete connection queue, respectively. tcpHalfOpenDrops - Number of connections dropped after the initial SYN packet was received.</li>
</ul>
<h2 id="41-nslookup"><a href="#41-nslookup" class="headerlink" title="41. nslookup"></a>41. nslookup</h2><ul>
<li>Compat: Legacy; prefer <code>dig</code>&#x2F;<code>resolvectl</code>; Requires: dnsutils&#x2F;bind-utils.query Internet name servers interactively</li>
<li><code>nslookup &lt;domain&gt;</code></li>
<li>Note: legacy tool. Prefer <code>dig</code> for detailed queries or <code>resolvectl</code> on systemd-based systems. Requires: dnsutils&#x2F;bind-utils (for nslookup&#x2F;dig).</li>
<li>Quick equivalents: <code>dig &lt;domain&gt; A +short</code>; <code>resolvectl query &lt;domain&gt;</code></li>
</ul>
<h2 id="42-host"><a href="#42-host" class="headerlink" title="42. host"></a>42. host</h2><ul>
<li>Compat: Linux; Requires: bind9-host&#x2F;bind-utils.<br>host is a simple utility for performing DNS lookups. It is normally used to convert names to IP addresses and vice versa.</li>
<li><code>host &lt;domain&gt;</code></li>
<li>Examples: <code>host -t A &lt;domain&gt;</code>; reverse lookup: <code>host &lt;ip&gt;</code></li>
<li>Tip: for more control, use <code>dig</code> (if installed) or <code>resolvectl</code>. Requires: bind9-host (Debian&#x2F;Ubuntu) or bind-utils.</li>
</ul>
<h2 id="43-iwconfig"><a href="#43-iwconfig" class="headerlink" title="43. iwconfig"></a>43. iwconfig</h2><ul>
<li>Compat: Legacy; prefer <code>iw</code>; Requires: wireless-tools.</li>
<li><code>iwconfig wlo1</code>: show WLAN config:</li>
<li>Note: <code>iwconfig</code> is legacy (wireless-tools). Prefer <code>iw</code> for modern drivers, e.g., <code>iw dev</code>, <code>iw dev wlo1 link</code>. Requires: wireless-tools. Modern alternative: iw.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wlo1      IEEE 802.11  ESSID:&quot;NETGEAR97&quot;  </span><br><span class="line">      Mode:Managed  Frequency:2.462 GHz  Access Point: C4:04:15:58:60:C7   </span><br><span class="line">      Bit Rate=72.2 Mb/s   Tx-Power=20 dBm   </span><br><span class="line">      Retry short limit:7   RTS thr=2347 B   Fragment thr:off</span><br><span class="line">      Power Management:off</span><br><span class="line">      Link Quality=70/70  Signal level=-32 dBm  </span><br><span class="line">      Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">      Tx excessive retries:0  Invalid misc:22932   Missed beacon:0</span><br></pre></td></tr></table></figure>

<h2 id="44-brctl"><a href="#44-brctl" class="headerlink" title="44. brctl"></a>44. brctl</h2><ul>
<li>Compat: Legacy; prefer <code>ip link</code> and <code>bridge</code>; Requires: bridge-utils.</li>
<li>brctl is used to set up, maintain, and inspect the ethernet bridge configuration in the linux kernel. Legacy: prefer <code>ip link add name br0 type bridge</code> and <code>bridge</code> (iproute2) tooling. Requires: bridge-utils.</li>
</ul>
<h1 id="Kernel-Tracing"><a href="#Kernel-Tracing" class="headerlink" title="Kernel &amp; Tracing"></a>Kernel &amp; Tracing</h1><p>Cheat Card</p>
<ul>
<li>Kernel logs: <code>dmesg -T -l err,crit,alert,emerg</code></li>
<li>Syscalls: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file</code></li>
<li>Modules: <code>lsmod | head</code>, <code>modprobe &lt;name&gt;</code> (caution), <code>sysctl -a | grep tcp</code></li>
<li>Optional advanced:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">perf (<span class="keyword">if</span> installed)</span></span><br><span class="line">perf top</span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bpftrace one-liner (Requires: bpftrace)</span></span><br><span class="line">bpftrace -e &#x27;tracepoint:syscalls:sys_enter_openat &#123; @[comm] = count(); &#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-dmesg"><a href="#11-dmesg" class="headerlink" title="11. dmesg"></a>11. dmesg</h2><ul>
<li><p>Compat: Linux; May be restricted by <code>kernel.dmesg_restrict</code>; Requires: util-linux.</p>
</li>
<li><p><code>dmesg --level=&lt;LEVEL&gt;</code> where <code>&lt;LEVEL&gt;</code> is:</p>
<ul>
<li><code>emerg</code> - system is unusable.</li>
<li><code>alert</code> - action must be taken immediately.</li>
<li><code>crit</code> - critical conditions.</li>
<li><code>err</code> - error conditions.</li>
<li><code>warn</code> - warning conditions.</li>
<li><code>notice</code> - normal but significant condition.</li>
<li><code>info</code> - informational.</li>
<li><code>debug</code> - debug-level messages.</li>
</ul>
</li>
<li><p><code>dmesg -k</code>: print kernel messages</p>
</li>
<li><p><code>dmesg -f=&lt;FACILITY&gt;</code> where <code>&lt;FACILITY&gt;</code> is:</p>
<ul>
<li><code>kern</code>: Kernel messages.</li>
<li><code>user</code>: User-level messages.</li>
<li><code>mail</code>: Mail system.</li>
<li><code>daemon</code>: System daemons.</li>
<li><code>auth</code>: Security&#x2F;authorization messages.</li>
<li><code>syslog</code>: Internal syslogd messages.</li>
<li><code>lpr</code>: Line printer subsystem.</li>
<li><code>news</code>: Network news subsystem.</li>
</ul>
</li>
<li><p><code>dmesg -T</code>: human readable timestamps</p>
</li>
</ul>
<h2 id="12-lsmod"><a href="#12-lsmod" class="headerlink" title="12. lsmod"></a>12. lsmod</h2><ul>
<li>Compat: Linux; Lists modules without root; Requires: kmod.</li>
<li>Show loaded kernel modules and sizes&#x2F;dependencies.</li>
<li>Quick peek: <code>lsmod | head</code></li>
<li>Module info (version, params): <code>modinfo &lt;module&gt;</code></li>
</ul>
<h2 id="13-modprobe"><a href="#13-modprobe" class="headerlink" title="13. modprobe"></a>13. modprobe</h2><ul>
<li>Compat: Linux; Root required; Caution: can destabilize systems; Requires: kmod.Add or remove modules from the Linux kernel.</li>
<li>Load: <code>modprobe &lt;module&gt;</code>; with params: <code>modprobe &lt;module&gt; key=value</code></li>
<li>Unload: <code>modprobe -r &lt;module&gt;</code> (fails if in use)</li>
<li>Caution: loading&#x2F;unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</li>
</ul>
<h1 id="Disk-Filesystems"><a href="#Disk-Filesystems" class="headerlink" title="Disk &amp; Filesystems"></a>Disk &amp; Filesystems</h1><p>Cheat Card</p>
<ul>
<li>Space&#x2F;inodes: <code>df -h</code> and <code>df -i</code>; biggest dirs: <code>du -xhd1 /path | sort -h</code></li>
<li>IO saturation: <code>iostat -xz 1</code>; per-proc IO: <code>pidstat -d 1</code>, <code>iotop -oPa</code></li>
<li>Devices&#x2F;FS: <code>lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</code>; mounts: <code>findmnt</code></li>
<li>Mount ops: <code>mount --bind olddir newdir</code>; remount ro: <code>mount -o remount,ro /mnt</code></li>
</ul>
<p>Inventory and health</p>
<ul>
<li>Device tree: <code>lsblk -o NAME,TYPE,SIZE,FSTYPE,MOUNTPOINT,MODEL</code></li>
<li>Identify filesystem UUID&#x2F;TYPE: <code>blkid</code></li>
<li>SMART check (if supported): <code>smartctl -H /dev/sdX</code> and <code>smartctl -a /dev/sdX</code> (Requires: smartmontools)</li>
<li>NVMe info: <code>nvme list</code>; <code>nvme smart-log /dev/nvme0</code> (Requires: nvme-cli)</li>
</ul>
<p><strong>Notes</strong></p>
<ul>
<li>iostat quick view (Requires: sysstat): <code>iostat -xz 1</code> (watch <code>await</code>, <code>%util</code>, <code>r/s</code>, <code>w/s</code>)</li>
<li>findmnt: show mount hierarchy or lookup by target: <code>findmnt /mount/point</code></li>
<li>adds or removes modules from the Linux Kernel</li>
<li>Caution: loading&#x2F;unloading modules can destabilize systems; prefer persistent config and ensure module compatibility.</li>
</ul>
<h2 id="14-dd-DANGER-DESTRUCTIVE-—-READ-FIRST"><a href="#14-dd-DANGER-DESTRUCTIVE-—-READ-FIRST" class="headerlink" title="14. dd (DANGER: DESTRUCTIVE — READ FIRST)"></a>14. dd (DANGER: DESTRUCTIVE — READ FIRST)</h2><ul>
<li>Compat: Linux; Root required for raw devices; Highly destructive when writing; Requires: coreutils.</li>
<li>Danger: dd will overwrite data with no confirmation. Double-check devices (e.g., <code>/dev/sdX</code>) and consider read-only or safer alternatives first. Use <code>lsblk</code>, <code>blkid</code> to verify targets.</li>
<li>Safer tips: for copies, consider <code>pv</code> to visualize throughput; for imaging, <code>dcfldd</code>; for testing, prefer non-destructive reads.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: wipes target disk. Verify device with lsblk/blkid.</span></span><br><span class="line">dd if=/dev/zero of=/dev/sda bs=4k status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Verify a drive is zeroed (non-zero bytes check)</span></span><br><span class="line">dd if=/dev/sda status=none | hexdump -C | grep -q &#x27;[^00]&#x27; || echo &quot;All zeros&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Fill a file with random data (example size)</span></span><br><span class="line">dd if=/dev/urandom of=myfile bs=6703104 count=1 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: <span class="built_in">clone</span> a partition to another (same size/align). Verify both!</span></span><br><span class="line">dd if=/dev/sda3 of=/dev/sdb3 bs=4096 status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Danger: write an image to a USB device. Verify device path first!</span></span><br><span class="line">dd if=/path/to/bootimage.img of=/dev/sdc bs=4M status=progress conv=fsync</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Quick r/w benchmark <span class="keyword">for</span> a file (non-destructive <span class="built_in">read</span> + temp write)</span></span><br><span class="line">dd if=/home/$user/bigfile of=/dev/null status=progress</span><br><span class="line">dd if=/dev/zero of=/home/$user/bigfile bs=1M count=1000 oflag=dsync status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Sequential device <span class="built_in">read</span> throughput sample (approx 1 GiB)</span></span><br><span class="line">dd if=/dev/sda of=/dev/null bs=1024k count=1024 status=progress</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Create a swapfile (example: 8 GiB), <span class="keyword">then</span> mkswap + swapon</span></span><br><span class="line">dd if=/dev/zero of=swapfile bs=1MiB count=$((8*1024)) status=progress</span><br></pre></td></tr></table></figure>

<h2 id="15-jq"><a href="#15-jq" class="headerlink" title="15. jq"></a>15. jq</h2><ul>
<li>Compat: Linux; Requires: jq package.<br>What it does: parse&#x2F;query&#x2F;transform JSON on the command line. Requires: jq.</li>
<li>Pretty-print: <code>jq . file.json</code></li>
<li>Extract field list: <code>jq -r &#39;.items[].metadata.name&#39; file.json</code></li>
<li>Filter by condition: <code>jq &#39;.[] | select(.status==&quot;RUNNING&quot;)&#39; file.json</code></li>
<li>Transform and count: <code>jq &#39;[.[] | .level] | group_by(.) | map({level: .[0], count: length})&#39; file.json</code></li>
<li>Sort and top N: <code>jq &#39;sort_by(.time) | reverse | .[0:5]&#39; file.json</code></li>
<li>From journald: <code>journalctl -o json | jq -r &#39;select(.PRIORITY&lt;=3) | .MESSAGE&#39;</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: jq — show high-priority messages from journald</span></span><br><span class="line">journalctl -o json | jq -r &#x27;select(.PRIORITY&lt;=3) | .MESSAGE&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>Keys and length: <code>jq &#39;keys, length&#39; file.json</code></li>
</ul>
<h2 id="16-diff"><a href="#16-diff" class="headerlink" title="16. diff"></a>16. diff</h2><ul>
<li>Compat: Linux; Requires: diffutils.</li>
<li>unified diff: <code>diff -u old.txt new.txt</code></li>
<li>recursive dirs: <code>diff -ruN dir_old dir_new</code></li>
<li>ignore whitespace changes: <code>diff -u -w old new</code></li>
<li>handle CRLF: <code>diff -u --strip-trailing-cr a b</code></li>
<li>color (if supported): <code>diff --color=auto -u a b</code></li>
<li>apply a patch: <code>patch -p1 &lt; change.diff</code></li>
</ul>
<h2 id="17-uname"><a href="#17-uname" class="headerlink" title="17. uname"></a>17. uname</h2><ul>
<li>Compat: Linux; Requires: coreutils.</li>
<li>get all details about the computer</li>
</ul>
<h2 id="18-sync-fsync"><a href="#18-sync-fsync" class="headerlink" title="18. sync&#x2F;fsync"></a>18. sync&#x2F;fsync</h2><ul>
<li>Compat: Linux; <code>sync</code> is user command; <code>fsync</code> is a syscall.</li>
<li><code>fsync</code> is a syscall that flushes a file’s in-memory data and metadata to storage. From the shell, use <code>sync</code> (flush all dirty data) or <code>syncfs</code> (flush a filesystem) when available.</li>
</ul>
<h2 id="19-mkswap"><a href="#19-mkswap" class="headerlink" title="19. mkswap"></a>19. mkswap</h2><ul>
<li>Compat: Linux; Root required; Requires: util-linux.</li>
<li><code>-c</code>: check if blocks are corrupted</li>
<li><code>-p</code>: set pagesize</li>
</ul>
<h2 id="20-fsck"><a href="#20-fsck" class="headerlink" title="20. fsck"></a>20. fsck</h2><ul>
<li>Compat: Linux; Root required; Avoid on mounted filesystems; Requires: e2fsprogs for ext*.</li>
<li>check for file system consistency:<ul>
<li>The superblock is checked for inconsistencies in:<ul>
<li>File system size</li>
<li>Number of inodes</li>
<li>Free-block count</li>
<li>Free-inode count</li>
</ul>
</li>
<li>Each inode is checked for inconsistencies in:<ul>
<li>Format and type</li>
<li>Link count</li>
<li>Duplicate block</li>
<li>Bad block numbers</li>
<li>Inode size</li>
</ul>
</li>
</ul>
</li>
<li>see: <a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19455-01/805-7228/6j6q7uf0e/index.html">https://docs.oracle.com/cd/E19455-01/805-7228/6j6q7uf0e/index.html</a></li>
<li>Caution: avoid running fsck on a mounted filesystem (except with specific fs support); prefer read-only mounts or maintenance windows.</li>
</ul>
<p>Extended notes</p>
<ul>
<li>ext* specifics: <code>e2fsck</code> checks ext2&#x2F;3&#x2F;4; use <code>-f</code> to force, <code>-n</code> for read-only, <code>-p</code> for preen (auto-fix safe issues). Requires: e2fsprogs.</li>
<li>Bad blocks (DANGER): <code>badblocks</code> scans devices for bad sectors; write-mode is destructive. Prefer read-only first.</li>
</ul>
<p>Examples</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Read-only badblocks scan (non-destructive)</span></span><br><span class="line">sudo badblocks -sv /dev/sdX</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DANGER: write-mode destructive scan — data loss</span></span><br><span class="line">sudo badblocks -wsv /dev/sdX</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ext* filesystem check (read-only)</span></span><br><span class="line">sudo e2fsck -fn /dev/sdXN</span><br></pre></td></tr></table></figure>

<h2 id="21-mount"><a href="#21-mount" class="headerlink" title="21. mount"></a>21. mount</h2><ul>
<li>Compat: Linux; Root required unless user mounts configured; Requires: util-linux.</li>
<li><code>mount -a [-t type] [-O optlist]</code>: mount all FSs mentioned in fstab to be mounted</li>
<li><code>-o</code>: override the settings in fstab</li>
<li><code>mount --bind olddir newdir</code>: remount part of the hierarchy elsewhere</li>
<li><code>mount --move</code>: move mounted tree to another place</li>
<li>Caution: <code>--bind/--move</code> and remounts can impact running services; ensure correct <code>fstab</code> for persistence and have rollback plan.</li>
</ul>
<h2 id="22-umount"><a href="#22-umount" class="headerlink" title="22. umount"></a>22. umount</h2><ul>
<li>Compat: Linux; Root required for system mounts; Requires: util-linux.</li>
<li>unmount from a mountpoint</li>
</ul>
<h2 id="23-chown"><a href="#23-chown" class="headerlink" title="23. chown"></a>23. chown</h2><ul>
<li><code>chown root:staff /u</code>: change owner and group</li>
</ul>
<h2 id="24-sysctl"><a href="#24-sysctl" class="headerlink" title="24. sysctl"></a>24. sysctl</h2><ul>
<li>Compat: Linux; Root required for <code>-w</code>; Persistence via <code>/etc/sysctl.d</code>; Requires: procps.</li>
<li>configure kernel parameters at runtime</li>
<li><code>sysctl -a | grep &quot;tcp&quot;</code></li>
<li>Caution: <code>sysctl -w</code> changes take effect immediately; persist only via <code>/etc/sysctl.d/*.conf</code> after validation.</li>
<li>Read a key: <code>sysctl net.ipv4.tcp_congestion_control</code></li>
<li>Set a key (runtime): <code>sysctl -w vm.swappiness=10</code></li>
<li>Persist: create <code>/etc/sysctl.d/99-local.conf</code> with <code>vm.swappiness = 10</code>, then <code>sysctl --system</code></li>
</ul>
<h2 id="25-iotop"><a href="#25-iotop" class="headerlink" title="25. iotop"></a>25. iotop</h2><ul>
<li>Compat: Linux; Root required; Needs kernel taskstats&#x2F;delay accounting; Python tool.</li>
<li><code>iotop -o</code>: only show threads doing I&#x2F;O</li>
<li><code>iotop -p &lt;PID1&gt;,&lt;PID2&gt;,...</code>: list of processes to monitor</li>
<li><code>iotop -a</code>: show accumulated IO rather than diff Requires: iotop.</li>
</ul>
<h2 id="26-netstat"><a href="#26-netstat" class="headerlink" title="26. netstat"></a>26. netstat</h2><ul>
<li>Compat: Legacy; prefer <code>ss</code>; Requires: net-tools.</li>
</ul>
<h1 id="Processes-Scheduling"><a href="#Processes-Scheduling" class="headerlink" title="Processes &amp; Scheduling"></a>Processes &amp; Scheduling</h1><p>Cheat Card</p>
<ul>
<li>Top offenders: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code></li>
<li>Threads view: <code>top -H</code> or <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code></li>
<li>Target processes:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Preview before signaling</span></span><br><span class="line">pgrep -a &lt;name&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Then send a scoped, safe signal (example: TERM)</span></span><br><span class="line">pkill -TERM -u &lt;user&gt; -f &#x27;&lt;exact-pattern&gt;&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>Over time: <code>pidstat -u 1 -p &lt;pid&gt;</code> (CPU) and <code>pidstat -d 1</code> (IO)</li>
<li>Find PIDs: <code>pidof &lt;proc&gt;</code>; list threads: <code>ps -Lp &lt;pid&gt;</code></li>
<li>Niceness: start <code>nice -n 10 cmd</code>; adjust: <code>renice -n 10 -p &lt;pid&gt;</code></li>
<li>Locks: <code>/proc/locks</code> shows current file locks (read-only)</li>
<li>Sessions: users <code>who</code>; recent logins <code>last | head</code></li>
<li>Schedule: <code>crontab -l</code> list; <code>crontab -e</code> edit</li>
<li>Deprecated in many distros; prefer <code>ss</code>.</li>
<li>Common mappings:<ul>
<li><code>netstat -tulpn</code> -&gt; <code>ss -tulpn</code></li>
<li><code>netstat -anp</code> -&gt; <code>ss -anp</code></li>
<li><code>netstat -s</code> -&gt; <code>ss -s</code></li>
</ul>
</li>
</ul>
<h2 id="27-top"><a href="#27-top" class="headerlink" title="27. top"></a>27. top</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li>Dynamic process view with CPU, memory, and load summaries.</li>
<li>Key CPU line fields: <code>us</code> (user), <code>sy</code> (system), <code>ni</code>, <code>id</code> (idle), <code>wa</code> (iowait), <code>hi/si</code> (IRQ&#x2F;softIRQ), <code>st</code> (steal).</li>
<li>Key per-proc fields: <code>%CPU</code>, <code>%MEM</code>, <code>VIRT</code> (virtual), <code>RES</code> (resident), <code>SHR</code> (shared), <code>TIME+</code> (CPU time).</li>
<li><code>top -E m|g</code>: scale as mega|giga bytes</li>
<li><code>top -H</code>: thread-mode</li>
<li><code>top -i</code>: show idle processes</li>
<li><code>top -o RES|VIRT|SWAP</code>, etc: sort by attribute</li>
<li><code>top -O</code>: output fields: print all available sort-attributes</li>
<li><code>top -p pid1,pid2,...</code>: monitor only these PIDs</li>
<li><code>top -1</code>: show per-CPU stats</li>
</ul>
<h2 id="28-vmstat"><a href="#28-vmstat" class="headerlink" title="28. vmstat"></a>28. vmstat</h2><ul>
<li>Compat: Linux; Requires: procps.<br>Useful to get so&#x2F;si information</li>
<li>Report virtual memory statistics</li>
<li><code>vmstat -a</code>: number active&#x2F;inactive memory</li>
<li><code>vmstat --stats</code>: various statistics</li>
</ul>
<p>Interpretation tips</p>
<ul>
<li><code>r</code> runnable &gt; number of CPUs indicates run-queue contention.</li>
<li><code>b</code> blocked processes (often IO wait); correlate with <code>%wa</code> in top&#x2F;mpstat.</li>
<li><code>si/so</code> swap in&#x2F;out: sustained non-zero values indicate memory pressure.</li>
<li>Use <code>vmstat 1</code> for near-real-time view.</li>
</ul>
<h2 id="29-strace"><a href="#29-strace" class="headerlink" title="29. strace"></a>29. strace</h2><ul>
<li>Compat: Linux; May be restricted by ptrace scope; Requires: strace.<br>Trace system calls and signals.</li>
<li>Attach to a PID: <code>strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</code></li>
<li>Run a program under strace: <code>strace -o strace.log -s 200 -vv -f -ttT your_cmd --arg</code></li>
<li>Syscall time summary: <code>strace -c -p &lt;pid&gt;</code></li>
<li>Filter a path: <code>strace -ttT -e trace=file -P /etc/resolv.conf -p &lt;pid&gt;</code></li>
<li>Notes: <code>-f</code> follows forks; <code>-ttT</code> adds timestamps and syscall durations; <code>-s</code> increases string size.</li>
<li>trace system calls and signals</li>
</ul>
<h2 id="30-slabtop"><a href="#30-slabtop" class="headerlink" title="30. slabtop"></a>30. slabtop</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li><code>slabtop</code>: display kernel slab cache information in real time</li>
<li>Sort by size: <code>slabtop -s c</code>; one-shot: <code>slabtop -o</code></li>
</ul>
<h2 id="31-uptime"><a href="#31-uptime" class="headerlink" title="31. uptime"></a>31. uptime</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li>information about how long the system has been up, and load averages</li>
</ul>
<h2 id="32-htop"><a href="#32-htop" class="headerlink" title="32. htop"></a>32. htop</h2><ul>
<li>Compat: Linux; Requires: htop package.</li>
<li>like top, but prettier</li>
</ul>
<h2 id="33-ps"><a href="#33-ps" class="headerlink" title="33. ps"></a>33. ps</h2><ul>
<li>Compat: Linux; Requires: procps.<br>Cheat Card</li>
<li>Top CPU: <code>ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</code></li>
<li>Top RSS: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code></li>
<li>Tree view: <code>ps -ejH</code> (or <code>ps axjf</code>)</li>
<li>By command: <code>ps -C nginx -o pid,ppid,cmd,%mem,%cpu</code></li>
<li>Threads of a PID: <code>ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</code></li>
<li><code>ps aux</code>: show all processes</li>
<li><code>ps axjf</code> - print process tree</li>
<li><code>ps a</code> - Lift the BSD-style “only yourself” restriction</li>
<li><code>ps -A</code> - select all processes</li>
<li><code>ps -d</code> - select all processes except session leaders</li>
<li><code>ps g</code> - select all processes including session leaders</li>
<li><code>ps Ta</code> - all process associated with this terminal</li>
<li><code>ps r</code> - restrict to running processes</li>
<li><code>ps --pid pidlist</code> - restrict to pidlist processes</li>
<li><code>ps -s|--sid</code> - select by session ID</li>
<li><code>ps t ttylist</code> - select by TTY list</li>
<li><code>ps U|-U</code> - select by effective user-id</li>
<li><code>ps s</code> - display signals</li>
<li><code>ps f</code> - ASCII art process hierarchy</li>
<li><code>ps ax -o rss,pid,user,pcpu,command --sort -%cpu</code>: sort by %cpu</li>
<li><code>ps ax -o rss,pid,user,pcpu,command --sort -rss</code>: sort by rss</li>
</ul>
<p>process states:</p>
<ul>
<li><code>D</code> - uninterruptible sleep (usually IO)</li>
<li><code>I</code> - Idle kernel thread</li>
<li><code>R</code> - running or runnable (on run queue)</li>
<li><code>S</code> - interruptible sleep (waiting for an event to complete)</li>
<li><code>T</code> - stopped by job control signal</li>
<li><code>t</code> - stopped by debugger during the tracing</li>
<li><code>W</code> - paging (not valid since the 2.6.xx kernel)</li>
<li><code>X</code> - dead (should never be seen)</li>
<li><code>Z</code> - defunct (“zombie”) process, terminated but not reaped by its parent</li>
</ul>
<p>see STANDARD FORMAT SPECIFIERS in <code>man ps</code></p>
<h1 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h1><p>Cheat Card</p>
<ul>
<li>CPU saturation: <code>mpstat -P ALL 1</code> (sys&#x2F;iowait&#x2F;irq&#x2F;soft)</li>
<li>Per-core view in top: <code>top -1</code>; over time per PID: <code>pidstat -u 1 -p &lt;pid&gt;</code></li>
<li>Interrupt spikes: <code>mpstat -I CPU 1</code></li>
</ul>
<h2 id="34-mpstat"><a href="#34-mpstat" class="headerlink" title="34. mpstat"></a>34. mpstat</h2><ul>
<li>Compat: Linux; Requires: sysstat.</li>
</ul>
<p>The mpstat command writes to standard output activities for each available processor, processor 0 being the first one. Global average activities among all processors are also reported. Requires: sysstat.</p>
<p>Interpretation tips</p>
<ul>
<li>High <code>%iowait</code>: CPUs idle while waiting on disk IO (check iostat).</li>
<li>High <code>%irq/%soft</code>: heavy interrupts&#x2F;softirqs (often network or storage).</li>
<li>High <code>%steal</code>: hypervisor stealing time (noisy neighbor in a VM).</li>
<li>Compare per-core: hotspots can be isolated to specific cores (affinity).</li>
<li><code>CPU</code>: Processor number. The keyword all indicates that statistics are calculated as averages among all processors.</li>
<li><code>%usr</code>: Show the percentage of CPU utilization that occurred while executing at the user level (application).</li>
<li><code>%nice</code>: Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</li>
<li><code>%sys</code>: Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.</li>
<li><code>%iowait</code>: Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I&#x2F;O request.</li>
<li><code>%irq</code>: Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.</li>
<li><code>%soft</code>: Show the percentage of time spent by the CPU or CPUs to service software interrupts.</li>
<li><code>%steal</code>: Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</li>
<li><code>%guest</code>: Show the percentage of time spent by the CPU or CPUs to run a virtual processor.</li>
<li><code>%gnice</code>: Show the percentage of time spent by the CPU or CPUs to run a niced guest.</li>
<li><code>mpstat -I</code>: report interrupt stats<ul>
<li>of interrupts per CPU</li>
<li>of times a particular interrupt occurred</li>
</ul>
</li>
</ul>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Cheat Card</p>
<ul>
<li>Snapshot: <code>free -h --wide</code>; paging: <code>vmstat -a 1</code> (si&#x2F;so)</li>
<li>Per-proc memory: <code>ps -eo pid,user,rss,cmd --sort=-rss | head</code>; deep dive: <code>pmap -x &lt;pid&gt;</code></li>
<li>OOM evidence: <code>dmesg -T | grep -i oom</code> or <code>journalctl -k -g OOM</code></li>
</ul>
<h2 id="35-free"><a href="#35-free" class="headerlink" title="35. free"></a>35. free</h2><ul>
<li>Compat: Linux; Requires: procps.</li>
<li><code>used</code> - Used memory (calculated as total - free - buffers - cache)</li>
<li><code>free</code> - Unused memory (MemFree and SwapFree in &#x2F;proc&#x2F;meminfo)</li>
<li><code>shared</code> - Memory used (mostly) by tmpfs (Shmem in &#x2F;proc&#x2F;meminfo)</li>
<li><code>buffers</code> - Memory used by kernel buffers (Buffers in &#x2F;proc&#x2F;meminfo)</li>
<li><code>cache</code> - Memory used by the page cache and slabs (Cached and SReclaimable in &#x2F;proc&#x2F;meminfo)</li>
<li><code>buff/cache</code> - Sum of buffers and cache</li>
<li><code>available</code> - Estimation of how much memory is available for starting new applications, without swapping. Unlike the data provided by the cache or free fields, this field takes into account page cache and also that not all reclaimable memory slabs will be reclaimed due to items being in use (MemAvailable in &#x2F;proc&#x2F;meminfo, available on kernels 3.14, emulated on kernels 2.6.27+, otherwise the same as free)</li>
<li><code>free -l</code>: show low-high memory breakdown</li>
<li><code>free --wide</code>: show free memory stats<br>Interpretation tips</li>
<li><code>available</code> approximates memory free for new apps without swapping; don’t confuse <code>free</code> with usable memory.</li>
<li>High <code>buff/cache</code> is normal; it’s the page cache and reclaimable slabs.<br>Examples</li>
<li>Human-readable snapshot: <code>free -h --wide</code></li>
<li>Example output:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           31Gi        2.1Gi       22Gi        312Mi       7.2Gi        28Gi</span><br><span class="line">Swap:           8Gi           0B        8Gi</span><br></pre></td></tr></table></figure>

<h2 id="36-sar"><a href="#36-sar" class="headerlink" title="36. sar"></a>36. sar</h2><ul>
<li><p>Compat: Linux; Requires: sysstat; history needs <code>sadc</code> enabled.<br>Cheat Card</p>
</li>
<li><p>CPU load&#x2F;queue: <code>sar -q 1 5</code>; memory: <code>sar -r 1 5</code></p>
</li>
<li><p>IO bw&#x2F;ops: <code>sar -b 1 5</code>; per-device: <code>sar -d 1 5</code> (watch <code>await</code>, <code>%util</code>)</p>
</li>
<li><p>Network: <code>sar -n DEV 1 5</code>; TCP: <code>sar -n TCP,ETCP 1 5</code></p>
</li>
<li><p>Paging: <code>sar -B 1 5</code> (<code>pgsteal</code>, <code>pgscan</code>, <code>majflt/s</code>)<br>Requires: sysstat (includes pidstat).<br>Field reference (click to expand)</p>
</li>
<li><p><code>sar -B</code>: report paging stats</p>
<ul>
<li><code>gpgin/s</code> - Total number of kilobytes the system paged in from disk per second.</li>
<li><code>pgpgout/s</code> - Total number of kilobytes the system paged out to disk per second.</li>
</ul>
</li>
<li><p><code>fault/s</code> - Number of page faults (major + minor) made by the system per second. This is not a count of page faults that generate I&#x2F;O, because some page faults can be resolved without I&#x2F;O.</p>
<ul>
<li><code>majflt/s</code> - Number of major faults the system has made per second, those which have required loading a memory page from disk.</li>
<li><code>pgfree/s</code> - Number of pages placed on the free list by the system per second.</li>
<li><code>pgscank/s</code> - Number of pages scanned by the kswapd daemon per second.</li>
<li><code>pgscand/s</code> - Number of pages scanned directly per second.</li>
<li><code>pgsteal/s</code> - Number of pages the system has reclaimed from cache (pagecache and swapcache) per second to satisfy its memory demands.</li>
<li><code>%vmeff</code> - Calculated as pgsteal &#x2F; pgscan, this is a metric of the efficiency of page reclaim. If it is near 100% then almost every page coming off the tail of the inactive list is being reaped. If it gets too low (e.g. less than 30%) then the virtual memory is having some difficulty. This field is displayed as zero if no pages have been scanned during the interval of time.</li>
</ul>
</li>
<li><p><code>sar -b</code>: Report I&#x2F;O and transfer rate statistics.</p>
<ul>
<li><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I&#x2F;O request to a physical device. Multiple logical requests can be combined into a single I&#x2F;O request to the device. A transfer is of indeterminate size.</li>
<li><code>rtps</code> - Total number of read requests per second issued to physical devices.</li>
<li><code>wtps</code> - Total number of write requests per second issued to physical devices.</li>
<li><code>bread/s</code> - Total amount of data read from the devices in blocks per second. Blocks are equivalent to sectors and therefore have a size of 512 bytes.</li>
<li><code>bwrtn/s</code> - Total amount of data written to devices in blocks per second.</li>
</ul>
</li>
<li><p><code>sar -d</code>: report activity for each block device</p>
</li>
<li><p><code>tps</code> - Total number of transfers per second that were issued to physical devices. A transfer is an I&#x2F;O request to a physical device. Multiple logical requests can be combined into a single I&#x2F;O request to the device. A transfer is of indeterminate size.</p>
<ul>
<li><code>rkB/s</code> - Number of kilobytes read from the device per second.</li>
<li><code>wkB/s</code> - Number of kilobytes written to the device per second.</li>
<li><code>areq-sz</code> - The average size (in kilobytes) of the I&#x2F;O requests that were issued to the device. Note: In previous versions, this field was known as avgrq-sz and was expressed in sectors.</li>
<li><code>aqu-sz</code> - The average queue length of the requests that were issued to the device. Note: In previous versions, this field was known as avgqu-sz.</li>
<li><code>await</code> - The average time (in milliseconds) for I&#x2F;O requests issued to the device to be served. This includes the time spent by the requests in queue and the time spent servicing them.</li>
<li><code>svctm</code> - The average service time (in milliseconds) for I&#x2F;O requests that were issued to the device. Warning! Do not trust this field any more. This field will be removed in a future sysstat version.</li>
<li><code>%util</code> - Percentage of elapsed time during which I&#x2F;O requests were issued to the device (bandwidth utilization for the device). Device saturation occurs when this value is close to 100% for devices serving requests serially. But for devices serving requests in parallel, such as RAID arrays and modern SSDs, this number does not reflect their performance limits.</li>
</ul>
</li>
<li><p><code>sar -F</code>: display stats. for currently mounted FSs:</p>
<ul>
<li><code>MBfsfree</code> - Total amount of free space in megabytes (including space available only to privileged user).</li>
<li><code>MBfsused</code> - Total amount of space used in megabytes.</li>
<li><code>%fsused</code> - Percentage of filesystem space used, as seen by a privileged user.</li>
<li><code>%ufsused</code> - Percentage of filesystem space used, as seen by an unprivileged user.</li>
<li><code>Ifree</code> - Total number of free file nodes in filesystem.</li>
<li><code>Iused</code> - Total number of file nodes used in filesystem.</li>
<li><code>%Iused</code> - Percentage of file nodes used in filesystem.</li>
</ul>
</li>
<li><p><code>sar -m</code>: power management statistics:</p>
<ul>
<li><code>MHz</code> - Instantaneous CPU clock frequency in MHz.<br>  With the FAN keyword, statistics about fans speed are reported. The following values are displayed:</li>
<li><code>rpm</code> - Fan speed expressed in revolutions per minute.</li>
<li><code>drpm</code> - This field is calculated as the difference between current fan speed (rpm) and its low limit (fan_min).</li>
<li><code>DEVICE</code> - Sensor device name.<br>  With the FREQ keyword, statistics about CPU clock frequency are reported. The following value is displayed:</li>
<li><code>wghMHz</code> - Weighted average CPU clock frequency in MHz. Note that the cpufreq-stats driver must be compiled in the kernel for this option to work.</li>
</ul>
<p>  With the IN keyword, statistics about voltage inputs are reported. The following values are displayed:</p>
<ul>
<li><code>inV</code> - Voltage input expressed in Volts.</li>
<li><code>%in</code> - Relative input value. A value of 100% means that voltage input has reached its high limit (in_max) whereas a value of 0% means that it has reached its low limit (in_min).</li>
<li><code>DEVICE</code> - Sensor device name.</li>
</ul>
<p>  With the USB keyword, the sar command takes a snapshot of all the USB devices currently plugged into the system. At the end of the report, sar will display a summary of all those USB devices. The following values are displayed:</p>
<ul>
<li><code>BUS</code> - Root hub number of the USB device.</li>
<li><code>idvendor</code> - Vendor ID number (assigned by USB organization).</li>
<li><code>idprod</code> - Product ID number (assigned by Manufacturer).</li>
<li><code>maxpower</code> - Maximum power consumption of the device (expressed in mA).</li>
<li><code>manufact</code> - Manufacturer name.</li>
<li><code>product</code> - Product name.</li>
</ul>
</li>
<li><p><code>sar -n DEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxpck/s</code> - Total number of packets received per second.</li>
<li><code>txpck/s</code> - Total number of packets transmitted per second.</li>
<li><code>rxkB/s</code> - Total number of kilobytes received per second.</li>
<li><code>txkB/s</code> - Total number of kilobytes transmitted per second.</li>
<li><code>rxcmp/s</code> - Number of compressed packets received per second (for cslip etc.).</li>
<li><code>txcmp/s</code> - Number of compressed packets transmitted per second.</li>
<li><code>rxmcst/s</code> - Number of multicast packets received per second.</li>
<li><code>%ifutil</code> - Utilization percentage of the network interface. For half-duplex interfaces, utilization is calculated using the sum of rxkB&#x2F;s and txkB&#x2F;s as a percentage of the interface speed. For full-duplex, this is the greater of rxkB&#x2F;S or txkB&#x2F;s.</li>
</ul>
</li>
<li><p><code>sar -n EDEV</code>:</p>
<ul>
<li><code>IFACE</code> - Name of the network interface for which statistics are reported.</li>
<li><code>rxerr/s</code> - Total number of bad packets received per second.</li>
<li><code>txerr/s</code> - Total number of errors that happened per second while transmitting packets.</li>
<li><code>coll/s</code> - Number of collisions that happened per second while transmitting packets.</li>
<li><code>rxdrop/s</code> - Number of received packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txdrop/s</code> - Number of transmitted packets dropped per second because of a lack of space in linux buffers.</li>
<li><code>txcarr/s</code> - Number of carrier-errors that happened per second while transmitting packets.</li>
<li><code>rxfram/s</code> - Number of frame alignment errors that happened per second on received packets.</li>
<li><code>rxfifo/s</code> - Number of FIFO overrun errors that happened per second on received packets.</li>
<li><code>txfifo/s</code> - Number of FIFO overrun errors that happened per second on transmitted packets.</li>
</ul>
</li>
<li><p><code>sar -n ICMP</code>:</p>
<ul>
<li><code>imsg/s</code> - The total number of ICMP messages which the entity received per second [icmpInMsgs]. Note that this counter includes all those counted by ierr&#x2F;s.</li>
<li><code>omsg/s</code> - The total number of ICMP messages which this entity attempted to send per second [icmpOutMsgs]. Note that this counter includes all those counted by oerr&#x2F;s.</li>
<li><code>iech/s</code> - The number of ICMP Echo (request) messages received per second [icmpInEchos].</li>
<li><code>iechr/s</code> - The number of ICMP Echo Reply messages received per second [icmpInEchoReps].</li>
<li><code>oech/s</code> - The number of ICMP Echo (request) messages sent per second [icmpOutEchos].</li>
<li><code>oechr/s</code> - The number of ICMP Echo Reply messages sent per second [icmpOutEchoReps].</li>
<li><code>itm/s</code> - The number of ICMP Timestamp (request) messages received per second [icmpInTimestamps].</li>
<li><code>itmr/s</code> - The number of ICMP Timestamp Reply messages received per second [icmpInTimestampReps].</li>
<li><code>otm/s</code> - The number of ICMP Timestamp (request) messages sent per second [icmpOutTimestamps].</li>
<li><code>otmr/s</code> - The number of ICMP Timestamp Reply messages sent per second [icmpOutTimestampReps].</li>
<li><code>iadrmk/s</code> - The number of ICMP Address Mask Request messages received per second [icmpInAddrMasks].</li>
<li><code>oadrmk/s</code> - The number of ICMP Address Mask Request messages sent per second [icmpOutAddrMasks].</li>
<li><code>oadrmkr/s</code> - The number of ICMP Address Mask Reply messages sent per second [icmpOutAddrMaskReps].</li>
</ul>
</li>
<li><p><code>sar -n EICMP</code>: Extended ICMP stats (errors, dest unreachable, time exceeded). Focus on spikes in <code>ierr/s</code> and <code>oerr/s</code>, and patterns in unreachable&#x2F;time- exceeded when debugging path issues.</p>
</li>
<li><p><code>sar -n EIP</code>: Extended IPv4 stats (header errors, addr errors, discards, no routes, reassembly, fragment fails). Use to spot header errors and routing&#x2F; no-route conditions.</p>
</li>
<li><p><code>sar -n IP6</code>: IPv6 per-protocol counters (receive&#x2F;deliver&#x2F;forward, multicast, fragmentation). Check for anomalies similar to IPv4.</p>
</li>
<li><p><code>sar -n EIP6</code>: Extended IPv6 errors and routing stats (header&#x2F;addr errors, discards, no routes, reassembly&#x2F;frag). Useful for IPv6-specific troubleshooting.</p>
</li>
<li><p><code>sar -n SOCK</code>:</p>
<ul>
<li><code>totsck</code> - Total number of sockets used by the system.</li>
<li><code>tcpsck</code> - TCP sockets in use; <code>tcp-tw</code> - TIME_WAIT sockets.</li>
</ul>
</li>
<li><p><code>sar -n SOFT</code>:</p>
<ul>
<li><code>total/s</code> - The total number of network frames processed per second.</li>
<li><code>dropd/s</code> - The total number of network frames dropped per second because there was no room on the processing queue.</li>
<li><code>squeezd/s</code> - The number of times the softirq handler function terminated per second because its budget was consumed or the time limit was reached, but more work could have been done.</li>
<li><code>rx_rps/s</code> - The number of times the CPU has been woken up per second to process packets via an inter-processor interrupt.</li>
<li><code>flw_lim/s</code> - The number of times the flow limit has been reached per second. Flow limiting is an optional RPS feature that can be used to limit the number of packets queued to the backlog for each flow to a certain amount. This can help ensure that smaller flows are processed even though much larger flows are pushing packets in.</li>
</ul>
</li>
<li><p><code>sar -n TCP</code>:</p>
<ul>
<li><code>active/s</code> - The number of times TCP connections have made a direct transition to the SYN-SENT state from the CLOSED state per second [tcpActiveOpens].</li>
<li><code>passive/s</code> - The number of times TCP connections have made a direct transition to the SYN-RCVD state from the LISTEN state per second [tcpPassiveOpens].</li>
<li><code>iseg/s</code> - The total number of segments received per second, including those received in error [tcpInSegs]. This count includes segments received on currently established connections.</li>
<li><code>oseg/s</code> - The total number of segments sent per second, including those on current connections but excluding those containing only retransmitted octets [tcpOutSegs].</li>
</ul>
</li>
<li><p><code>sar -n ETCP</code>:</p>
<ul>
<li><code>atmptf/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the SYN-SENT state or the SYN-RCVD state, plus the number of times per second TCP connections have made a direct transition to the LISTEN state from the SYN-RCVD state [tcpAttemptFails].</li>
<li><code>estres/s</code> - The number of times per second TCP connections have made a direct transition to the CLOSED state from either the ESTABLISHED state or the CLOSE-WAIT state [tcpEstabResets].</li>
<li><code>retrans/s</code> - The total number of segments retransmitted per second - that is, the number of TCP segments transmitted containing one or more previously transmitted octets [tcpRetransSegs].</li>
<li><code>isegerr/s</code> - The total number of segments received in error (e.g., bad TCP checksums) per second [tcpInErrs].</li>
<li><code>orsts/s</code> - The number of TCP segments sent per second containing the RST flag [tcpOutRsts].</li>
</ul>
</li>
<li><p><code>sar -n UDP</code>:</p>
<ul>
<li><code>idgm/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmerr/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul>
</li>
<li><p><code>sar -n UDP6</code>:</p>
<ul>
<li><code>idgm6/s</code> - The total number of UDP datagrams delivered per second to UDP users [udpInDatagrams].</li>
<li><code>odgm6/s</code> - The total number of UDP datagrams sent per second from this entity [udpOutDatagrams].</li>
<li><code>noport6/s</code> - The total number of received UDP datagrams per second for which there was no application at the destination port [udpNoPorts].</li>
<li><code>idgmer6/s</code> - The number of received UDP datagrams per second that could not be delivered for reasons other than the lack of an application at the destination port [udpInErrors].</li>
</ul>
</li>
<li><p><code>sar -q</code>:</p>
<ul>
<li><code>runq-sz</code> - Run queue length (number of tasks waiting for run time).</li>
<li><code>plist-sz</code> - Number of tasks in the task list.</li>
<li><code>ldavg-1</code> - System load average for the last minute. The load average is calculated as the average number of runnable or running tasks (R state), and the number of tasks in uninterruptible sleep (D state) over the specified interval.</li>
<li><code>ldavg-5</code> - System load average for the past 5 minutes.</li>
<li><code>ldavg-15</code> - System load average for the past 15 minutes.</li>
<li><code>blocked</code> - Number of tasks currently blocked, waiting for I&#x2F;O to complete.</li>
</ul>
</li>
<li><p><code>sar -r</code>:</p>
<ul>
<li><code>kbmemfree</code> - Amount of free memory available in kilobytes.</li>
<li><code>kbavail</code> - Estimate of how much memory in kilobytes is available for starting new applications, without swapping. The estimate takes into account that the system needs some page cache to function well, and that not all reclaimable memory slabs will be reclaimable, due to items being in use. The impact of those factors will vary from system to system.</li>
</ul>
</li>
<li><p><code>kbmemused</code> - Amount of used memory in kilobytes (calculated as total installed memory - kbmemfree - kbbuffers - kbcached - kbslab).</p>
<ul>
<li><code>%memused</code> - Percentage of used memory.</li>
<li><code>kbbuffers</code> - Amount of memory used as buffers by the kernel in kilobytes.</li>
<li><code>kbcached</code> - Amount of memory used to cache data by the kernel in kilobytes.</li>
</ul>
</li>
<li><p><code>kbcommit</code> - Amount of memory in kilobytes needed for current workload. This is an estimate of how much RAM&#x2F;swap is needed to guarantee that there never is out of memory.</p>
</li>
<li><p><code>%commit</code> - Percentage of memory needed for current workload in relation to the total amount of memory (RAM+swap). This number may be greater than 100% because the kernel usually overcommits memory.</p>
</li>
<li><p><code>kbactive</code> - Amount of active memory in kilobytes (memory that has been used more recently and usually not reclaimed unless absolutely necessary).</p>
</li>
<li><p><code>kbinact</code> - Amount of inactive memory in kilobytes (memory which has been less recently used. It is more eligible to be reclaimed for other purposes).</p>
<ul>
<li><code>kbdirty</code> - Amount of memory in kilobytes waiting to get written back to the disk.</li>
<li><code>kbanonpg</code> - Amount of non-file backed pages in kilobytes mapped into userspace page tables.</li>
<li><code>kbslab</code> - Amount of memory in kilobytes used by the kernel to cache data structures for its own use.</li>
<li><code>kbkstack</code> - Amount of memory in kilobytes used for kernel stack space.</li>
<li><code>kbpgtbl</code> - Amount of memory in kilobytes dedicated to the lowest level of page tables.</li>
<li><code>kbvmused</code> - Amount of memory in kilobytes of used virtual address space.</li>
</ul>
</li>
<li><p><code>sar -S</code>:</p>
<ul>
<li><code>kbswpfree</code> - Amount of free swap space in kilobytes.</li>
<li><code>kbswpused</code> - Amount of used swap space in kilobytes.</li>
<li><code>%swpused</code> - Percentage of used swap space.</li>
</ul>
</li>
<li><p><code>kbswpcad</code> - Amount of cached swap memory in kilobytes. This is memory that once was swapped out, is swapped back in but still also is in the swap area (if memory is needed it doesn’t need to be swapped out again because it is already in the swap area. This saves I&#x2F;O).</p>
<ul>
<li><code>%swpcad</code> - Percentage of cached swap memory in relation to the amount of used swap space.</li>
</ul>
</li>
<li><p><code>sar -u</code>:</p>
</li>
<li><p><code>%user</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field includes time spent running virtual processors.</p>
</li>
<li><p><code>%usr</code> - Percentage of CPU utilization that occurred while executing at the user level (application). Note that this field does NOT include time spent running virtual processors.</p>
</li>
<li><p><code>%nice</code> - Percentage of CPU utilization that occurred while executing at the user level with nice priority.</p>
</li>
<li><p><code>%system</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field includes time spent servicing hardware and software interrupts.</p>
</li>
<li><p><code>%sys</code> - Percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this field does NOT include time spent servicing hardware or software interrupts.</p>
</li>
<li><p><code>%iowait</code> - Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I&#x2F;O request.</p>
</li>
<li><p><code>%steal</code> - Percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</p>
<ul>
<li><code>%irq</code> - Percentage of time spent by the CPU or CPUs to service hardware interrupts.</li>
<li><code>%soft</code> - Percentage of time spent by the CPU or CPUs to service software interrupts.</li>
<li><code>%guest</code> - Percentage of time spent by the CPU or CPUs to run a virtual processor.</li>
<li><code>%gnice</code> - Percentage of time spent by the CPU or CPUs to run a niced guest.</li>
</ul>
</li>
<li><p><code>%idle</code> - Percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I&#x2F;O request.</p>
</li>
<li><p><code>sar -v</code>:</p>
<ul>
<li><code>dentunusd</code> - Number of unused cache entries in the directory cache.</li>
<li><code>file-nr</code> - Number of file handles used by the system.</li>
<li><code>inode-nr</code> - Number of inode handlers used by the system.</li>
<li><code>pty-nr</code> - Number of pseudo-terminals used by the system.</li>
</ul>
</li>
<li><p><code>sar -W</code>: Report swapping statistics. The following values are displayed:</p>
<ul>
<li><code>pswpin/s</code> - Total number of swap pages the system brought in per second.</li>
<li><code>pswpout/s</code> - Total number of swap pages the system brought out per second.</li>
</ul>
</li>
<li><p><code>sar -w</code>: Report task creation and system switching activity.</p>
<ul>
<li><code>proc/s</code> - Tasks created per second; <code>cswch/s</code> - context switches per second.</li>
</ul>
</li>
<li><p><code>sar -y</code>: Report TTY devices activity. The following values are displayed:</p>
</li>
<li><p><code>rcvin/s</code> - Number of receive interrupts per second for current serial line. Serial line number is given in the TTY column.</p>
<ul>
<li><code>xmtin/s</code> - Number of transmit interrupts per second for current serial line.</li>
<li><code>framerr/s</code> - Number of frame errors per second for current serial line.</li>
<li><code>prtyerr/s</code> - Number of parity errors per second for current serial line.</li>
<li><code>brk/s</code> - Number of breaks per second for current serial line.</li>
<li><code>ovrun/s</code> - Number of overrun errors per second for current serial line.</li>
</ul>
</li>
</ul>
<h2 id="45-pidstat"><a href="#45-pidstat" class="headerlink" title="45. pidstat"></a>45. pidstat</h2><ul>
<li>Compat: Linux; Requires: sysstat.</li>
<li>monitor individual tasks currently being managed Requires: sysstat.</li>
</ul>
<p>Cheat Card</p>
<ul>
<li>CPU by PID: <code>pidstat -u 1 -p &lt;pid&gt;</code> (watch <code>%usr/%system/%wait</code>)</li>
<li>IO by PID: <code>pidstat -d 1 -p &lt;pid&gt;</code> (check <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code>)</li>
<li>Memory faults: <code>pidstat -r 1 -p &lt;pid&gt;</code> (watch <code>majflt/s</code>)</li>
<li>Threads: <code>pidstat -t -u 1 -p &lt;pid&gt;</code></li>
<li><code>pidstat -d</code>:<ul>
<li>Key fields: <code>kB_rd/s</code>, <code>kB_wr/s</code>, <code>iodelay</code> (IO wait), <code>kB_ccwr/s</code> (cancelled writes).</li>
</ul>
</li>
<li><code>pidstat -R</code>: Report realtime priority and scheduling policy information. The following values may be displayed:<ul>
<li>Key fields: <code>prio</code>, <code>policy</code>.</li>
</ul>
</li>
<li><code>pidstat -r</code>: Report page faults and memory utilization.<br>  When reporting statistics for individual tasks, the following values may be displayed:<ul>
<li>Key fields: <code>majflt/s</code> (major faults), <code>RSS</code>, <code>%MEM</code>.<br>  When reporting global statistics for tasks and all their children, the following values may be displayed:</li>
<li>With children: <code>majflt-nr</code>, <code>minflt-nr</code> summarize faults.</li>
</ul>
</li>
<li><code>pidstat -s</code>: Report stack utilization. The following values may be displayed:<ul>
<li>Key fields: <code>StkRef</code> (used), <code>StkSize</code> (reserved).</li>
</ul>
</li>
<li><code>pidstat -t</code>: Also display statistics for threads associated with selected tasks. List process and threads</li>
<li><code>pidstat -u</code>: Report CPU utilization.<br>  When reporting statistics for individual tasks, the following values may be displayed:<ul>
<li>Key fields: <code>%usr</code>, <code>%system</code>, <code>%wait</code>, <code>%CPU</code>, <code>CPU</code>.<br>  When reporting global statistics for tasks and all their children, the following values may be displayed:</li>
<li>With children: <code>usr-ms</code>, <code>system-ms</code>, <code>guest-ms</code> summarize CPU time.</li>
</ul>
</li>
</ul>
<h2 id="46-lsof"><a href="#46-lsof" class="headerlink" title="46. lsof"></a>46. lsof</h2><ul>
<li>Compat: Linux; May require root to see all descriptors; Requires: lsof.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># List all open files</span><br><span class="line">lsof</span><br><span class="line"></span><br><span class="line"># Processes using a file? (fuser equivalent)</span><br><span class="line">lsof /path/to/file</span><br><span class="line"></span><br><span class="line"># Open files within a directory</span><br><span class="line">lsof +D /path</span><br><span class="line"></span><br><span class="line"># Files by user</span><br><span class="line">lsof -u name</span><br><span class="line">lsof -u name1,name2</span><br><span class="line">lsof -u name1 -u name2</span><br><span class="line"></span><br><span class="line"># By program name</span><br><span class="line">lsof -c apache</span><br><span class="line"></span><br><span class="line"># AND&#x27;ing selection conditions</span><br><span class="line">lsof -u www-data -c apache</span><br><span class="line"></span><br><span class="line"># By pid</span><br><span class="line">lsof -p 1</span><br><span class="line"></span><br><span class="line"># Except certain pids</span><br><span class="line">lsof -p ^1</span><br><span class="line"></span><br><span class="line"># TCP and UDP connections</span><br><span class="line">lsof -i</span><br><span class="line">lsof -i tcp # TCP connections</span><br><span class="line">lsof -i udp # UDP connections</span><br><span class="line"></span><br><span class="line"># By port</span><br><span class="line">lsof -i :25</span><br><span class="line">lsof -i :smtp</span><br><span class="line">lsof -i udp:53</span><br><span class="line">lsof -i tcp:80</span><br><span class="line"></span><br><span class="line"># All network activity by a user</span><br><span class="line">lsof -a -u name1 -i</span><br><span class="line"></span><br><span class="line">lsof -N # NFS use</span><br><span class="line">lsof -U # UNIX domain socket use</span><br><span class="line"></span><br><span class="line"># List PIDs</span><br><span class="line">lsof -t -i</span><br><span class="line"># Danger: broad kill; preview and scope carefully before use</span><br><span class="line">kill -9 $(lsof -t -i) # Kill all programs w/network activity</span><br></pre></td></tr></table></figure>

<p>Requires: lsof.</p>
<h2 id="51-pmap"><a href="#51-pmap" class="headerlink" title="51. pmap"></a>51. pmap</h2><ul>
<li>Compat: Linux; Requires: procps; <code>-X</code> needs procps-ng.</li>
<li><code>pmap 29740 -X</code>: show Address,Perm,Offset,Device,Inode,Size,Rss,Pss,Referenced,Anonymous,LazyFree, ShmemPmdMapped,Shared_Hugetlb,Private_Hugetlb,Swap,SwapPss,Locked,THPeligible, Mapping Requires: procps.<br>Common recipes</li>
<li>Largest mappings first: <code>pmap -x &lt;pid&gt; | sort -nrk 3 | head</code> (by RSS KB)</li>
<li>Totals summary: <code>pmap &lt;pid&gt;</code> (last line shows total)</li>
</ul>
<h2 id="52-blktrace"><a href="#52-blktrace" class="headerlink" title="52. blktrace"></a>52. blktrace</h2><ul>
<li>Compat: Linux; Root required; Needs kernel block trace support; Requires: blktrace.</li>
<li>blktrace is a block layer IO tracing mechanism which provides detailed information about request queue operations up to user space. There are three major components: a kernel component, a utility to record the i&#x2F;o trace information for the kernel to user space, and utilities to analyse and view the trace information.</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Trace block I/O on /dev/sda and parse</span></span><br><span class="line">sudo blktrace -d /dev/sda -o - | blkparse -i -</span><br></pre></td></tr></table></figure>
<p>Requires: blktrace.<br>outputs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">CPU0 (8,0):</span><br><span class="line"> Reads Queued:         385,     1540KiB     Writes Queued:           0,        0KiB</span><br><span class="line"> Read Dispatches:       75,     1544KiB     Write Dispatches:        4,       16KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:          315,     1260KiB     Write Merges:            0,        0KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            63             Timer unplugs:           0</span><br><span class="line">CPU1 (8,0):</span><br><span class="line"> Reads Queued:         406,     1624KiB     Writes Queued:          13,      996KiB</span><br><span class="line"> Read Dispatches:       71,     1620KiB     Write Dispatches:       10,      992KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          336,     1344KiB     Write Merges:            2,      200KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:            68             Timer unplugs:           0</span><br><span class="line">CPU2 (8,0):</span><br><span class="line"> Reads Queued:        1531,     6152KiB     Writes Queued:          30,      120KiB</span><br><span class="line"> Read Dispatches:      257,     6152KiB     Write Dispatches:        3,      108KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:         1277,     5108KiB     Write Merges:           24,       96KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           255             Timer unplugs:           0</span><br><span class="line">CPU3 (8,0):</span><br><span class="line"> Reads Queued:        1266,     5852KiB     Writes Queued:          23,       92KiB</span><br><span class="line"> Read Dispatches:      279,     5852KiB     Write Dispatches:       21,       92KiB</span><br><span class="line"> Reads Requeued:         0         Writes Requeued:         0</span><br><span class="line"> Reads Completed:        0,        0KiB     Writes Completed:        0,        0KiB</span><br><span class="line"> Read Merges:          987,     3948KiB     Write Merges:            2,        8KiB</span><br><span class="line"> Read depth:            84             Write depth:            21</span><br><span class="line"> IO unplugs:           279             Timer unplugs:           1</span><br><span class="line"></span><br><span class="line">Total (8,0):</span><br><span class="line"> Reads Queued:        3588,    15168KiB     Writes Queued:          66,     1208KiB</span><br><span class="line"> Read Dispatches:      682,    15168KiB     Write Dispatches:       38,     1208KiB</span><br><span class="line"> Reads Requeued:         1         Writes Requeued:         0</span><br><span class="line"> Reads Completed:      681,    15168KiB     Writes Completed:       42,     1208KiB</span><br><span class="line"> Read Merges:         2915,    11660KiB     Write Merges:           28,      304KiB</span><br><span class="line"> IO unplugs:           665             Timer unplugs:           1</span><br></pre></td></tr></table></figure>

<h2 id="53-btrace"><a href="#53-btrace" class="headerlink" title="53. btrace"></a>53. btrace</h2><ul>
<li>Compat: Linux; Wrapper script from blktrace; Root required.</li>
<li>The btrace script provides a quick and easy way to do live tracing of block devices. It calls blktrace on the specified devices and pipes the output through blkparse for formatting. See blktrace (8) for more in-depth information about how blktrace works.</li>
<li><code>btrace /dev/sda</code> Requires: blktrace.</li>
</ul>
<h2 id="54-tr"><a href="#54-tr" class="headerlink" title="54. tr"></a>54. tr</h2><ul>
<li>Compat: Linux; Requires: coreutils.<br>Translate, squeeze, and&#x2F;or delete characters from standard input, writing to standard output.</li>
<li><code>tr &#39;\n&#39; &#39;,&#39;</code>: convert new lines to commas</li>
<li>squeeze repeats: <code>tr -s &#39; &#39; &lt; file</code> (collapse runs of spaces)</li>
<li>delete chars: <code>tr -d &#39;\r&#39; &lt; file</code> (remove CR)</li>
<li>keep only printable: <code>tr -cd &#39;[:print:]\n&#39; &lt; file</code></li>
<li>case convert: <code>tr &#39;[:upper:]&#39; &#39;[:lower:]&#39; &lt; file</code></li>
</ul>
<h2 id="55-cut"><a href="#55-cut" class="headerlink" title="55. cut"></a>55. cut</h2><ul>
<li>Compat: Linux; Requires: coreutils.</li>
<li>select CSV fields: <code>cut -d, -f1,3 file.csv</code></li>
<li>ranges: <code>cut -d: -f1-3 /etc/passwd</code></li>
<li>bytes&#x2F;chars: <code>cut -b1-10 file</code>; <code>cut -c1-20 file</code></li>
<li>complement: <code>cut -d, -f1 --complement file.csv</code></li>
<li>with headers: pair with <code>head -1</code> to see column indexes</li>
</ul>
<h2 id="56-xargs"><a href="#56-xargs" class="headerlink" title="56. xargs"></a>56. xargs</h2><ul>
<li>Compat: Linux; Requires: findutils; GNU <code>-r</code> may vary on BusyBox.<br>Build and run argument lists; combine with <code>find</code> and null-terminated records for safety.</li>
<li>safe null delim: <code>find . -type f -name &#39;*.log&#39; -print0 | xargs -0 rm -f</code></li>
<li>limit args per call: <code>xargs -n 1 -I{} sh -c &#39;echo {}&#39;</code></li>
<li>parallelism: <code>xargs -P 4 -n 1 cmd</code> (run 4 at a time)</li>
<li>interactive confirm: <code>xargs -p rm</code> (ask before each batch)</li>
<li>do nothing on empty input: <code>xargs -r cmd</code> (GNU)</li>
</ul>
<h1 id="Logs-Systemd"><a href="#Logs-Systemd" class="headerlink" title="Logs &amp; Systemd"></a>Logs &amp; Systemd</h1><p>Cheat Card</p>
<ul>
<li>Unit status: <code>systemctl status &lt;unit&gt;</code>; failed: <code>systemctl list-units --failed</code></li>
<li>Hot errors: <code>journalctl -xeu &lt;unit&gt;</code>; follow: <code>journalctl -fu &lt;unit&gt;</code></li>
<li>Boot scoping: <code>journalctl -b</code> and <code>-b -1</code>; size: <code>journalctl --disk-usage</code></li>
</ul>
<h2 id="Systemd-basics"><a href="#Systemd-basics" class="headerlink" title="Systemd basics"></a>Systemd basics</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Unit status and enablement</span></span><br><span class="line">systemctl status &lt;unit&gt;</span><br><span class="line">systemctl is-active &lt;unit&gt;</span><br><span class="line">systemctl is-enabled &lt;unit&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Failed units overview</span></span><br><span class="line">systemctl list-units --failed</span><br><span class="line">journalctl -xe  # recent critical logs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Restart and verify logs from this boot</span></span><br><span class="line">systemctl restart &lt;unit&gt;</span><br><span class="line">journalctl -u &lt;unit&gt; -b -n 50</span><br></pre></td></tr></table></figure>
<h2 id="Journal-essentials"><a href="#Journal-essentials" class="headerlink" title="Journal essentials"></a>Journal essentials</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Recent errors <span class="keyword">for</span> a unit and live follow</span></span><br><span class="line">journalctl -xeu &lt;unit&gt;</span><br><span class="line">journalctl -fu &lt;unit&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Time window and priority</span></span><br><span class="line">journalctl -u &lt;unit&gt; --since &quot;1 hour ago&quot; --until now</span><br><span class="line">journalctl -p err..alert -b</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Previous boot</span></span><br><span class="line">journalctl -b -1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">JSON output piped to jq (Requires: jq)</span></span><br><span class="line">journalctl -u &lt;unit&gt; -o json | jq -r &#x27;.MESSAGE&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="Journal-management"><a href="#Journal-management" class="headerlink" title="Journal management"></a>Journal management</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disk usage and vacuum</span></span><br><span class="line">journalctl --disk-usage</span><br><span class="line">journalctl --vacuum-size=1G</span><br><span class="line">journalctl --vacuum-time=7d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Make logs persistent (requires root; edit journald.conf)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/systemd/journald.conf: <span class="built_in">set</span> Storage=persistent</span></span><br><span class="line">systemctl restart systemd-journald</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Tip: tune RateLimitIntervalSec/RateLimitBurst to manage <span class="built_in">log</span> storms</span></span><br></pre></td></tr></table></figure>
<h2 id="Resolved-DNS"><a href="#Resolved-DNS" class="headerlink" title="Resolved (DNS)"></a>Resolved (DNS)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Overall resolver status</span></span><br><span class="line">resolvectl status</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Query using systemd-resolved</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Flush caches</span></span><br><span class="line">resolvectl flush-caches</span><br></pre></td></tr></table></figure>

<h1 id="Security-Audit"><a href="#Security-Audit" class="headerlink" title="Security &amp; Audit"></a>Security &amp; Audit</h1><p>Cheat Card</p>
<ul>
<li>SELinux mode: <code>getenforce</code>; recent denials: <code>ausearch -m AVC -ts recent</code></li>
<li>AppArmor status: <code>aa-status</code>; set complain&#x2F;enforce on a profile</li>
<li>Audit rule example: <code>auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</code><br>SELinux</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Current mode and temporary permissive (diagnostic; requires root)</span></span><br><span class="line">getenforce</span><br><span class="line">setenforce 0  # Caution: reduces enforcement</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Contexts and recent denials</span></span><br><span class="line">ls -Z</span><br><span class="line">ps -eZ | head</span><br><span class="line">ausearch -m AVC -ts recent</span><br><span class="line">journalctl -t setroubleshoot</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Manage booleans (example: allow httpd network connect)</span></span><br><span class="line">getsebool -a | grep httpd</span><br><span class="line">setsebool -P httpd_can_network_connect on</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: selinux-utils/policycoreutils; setroubleshoot (optional)</span></span><br></pre></td></tr></table></figure>
<p>AppArmor</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Status and service</span></span><br><span class="line">aa-status</span><br><span class="line">systemctl status apparmor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Toggle a profile mode</span></span><br><span class="line">aa-complain /path/to/bin</span><br><span class="line">aa-enforce /path/to/bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: apparmor-utils</span></span><br></pre></td></tr></table></figure>
<p>Auditd</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Service and rules</span></span><br><span class="line">systemctl status auditd</span><br><span class="line">auditctl -l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Search recent denials / by PID</span></span><br><span class="line">ausearch -m avc -ts recent</span><br><span class="line">ausearch -p &lt;pid&gt; -ts recent</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Watch a file <span class="keyword">for</span> writes/attr changes (key: sshcfg)</span></span><br><span class="line">auditctl -w /etc/ssh/sshd_config -p wa -k sshcfg</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Summary report</span></span><br><span class="line">aureport --summary -ts today</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires: auditd (auditd, auditctl, ausearch, aureport)</span></span><br></pre></td></tr></table></figure>

<h1 id="Containers-Namespaces"><a href="#Containers-Namespaces" class="headerlink" title="Containers &amp; Namespaces"></a>Containers &amp; Namespaces</h1><p>Cheat Card</p>
<ul>
<li>Enter container namespace: <code>nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</code></li>
<li>Docker triage: <code>docker ps</code>, <code>docker logs --tail=200 -f &lt;id&gt;</code>, <code>docker exec -it &lt;id&gt; sh</code></li>
<li>K8s triage: <code>kubectl get pods -A</code>, <code>kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</code>, <code>kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</code><br>nsenter (enter namespaces of a PID)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get target PID (e.g., container process)</span></span><br><span class="line">pidof &lt;proc&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Enter multiple namespaces of a PID</span></span><br><span class="line">nsenter --target &lt;pid&gt; --mount --uts --ipc --net --pid -- bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Inspect and chroot-like into the process rootfs</span></span><br><span class="line">ls -l /proc/&lt;pid&gt;/root</span><br><span class="line">nsenter --target &lt;pid&gt; --mount -- chroot /proc/&lt;pid&gt;/root bash</span><br></pre></td></tr></table></figure>
<p>Docker (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List, <span class="built_in">exec</span>, inspect PID, and <span class="built_in">tail</span> logs</span></span><br><span class="line">docker ps --format &#x27;&#123;&#123;.ID&#125;&#125; &#123;&#123;.Names&#125;&#125; &#123;&#123;.Status&#125;&#125;&#x27;</span><br><span class="line">docker exec -it &lt;id|name&gt; bash  # or sh</span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; &lt;id&gt;</span><br><span class="line">docker logs --tail=200 -f &lt;id&gt;</span><br></pre></td></tr></table></figure>
<p>Kubernetes (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Pods and events</span></span><br><span class="line">kubectl get pods -A -o wide</span><br><span class="line">kubectl get events -A --sort-by=.lastTimestamp | tail</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Describe, logs, and <span class="built_in">exec</span></span></span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --tail=200</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line">kubectl exec -it &lt;pod&gt; -n &lt;ns&gt; -- bash</span><br></pre></td></tr></table></figure>
<p>CRI&#x2F;containerd (if present)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List, inspect, and logs via crictl</span></span><br><span class="line">crictl ps -a</span><br><span class="line">crictl inspect &lt;id&gt;</span><br><span class="line">crictl logs &lt;id&gt;</span><br></pre></td></tr></table></figure>
<p>Notes</p>
<ul>
<li>Without runtime CLIs, use <code>nsenter</code> by PID from <code>ps</code>&#x2F;<code>systemctl</code>.</li>
<li>Requires: docker or podman for Docker-like commands; kubectl; crictl for containerd&#x2F;CRI.</li>
</ul>
<h1 id="Incident-Playbooks"><a href="#Incident-Playbooks" class="headerlink" title="Incident Playbooks"></a>Incident Playbooks</h1><h2 id="High-CPU"><a href="#High-CPU" class="headerlink" title="High CPU"></a>High CPU</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Top CPU processes and hot threads</span></span><br><span class="line">ps -eo pid,ppid,user,%cpu,%mem,cmd --sort=-%cpu | head</span><br><span class="line">top -H</span><br><span class="line">ps -Lp &lt;pid&gt; -o pid,tid,pcpu,comm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Per-process CPU over <span class="keyword">time</span>; optional perf <span class="keyword">if</span> available</span></span><br><span class="line">pidstat -u 1 -p &lt;pid&gt;</span><br><span class="line">perf top  # if installed</span><br></pre></td></tr></table></figure>
<h2 id="High-IO-wait-Disk-latency"><a href="#High-IO-wait-Disk-latency" class="headerlink" title="High IO wait &#x2F; Disk latency"></a>High IO wait &#x2F; Disk latency</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Device saturation and per-process IO</span></span><br><span class="line">iostat -xz 1   # watch await, %util, r/s, w/s</span><br><span class="line">pidstat -d 1</span><br><span class="line">iotop -oPa</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Device/FS inventory and kernel errors</span></span><br><span class="line">lsblk -o NAME,TYPE,SIZE,ROTA,MOUNTPOINT,MODEL</span><br><span class="line">dmesg -T | egrep -i &#x27;error|reset|blk|nvme&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Optional deep dive</span></span><br><span class="line">blktrace -d /dev/sdX -o - | blkparse -i -</span><br></pre></td></tr></table></figure>
<h2 id="Memory-leak-OOM"><a href="#Memory-leak-OOM" class="headerlink" title="Memory leak &#x2F; OOM"></a>Memory leak &#x2F; OOM</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Snapshot and top RSS processes</span></span><br><span class="line">free -h</span><br><span class="line">ps aux --sort=-rss | head</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Per-process mappings and over-time faults</span></span><br><span class="line">pmap -x &lt;pid&gt; | sort -nrk 3 | head</span><br><span class="line">pidstat -r 1 -p &lt;pid&gt;</span><br><span class="line">smem -r  # if installed</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OOM evidence</span></span><br><span class="line">dmesg -T | grep -i oom || journalctl -k -g OOM</span><br></pre></td></tr></table></figure>
<h2 id="Packet-loss-High-latency"><a href="#Packet-loss-High-latency" class="headerlink" title="Packet loss &#x2F; High latency"></a>Packet loss &#x2F; High latency</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Path and end-to-end latency</span></span><br><span class="line">ip route get &lt;dest&gt;</span><br><span class="line">mtr -ezbw &lt;dest&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Interface health and TCP details</span></span><br><span class="line">ip -s link show &lt;iface&gt;</span><br><span class="line">ethtool -S &lt;iface&gt;</span><br><span class="line">ss -i dst &lt;dest&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Targeted capture samples</span></span><br><span class="line">tcpdump -ni &lt;iface&gt; host &lt;dest&gt; and icmp</span><br><span class="line">tcpdump -ni &lt;iface&gt; tcp port 443 and &#x27;tcp[tcpflags] &amp; tcp-syn != 0&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="DNS-failures"><a href="#DNS-failures" class="headerlink" title="DNS failures"></a>DNS failures</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Resolve via systemd-resolved (or dig <span class="keyword">if</span> available)</span></span><br><span class="line">resolvectl query example.com</span><br><span class="line">resolvectl status</span><br><span class="line">dig @8.8.8.8 example.com A +time=2 +tries=1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Reachability and captures</span></span><br><span class="line">ss -u &#x27;sport = :53 or dport = :53&#x27;</span><br><span class="line">tcpdump -ni &lt;iface&gt; port 53</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Config checks</span></span><br><span class="line">ls -l /etc/resolv.conf</span><br><span class="line">resolvectl flush-caches</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check firewall rules as appropriate</span></span><br></pre></td></tr></table></figure>
<h2 id="TLS-handshake-issues"><a href="#TLS-handshake-issues" class="headerlink" title="TLS handshake issues"></a>TLS handshake issues</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Inspect handshake/cert chain (TLS1.2 example)</span></span><br><span class="line">openssl s_client -connect host:443 -servername host -tls1_2 -showcerts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Check expiry/subject/issuer quickly</span></span><br><span class="line">echo | openssl s_client -connect host:443 -servername host 2&gt;/dev/null \</span><br><span class="line">  | openssl x509 -noout -dates -subject -issuer</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">App behavior (SNI, ALPN, protocols)</span></span><br><span class="line">curl -v https://host/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If proxy/MTLS: verify CA path and client certs; check <span class="keyword">time</span> skew</span></span><br><span class="line">timedatectl</span><br></pre></td></tr></table></figure>
<h2 id="Disk-full-Inode-exhaustion"><a href="#Disk-full-Inode-exhaustion" class="headerlink" title="Disk full &#x2F; Inode exhaustion"></a>Disk full &#x2F; Inode exhaustion</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Space vs inodes</span></span><br><span class="line">df -h</span><br><span class="line">df -i</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find biggest <span class="built_in">dirs</span> on same filesystem</span></span><br><span class="line">du -xhd1 /path | sort -h</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Deleted-but-open files</span></span><br><span class="line">lsof +L1</span><br><span class="line">journalctl --vacuum-size=1G  # cull journal size</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Many small files</span></span><br><span class="line">find /path -xdev -type f | wc -l</span><br></pre></td></tr></table></figure>
<h2 id="Syscall-slowness"><a href="#Syscall-slowness" class="headerlink" title="Syscall slowness"></a>Syscall slowness</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Trace syscalls and timings</span></span><br><span class="line">strace -ttT -p &lt;pid&gt; -f -e trace=network,file,fsync,clock,nanosleep</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Optional CPU hotspot profiling</span></span><br><span class="line">perf record -g -p &lt;pid&gt;; perf report</span><br></pre></td></tr></table></figure>
<h2 id="Container-restart-loops"><a href="#Container-restart-loops" class="headerlink" title="Container restart loops"></a>Container restart loops</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Docker restart loops</span></span><br><span class="line">docker ps --filter &#x27;status=restarting&#x27;</span><br><span class="line">docker logs &lt;id&gt; --tail=200</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Kubernetes restart loops</span></span><br><span class="line">kubectl get pods -A</span><br><span class="line">kubectl describe pod &lt;pod&gt; -n &lt;ns&gt;</span><br><span class="line">kubectl logs &lt;pod&gt; -n &lt;ns&gt; --previous</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Node/agent issues</span></span><br><span class="line">journalctl -u kubelet</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/20/ARM%E7%9B%B8%E5%85%B3/ARM%E7%9B%B8%E5%85%B3%E7%BC%A9%E7%95%A5%E8%AF%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/20/ARM%E7%9B%B8%E5%85%B3/ARM%E7%9B%B8%E5%85%B3%E7%BC%A9%E7%95%A5%E8%AF%AD/" class="post-title-link" itemprop="url">ARM相关缩略语</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-20 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-20T00:00:00+00:00">2025-12-20</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>转载：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/1985799288740136627">https://zhuanlan.zhihu.com/p/1985799288740136627</a></p>
</blockquote>
<p>ARM 相关缩略语大全（按大类系统整理）<br>本文系统性整理 <strong>ARM 架构</strong>中常见缩略语，覆盖 <strong>CPU &#x2F; Core &#x2F; AMBA &#x2F; CoreSight &#x2F; GIC &#x2F; 内存系统 &#x2F; 异构与加速 &#x2F; 安全 &#x2F; 虚拟化 &#x2F; SoC 互连</strong> 等多个层面，适合 <strong>内核、驱动、SoC、性能分析、芯片架构</strong> 方向长期查阅。</p>
<p>一、ARM 架构与指令集（Architecture &amp; ISA）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>ARM</td>
<td>Advanced RISC Machines</td>
<td>ARM 公司 &#x2F; 架构统称</td>
</tr>
<tr>
<td>ISA</td>
<td>Instruction Set Architecture</td>
<td>指令集架构</td>
</tr>
<tr>
<td>AArch32</td>
<td>ARM Architecture 32-bit</td>
<td>ARMv7 及兼容 32 位执行态</td>
</tr>
<tr>
<td>AArch64</td>
<td>ARM Architecture 64-bit</td>
<td>ARMv8+ 的 64 位执行态</td>
</tr>
<tr>
<td>ARMv7-A</td>
<td>ARM Architecture v7 Application</td>
<td>经典 32 位应用处理器架构</td>
</tr>
<tr>
<td>ARMv8-A</td>
<td>ARM Architecture v8 Application</td>
<td>引入 AArch64</td>
</tr>
<tr>
<td>ARMv9-A</td>
<td>ARM Architecture v9 Application</td>
<td>引入 SVE2 &#x2F; CCA</td>
</tr>
<tr>
<td>Thumb</td>
<td>Thumb Instruction Set</td>
<td>16-bit 压缩指令集</td>
</tr>
<tr>
<td>Thumb-2</td>
<td>Thumb-2 Instruction Set</td>
<td>16&#x2F;32 混合指令</td>
</tr>
<tr>
<td>NEON</td>
<td>Advanced SIMD</td>
<td>ARM 向量 SIMD 扩展</td>
</tr>
<tr>
<td>SVE</td>
<td>Scalable Vector Extension</td>
<td>可变向量长度 SIMD</td>
</tr>
<tr>
<td>SVE2</td>
<td>SVE v2</td>
<td>面向通用计算与 DSP</td>
</tr>
<tr>
<td>SME</td>
<td>Scalable Matrix Extension</td>
<td>ARMv9 矩阵扩展</td>
</tr>
</tbody></table>
<p>二、ARM CPU Core 家族（Processor Cores）<br>Cortex 系列</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>Cortex-A</td>
<td>Cortex Application</td>
<td>应用处理器（Linux &#x2F; Android）</td>
</tr>
<tr>
<td>Cortex-R</td>
<td>Cortex Real-time</td>
<td>实时处理器</td>
</tr>
<tr>
<td>Cortex-M</td>
<td>Cortex Microcontroller</td>
<td>微控制器</td>
</tr>
</tbody></table>
<p>Cortex-A 常见核心</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Core</td>
<td>特点</td>
<td>应用</td>
</tr>
<tr>
<td>A53</td>
<td>小核，低功耗</td>
<td>手机 &#x2F; 嵌入式</td>
</tr>
<tr>
<td>A55</td>
<td>A53 后继</td>
<td>big.LITTLE</td>
</tr>
<tr>
<td>A57</td>
<td>高性能</td>
<td>服务器 &#x2F; 手机</td>
</tr>
<tr>
<td>A72</td>
<td>高 IPC</td>
<td>SoC 主核</td>
</tr>
<tr>
<td>A73</td>
<td>优化能效</td>
<td>移动平台</td>
</tr>
<tr>
<td>A75</td>
<td>ARMv8.2</td>
<td>DynamIQ</td>
</tr>
<tr>
<td>A76</td>
<td>高性能单核</td>
<td>旗舰 SoC</td>
</tr>
<tr>
<td>A78</td>
<td>高能效</td>
<td>新一代移动</td>
</tr>
<tr>
<td>X1 &#x2F; X2 &#x2F; X3</td>
<td>Cortex-X</td>
<td>极致性能</td>
</tr>
</tbody></table>
<p>Neoverse（服务器）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Core</td>
<td>定位</td>
</tr>
<tr>
<td>N1</td>
<td>通用服务器</td>
</tr>
<tr>
<td>N2</td>
<td>ARMv9 数据中心</td>
</tr>
<tr>
<td>V1</td>
<td>SVE 向量优化</td>
</tr>
<tr>
<td>E1</td>
<td>边缘高吞吐</td>
</tr>
</tbody></table>
<p>三、异常级别与特权模型（Exception Levels）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>EL0</td>
<td>Exception Level 0</td>
<td>用户态</td>
</tr>
<tr>
<td>EL1</td>
<td>Exception Level 1</td>
<td>内核态</td>
</tr>
<tr>
<td>EL2</td>
<td>Exception Level 2</td>
<td>Hypervisor</td>
</tr>
<tr>
<td>EL3</td>
<td>Exception Level 3</td>
<td>Secure Monitor</td>
</tr>
<tr>
<td>PL</td>
<td>Privilege Level</td>
<td>特权等级</td>
</tr>
<tr>
<td>SPSR</td>
<td>Saved Program Status Register</td>
<td>异常返回寄存器</td>
</tr>
<tr>
<td>ESR</td>
<td>Exception Syndrome Register</td>
<td>异常原因</td>
</tr>
</tbody></table>
<p>四、内存系统（Memory System &amp; MMU）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>MMU</td>
<td>Memory Management Unit</td>
<td>内存管理单元</td>
</tr>
<tr>
<td>SMMU</td>
<td>System Memory Management Unit</td>
<td>系统内存管理单元</td>
</tr>
<tr>
<td>MPU</td>
<td>Memory Protection Unit</td>
<td>无 MMU 系统</td>
</tr>
<tr>
<td>TLB</td>
<td>Translation Lookaside Buffer</td>
<td>地址翻译缓存</td>
</tr>
<tr>
<td>ASID</td>
<td>Address Space ID</td>
<td>进程地址空间标识</td>
</tr>
<tr>
<td>VA</td>
<td>Virtual Address</td>
<td>虚拟地址</td>
</tr>
<tr>
<td>PA</td>
<td>Physical Address</td>
<td>物理地址</td>
</tr>
<tr>
<td>IPA</td>
<td>Intermediate Physical Address</td>
<td>虚拟化中间地址</td>
</tr>
<tr>
<td>TTBR</td>
<td>Translation Table Base Register</td>
<td>页表基址</td>
</tr>
<tr>
<td>MAIR</td>
<td>Memory Attribute Indirection Register</td>
<td>内存属性</td>
</tr>
<tr>
<td>ATS</td>
<td>Address Translation Service</td>
<td>PCIe 地址翻译</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>五、AMBA 总线与互连（Bus &amp; Interconnect）<br>AMBA 总线协议</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>AMBA</td>
<td>Advanced Microcontroller Bus Architecture</td>
<td>ARM 总线体系</td>
</tr>
<tr>
<td>AXI</td>
<td>Advanced eXtensible Interface</td>
<td>高性能总线</td>
</tr>
<tr>
<td>AXI4</td>
<td>AXI version 4</td>
<td>主流 SoC 总线</td>
</tr>
<tr>
<td>AXI-Lite</td>
<td>AXI Lite</td>
<td>寄存器访问</td>
</tr>
<tr>
<td>AHB</td>
<td>Advanced High-performance Bus</td>
<td>中速总线</td>
</tr>
<tr>
<td>APB</td>
<td>Advanced Peripheral Bus</td>
<td>低速外设</td>
</tr>
<tr>
<td>CHI</td>
<td>Coherent Hub Interface</td>
<td>Cache Coherent 总线</td>
</tr>
<tr>
<td>ACE</td>
<td>AXI Coherency Extensions</td>
<td>一致性扩展</td>
</tr>
</tbody></table>
<p>互连与一致性</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>说明</td>
<td></td>
</tr>
<tr>
<td>CCN</td>
<td>Cache Coherent Network</td>
<td>一致性网络</td>
</tr>
<tr>
<td>CMN</td>
<td>Coherent Mesh Network</td>
<td>Mesh 架构</td>
</tr>
<tr>
<td>DVM</td>
<td>Distributed Virtual Memory</td>
<td>TLB 一致性</td>
</tr>
<tr>
<td>Snoop</td>
<td>Cache Snoop</td>
<td>Cache 探测</td>
</tr>
</tbody></table>
<p>六、GIC 中断控制器（Generic Interrupt Controller）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>GIC</td>
<td>Generic Interrupt Controller</td>
<td>ARM 中断控制器</td>
</tr>
<tr>
<td>GICv2</td>
<td>GIC version 2</td>
<td>ARMv7 常用</td>
</tr>
<tr>
<td>GICv3</td>
<td>GIC version 3</td>
<td>ARMv8 主流</td>
</tr>
<tr>
<td>GICv4</td>
<td>GIC version 4</td>
<td>虚拟化直通</td>
</tr>
<tr>
<td>SGI</td>
<td>Software Generated Interrupt</td>
<td>软件中断</td>
</tr>
<tr>
<td>PPI</td>
<td>Private Peripheral Interrupt</td>
<td>CPU 私有中断</td>
</tr>
<tr>
<td>SPI</td>
<td>Shared Peripheral Interrupt</td>
<td>共享中断</td>
</tr>
<tr>
<td>ITS</td>
<td>Interrupt Translation Service</td>
<td>MSI 映射</td>
</tr>
<tr>
<td>LPI</td>
<td>Locality-specific Peripheral Interrupt</td>
<td>大规模中断</td>
</tr>
</tbody></table>
<p>七、CoreSight 调试与追踪（Debug &amp; Trace）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>CoreSight</td>
<td>ARM Debug &amp; Trace 架构</td>
<td>调试体系</td>
</tr>
<tr>
<td>JTAG</td>
<td>Joint Test Action Group</td>
<td>硬件调试接口</td>
</tr>
<tr>
<td>SWD</td>
<td>Serial Wire Debug</td>
<td>精简调试</td>
</tr>
<tr>
<td>ETM</td>
<td>Embedded Trace Macrocell</td>
<td>指令追踪</td>
</tr>
<tr>
<td>PTM</td>
<td>Program Trace Macrocell</td>
<td>程序追踪</td>
</tr>
<tr>
<td>STM</td>
<td>System Trace Macrocell</td>
<td>系统事件追踪</td>
</tr>
<tr>
<td>ITM</td>
<td>Instrumentation Trace Macrocell</td>
<td>软件埋点</td>
</tr>
<tr>
<td>DWT</td>
<td>Data Watchpoint and Trace</td>
<td>数据监控</td>
</tr>
<tr>
<td>CTI</td>
<td>Cross Trigger Interface</td>
<td>模块联动</td>
</tr>
<tr>
<td>TPIU</td>
<td>Trace Port Interface Unit</td>
<td>Trace 输出</td>
</tr>
</tbody></table>
<p>八、安全架构（Security）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>全称</td>
<td>说明</td>
</tr>
<tr>
<td>TrustZone</td>
<td>ARM TrustZone</td>
<td>安全隔离</td>
</tr>
<tr>
<td>Secure World</td>
<td>安全世界</td>
<td>TEE</td>
</tr>
<tr>
<td>Normal World</td>
<td>普通世界</td>
<td>REE</td>
</tr>
<tr>
<td>TEE</td>
<td>Trusted Execution Environment</td>
<td>安全 OS</td>
</tr>
<tr>
<td>OP-TEE</td>
<td>Open Portable TEE</td>
<td>开源 TEE</td>
</tr>
<tr>
<td>CCA</td>
<td>Confidential Compute Architecture</td>
<td>ARMv9</td>
</tr>
<tr>
<td>RME</td>
<td>Realm Management Extension</td>
<td>Realm 隔离</td>
</tr>
</tbody></table>
<p>九、虚拟化（Virtualization）</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>说明</td>
</tr>
<tr>
<td>HYP</td>
<td>Hypervisor 模式</td>
</tr>
<tr>
<td>VHE</td>
<td>Virtualization Host Extensions</td>
</tr>
<tr>
<td>Stage-2</td>
<td>二级地址翻译</td>
</tr>
<tr>
<td>VGIC</td>
<td>Virtual GIC</td>
</tr>
<tr>
<td>VCPU</td>
<td>Virtual CPU</td>
</tr>
<tr>
<td>VMID</td>
<td>Virtual Machine ID</td>
</tr>
</tbody></table>
<p>十、SoC &#x2F; 系统级常见缩略语</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>说明</td>
</tr>
<tr>
<td>SoC</td>
<td>System on Chip</td>
</tr>
<tr>
<td>PMU</td>
<td>Performance Monitor Unit</td>
</tr>
<tr>
<td>DVFS</td>
<td>Dynamic Voltage and Frequency Scaling</td>
</tr>
<tr>
<td>QoS</td>
<td>Quality of Service</td>
</tr>
<tr>
<td>NoC</td>
<td>Network on Chip</td>
</tr>
<tr>
<td>SRAM</td>
<td>Static RAM</td>
</tr>
<tr>
<td>DRAM</td>
<td>Dynamic RAM</td>
</tr>
<tr>
<td>LPDDR</td>
<td>Low Power DDR</td>
</tr>
</tbody></table>
<p>十一、软件与生态</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>缩略语</td>
<td>说明</td>
</tr>
<tr>
<td>PSCI</td>
<td>Power State Coordination Interface</td>
</tr>
<tr>
<td>SMC</td>
<td>Secure Monitor Call</td>
</tr>
<tr>
<td>HVC</td>
<td>Hypervisor Call</td>
</tr>
<tr>
<td>UEFI</td>
<td>Unified Extensible Firmware Interface</td>
</tr>
<tr>
<td>ACPI</td>
<td>Advanced Configuration and Power Interface</td>
</tr>
<tr>
<td>DT &#x2F; DTS</td>
<td>Device Tree &#x2F; Source</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/17/Windows%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90-Windows%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/17/Windows%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90-Windows%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">性能分析-Windows（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-17 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-17T00:00:00+00:00">2025-12-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>介绍几款Windows下的性能分析工具。</p>
<h1 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h1><ul>
<li>Perfmon（性能监视器）：是Windows自带的性能监控工具，可以通过它来查看CPU、内存、硬盘、网络等系统性能指标的实时数据，也可以将数据保存到文件中进行后续分析。</li>
<li>Sysinternals Suite：是一个由微软官方提供的一组系统工具集合，其中包括了很多用于性能监控的工具，例如Process Monitor、DiskMon、TCPView等。</li>
<li>Windows Performance Toolkit：是一组高级性能监控工具，可用于性能分析和故障排查，包括xperf、WPR、WPA等。</li>
<li>perfview：Perfview是一个开源的CPU和内存性能分析工具，也包括一些针对.NET的分析功能，例如GC分析，JIT分析，甚至ASP.NET中的请求统计等等。</li>
<li>System Informer：系统资源监控工具，支持windows10、windows11。</li>
</ul>
<h1 id="工具概览"><a href="#工具概览" class="headerlink" title="工具概览"></a>工具概览</h1><h2 id="Perfmon"><a href="#Perfmon" class="headerlink" title="Perfmon"></a>Perfmon</h2><p>Windows自带的，详细使用方法，参考官方<a target="_blank" rel="noopener" href="https://techcommunity.microsoft.com/t5/ask-the-performance-team/windows-performance-monitor-overview/ba-p/375481">链接</a><br><img src="/perfmon.png"></p>
<h2 id="Sysinternals"><a href="#Sysinternals" class="headerlink" title="Sysinternals"></a>Sysinternals</h2><p>下载后即可使用的工具集，官方下链接<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sysinternals/">下载</a>，如常用的process monitor也包括在内<br><img src="/sysinternal.png"></p>
<h2 id="Windows-Performance-Toolkit"><a href="#Windows-Performance-Toolkit" class="headerlink" title="Windows Performance Toolkit"></a>Windows Performance Toolkit</h2><p>这个是Windows下的性能工具合集，见<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows-hardware/test/wpt/windows-performance-toolkit-technical-reference">官网</a>，Windows 性能工具包包含两个独立的工具：Windows Performance Recorder (WPR) 和 Windows Performance Analyzer (WPA) 此外，还保留了对以前的命令行工具 Xperf 的支持。 但是，不再支持 Xperfview。 所有记录都必须使用 WPA 来打开和分析。</p>
<p>需要使用WPR收集数据，再使用WPA分析数据。<br><img src="/wpa.png"></p>
<h2 id="perfview"><a href="#perfview" class="headerlink" title="perfview"></a>perfview</h2><p>perfview<a target="_blank" rel="noopener" href="https://github.com/microsoft/perfview">下载地址</a>。Perfview是一个开源的CPU和内存性能分析工具，也包括一些针对.NET的分析功能，例如GC分析，JIT分析，甚至ASP.NET中的请求统计等等。Perfview是一个Windows应用程序，但也能对在Linux系统上采集的数据进行分析（<a target="_blank" rel="noopener" href="https://blogs.msdn.microsoft.com/vancem/2016/02/20/analyzing-cpu-traces-from-linux-with-perfview/">参考</a>）。Perfview免安装，而且只是一个14M的.exe文件，非常容易部署到需要进行性能分析的机器上，例如生产环境的服务器。而且在性能数据收集的过程中不需要重启应用程序或者服务器，而且收集的性能数据日志（.etl文件）可以被拷贝到其他Windows机器上，再进行分析工作，对业务的影响非常少。<br><img src="/perfview.png">  </p>
<h2 id="System-Informer"><a href="#System-Informer" class="headerlink" title="System Informer"></a>System Informer</h2><p>系统资源监控工具，支持windows10、windows11，官网<a target="_blank" rel="noopener" href="https://systeminformer.sourceforge.io/">地址</a>。<br><img src="/sysinformer.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/15/TCP%E5%AD%A6%E4%B9%A0/TCP%E5%AD%A6%E4%B9%A0-NS3%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/15/TCP%E5%AD%A6%E4%B9%A0/TCP%E5%AD%A6%E4%B9%A0-NS3%E6%A8%A1%E6%8B%9F%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">TCP学习-NS3模拟环境搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-15T00:00:00+00:00">2025-12-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>参考<a target="_blank" rel="noopener" href="https://github.com/ituring/tcp-book/?tab=readme-ov-file">https://github.com/ituring/tcp-book/?tab=readme-ov-file</a></p>
</blockquote>
<h1 id="前置工具下载"><a href="#前置工具下载" class="headerlink" title="前置工具下载"></a>前置工具下载</h1><h2 id="virtualBox（最新版本即可）"><a href="#virtualBox（最新版本即可）" class="headerlink" title="virtualBox（最新版本即可）"></a>virtualBox（最新版本即可）</h2><p><a target="_blank" rel="noopener" href="https://www.virtualbox.org/">https://www.virtualbox.org/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">VirtualBox 图形用户界面</span><br><span class="line">版本 7.0.22 r165102 (Qt5.15.2)</span><br><span class="line">Copyright © 2024 Oracle and/or its affiliates</span><br></pre></td></tr></table></figure>

<h2 id="Vagrant（最新版本即可）"><a href="#Vagrant（最新版本即可）" class="headerlink" title="Vagrant（最新版本即可）"></a>Vagrant（最新版本即可）</h2><p><a target="_blank" rel="noopener" href="https://developer.hashicorp.com/vagrant">https://developer.hashicorp.com/vagrant</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\dushenda&gt; vagrant.exe -v</span><br><span class="line">Vagrant 2.4.9</span><br></pre></td></tr></table></figure>

<h2 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h2><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/powershell/scripting/install/install-powershell-on-windows?view=powershell-7.5">https://learn.microsoft.com/en-us/powershell/scripting/install/install-powershell-on-windows?view=powershell-7.5</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\dushenda&gt; pwsh.exe -v</span><br><span class="line">PowerShell 7.1.4</span><br></pre></td></tr></table></figure>

<h2 id="X-server"><a href="#X-server" class="headerlink" title="X server"></a>X server</h2><h3 id="下载并安装-VcXsrv："><a href="#下载并安装-VcXsrv：" class="headerlink" title="下载并安装 VcXsrv："></a>下载并安装 VcXsrv：</h3><ol>
<li>访问：<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/vcxsrv/">https://sourceforge.net/projects/vcxsrv/</a></li>
<li>下载并安装 VcXsrv Windows X Server</li>
</ol>
<h3 id="配置-VcXsrv："><a href="#配置-VcXsrv：" class="headerlink" title="配置 VcXsrv："></a>配置 VcXsrv：</h3><ol>
<li>启动 “XLaunch”</li>
<li>选择 “Multiple windows”</li>
<li>Display number 设为 “0” 或 “-1”（自动）</li>
<li>选择 “Start no client”</li>
<li>在 “Extra settings” 中勾选 “Disable access control”（重要！）</li>
<li>完成设置，VcXsrv 会在系统托盘运行</li>
</ol>
<h3 id="设置-PowerShell-环境变量"><a href="#设置-PowerShell-环境变量" class="headerlink" title="设置 PowerShell 环境变量"></a>设置 PowerShell 环境变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在启动 Vagrant 前设置 DISPLAY</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="built_in">env</span>:DISPLAY = <span class="string">&quot;localhost:0.0&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者尝试</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="built_in">env</span>:DISPLAY = <span class="string">&quot;127.0.0.1:0.0&quot;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="修改-Vagrantfile-配置"><a href="#修改-Vagrantfile-配置" class="headerlink" title="修改 Vagrantfile 配置"></a>修改 Vagrantfile 配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class="line">  config.vm.define &quot;guest1&quot; do |guest1|</span><br><span class="line">    guest1.vm.box = &quot;ubuntu/xenial64&quot;</span><br><span class="line">    </span><br><span class="line">    # 关键配置：启用 X11 转发</span><br><span class="line">    guest1.ssh.forward_x11 = true</span><br><span class="line">    guest1.ssh.forward_agent = true</span><br><span class="line">    guest1.ssh.forward_x11_trusted = true</span><br><span class="line">    guest1.ssh.keep_alive = true</span><br><span class="line">    </span><br><span class="line">    # 网络配置</span><br><span class="line">    guest1.vm.network &quot;private_network&quot;, type: &quot;dhcp&quot;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h1 id="安装wireshark虚拟机"><a href="#安装wireshark虚拟机" class="headerlink" title="安装wireshark虚拟机"></a>安装wireshark虚拟机</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/ituring/tcp-book.git</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> tcp-book/wireshark/vagrant</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant up</span></span><br></pre></td></tr></table></figure>

<h2 id="登录虚拟机"><a href="#登录虚拟机" class="headerlink" title="登录虚拟机"></a>登录虚拟机</h2><p>使用以下的命令，ssh连接到Guest操作系统上。在登录消息显示之后，命令行提示会变成<code>vagrant@guest1:~$</code>。</p>
<p>在<code>powershell</code>中运行<code>vagrant ssh guest1</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant ssh guest1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Welcome to Ubuntu 16.04.5 LTS (GNU/Linux 4.4.0-139-generic x86_64)</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; * Documentation:  https://help.ubuntu.com</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">* Management:     https://landscape.canonical.com</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">* Support:        https://ubuntu.com/advantage</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; Get cloud support with Ubuntu Advantage Cloud Guest:</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">http://www.ubuntu.com/business/services/cloud</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; 0 packages can be updated.</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">0 updates are security updates.</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">&gt; New release <span class="string">&#x27;18.04.1 LTS&#x27;</span> available.</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">Run <span class="string">&#x27;do-release-upgrade&#x27;</span> to upgrade to it.</span></span><br><span class="line"></span><br><span class="line">vagrant@guest1:~$</span><br></pre></td></tr></table></figure>

<p>启动Wireshark。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant@guest1:~$ wireshark</span><br></pre></td></tr></table></figure>
<p><img src="/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAwireshark.png"></p>
<h1 id="安装ns3虚拟机"><a href="#安装ns3虚拟机" class="headerlink" title="安装ns3虚拟机"></a>安装ns3虚拟机</h1><p>当确认已经准备好VirtualBox和Vagrant的环境之后，请将<a target="_blank" rel="noopener" href="https://github.com/ituring/tcp-book">此Github代码库</a>克隆到任意目录。打开其中的<code>ns3/vagrant</code>目录，执行<code>vagrant up</code>命令。如此一来，就在虚拟机上完成了安装Ubuntu 16.04，并搭建ns-3的过程。另外，在2019年4月1日的时间点，第5章和第6章所使用的CUBIC和BBR模块不支持ns-3.28以上版本，因此本书使用ns-3.27版本。由于搭建ns-3环境相当花时间，请务必耐心等待 。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/ituring/tcp-book.git</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> tcp-book/ns3/vagrant</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vagrant up</span></span><br></pre></td></tr></table></figure>
<p><img src="/%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA.png"><br>在<code>powershell</code>中运行<code>vagrant ssh</code><br><img src="/ns3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/13/Linux%E5%86%85%E5%AD%98%E5%AD%90%E7%B3%BB%E7%BB%9F/Linux%E5%86%85%E5%AD%98%E5%AD%90%E7%B3%BB%E7%BB%9F-Page%20Cache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/13/Linux%E5%86%85%E5%AD%98%E5%AD%90%E7%B3%BB%E7%BB%9F/Linux%E5%86%85%E5%AD%98%E5%AD%90%E7%B3%BB%E7%BB%9F-Page%20Cache/" class="post-title-link" itemprop="url">Linux内存子系统-Page Cache</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-13 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-13T00:00:00+00:00">2025-12-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="pagecache是什么"><a href="#pagecache是什么" class="headerlink" title="pagecache是什么"></a>pagecache是什么</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /proc/meminfo</span></span><br><span class="line">...</span><br><span class="line">Buffers:            1224 kB</span><br><span class="line">Cached:           111472 kB</span><br><span class="line">SwapCached:        36364 kB</span><br><span class="line">Active:          6224232 kB</span><br><span class="line">Inactive:         979432 kB</span><br><span class="line">Active(anon):    6173036 kB</span><br><span class="line">Inactive(anon):   927932 kB</span><br><span class="line">Active(file):      51196 kB</span><br><span class="line">Inactive(file):    51500 kB</span><br><span class="line">...</span><br><span class="line">Shmem:             10000 kB</span><br><span class="line">...</span><br><span class="line">SReclaimable:      43532 kB</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Page Cache &#x3D; Buffers + Cached + SwapCached &#x3D; Active(file) + Inactive(file) + Shmem + SwapCached</p>
<p><img src="/pagecache.png"></p>
<p>&#x2F;proc&#x2F;meminfo的解释见如下网站<a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/filesystems/proc.rst">https://www.kernel.org/doc/Documentation/filesystems/proc.rst</a></p>
<p>在 Page Cache 中，Active(file)+Inactive(file) 是 File-backed page（与文件对应的内存页），是你最需要关注的部分。因为你平时用的 mmap() 内存映射方式和 buffered I&#x2F;O 来消耗的内存就属于这部分。</p>
<p>而 SwapCached 是在打开了 Swap 分区后，把 Inactive(anon)+Active(anon) 这两项里的匿名页给交换到磁盘（swap out），然后再读入到内存（swap in）后分配的内存。由于读入到内存后原来的 Swap File 还在，所以 SwapCached 也可以认为是 File-backed page，即属于 Page Cache。这样做的目的也是为了减少 I&#x2F;O。</p>
<p><img src="/swapcache.png"></p>
<p>SwapCached 只在 Swap 分区打开的情况下才会有，建议在生产环境中关闭 Swap 分区，因为 Swap 过程产生的 I&#x2F;O 会很容易引起性能抖动。</p>
<p>下面解释一下free输出</p>
<p>buff&#x2F;cache &#x3D; Buffers + Cached + SReclaimable</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">free -k</span></span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:        7926580     7277960      492392       10000      156228      430680</span><br><span class="line">Swap:       8224764      380748     7844016</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>指标</th>
<th>数据来源 (参考 <code>/proc/meminfo</code>)</th>
<th>主要作用</th>
</tr>
</thead>
<tbody><tr>
<td>**<code>Buffers</code>**​</td>
<td><code>Buffers</code>值</td>
<td>临时存放<strong>原始磁盘块数据</strong>，用于优化对磁盘（块设备）的直接读写操作。</td>
</tr>
<tr>
<td>**<code>Cached</code>**​</td>
<td><code>Cached</code>值</td>
<td>缓存<strong>从文件读取的数据</strong>（即页缓存&#x2F;Page Cache），使得再次访问这些文件时可以直接从内存快速读取，无需访问磁盘。</td>
</tr>
<tr>
<td>**<code>SReclaimable</code>**​</td>
<td><code>SReclaimable</code>值</td>
<td>属于 <strong>Slab 分配器</strong>​ 的一部分，记录内核对象（如目录项、inode 等）缓存中<strong>可以被回收</strong>占用的内存。指可以被回收的内核内存，包括 dentry 和 inode 等。</td>
</tr>
</tbody></table>
<blockquote>
<p>实际场景中的表现：通过 vmstat等工具可以观察它们的变化。例如，当使用 dd命令向磁盘分区直接写入大量数据时（如 dd if&#x3D;&#x2F;dev&#x2F;urandom of&#x3D;&#x2F;dev&#x2F;sdb1 …），会观察到 Buffers显著增长，因为这是对原始磁盘块的操作。而当读写普通文件时（如 dd if&#x3D;&#x2F;dev&#x2F;urandom of&#x3D;&#x2F;tmp&#x2F;file …），则会看到 Cached部分明显增加，因为这些数据被文件系统缓存了。</p>
</blockquote>
<h1 id="pagecache出现的意义"><a href="#pagecache出现的意义" class="headerlink" title="pagecache出现的意义"></a>pagecache出现的意义</h1><p>先看如何使用pagecache的方法</p>
<ul>
<li>第一种，应用程序维护自己的 Cache 做更加细粒度的控制，比如 MySQL 就是这样做的，你可以参考MySQL Buffer Pool 。</li>
<li>第二种，使用 Direct I&#x2F;O 来绕过 Page Cache。</li>
</ul>
<p>pagecache的意义就是加速：标准 I&#x2F;O 和内存映射会先把数据写入到 Page Cache，这样做会通过减少 I&#x2F;O 次数来提升读写效率。</p>
<p>我们看一个具体的例子。首先，我们来生成一个 1G 大小的新文件，然后把 Page Cache 清空，确保文件内容不在内存中，以此来比较第一次读文件和第二次读文件耗时的差异。具体的流程如下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=./dd.out bs=4096 count=((1024*256))</span><br></pre></td></tr></table></figure>

<p>清空 Page Cache，需要先执行一下 sync 来将脏页同步到磁盘再去 drop cache。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync &amp;&amp; echo 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure>

<p>读两次文件，计算耗时</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="keyword">time</span> <span class="built_in">cat</span> /home/yafang/test/dd.out &amp;&gt; /dev/null</span></span><br><span class="line">real  0m5.733s</span><br><span class="line">user  0m0.003s</span><br><span class="line">sys  0m0.213s</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="keyword">time</span> <span class="built_in">cat</span> /home/yafang/test/dd.out &amp;&gt; /dev/null</span> </span><br><span class="line">real  0m0.132s</span><br><span class="line">user  0m0.001s</span><br><span class="line">sys  0m0.130s</span><br></pre></td></tr></table></figure>

<p>通过这样详细的过程你可以看到，第二次读取文件的耗时远小于第一次的耗时，这是因为第一次是从磁盘来读取的内容，磁盘 I&#x2F;O 是比较耗时的，而第二次读取的时候由于文件内容已经在第一次读取时被读到内存了，所以是直接从内存读取的数据，内存相比磁盘速度是快很多的。这就是 Page Cache 存在的意义：减少 I&#x2F;O，提升应用的 I&#x2F;O 速度。</p>
<h1 id="pagecache机制"><a href="#pagecache机制" class="headerlink" title="pagecache机制"></a>pagecache机制</h1><h2 id="pagecache产生"><a href="#pagecache产生" class="headerlink" title="pagecache产生"></a>pagecache产生</h2><p>Page Cache 的产生有两种不同的方式：</p>
<ul>
<li>Buffered I&#x2F;O（标准 I&#x2F;O）；</li>
<li>Memory-Mapped I&#x2F;O（存储映射 I&#x2F;O）。<br><img src="/pagecache_twoway.png"></li>
</ul>
<p>buffered&#x2F;mmap都能产生 Page Cache，但是二者的还是有些差异的：标准 I&#x2F;O 是写的 (write(2)) 用户缓冲区 (Userpace Page 对应的内存)，然后再将用户缓冲区里的数据拷贝到内核缓冲区 (Pagecache Page 对应的内存)；如果是读的 (read(2)) 话则是先从内核缓冲区拷贝到用户缓冲区，再从用户缓冲区读数据，也就是 buffer 和文件内容不存在任何映射关系。</p>
<p>对于存储映射 I&#x2F;O 而言，则是直接将 Pagecache Page 给映射到用户地址空间，用户直接读写 Pagecache Page 中内容。</p>
<p>显然，存储映射 I&#x2F;O 要比标准 I&#x2F;O 效率高一些，毕竟少了“用户空间到内核空间互相拷贝”的过程。这也是很多应用开发者发现，为什么使用内存映射 I&#x2F;O 比标准 I&#x2F;O 方式性能要好一些的主要原因。</p>
<p>我们来用具体的例子演示一下 Page Cache 是如何“诞生”的，就以其中的标准 I&#x2F;O 为例，因为这是我们最常使用的一种方式，如下是一个简单的示例脚本：</p>
<h2 id="pagecache回收"><a href="#pagecache回收" class="headerlink" title="pagecache回收"></a>pagecache回收</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/11/Linux%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/Linux%E6%80%A7%E8%83%BDIO-blktrace%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/11/Linux%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/Linux%E6%80%A7%E8%83%BDIO-blktrace%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">Linux性能IO-blktrace工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-11 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-11T00:00:00+00:00">2025-12-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="快速分析"><a href="#快速分析" class="headerlink" title="快速分析"></a>快速分析</h1><p>使用命令组合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装工具</span></span><br><span class="line">yum install blktrace -y</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">采集数据：（监控30秒）</span></span><br><span class="line">blktrace -d /dev/nvme0n1 -w 30</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">合并数据：</span></span><br><span class="line">blkparse -i nvme0n1 -d nvme_trace.bin。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解析分析：，重点查看 <span class="string">&quot;ALL&quot;</span> 统计区和 <span class="string">&quot;Device Overhead&quot;</span> 分布</span></span><br><span class="line">btt -i nvme_trace.bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">组合命令</span></span><br><span class="line">blktrace -d /dev/sdf -w 5 -o - | blkparse -i - -d btt.bin &gt; blkparse.txt</span><br><span class="line">btt -i btt.bin</span><br></pre></td></tr></table></figure>
<p>btrace组合</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">追踪设备/dev/sda并输出blkparse数据</span></span><br><span class="line">btrace /dev/sda</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实际上btrace是调用了blktarce和blkparse组合出来的脚本文件，位于&#x2F;usr&#x2F;bin&#x2F;btrace</p>
</blockquote>
<h1 id="理论分析"><a href="#理论分析" class="headerlink" title="理论分析"></a>理论分析</h1><p>一个I&#x2F;O请求，从应用层到底层块设备，路径如下图所示：<br><img src="/Linux-storage-stack-diagram_v4.0.png"><br>我们将IO路径简化一下：<br><img src="/io_path_simple.png"><br>一个I&#x2F;O请求进入block layer之后，可能会经历下面的过程：</p>
<ul>
<li>Remap: 可能被DM(Device Mapper)或MD(Multiple Device, Software RAID) remap到其它设备</li>
<li>Split: 可能会因为I&#x2F;O请求与扇区边界未对齐、或者size太大而被分拆(split)成多个物理I&#x2F;O</li>
<li>Merge: 可能会因为与其它I&#x2F;O请求的物理位置相邻而合并(merge)成一个I&#x2F;O</li>
<li>被IO Scheduler依照调度策略发送给driver</li>
<li>被driver提交给硬件，经过HBA、电缆（光纤、网线等）、交换机（SAN或网络）、最后到达存储设备，设备完成IO请求之后再把结果发回。</li>
</ul>
<p>blktrace 能够记录下IO所经历的各个步骤:<br><img src="/blktrace_architecture.png"><br>我们一起看下blktrace的输出长什么样子：<br><img src="/blktrace_out.png"></p>
<ul>
<li>第一个字段：8,0 这个字段是设备号 major device ID和minor device ID。</li>
<li>第二个字段：3 表示CPU</li>
<li>第三个字段：11 序列号</li>
<li>第四个字段：0.009507758 Time Stamp是时间偏移</li>
<li>第五个字段：PID 本次IO对应的进程ID</li>
<li>第六个字段：Event，这个字段非常重要，反映了IO进行到了那一步</li>
<li>第七个字段：R表示 Read， W是Write，D表示block，B表示Barrier Operation</li>
<li>第八个字段：223490+56，表示的是起始block number 和 number of blocks，即我们常说的Offset 和 Size</li>
<li>第九个字段： 进程名</li>
</ul>
<p><code>blkparse</code>的输出包含了每个 I&#x2F;O 请求事件的详细信息，理解这些字段是分析的关键：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义说明</th>
</tr>
</thead>
<tbody><tr>
<td>**设备号 (Major, Minor)**​</td>
<td>如 <code>8,0</code>通常指 <code>/dev/sda</code></td>
</tr>
<tr>
<td><strong>CPU ID</strong>​</td>
<td>处理此事件的 CPU 核心编号</td>
</tr>
<tr>
<td><strong>序列号</strong>​</td>
<td>事件的序列号</td>
</tr>
<tr>
<td><strong>时间戳</strong>​</td>
<td>事件发生的时间（通常为相对时间）</td>
</tr>
<tr>
<td>**进程ID (PID)**​</td>
<td>发起 I&#x2F;O 操作的进程 ID</td>
</tr>
<tr>
<td>**事件类型 (Action)**​</td>
<td><strong>核心字段</strong>，表示 I&#x2F;O 请求所处的阶段</td>
</tr>
<tr>
<td><strong>RWBS 描述符</strong>​</td>
<td>描述 I&#x2F;O 类型：R(读)&#x2F;W(写)&#x2F;B(屏障)&#x2F;S(同步)</td>
</tr>
<tr>
<td><strong>扇区信息</strong>​</td>
<td>如 <code>2048 + 8</code>，表示起始扇区号及连续扇区数</td>
</tr>
<tr>
<td><strong>进程名</strong>​</td>
<td>发起 I&#x2F;O 的进程名称</td>
</tr>
</tbody></table>
<p>其中，**事件类型 (Action)**​ 是理解 I&#x2F;O 路径的关键，它记录了请求从产生到完成的各个阶段：</p>
<ul>
<li><strong>Q</strong>​ (Queued): I&#x2F;O 请求进入块层。</li>
<li><strong>G</strong>​ (Get request): 分配请求结构。</li>
<li><strong>I</strong>​ (Inserted): 请求插入 I&#x2F;O 调度器队列。</li>
<li><strong>D</strong>​ (Issued): 请求提交给设备驱动。</li>
<li><strong>C</strong>​ (Completed): 请求完成。</li>
</ul>
<p>根据这些事件的时间戳，可以计算出 I&#x2F;O 路径各阶段的耗时，例如：</p>
<ul>
<li><strong>D2C</strong>: 请求在驱动和硬件上消耗的时间，是评估<strong>硬件性能</strong>的关键指标。</li>
<li><strong>I2D</strong>: 请求在 I&#x2F;O 调度队列中等待的时间，反映<strong>调度器性能</strong>。</li>
<li><strong>Q2C</strong>: 整个 I&#x2F;O 请求的总时间，近似于 <code>iostat</code>中的 <code>await</code>。</li>
</ul>
<p>其中第六个字段非常有用：每一个字母都代表了IO请求所经历的某个阶段。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Q – 即将生成IO请求</span><br><span class="line">|</span><br><span class="line">G – IO请求生成</span><br><span class="line">|</span><br><span class="line">I – IO请求进入IO Scheduler队列</span><br><span class="line">|</span><br><span class="line">D – IO请求进入driver</span><br><span class="line">|</span><br><span class="line">C – IO请求执行完毕</span><br></pre></td></tr></table></figure>
<p>注意，整个IO路径，分成很多段，每一段开始的时候，都会有一个时间戳，根据上一段开始的时间和下一段开始的时间，就可以得到IO 路径各段花费的时间。</p>
<p>注意，我们心心念念的service time，也就是反应块设备处理能力的指标，就是从D到C所花费的时间，简称D2C。</p>
<p>而iostat输出中的await，即整个IO从生成请求到IO请求执行完毕，即从Q到C所花费的时间，我们简称Q2C。</p>
<p>我们知道Linux 有I&#x2F;O scheduler，调度器的效率如何，I2D是重要的指标。</p>
<p>注意，这只是blktrace输出的一个部分，很明显，我们还能拿到offset和size，根据offset，我们能拿到某一段时间里，应用程序都访问了整个块设备的那些block，从而绘制出块设备访问轨迹图。</p>
<p>另外还有size和第七个字段（Read or Write），我们可以知道IO size的分布直方图。对于本文来讲，我们就是要根据blktrace来获取这些信息。</p>
<h1 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h1><p>我们接下来简单介绍这些工具的使用，其中这三个命令都是属于blktrace这个包的，他们是一家人。</p>
<p>首先通过如下命令，可以查看磁盘上的实时信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blktrace -d /dev/sdb -o – | blkparse -i –</span><br></pre></td></tr></table></figure>

<p>这个命令会连绵不绝地出现很多输出，当你输入ctrl＋C的时候，会停止。</p>
<p>当然了，你也可以先用如下命令采集信息，待所有信息采集完毕后，统一分析所有采集到的数据。搜集信息的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blktrace -d /dev/sdb</span><br></pre></td></tr></table></figure>

<p>注意，这个命令并不是只输出一个文件，他会根据CPU的个数上，每一个CPU都会输出一个文件，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 manu manu  1.3M Jul  6 19:58 sdb.blktrace.0</span><br><span class="line">-rw-r--r-- 1 manu manu  823K Jul  6 19:58 sdb.blktrace.1</span><br><span class="line">-rw-r--r-- 1 manu manu  2.8M Jul  6 19:58 sdb.blktrace.10</span><br><span class="line">-rw-r--r-- 1 manu manu  1.9M Jul  6 19:58 sdb.blktrace.11</span><br><span class="line">-rw-r--r-- 1 manu manu  474K Jul  6 19:58 sdb.blktrace.12</span><br><span class="line">-rw-r--r-- 1 manu manu  271K Jul  6 19:58 sdb.blktrace.13</span><br><span class="line">-rw-r--r-- 1 manu manu  578K Jul  6 19:58 sdb.blktrace.14</span><br><span class="line">-rw-r--r-- 1 manu manu  375K Jul  6 19:58 sdb.blktrace.15</span><br><span class="line">-rw-r--r-- 1 manu manu  382K Jul  6 19:58 sdb.blktrace.16</span><br><span class="line">-rw-r--r-- 1 manu manu  478K Jul  6 19:58 sdb.blktrace.17</span><br><span class="line">-rw-r--r-- 1 manu manu  839K Jul  6 19:58 sdb.blktrace.18</span><br><span class="line">-rw-r--r-- 1 manu manu  848K Jul  6 19:58 sdb.blktrace.19</span><br><span class="line">-rw-r--r-- 1 manu manu  1.6M Jul  6 19:58 sdb.blktrace.2</span><br><span class="line">-rw-r--r-- 1 manu manu  652K Jul  6 19:58 sdb.blktrace.20</span><br><span class="line">-rw-r--r-- 1 manu manu  738K Jul  6 19:58 sdb.blktrace.21</span><br><span class="line">-rw-r--r-- 1 manu manu  594K Jul  6 19:58 sdb.blktrace.22</span><br><span class="line">-rw-r--r-- 1 manu manu  527K Jul  6 19:58 sdb.blktrace.23</span><br><span class="line">-rw-r--r-- 1 manu manu 1005K Jul  6 19:58 sdb.blktrace.3</span><br><span class="line">-rw-r--r-- 1 manu manu  1.2M Jul  6 19:58 sdb.blktrace.4</span><br><span class="line">-rw-r--r-- 1 manu manu  511K Jul  6 19:58 sdb.blktrace.5</span><br><span class="line">-rw-r--r-- 1 manu manu  2.3M Jul  6 19:58 sdb.blktrace.6</span><br><span class="line">-rw-r--r-- 1 manu manu  1.3M Jul  6 19:58 sdb.blktrace.7</span><br><span class="line">-rw-r--r-- 1 manu manu  2.1M Jul  6 19:58 sdb.blktrace.8</span><br><span class="line">-rw-r--r-- 1 manu manu  1.1M Jul  6 19:58 sdb.blktrace.9</span><br></pre></td></tr></table></figure>

<p>有了输出，我们可以通过blkparse -i sdb来分析采集的数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">8,16   7     2147     0.999400390 630169  I   W 447379872 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2148     0.999400653 630169  I   W 447380040 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2149     0.999401057 630169  I   W 447380088 + 16 [kworker/u482:0]</span><br><span class="line">8,16   7     2150     0.999401364 630169  I   W 447380176 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2151     0.999401521 630169  I   W 453543312 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2152     0.999401843 630169  I   W 453543328 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2153     0.999402195 630169  U   N [kworker/u482:0] 14</span><br><span class="line">8,16   6     5648     0.999403047 16921  C   W 347875880 + 8 [0]</span><br><span class="line">8,16   6     5649     0.999406293 16921  D   W 301856632 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5650     0.999421040 16921  C   W 354834456 + 8 [0]</span><br><span class="line">8,16   6     5651     0.999423900 16921  D   W 301857280 + 8 [ceph-osd]</span><br><span class="line">8,16   7     2154     0.999442195 630169  A   W 425409840 + 8 &lt;- (8,22) 131806512</span><br><span class="line">8,16   7     2155     0.999442601 630169  Q   W 425409840 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2156     0.999444277 630169  G   W 425409840 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2157     0.999445177 630169  P   N [kworker/u482:0]</span><br><span class="line">8,16   7     2158     0.999446341 630169  I   W 425409840 + 8 [kworker/u482:0]</span><br><span class="line">8,16   7     2159     0.999446773 630169 UT   N [kworker/u482:0] 1</span><br><span class="line">8,16   6     5652     0.999452685 16921  C   W 354834520 + 8 [0]</span><br><span class="line">8,16   6     5653     0.999455613 16921  D   W 301857336 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5654     0.999470425 16921  C   W 393228176 + 8 [0]</span><br><span class="line">8,16   6     5655     0.999474127 16921  D   W 411554968 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5656     0.999488551 16921  C   W 393228560 + 8 [0]</span><br><span class="line">8,16   6     5657     0.999491549 16921  D   W 411556112 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5658     0.999594849 16923  C   W 393230152 + 16 [0]</span><br><span class="line">8,16   6     5659     0.999604038 16923  D   W 432877368 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5660     0.999610322 16923  C   W 487390128 + 8 [0]</span><br><span class="line">8,16   6     5661     0.999614654 16923  D   W 432879632 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5662     0.999628284 16923  C   W 487391344 + 8 [0]</span><br><span class="line">8,16   6     5663     0.999632014 16923  D   W 432879680 + 8 [ceph-osd]</span><br><span class="line">8,16   6     5664     0.999646122 16923  C   W 293759504 + 8 [0]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意，blkparse仅仅是将blktrace输出的信息转化成人可以阅读和理解的输出，但是，信息太多，太杂，人完全没法得到关键信息。 这时候btt就横空出世了，这个工具可以将blktrace采集回来的数据，进行分析，得到对人更有用的信息。事实上，btt也是我们的终点。</p>
<h1 id="获取个阶段的延迟信息"><a href="#获取个阶段的延迟信息" class="headerlink" title="获取个阶段的延迟信息"></a>获取个阶段的延迟信息</h1><p>注意，btt已经可以很自如地生成这部分统计信息，我们可以很容易得到如下的表格：<br><img src="/latency_distribution_table.png"><br><img src="/ioflow.png"></p>
<table>
<thead>
<tr>
<th>阶段缩写</th>
<th>全称与含义</th>
<th>性能指标解读</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Q2Q</strong>​</td>
<td><strong>Queue to Queue</strong>  <br>衡量上一个I&#x2F;O完成到当前I&#x2F;O抵达块层的<strong>时间间隔</strong>，反映了I&#x2F;O请求的<strong>到达速率</strong>。</td>
<td>间隔时间短表示I&#x2F;O负载很重，请求密集；间隔时间长则表示I&#x2F;O负载较轻<br><br>。</td>
</tr>
<tr>
<td><strong>Q2G</strong>​</td>
<td><strong>Queue to Get</strong>  <br>I&#x2F;O请求进入块层后，等待系统为其分配一个<code>request</code>结构体的时间。</td>
<td>此阶段通常极短。如果时间较长，可能表示系统内存紧张或内核在分配数据结构时遇到瓶颈。</td>
</tr>
<tr>
<td><strong>G2I</strong>​</td>
<td><strong>Get to Insert</strong>  <br>获取<code>request</code>结构体后，准备并将其插入到I&#x2F;O调度器队列所花费的时间。</td>
<td>此阶段也非常短暂。它反映了I&#x2F;O调度器处理请求的初始开销。</td>
</tr>
<tr>
<td><strong>I2D</strong>​</td>
<td><strong>Insert to Issue</strong>  <br>请求在<strong>I&#x2F;O调度器队列</strong>中等待以及被调度（合并、排序）后，派发（Issue）到设备驱动程序的时间。这是分析<strong>操作系统层面瓶颈</strong>的关键指标<br><br>。</td>
<td><strong>这是判断I&#x2F;O调度器和系统负载的关键指标</strong>。如果I2D时间很长，说明：  <br>1. 存储设备速度跟不上请求速率，队列中有大量请求在排队。  <br>2. I&#x2F;O调度策略可能不适合当前负载。</td>
</tr>
<tr>
<td><strong>D2C</strong>​</td>
<td><strong>Issue to Complete</strong>  <br>请求被提交给设备驱动后，在<strong>物理硬件上真正执行</strong>所花费的时间（包括在设备自身的缓存和介质上的读写时间）。这是评估<strong>硬件性能</strong>最直接的指标<br><br>。</td>
<td><strong>这是判断硬件瓶颈的核心指标</strong>。如果D2C时间很长，通常意味着：  <br>1. <strong>存储设备本身性能不足</strong>（如机械硬盘随机读写慢）。  <br>2. 设备可能处于高负载或存在故障。</td>
</tr>
<tr>
<td><strong>Q2C</strong>​</td>
<td><strong>Queue to Complete</strong>  <br>一个I&#x2F;O请求在块层处理的<strong>总时间</strong>。它近似等于 <code>Q2I + I2D + D2C</code>（Q2I可再细分为Q2G+G2I）<br><br>。</td>
<td>这大致相当于 <code>iostat</code>命令输出的 <code>await</code>值。反映了一个I&#x2F;O请求从进入系统到完成的总延迟<br><br>。</td>
</tr>
<tr>
<td>方法如下：</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>首先blkparse可以将对应不同cpu的多个文件聚合成一个文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blkparse -i sdb -d sdb.blktrace.bin</span><br></pre></td></tr></table></figure>

<p>然后btt就可以分析这个sdb.blktrace.bin了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">==================== All Devices ====================</span><br><span class="line"></span><br><span class="line">            ALL           MIN           AVG           MAX           N</span><br><span class="line">--------------- ------------- ------------- ------------- -----------</span><br><span class="line"></span><br><span class="line">Q2Q               0.000000001   0.000159747   0.025292639       62150</span><br><span class="line">Q2G               0.000000233   0.000001380   0.000056343       52423</span><br><span class="line">G2I               0.000000146   0.000027084   0.005031317       48516</span><br><span class="line">Q2M               0.000000142   0.000000751   0.000021613        9728</span><br><span class="line">I2D               0.000000096   0.001534463   0.022469688       52423</span><br><span class="line">M2D               0.000000647   0.002617691   0.022445412        5821</span><br><span class="line">D2C               0.000046189   0.000779355   0.007860766       62151</span><br><span class="line">Q2C               0.000051089   0.002522832   0.026096657       62151</span><br><span class="line"></span><br><span class="line">==================== Device Overhead ====================</span><br><span class="line"></span><br><span class="line">       DEV |       Q2G       G2I       Q2M       I2D       D2C</span><br><span class="line">---------- | --------- --------- --------- --------- ---------</span><br><span class="line"> (  8, 16) |   0.0461%   0.8380%   0.0047%  51.3029%  30.8921%</span><br><span class="line">---------- | --------- --------- --------- --------- ---------</span><br><span class="line">   Overall |   0.0461%   0.8380%   0.0047%  51.3029%  30.8921%</span><br><span class="line"></span><br><span class="line">==================== Device Merge Information ====================</span><br><span class="line"></span><br><span class="line">       DEV |       #Q       #D   Ratio |   BLKmin   BLKavg   BLKmax    Total</span><br><span class="line">---------- | -------- -------- ------- | -------- -------- -------- --------</span><br><span class="line"> (  8, 16) |    62151    52246     1.2 |        1       20      664  1051700</span><br><span class="line"></span><br><span class="line">==================== Device Q2Q Seek Information ====================</span><br><span class="line"></span><br><span class="line">       DEV |          NSEEKS            MEAN          MEDIAN | MODE           </span><br><span class="line">---------- | --------------- --------------- --------------- | ---------------</span><br><span class="line"> (  8, 16) |           62151      42079658.0               0 | 0(17159)</span><br><span class="line">---------- | --------------- --------------- --------------- | ---------------</span><br><span class="line">   Overall |          NSEEKS            MEAN          MEDIAN | MODE           </span><br><span class="line">   Average |           62151      42079658.0               0 | 0(17159)</span><br><span class="line"></span><br><span class="line">==================== Device D2D Seek Information ====================</span><br><span class="line"></span><br><span class="line">       DEV |          NSEEKS            MEAN          MEDIAN | MODE           </span><br><span class="line">---------- | --------------- --------------- --------------- | ---------------</span><br><span class="line"> (  8, 16) |           52246      39892356.2               0 | 0(9249)</span><br><span class="line">---------- | --------------- --------------- --------------- | ---------------</span><br><span class="line">   Overall |          NSEEKS            MEAN          MEDIAN | MODE           </span><br><span class="line">   Average |           52246      39892356.2               0 | 0(9249)</span><br></pre></td></tr></table></figure>

<p>注意： D2C和Q2C，一个是表征块设备性能的关键指标，另一个是客户发起请求到收到响应的时间，我们可以看出，</p>
<p>D2C 平均在0.000779355 秒，即0.7毫秒 Q2C 平均在0.002522832 秒，即2.5毫秒，</p>
<p>无论是service time 还是客户感知到的await time，都是非常短的，表现非常不俗。但是D2C花费的时间只占整个Q2C的30%， 51%以上的时间花费在I2D。</p>
<h1 id="参考-搬运"><a href="#参考-搬运" class="headerlink" title="参考&#x2F;搬运"></a>参考&#x2F;搬运</h1><p><a target="_blank" rel="noopener" href="https://bean-li.github.io/blktrace-to-report/">https://bean-li.github.io/blktrace-to-report/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/10/Linux%20Debug/Linux-%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/10/Linux%20Debug/Linux-%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85/" class="post-title-link" itemprop="url">Linux-网络抓包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+00:00">2025-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h1><h2 id="远程抓包"><a href="#远程抓包" class="headerlink" title="远程抓包"></a>远程抓包</h2><p>在wireshark的以下两个部分进行抓包，不建议性能分析时进行，在连通性验证时可以使用（ssh传输可能丢包等）<br><img src="/img1.png"><br><img src="/image.png" alt="image.png"></p>
<h2 id="ssh-tcpdump-wireshark解析"><a href="#ssh-tcpdump-wireshark解析" class="headerlink" title="ssh+tcpdump+wireshark解析"></a>ssh+tcpdump+wireshark解析</h2><p>直接抓包解析</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;ip&gt; &#x27;tcpdump -ni any -s0 -U -w - udp port 53&#x27; | wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>跳板机执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -J &lt;jumpsever ip&gt; &lt;ip&gt; &#x27;tcpdump -ni any -s0 -U -w - udp port 53&#x27; | wireshark -k -i -</span><br></pre></td></tr></table></figure>
<p>直接抓包并保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;ip&gt; <span class="string">&#x27;tcpdump -ni any -s0 -U -w- udp port 53&#x27;</span> &gt; /tmp/packets.pcap</span><br></pre></td></tr></table></figure>

<h1 id="tcpdump"><a href="#tcpdump" class="headerlink" title="tcpdump"></a>tcpdump</h1><h2 id="常用抓包指令"><a href="#常用抓包指令" class="headerlink" title="常用抓包指令"></a>常用抓包指令</h2><p>过滤tcp flags，比如抓syn报文，看是否能握手成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn&#x27;</span><br></pre></td></tr></table></figure>
<p>查看tcp状态，如下为发送了sync，如果一直未回复，则可以在<code>sar -n ETCP 1</code>看到<code>retrans/s</code>不断上升</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 0.1 &#x27;ss -tpn state syn-sent&#x27;</span><br></pre></td></tr></table></figure>
<p>抓syn和syn+ack报文</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any <span class="string">&#x27;tcp[tcpflags] == tcp-syn or tcp[13]=18&#x27;</span></span><br></pre></td></tr></table></figure>
<p>抓syn和syn+rst报文</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn or tcp[13] &amp; 4!=0&#x27;</span><br></pre></td></tr></table></figure>
<p>抓syn和icmp不可达报文</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;tcp[tcpflags] == tcp-syn or icmp[0] = 3&#x27;</span><br></pre></td></tr></table></figure>
<p>抓syn、syn+ack、rst和icmp端口不可达报文（tcp[13]指的是从tcp报文头偏移13字节的选项）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -ni any &#x27;(tcp[tcpflags] == tcp-syn or tcp[13]=18) or tcp[13] &amp;amp; 4!=0 or icmp[0] = 3&#x27;</span><br></pre></td></tr></table></figure>
<p>tcp flags抓包例子</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-syn&#x27;</span><br><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-rst&#x27;</span><br><span class="line">tcpdump &#x27;tcp[tcpflags] == tcp-fin&#x27;</span><br></pre></td></tr></table></figure>
<p>抓取指定报文大小</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump less 32</span><br><span class="line">tcpdump greater 32</span><br><span class="line">tcpdump &lt;= 102</span><br></pre></td></tr></table></figure>
<p>持续抓取端口 <code>8080</code>的流量，每个文件最大 <code>100MB</code>，最多保留 <code>10</code>个文件，写满后覆盖最旧的文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -C 100 -W 10 -w my_capture.pcap port 8080</span><br></pre></td></tr></table></figure>
<p>抓取 <code>10000</code>个发往 <code>80</code>端口的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -c 10000 -w http_requests.pcap dst port 80</span><br></pre></td></tr></table></figure>

<h2 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h2><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>**<code>-i &lt;interface&gt;</code>**​</td>
<td>指定抓包网卡。<code>any</code>表示所有网卡。</td>
<td><code>-i any</code></td>
</tr>
<tr>
<td>**<code>port &lt;端口号&gt;</code>**​</td>
<td>过滤特定端口的流量（TCP&#x2F;UDP）。</td>
<td><code>port 8080</code></td>
</tr>
<tr>
<td>**<code>-C &lt;大小&gt;</code>**​</td>
<td><strong>按文件大小分割</strong>。单位通常为MB（M）。</td>
<td><code>-C 100</code></td>
</tr>
<tr>
<td>**<code>-W &lt;数量&gt;</code>**​</td>
<td><strong>限制文件总数</strong>，与 <code>-C</code>配合实现循环覆盖。</td>
<td><code>-W 10</code></td>
</tr>
<tr>
<td>**<code>-w &lt;文件名&gt;</code>**​</td>
<td>将抓取的原始数据包写入指定文件。</td>
<td><code>-w my_capture.pcap</code></td>
</tr>
<tr>
<td>**<code>-c &lt;数量&gt;</code>**​</td>
<td>抓取指定数量的数据包后自动退出。</td>
<td><code>-c 10000</code></td>
</tr>
<tr>
<td>**<code>-s &lt;长度&gt;</code>**​</td>
<td>设置每个数据包的抓取长度（快照长度byte），<code>-s 0</code>表示抓取完整数据包。<strong>(在长期抓只需要分析报文头很实用)</strong></td>
<td><code>-s 0</code></td>
</tr>
</tbody></table>
<h2 id="其他选项"><a href="#其他选项" class="headerlink" title="其他选项"></a>其他选项</h2><h3 id="Capture-Commands"><a href="#Capture-Commands" class="headerlink" title="Capture Commands"></a>Capture Commands</h3><table>
<thead>
<tr>
<th>Command</th>
<th>Example usage</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td><code>-i any</code></td>
<td><code>tcpdump -i any</code></td>
<td>Capture from all interfaces; may require superuser (<code>sudo/su</code>)</td>
</tr>
<tr>
<td><code>-i eth0</code></td>
<td><code>tcpdump -i eth0</code></td>
<td>Capture from the interface <code>eth0</code></td>
</tr>
<tr>
<td><code>-c count</code></td>
<td><code>tcpdump -i eth0 -c 5</code></td>
<td>Exit after receiving <code>count (5)</code> packets</td>
</tr>
<tr>
<td><code>-r captures.pcap</code></td>
<td><code>tcpdump -i eth0 -r captures.pcap</code></td>
<td>Read and analyze saved capture file <code>captures.pcap</code></td>
</tr>
<tr>
<td><code>tcp</code></td>
<td><code>tcpdump -i eth0 tcp</code></td>
<td>Show TCP packets only</td>
</tr>
<tr>
<td><code>udp</code></td>
<td><code>tcpdump -i eth0 udp</code></td>
<td>Show UDP packets only</td>
</tr>
<tr>
<td><code>icmp</code></td>
<td><code>tcpdump -i eth0 icmp</code></td>
<td>Show ICMP packets only</td>
</tr>
<tr>
<td><code>ip</code></td>
<td><code>tcpdump -i eth0 ip</code></td>
<td>Show IPv4 packets only</td>
</tr>
<tr>
<td><code>ip6</code></td>
<td><code>tcpdump -i eth0 ip6</code></td>
<td>Show IPv6 packets only</td>
</tr>
<tr>
<td><code>arp</code></td>
<td><code>tcpdump -i eth0 arp</code></td>
<td>Show ARP packets only</td>
</tr>
<tr>
<td><code>rarp</code></td>
<td><code>tcpdump -i eth0 rarp</code></td>
<td>Show RARP packets only</td>
</tr>
<tr>
<td><code>slip</code></td>
<td><code>tcpdump -i eth0 slip</code></td>
<td>Show SLIP packets only</td>
</tr>
<tr>
<td><code>-I</code></td>
<td><code>tcpdump -i eth0 -I</code></td>
<td>Set interface as monitor mode</td>
</tr>
<tr>
<td><code>-K</code></td>
<td><code>tcpdump -i eth0 -K</code></td>
<td>Don’t verify checksum</td>
</tr>
<tr>
<td><code>-p</code></td>
<td><code>tcpdump -i eth0 -p</code></td>
<td>Don’t capture in promiscuous mode</td>
</tr>
</tbody></table>
<h3 id="Filter-Commands"><a href="#Filter-Commands" class="headerlink" title="Filter Commands"></a>Filter Commands</h3><table>
<thead>
<tr>
<th>Filter expression</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td><code>src host 127.0.0.1</code></td>
<td>Filter by source IP&#x2F;hostname <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>dst host 127.0.0.1</code></td>
<td>Filter by destination IP&#x2F;hostname <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>host 127.0.0.1</code></td>
<td>Filter by source or destination &#x3D; <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>ether src 01:23:45:AB:CD:EF</code></td>
<td>Filter by source MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr>
<td><code>ether dst 01:23:45:AB:CD:EF</code></td>
<td>Filter by destination MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr>
<td><code>ether host 01:23:45:AB:CD:EF</code></td>
<td>Filter by source or destination MAC <code>01:23:45:AB:CD:EF</code></td>
</tr>
<tr>
<td><code>src net 127.0.0.1</code></td>
<td>Filter by source network location <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>dst net 127.0.0.1</code></td>
<td>Filter by destination network location <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>net 127.0.0.1</code></td>
<td>Filter by source or destination network location <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>net 127.0.0.1/24</code></td>
<td>Filter by source or destination network location <code>127.0.0.1</code> with the tcpdump subnet mask of length <code>24</code></td>
</tr>
<tr>
<td><code>src port 80</code></td>
<td>Filter by source port &#x3D; 80</td>
</tr>
<tr>
<td><code>dst port 80</code></td>
<td>Filter by destination port &#x3D; 80</td>
</tr>
<tr>
<td><code>port 80</code></td>
<td>Filter by source or destination port &#x3D; 80</td>
</tr>
<tr>
<td><code>src portrange 80-400</code></td>
<td>Filter by source port value between 80 and 400</td>
</tr>
<tr>
<td><code>dst portrange 80-400</code></td>
<td>Filter by destination port value between 80 and 400</td>
</tr>
<tr>
<td><code>portrange 80-400</code></td>
<td>Filter by source or destination port value between 80 and 400</td>
</tr>
<tr>
<td><code>ether broadcast</code></td>
<td>Filter for Ethernet broadcasts</td>
</tr>
<tr>
<td><code>ip broadcast</code></td>
<td>Filter for IPv4 broadcasts</td>
</tr>
<tr>
<td><code>ether multicast</code></td>
<td>Filter for Ethernet multicasts</td>
</tr>
<tr>
<td><code>ip multicast</code></td>
<td>Filter for IPv4 multicasts</td>
</tr>
<tr>
<td><code>ip6 multicast</code></td>
<td>Filter for IPv6 multicasts</td>
</tr>
<tr>
<td><code>ip src host mydevice</code></td>
<td>Filter by IPv4 source hostname <code>mydevice</code></td>
</tr>
<tr>
<td><code>arp dst host mycar</code></td>
<td>Filter by ARP destination hostname <code>mycar</code></td>
</tr>
<tr>
<td><code>rarp src host 127.0.0.1</code></td>
<td>Filter by RARP source <code>127.0.0.1</code></td>
</tr>
<tr>
<td><code>ip6 dst host mywatch</code></td>
<td>Filter by IPv6 destination hostname <code>mywatch</code></td>
</tr>
<tr>
<td><code>tcp dst port 8000</code></td>
<td>Filter by destination TCP port &#x3D; 8000</td>
</tr>
<tr>
<td><code>udp src portrange 1000-2000</code></td>
<td>Filter by source TCP ports in 1000–2000</td>
</tr>
<tr>
<td><code>sctp port 22</code></td>
<td>Filter by source or destination port &#x3D; 22</td>
</tr>
</tbody></table>
<h3 id="Display-Commands"><a href="#Display-Commands" class="headerlink" title="Display Commands"></a>Display Commands</h3><table>
<thead>
<tr>
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td><code>tcpdump -i eth0 -A</code></td>
<td>Print each packet (minus its link level header) in ASCII. Handy for capturing web pages.  <br>  <br>[![Screenshot with ASCII (sudo tcpdump twitter)</td>
</tr>
<tr>
<td><code>tcpdump -D</code></td>
<td>Print the list of the network interfaces available on the system and on which tcpdump can capture packets.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -e</code></td>
<td>Print the link-level header on each output line, such as MAC layer addresses for protocols such as Ethernet and IEEE 802.11.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -F /path/to/params.conf</code></td>
<td>Use the file <code>params.conf</code> as input for the [filter expression](### Filter Commands). (Ignore other expressions on the command line.)</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -n</code></td>
<td>Don’t convert addresses (i.e., host addresses, port numbers, etc.) to names.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -S</code></td>
<td>Print absolute, rather than relative, TCP sequence numbers. (Absolute TCP sequence numbers are longer.)</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 --time-stamp-precision=nano</code></td>
<td>When capturing, set the timestamp precision for the capture to <code>tsp</code>:  <br>• <code>micro</code> for microsecond (default)  <br>• <code>nano</code> for nanosecond.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -t</code></td>
<td>Omit the timestamp on each output line.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -tt</code></td>
<td>Print the timestamp, as seconds since January 1, 1970, 00:00:00, UTC, and fractions of a second since that time, on each dump line.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -ttt</code></td>
<td>Print a delta (microsecond or nanosecond resolution depending on the <code>--time-stamp-precision</code> option) between the current and previous line on each output line. The default is microsecond resolution.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -tttt</code></td>
<td>Print a timestamp as hours, minutes, seconds, and fractions of a second since midnight, preceded by the date, on each dump line.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -ttttt</code></td>
<td>Print a delta (microsecond or nanosecond resolution depending on the <code>--time-stamp-precision</code> option) between the current and first line on each dump line. The default is microsecond resolution.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -u</code></td>
<td>Print undecoded network file system (NFS) handles.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -v</code></td>
<td>Produce verbose output.  <br>When writing to a file (<code>-w</code> option) and at the same time not reading from a file (<code>-r</code> option), report to standard error, once per second, the number of packets captured.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -vv</code></td>
<td>Additional verbose output than <code>-v</code></td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -vvv</code></td>
<td>Additional verbose output than <code>-vv</code></td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -x</code></td>
<td>Print the headers and data of each packet (minus its link level header) in hex.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -xx</code></td>
<td>Print the headers and data of each packet, including its link level header, in hex.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -X</code></td>
<td>Print the headers and data of each packet (minus its link level header) in hex and ASCII.</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -XX</code></td>
<td>Print the headers and data of each packet, including its link level header, in hex and ASCII.</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="Output-Commands"><a href="#Output-Commands" class="headerlink" title="Output Commands"></a>Output Commands</h3><table>
<thead>
<tr>
<th>Command</th>
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td><code>-w captures.pcap</code></td>
<td><code>tcpdump -i eth0 -w captures.pcap</code></td>
<td>Output capture to a file <code>captures.pcap</code></td>
</tr>
<tr>
<td><code>-d</code></td>
<td><code>tcpdump -i eth0 -d</code></td>
<td>Display human-readable form in standard output</td>
</tr>
<tr>
<td><code>-L</code></td>
<td><code>tcpdump -i eth0 -L</code></td>
<td>Display data link types for the interface</td>
</tr>
<tr>
<td><code>-q</code></td>
<td><code>tcpdump -i eth0 -q</code></td>
<td>Quick&#x2F;quiet output. Print less protocol information, so output lines are shorter.</td>
</tr>
<tr>
<td><code>-U</code></td>
<td><code>tcpdump -i eth0 -U -w out.pcap</code></td>
<td><strong>Without -w option</strong>  <br>Print a description of each packet’s contents.  <br><strong>With -w option</strong>  <br>Write each packet to the output file <code>out.pcap</code> in real time rather than only when the output buffer fills.</td>
</tr>
</tbody></table>
<h3 id="Miscellaneous-Commands"><a href="#Miscellaneous-Commands" class="headerlink" title="Miscellaneous Commands"></a>Miscellaneous Commands</h3><table>
<thead>
<tr>
<th>Operator</th>
<th>Syntax</th>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>AND</code></td>
<td><code>and, &amp;&amp;</code></td>
<td><code>tcpdump -n src 127.0.0.1 and dst port 21</code></td>
<td>Combine filtering options joined by “and”</td>
</tr>
<tr>
<td><code>OR</code></td>
<td><code>or, |</code></td>
<td><code>tcpdump dst 127.0.0.1 or src port 22</code></td>
<td>Match any of the conditions joined by “or”</td>
</tr>
<tr>
<td><code>EXCEPT</code></td>
<td><code>not, !</code></td>
<td><code>tcpdump dst 127.0.0.1 and not icmp</code></td>
<td>Negate the condition prefixed by “not”</td>
</tr>
<tr>
<td><code>LESS</code></td>
<td><code>less, &lt;, (&lt;=)</code></td>
<td><code>tcpdump dst host 127.0.0.1 and less 128</code></td>
<td>Shows packets shorter than (or equal to) 128 bytes in length.  <br>&lt; only applies to length 32, i.e., <code>&lt;32</code>.</td>
</tr>
<tr>
<td><code>GREATER</code></td>
<td><code>greater, &gt;, (&gt;=)</code></td>
<td><code>tcpdump dst host 127.0.0.1 and greater 64</code></td>
<td>Shows packets longer than (or equal to) 64 bytes in length.  <br>&gt; only applies to length 32, i.e., <code>&gt;32</code>.</td>
</tr>
<tr>
<td><code>EQUAL</code></td>
<td><code>=, ==</code></td>
<td><code>tcpdump host 127.0.0.1 = 0</code></td>
<td>Show packets with zero length</td>
</tr>
</tbody></table>
<h3 id="Example-Usage"><a href="#Example-Usage" class="headerlink" title="Example Usage"></a>Example Usage</h3><table>
<thead>
<tr>
<th>Example</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td><code>tcpdump -r outfile.pcap src host 10.0.2.15</code></td>
<td>Print all packets in the file <code>outfile.pcap</code> coming from the host with IP address 10.0.2.15</td>
</tr>
<tr>
<td><code>tcpdump -i any ip and not tcp port 80</code></td>
<td>Listen for non-HTTP packets (which have TCP port number 80) on any network interface</td>
</tr>
<tr>
<td><code>tcpdump -i eth0 -n &gt;32 -w pv01.pcap -c 30</code></td>
<td>Save 30 packets of length exceeding 32 bytes to <code>captures.pcap</code> without DNS resolution on the <code>eth0</code> network interface</td>
</tr>
<tr>
<td><code>tcpdump -AtuvX icmp</code></td>
<td>Capture ICMP traffic and print ICMP packets in hex and ASCII and the following features:  <br>With:  <br>• headers  <br>• data  <br>• undecoded NFS handles  <br>Without:  <br>• link level headers  <br>• timestamps.</td>
</tr>
<tr>
<td><code>tcpdump &#39;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#39;</code></td>
<td>Print all IPv4 HTTP packets to and from port 80, i.e. print only packets that contain data, not, for example, SYN and FIN packets and ACK-only packets.</td>
</tr>
</tbody></table>
<h1 id="参考-搬运"><a href="#参考-搬运" class="headerlink" title="参考&#x2F;搬运"></a>参考&#x2F;搬运</h1><ul>
<li><a target="_blank" rel="noopener" href="https://debugging.works/blog/network-debugging/">https://debugging.works/blog/network-debugging/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.stationx.net/tcpdump-cheat-sheet/">https://www.stationx.net/tcpdump-cheat-sheet/</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/10/Linux%20Debug/bpftrace%E6%8A%80%E6%9C%AF1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/10/Linux%20Debug/bpftrace%E6%8A%80%E6%9C%AF1-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">bpftrace技术1-常用命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+00:00">2025-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="bpftrace是什么"><a href="#bpftrace是什么" class="headerlink" title="bpftrace是什么"></a>bpftrace是什么</h1><p>一种追踪内核态和用户态的新技术</p>
<h1 id="看可以跟踪哪些内核函数"><a href="#看可以跟踪哪些内核函数" class="headerlink" title="看可以跟踪哪些内核函数"></a>看可以跟踪哪些内核函数</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -l | grep kprobe</span><br></pre></td></tr></table></figure>

<h1 id="跟踪内核函数例子"><a href="#跟踪内核函数例子" class="headerlink" title="跟踪内核函数例子"></a>跟踪内核函数例子</h1><h2 id="是否调用"><a href="#是否调用" class="headerlink" title="是否调用"></a>是否调用</h2><p>跟踪 <code>net/ipv4/netfilter/ip_tables.c looks promising</code> 的两个函数: <code>compat_do_ipt_get_ctl</code> 和 <code>do_ipt_get_ctl</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">~# </span><span class="language-bash">bpftrace -e <span class="string">&#x27;kprobe:do_ipt_get_ctl &#123; printf(&quot;function was called!\n&quot;); &#125;&#x27;</span></span></span><br><span class="line">Attaching 1 probe...</span><br><span class="line">function was called!</span><br><span class="line">function was called!</span><br></pre></td></tr></table></figure>

<p><code>compat_do_ipt_get_ctl</code> 函数签名如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">compat_do_ipt_get_ctl</span><span class="params">(<span class="keyword">struct</span> sock *sk, <span class="type">int</span> cmd, <span class="type">void</span> __user *user, <span class="type">int</span> *len)</span></span><br></pre></td></tr></table></figure>

<h2 id="调用命令，pid，入参"><a href="#调用命令，pid，入参" class="headerlink" title="调用命令，pid，入参"></a>调用命令，pid，入参</h2><p>建立<code>test.bpf</code>文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;net/sock.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">kprobe:do_ipt_get_ctl</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;called by %s (pid: %d). and: %d\n&quot;</span>, comm, pid, ((sock *)arg0)-&gt;__sk_common.skc_family);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~<span class="meta"># bpftrace test.bpf</span></span><br><span class="line">/bpftrace/include/stdarg.h:<span class="number">52</span>:<span class="number">1</span>: warning: null character ignored [-Wnull-character]       </span><br><span class="line">/lib/modules/<span class="number">4.19</span>.<span class="number">0</span><span class="number">-8</span>-amd64/source/arch/x86/include/<span class="keyword">asm</span>/bitops.h:<span class="number">209</span>:<span class="number">2</span>: error: <span class="string">&#x27;asm goto&#x27;</span> constructs are not supported yet</span><br><span class="line">/lib/modules/<span class="number">4.19</span>.<span class="number">0</span><span class="number">-8</span>-amd64/source/arch/x86/include/<span class="keyword">asm</span>/bitops.h:<span class="number">256</span>:<span class="number">2</span>: error: <span class="string">&#x27;asm goto&#x27;</span> constructs are not supported yet</span><br><span class="line">/lib/modules/<span class="number">4.19</span>.<span class="number">0</span><span class="number">-8</span>-amd64/source/arch/x86/include/<span class="keyword">asm</span>/bitops.h:<span class="number">310</span>:<span class="number">2</span>: error: <span class="string">&#x27;asm goto&#x27;</span> constructs are not supported yet</span><br><span class="line">/lib/modules/<span class="number">4.19</span>.<span class="number">0</span><span class="number">-8</span>-amd64/source/arch/x86/include/<span class="keyword">asm</span>/jump_label.h:<span class="number">23</span>:<span class="number">2</span>: error: <span class="string">&#x27;asm goto&#x27;</span> constructs are not supported yet</span><br><span class="line">/lib/modules/<span class="number">4.19</span>.<span class="number">0</span><span class="number">-8</span>-amd64/source/arch/x86/include/<span class="keyword">asm</span>/signal.h:<span class="number">24</span>:<span class="number">2</span>: note: <span class="built_in">array</span> <span class="string">&#x27;sig&#x27;</span> declared here</span><br><span class="line">Attaching <span class="number">1</span> probe...</span><br><span class="line">called by iptables-legacy (pid: <span class="number">2981</span>). and: <span class="number">2</span></span><br><span class="line">called by iptables-legacy (pid: <span class="number">2981</span>). and: <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p> <code>2</code> 的含义解释如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/usr/src/linux-headers<span class="number">-4.19</span>.<span class="number">0</span><span class="number">-8</span>-common/include/linux/socket.h</span><br><span class="line"><span class="number">160</span> <span class="comment">/* Supported address families. */</span></span><br><span class="line"><span class="number">161</span> <span class="meta">#<span class="keyword">define</span> AF_UNSPEC   0</span></span><br><span class="line"><span class="number">162</span> <span class="meta">#<span class="keyword">define</span> AF_UNIX     1   <span class="comment">/* Unix domain sockets      */</span></span></span><br><span class="line"><span class="number">163</span> <span class="meta">#<span class="keyword">define</span> AF_LOCAL    1   <span class="comment">/* POSIX name for AF_UNIX   */</span></span></span><br><span class="line"><span class="number">164</span> <span class="meta">#<span class="keyword">define</span> AF_INET     2   <span class="comment">/* Internet IP Protocol     */</span></span></span><br><span class="line"><span class="number">165</span> <span class="meta">#<span class="keyword">define</span> AF_AX25     3   <span class="comment">/* Amateur Radio AX.25      */</span></span></span><br><span class="line"><span class="number">166</span> <span class="meta">#<span class="keyword">define</span> AF_IPX      4   <span class="comment">/* Novell IPX           */</span></span></span><br></pre></td></tr></table></figure>

<h2 id="打印入参"><a href="#打印入参" class="headerlink" title="打印入参"></a>打印入参</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;kprobe:vfs_open &#123; printf(&quot;open path: %s\n&quot;, str(((path *)arg0)-&gt;dentry-&gt;d_name.name)); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="打印返回值"><a href="#打印返回值" class="headerlink" title="打印返回值"></a>打印返回值</h2><p>使用默认变量<code>retval</code>。</p>
<h3 id="内核函数返回值"><a href="#内核函数返回值" class="headerlink" title="内核函数返回值"></a>内核函数返回值</h3><p>使用 <code>kretprobe</code>跟踪内核函数的返回值。例如，跟踪 <code>vfs_read</code>的返回值（读取的字节数或错误码）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;kretprobe:vfs_read &#123; printf(&quot;vfs_read returned: %d\n&quot;, retval); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="用户空间函数返回值"><a href="#用户空间函数返回值" class="headerlink" title="用户空间函数返回值"></a>用户空间函数返回值</h3><p>使用 <code>uretprobe</code>跟踪用户空间函数的返回值。例如，跟踪一个名为 <code>myfunc</code>的函数的返回值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;uretprobe:/path/to/binary:myfunc &#123; printf(&quot;myfunc returned: %d\n&quot;, retval); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="结合入口和返回探针"><a href="#结合入口和返回探针" class="headerlink" title="结合入口和返回探针"></a>结合入口和返回探针</h3><p>测量函数执行时间或关联参数与返回值。这可以通过在函数入口（如 <code>kprobe</code>&#x2F;<code>uprobe</code>）记录时间戳（<code>tid</code>是内置变量，代表线程id），然后在返回探针中计算差值来实现。例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;kprobe:vfs_read &#123; @start[tid] = nsecs; &#125; </span></span><br><span class="line"><span class="string">                kretprobe:vfs_read /@start[tid]/ &#123; </span></span><br><span class="line"><span class="string">                    $duration = nsecs - @start[tid]; </span></span><br><span class="line"><span class="string">                    printf(&quot;vfs_read took %d ns, returned %d\n&quot;, $duration, retval); </span></span><br><span class="line"><span class="string">                    delete(@start[tid]); </span></span><br><span class="line"><span class="string">                &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤条件"><a href="#过滤条件" class="headerlink" title="过滤条件"></a>过滤条件</h3><p>可以在返回探针上添加过滤条件，例如只处理特定进程或返回值范围的调用。使用 <code>/&lt;filter&gt;/</code>语法。例如，只打印返回值大于0的 <code>vfs_read</code>调用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;kretprobe:vfs_read /retval &gt; 0/ &#123; printf(&quot;vfs_read returned: %d\n&quot;, retval); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://dushenda.github.io/2025/12/10/Linux%20Debug/bpftrace%E6%8A%80%E6%9C%AF2-map%E5%8F%98%E9%87%8F%E5%92%8Cmap%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="dushenda">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dushenda">
      <meta itemprop="description" content="雄关漫道真如铁，而今迈步从头越">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | dushenda">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/10/Linux%20Debug/bpftrace%E6%8A%80%E6%9C%AF2-map%E5%8F%98%E9%87%8F%E5%92%8Cmap%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">bpftrace技术2-map变量和map函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-12-10T00:00:00+00:00">2025-12-10</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Map-的核心概念与用途"><a href="#Map-的核心概念与用途" class="headerlink" title="Map 的核心概念与用途"></a>Map 的核心概念与用途</h1><p>在 bpftrace 中，符号 <code>@</code>用于定义和操作 <strong>Map 变量</strong>（或称映射变量）。这是 bpftrace 实现高效数据聚合的核心机制，你可以把它理解为一个在内核中运行的、功能强大的<strong>迷你数据库</strong></p>
<p>Map 的主要作用是在不同的事件探针（probe）之间<strong>存储、共享和聚合数据</strong>。当某个事件触发时，你可以将数据记录到 Map 中；当另一个相关事件触发时，再从中读取或更新数据。这使得实现复杂的追踪逻辑成为可能。</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>数据持久化</strong>​</td>
<td>Map 中的数据在多个探针事件之间保持存在，不像普通变量那样每次事件触发后就被重置。（全局变量）</td>
</tr>
<tr>
<td><strong>键值对结构</strong>​</td>
<td>Map 使用键（key）来索引值（value），格式为 <code>@map_name[key] = value</code>。键可以是单一值，也可以是多个值的组合（如 <code>@a[pid, comm]</code>）。kv结构</td>
</tr>
<tr>
<td><strong>自动输出</strong>​</td>
<td>默认情况下，当 bpftrace 程序退出时（例如你按下 <code>Ctrl-C</code>），所有非空的 Map 内容会自动打印到屏幕上。</td>
</tr>
</tbody></table>
<h1 id="Map-的常见操作与示例"><a href="#Map-的常见操作与示例" class="headerlink" title="Map 的常见操作与示例"></a>Map 的常见操作与示例</h1><table>
<thead>
<tr>
<th>操作&#x2F;函数</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><strong>赋值</strong>​</td>
<td>直接给 Map 赋值。</td>
<td><code>@start_time[tid] = nsecs</code>(记录线程的开始时间)</td>
</tr>
<tr>
<td>**计数 (<code>count()</code>)**​</td>
<td>统计事件发生的次数。</td>
<td><code>@syscall_count[comm] = count()</code>(统计每个进程名的系统调用次数)</td>
</tr>
<tr>
<td>**求和 (<code>sum()</code>)**​</td>
<td>对数值进行累加。</td>
<td><code>@total_bytes[pid] = sum(args-&gt;ret)</code>(累计每个进程读取的总字节数)</td>
</tr>
<tr>
<td>**统计 (<code>avg()</code>, <code>min()</code>, <code>max()</code>)**​</td>
<td>计算平均值、最小值、最大值。</td>
<td><code>@response_time = avg($latency)</code></td>
</tr>
<tr>
<td>**直方图 (<code>hist()</code>)**​</td>
<td><strong>非常实用</strong>，生成2的幂次方的直方图，直观展示数据分布。</td>
<td><code>@latency_ns = hist(nsecs - @start[tid])</code>(可视化读操作的延迟分布)</td>
</tr>
<tr>
<td>**线性直方图 (<code>lhist()</code>)**​</td>
<td>生成自定义区间的线性直方图。</td>
<td><code>@read_sizes = lhist(args-&gt;ret, 0, 10000, 1000)</code>(统计读取大小的分布)</td>
</tr>
<tr>
<td>**数据清理 (<code>delete()</code>)**​</td>
<td>从 Map 中删除特定的键值对，防止内存无限增长。</td>
<td><code>delete(@start_time[tid])</code>(在处理完一个事件后清理对应的开始时间)</td>
</tr>
</tbody></table>
<h1 id="与其他变量的区别"><a href="#与其他变量的区别" class="headerlink" title="与其他变量的区别"></a>与其他变量的区别</h1><table>
<thead>
<tr>
<th>变量类型</th>
<th>前缀</th>
<th>作用域与用途</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Map 变量</strong>​</td>
<td><code>@</code></td>
<td><strong>全局</strong>。用于在探针之间持久化存储和聚合数据。</td>
</tr>
<tr>
<td><strong>内置变量</strong>​</td>
<td>无</td>
<td><strong>只读</strong>。提供事件上下文信息，如 <code>pid</code>(进程ID)、<code>comm</code>(命令名)、<code>retval</code>(函数返回值)等。</td>
</tr>
<tr>
<td><strong>暂存变量</strong>​</td>
<td><code>$</code></td>
<td><strong>局部临时</strong>。用于单次探针触发过程中的中间计算，例如 <code>$duration = nsecs - @start[tid]</code>。</td>
</tr>
</tbody></table>
<h1 id="map函数参考表"><a href="#map函数参考表" class="headerlink" title="map函数参考表"></a>map函数参考表</h1><table>
<thead>
<tr>
<th>函数原型</th>
<th>核心作用与参数说明</th>
<th>典型应用场景</th>
</tr>
</thead>
<tbody><tr>
<td>**<code>count()</code>**​</td>
<td><strong>计数</strong>。统计事件被触发的次数。无参数。</td>
<td>统计系统调用次数、函数调用次数等。</td>
</tr>
<tr>
<td>**<code>sum(int n)</code>**​</td>
<td><strong>求和</strong>。对参数 <code>n</code>的值进行累加。</td>
<td>计算总的字节读写量、总耗时等。</td>
</tr>
<tr>
<td>**<code>avg(int n)</code>**​</td>
<td><strong>求平均值</strong>。计算参数 <code>n</code>的平均值。</td>
<td>计算平均延迟、平均数据包大小等。</td>
</tr>
<tr>
<td>**<code>min(int n)</code>**​</td>
<td><strong>求最小值</strong>。记录参数 <code>n</code>的最小值。</td>
<td>追踪最小延迟、最小数据块大小。</td>
</tr>
<tr>
<td>**<code>max(int n)</code>**​</td>
<td><strong>求最大值</strong>。记录参数 <code>n</code>的最大值。</td>
<td>追踪最大延迟、最大数据块大小。</td>
</tr>
<tr>
<td>**<code>stats(int n)</code>**​</td>
<td><strong>统计摘要</strong>。返回参数 <code>n</code>的计数、平均值、总和、最小值、最大值。</td>
<td>获取一个指标的全面统计信息。</td>
</tr>
<tr>
<td>**<code>hist(int n)</code>**​</td>
<td><strong>对数直方图</strong>。按2的幂次方区间（如 <code>[4-8)</code>, <code>[8-16)</code>）展示参数 <code>n</code>的分布。</td>
<td>直观展示延迟、数据大小的分布情况，易于发现模式。</td>
</tr>
<tr>
<td>**<code>lhist(int n, int min, int max, int step)</code>**​</td>
<td><strong>线性直方图</strong>。在指定的线性区间（<code>min</code>到<code>max</code>，步长为<code>step</code>）内展示参数 <code>n</code>的分布。</td>
<td>当需要自定义固定区间进行分析时使用。</td>
</tr>
<tr>
<td>**<code>delete(@m[key])</code>**​</td>
<td><strong>删除键值对</strong>。从 Map <code>@m</code>中删除指定的 <code>key</code>及其对应的值。</td>
<td>清理临时数据，防止 Map 无限增长，常用于配对探针（如 kprobe&#x2F;kretprobe）。</td>
</tr>
<tr>
<td>**<code>clear(@m)</code>**​</td>
<td><strong>清空 Map</strong>。清除 Map <code>@m</code>中的所有键值对。</td>
<td>在定时器（如 <code>interval</code>）中定期重置统计。</td>
</tr>
<tr>
<td>**<code>zero(@m)</code>**​</td>
<td><strong>归零 Map</strong>。将 Map <code>@m</code>中所有键的值重置为 0。</td>
<td>重置计数或求和等数据，但保留键的结构。</td>
</tr>
</tbody></table>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><h2 id="count-统计系统调用次数"><a href="#count-统计系统调用次数" class="headerlink" title="count()- 统计系统调用次数"></a>count()- 统计系统调用次数</h2><p>统计每个进程调用的系统调用次数</p>
<p><code>bpftrace -e &#39;tracepoint:raw_syscalls:sys_enter { @[comm] = count(); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@count[bash]: 15</span><br><span class="line">@count[sshd]: 28</span><br><span class="line">@count[snmpd]: 102</span><br></pre></td></tr></table></figure>

<ul>
<li>@[comm]：以进程名 comm为键（key）。</li>
<li>count()：每次事件触发，对应键的值加 1</li>
</ul>
<h2 id="sum-int-n-计算读取的总字节数"><a href="#sum-int-n-计算读取的总字节数" class="headerlink" title="sum(int n)- 计算读取的总字节数"></a>sum(int n)- 计算读取的总字节数</h2><p>累计所有进程通过 read 系统调用成功读取的字节数</p>
<p><code>bpftrace -e &#39;tracepoint:syscalls:sys_exit_read /args-&gt;ret &gt; 0/ { @bytes = sum(args-&gt;ret); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@bytes: 1048576</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2F;args-&gt;ret &gt; 0&#x2F;：过滤器，只处理成功读取（返回值大于0）的情况。</li>
<li>sum(args-&gt;ret)：对返回值（读取的字节数）进行累加</li>
</ul>
<h2 id="avg-int-n-计算平均读取大小"><a href="#avg-int-n-计算平均读取大小" class="headerlink" title="avg(int n)- 计算平均读取大小"></a>avg(int n)- 计算平均读取大小</h2><p>计算每次 <code>read</code>系统调用成功读取的平均字节数。</p>
<p><code>bpftrace -e &#39;tracepoint:syscalls:sys_exit_read /args-&gt;ret &gt; 0/ { @avg_size = avg(args-&gt;ret); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@avg_size: 512</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2F;args-&gt;ret &gt; 0&#x2F;：过滤器，只处理成功读取（返回值大于0）的情况。</li>
<li>avg(args-&gt;ret)：对返回值（读取的字节数）求平均</li>
</ul>
<h2 id="stats-int-n-获取完整的统计摘要"><a href="#stats-int-n-获取完整的统计摘要" class="headerlink" title="stats(int n)- 获取完整的统计摘要"></a>stats(int n)- 获取完整的统计摘要</h2><p>对 <code>read</code>系统调用的返回值进行全面的统计。</p>
<p><code>bpftrace -e &#39;tracepoint:syscalls:sys_exit_read /args-&gt;ret &gt; 0/ { @s = stats(args-&gt;ret); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@s: count 100, average 4096, total 409600, min 1, max 8192</span><br></pre></td></tr></table></figure>

<ul>
<li>&#x2F;args-&gt;ret &gt; 0&#x2F;：过滤器，只处理成功读取（返回值大于0）的情况。</li>
<li>stats(args-&gt;ret)：求调用次数，对返回值（读取的字节数）求平均，求总数，求最大最小值</li>
</ul>
<h2 id="hist-int-n-分析读取字节数的对数分布"><a href="#hist-int-n-分析读取字节数的对数分布" class="headerlink" title="hist(int n)- 分析读取字节数的对数分布"></a>hist(int n)- 分析读取字节数的对数分布</h2><p>显示 <code>read</code>系统调用返回值的分布，区间按2的幂次方划分。</p>
<p><code>bpftrace -e &#39;tracepoint:syscalls:sys_exit_read { @bytes = hist(args-&gt;ret); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@bytes:</span><br><span class="line">[0, 1]                12 |@@@@@@@@@@@@@@@@@@@@                                |</span><br><span class="line">[2, 4)                18 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                     |</span><br><span class="line">[4, 8)                 0 |                                                    |</span><br><span class="line">...</span><br><span class="line">[128, 256)             1 |@</span><br></pre></td></tr></table></figure>

<ul>
<li>hist(args-&gt;ret)：分为2^x ~2^y 大小的桶，统计每个桶的里面的数目个数</li>
</ul>
<h2 id="lhist-int-n-int-min-int-max-int-step-分析读取字节数的线性分布"><a href="#lhist-int-n-int-min-int-max-int-step-分析读取字节数的线性分布" class="headerlink" title="lhist(int n, int min, int max, int step)- 分析读取字节数的线性分布"></a>lhist(int n, int min, int max, int step)- 分析读取字节数的线性分布</h2><p>使用线性直方图统计 <code>read</code>返回值，范围从0到2000，步长为200。</p>
<p><code>bpftrace -e &#39;tracepoint:syscalls:sys_exit_read { @bytes = lhist(args-&gt;ret, 0, 2000, 200); }&#39;</code></p>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@bytes:</span><br><span class="line">(..., 0)                0 |                                                    |</span><br><span class="line">[0, 200)              66 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|</span><br><span class="line">[200, 400)             2 |@                                                   |</span><br><span class="line">...</span><br><span class="line">[2000, ...)            39 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                      |</span><br></pre></td></tr></table></figure>

<ul>
<li>hist(args-&gt;ret)：分为0-200区间桶，统计每个桶的里面的数目个数</li>
</ul>
<h2 id="delete-m-key-清理临时数据"><a href="#delete-m-key-清理临时数据" class="headerlink" title="delete(@m[key])- 清理临时数据"></a>delete(@m[key])- 清理临时数据</h2><p>在计算函数耗时后，删除用于存储开始时间的临时键，避免 Map 无限增长。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;kprobe:vfs_read </span></span><br><span class="line"><span class="string">			&#123; @start[tid] = nsecs; &#125; </span></span><br><span class="line"><span class="string">			   kretprobe:vfs_read /@start[tid]/ </span></span><br><span class="line"><span class="string">			   &#123; $duration_ns = nsecs - @start[tid]; </span></span><br><span class="line"><span class="string">				 @us = hist($duration_ns); </span></span><br><span class="line"><span class="string">			     delete(@start[tid]); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>此函数通常用于配对操作的探针（如 <code>kprobe</code>和 <code>kretprobe</code>），在操作完成后及时清理资源</li>
</ul>
<h2 id="clear-m-和-zero-m-重置-Map"><a href="#clear-m-和-zero-m-重置-Map" class="headerlink" title="clear(@m)和 zero(@m)- 重置 Map"></a>clear(@m)和 zero(@m)- 重置 Map</h2><p>每5秒打印并清空一次系统调用计数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:raw_syscalls:sys_enter &#123; @[comm] = count(); &#125; interval:s:5 &#123; print(@); clear(@); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@[Relay(89295)]: 3</span><br><span class="line">@[mini_init]: 4</span><br><span class="line">@[gmain]: 5</span><br><span class="line">@[Relay(909)]: 6</span><br><span class="line">@[Relay(893)]: 6</span><br><span class="line">@[systemd-udevd]: 37</span><br><span class="line">@[chronyd]: 40</span><br><span class="line">@[bpftrace]: 118</span><br></pre></td></tr></table></figure>

<ul>
<li><code>clear(@m)</code>会删除 Map 中的所有键值对。而 <code>zero(@m)</code>则将所有键的值重置为0，但保留键的结构</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bpftrace -e <span class="string">&#x27;tracepoint:raw_syscalls:sys_enter &#123; @[comm] = count(); &#125; interval:s:5 &#123; print(@); zero(@); &#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@[gmain]: 5</span><br><span class="line">@[Relay(893)]: 6</span><br><span class="line">@[Relay(909)]: 6</span><br><span class="line">@[Relay(89295)]: 9</span><br><span class="line">@[mini_init]: 12</span><br><span class="line">@[chronyd]: 44</span><br><span class="line">@[init]: 103</span><br><span class="line">@[bpftrace]: 114</span><br><span class="line">@[GnsPortTracker]: 242</span><br><span class="line">@[top]: 350</span><br><span class="line">@[grep]: 664</span><br><span class="line">@[sh]: 923</span><br><span class="line">@[Xwayland]: 1978</span><br><span class="line">@[ps]: 2778</span><br><span class="line">@[libuv-worker]: 4028</span><br><span class="line">@[ls]: 4256</span><br><span class="line">@[node]: 4722</span><br><span class="line">@[mini_init]: 0   &lt;---------主要看这个，明显没有调用，但是结构被保留下来了</span><br><span class="line">@[Relay(109)]: 3</span><br><span class="line">@[Relay(909)]: 6</span><br><span class="line">@[Relay(89295)]: 6</span><br><span class="line">@[Relay(893)]: 6</span><br></pre></td></tr></table></figure>

<h1 id="map特点"><a href="#map特点" class="headerlink" title="map特点"></a>map特点</h1><ul>
<li><strong>自动打印</strong>：默认情况下，当 bpftrace 程序终止时（例如用户按下 <code>Ctrl-C</code>），所有非空的 Map 变量会自动打印出来。</li>
<li><strong>过滤条件</strong>：使用 <code>/&lt;filter&gt;/</code>可以设置条件，只有满足条件时才会执行后面的动作，这能有效提升脚本效率和输出内容的针对性</li>
<li><strong>结合变量</strong>：Map 函数常与内置变量（如 <code>comm</code>, <code>pid</code>, <code>nsecs</code>）或临时变量（以 <code>$</code>开头）结合使用，以实现复杂的追踪逻辑</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dushenda</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/dushenda" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
